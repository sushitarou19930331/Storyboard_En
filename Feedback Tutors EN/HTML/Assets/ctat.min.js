/*
 MIT License - https://bitbucket.org/pellepim/jstimezonedetect/src/default/LICENCE.txt

 For usage and examples, visit:
 http://pellepim.bitbucket.org/jstz/

 Copyright (c) Jon Nylander
*/
var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,f,g){if(g.get||g.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[f]=g.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var f=0;return $jscomp.iteratorPrototype(function(){return f<a.length?{done:!1,value:a[f++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var f=a[Symbol.iterator];return f?f.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var f,g=[];!(f=a.next()).done;)g.push(f.value);return g};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};
$jscomp.checkStringArgs=function(a,f,g){if(null==a)throw new TypeError("The 'this' value for String.prototype."+g+" must not be null or undefined");if(f instanceof RegExp)throw new TypeError("First argument to String.prototype."+g+" must not be a regular expression");return a+""};
$jscomp.polyfill=function(a,f,g,e){if(f){g=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var c=a[e];c in g||(g[c]={});g=g[c]}a=a[a.length-1];e=g[a];f=f(e);f!=e&&null!=f&&$jscomp.defineProperty(g,a,{configurable:!0,writable:!0,value:f})}};
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(a,g){var e=$jscomp.checkStringArgs(this,a,"startsWith");a+="";var c=e.length,b=a.length;g=Math.max(0,Math.min(g|0,e.length));for(var d=0;d<b&&g<c;)if(e[g++]!=a[d++])return!1;return d>=b}},"es6-impl","es3");
$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(a,g){var e=$jscomp.checkStringArgs(this,a,"endsWith");a+="";void 0===g&&(g=e.length);g=Math.max(0,Math.min(g|0,e.length));for(var c=a.length;0<c&&0<g;)if(e[--g]!=a[--c])return!1;return 0>=c}},"es6-impl","es3");$jscomp.polyfill("Number.isNaN",function(a){return a?a:function(a){return"number"===typeof a&&isNaN(a)}},"es6-impl","es3");
$jscomp.polyfill("Number.isFinite",function(a){return a?a:function(a){return"number"!==typeof a?!1:!isNaN(a)&&Infinity!==a&&-Infinity!==a}},"es6-impl","es3");$jscomp.polyfill("Number.isInteger",function(a){return a?a:function(a){return Number.isFinite(a)?a===Math.floor(a):!1}},"es6-impl","es3");$jscomp.owns=function(a,f){return Object.prototype.hasOwnProperty.call(a,f)};
$jscomp.polyfill("WeakMap",function(a){function f(b){$jscomp.owns(b,e)||$jscomp.defineProperty(b,e,{value:{}})}function g(b){var d=Object[b];d&&(Object[b]=function(b){f(b);return d(b)})}if(function(){if(!a||!Object.seal)return!1;try{var b=Object.seal({}),c=Object.seal({}),e=new a([[b,2],[c,3]]);if(2!=e.get(b)||3!=e.get(c))return!1;e.delete(b);e.set(c,4);return!e.has(b)&&4==e.get(c)}catch(l){return!1}}())return a;var e="$jscomp_hidden_"+Math.random().toString().substring(2);g("freeze");g("preventExtensions");
g("seal");var c=0,b=function(b){this.id_=(c+=Math.random()+1).toString();if(b){$jscomp.initSymbol();$jscomp.initSymbolIterator();b=$jscomp.makeIterator(b);for(var d;!(d=b.next()).done;)d=d.value,this.set(d[0],d[1])}};b.prototype.set=function(b,c){f(b);if(!$jscomp.owns(b,e))throw Error("WeakMap key fail: "+b);b[e][this.id_]=c;return this};b.prototype.get=function(b){return $jscomp.owns(b,e)?b[e][this.id_]:void 0};b.prototype.has=function(b){return $jscomp.owns(b,e)&&$jscomp.owns(b[e],this.id_)};b.prototype.delete=
function(b){return $jscomp.owns(b,e)&&$jscomp.owns(b[e],this.id_)?delete b[e][this.id_]:!1};return b},"es6-impl","es3");$jscomp.ASSUME_NO_NATIVE_MAP=!1;
$jscomp.polyfill("Map",function(a){if(!$jscomp.ASSUME_NO_NATIVE_MAP&&function(){if(!a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),d=new a($jscomp.makeIterator([[b,"s"]]));if("s"!=d.get(b)||1!=d.size||d.get({x:4})||d.set({x:4},"t")!=d||2!=d.size)return!1;var c=d.entries(),e=c.next();if(e.done||e.value[0]!=b||"s"!=e.value[1])return!1;e=c.next();return e.done||4!=e.value[0].x||"t"!=e.value[1]||!c.next().done?!1:!0}catch(m){return!1}}())return a;$jscomp.initSymbol();
$jscomp.initSymbolIterator();var f=new WeakMap,g=function(d){this.data_={};this.head_=b();this.size=0;if(d){d=$jscomp.makeIterator(d);for(var c;!(c=d.next()).done;)c=c.value,this.set(c[0],c[1])}};g.prototype.set=function(b,d){var c=e(this,b);c.list||(c.list=this.data_[c.id]=[]);c.entry?c.entry.value=d:(c.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:b,value:d},c.list.push(c.entry),this.head_.previous.next=c.entry,this.head_.previous=c.entry,this.size++);return this};g.prototype.delete=
function(b){b=e(this,b);return b.entry&&b.list?(b.list.splice(b.index,1),b.list.length||delete this.data_[b.id],b.entry.previous.next=b.entry.next,b.entry.next.previous=b.entry.previous,b.entry.head=null,this.size--,!0):!1};g.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=b();this.size=0};g.prototype.has=function(b){return!!e(this,b).entry};g.prototype.get=function(b){return(b=e(this,b).entry)&&b.value};g.prototype.entries=function(){return c(this,function(b){return[b.key,
b.value]})};g.prototype.keys=function(){return c(this,function(b){return b.key})};g.prototype.values=function(){return c(this,function(b){return b.value})};g.prototype.forEach=function(b,d){for(var c=this.entries(),a;!(a=c.next()).done;)a=a.value,b.call(d,a[1],a[0],this)};g.prototype[Symbol.iterator]=g.prototype.entries;var e=function(b,c){var a;a=c&&typeof c;"object"==a||"function"==a?f.has(c)?a=f.get(c):(a=""+ ++d,f.set(c,a)):a="p_"+c;var e=b.data_[a];if(e&&$jscomp.owns(b.data_,a))for(b=0;b<e.length;b++){var g=
e[b];if(c!==c&&g.key!==g.key||c===g.key)return{id:a,list:e,index:b,entry:g}}return{id:a,list:e,index:-1,entry:void 0}},c=function(b,d){var c=b.head_;return $jscomp.iteratorPrototype(function(){if(c){for(;c.head!=b.head_;)c=c.previous;for(;c.next!=c.head;)return c=c.next,{done:!1,value:d(c)};c=null}return{done:!0,value:void 0}})},b=function(){var b={};return b.previous=b.next=b.head=b},d=0;return g},"es6-impl","es3");$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.polyfill("Set",function(a){if(!$jscomp.ASSUME_NO_NATIVE_SET&&function(){if(!a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var g=Object.seal({x:4}),e=new a($jscomp.makeIterator([g]));if(!e.has(g)||1!=e.size||e.add(g)!=e||1!=e.size||e.add({x:4})!=e||2!=e.size)return!1;var c=e.entries(),b=c.next();if(b.done||b.value[0]!=g||b.value[1]!=g)return!1;b=c.next();return b.done||b.value[0]==g||4!=b.value[0].x||b.value[1]!=b.value[0]?!1:c.next().done}catch(d){return!1}}())return a;
$jscomp.initSymbol();$jscomp.initSymbolIterator();var f=function(a){this.map_=new Map;if(a){a=$jscomp.makeIterator(a);for(var e;!(e=a.next()).done;)this.add(e.value)}this.size=this.map_.size};f.prototype.add=function(a){this.map_.set(a,a);this.size=this.map_.size;return this};f.prototype.delete=function(a){a=this.map_.delete(a);this.size=this.map_.size;return a};f.prototype.clear=function(){this.map_.clear();this.size=0};f.prototype.has=function(a){return this.map_.has(a)};f.prototype.entries=function(){return this.map_.entries()};
f.prototype.values=function(){return this.map_.values()};f.prototype[Symbol.iterator]=f.prototype.values;f.prototype.forEach=function(a,e){var c=this;this.map_.forEach(function(b){return a.call(e,b,b,c)})};return f},"es6-impl","es3");$jscomp.polyfill("Object.assign",function(a){return a?a:function(a,g){for(var e=1;e<arguments.length;e++){var c=arguments[e];if(c)for(var b in c)$jscomp.owns(c,b)&&(a[b]=c[b])}return a}},"es6-impl","es3");
$jscomp.findInternal=function(a,f,g){a instanceof String&&(a=String(a));for(var e=a.length,c=0;c<e;c++){var b=a[c];if(f.call(g,b,c,a))return{i:c,v:b}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,g){return $jscomp.findInternal(this,a,g).v}},"es6-impl","es3");$jscomp.array=$jscomp.array||{};
$jscomp.iteratorFromArray=function(a,f){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var g=0,e={next:function(){if(g<a.length){var c=g++;return{value:f(c,a[c]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6-impl","es3");
$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(a){var g=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var e="";a;)if(a&1&&(e+=g),a>>>=1)g+=g;return e}},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,g,e){var c=this.length||0;0>g&&(g=Math.max(0,c+g));if(null==e||e>c)e=c;e=Number(e);0>e&&(e=Math.max(0,c+e));for(g=Number(g||0);g<e;g++)this[g]=a;return this}},"es6-impl","es3");$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,g){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,g||0)}},"es6-impl","es3");
$jscomp.polyfill("Array.from",function(a){return a?a:function(a,g,e){$jscomp.initSymbolIterator();g=null!=g?g:function(b){return b};var c=[],b=a[Symbol.iterator];if("function"==typeof b)for(a=b.call(a);!(b=a.next()).done;)c.push(g.call(e,b.value));else for(var b=a.length,d=0;d<b;d++)c.push(g.call(e,a[d]));return c}},"es6-impl","es3");$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,g){return g})}},"es6","es3");
$jscomp.polyfill("Array.prototype.findIndex",function(a){return a?a:function(a,g){return $jscomp.findInternal(this,a,g).i}},"es6-impl","es3");$jscomp.polyfill("Object.setPrototypeOf",function(a){return a?a:"object"!=typeof"".__proto__?null:function(a,g){a.__proto__=g;if(a.__proto__!==g)throw new TypeError(a+" is not extensible");return a}},"es6","es5");$jscomp.polyfill("Math.sign",function(a){return a?a:function(a){a=Number(a);return 0===a||isNaN(a)?a:0<a?1:-1}},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.entries",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,g){return[a,g]})}},"es6-impl","es3");$jscomp.polyfill("Math.log10",function(a){return a?a:function(a){return Math.log(a)/Math.LN10}},"es6-impl","es3");$jscomp.polyfill("Number.MAX_SAFE_INTEGER",function(){return 9007199254740991},"es6-impl","es3");
$jscomp.polyfill("Number.isSafeInteger",function(a){return a?a:function(a){return Number.isInteger(a)&&Math.abs(a)<=Number.MAX_SAFE_INTEGER}},"es6-impl","es3");
var jstz=function(){var a={"America/Denver":["America/Mazatlan"],"Europe/London":["Africa/Casablanca"],"America/Chicago":["America/Mexico_City"],"America/Asuncion":["America/Campo_Grande","America/Santiago"],"America/Montevideo":["America/Sao_Paulo","America/Santiago"],"Asia/Beirut":"Asia/Amman Asia/Jerusalem Europe/Helsinki Asia/Damascus Africa/Cairo Asia/Gaza Europe/Minsk".split(" "),"Pacific/Auckland":["Pacific/Fiji"],"America/Los_Angeles":["America/Santa_Isabel"],"America/New_York":["America/Havana"],
"America/Halifax":["America/Goose_Bay"],"America/Godthab":["America/Miquelon"],"Asia/Dubai":["Asia/Yerevan"],"Asia/Jakarta":["Asia/Krasnoyarsk"],"Asia/Shanghai":["Asia/Irkutsk","Australia/Perth"],"Australia/Sydney":["Australia/Lord_Howe"],"Asia/Tokyo":["Asia/Yakutsk"],"Asia/Dhaka":["Asia/Omsk"],"Asia/Baku":["Asia/Yerevan"],"Australia/Brisbane":["Asia/Vladivostok"],"Pacific/Noumea":["Asia/Vladivostok"],"Pacific/Majuro":["Asia/Kamchatka","Pacific/Fiji"],"Pacific/Tongatapu":["Pacific/Apia"],"Asia/Baghdad":["Europe/Minsk",
"Europe/Moscow"],"Asia/Karachi":["Asia/Yekaterinburg"],"Africa/Johannesburg":["Asia/Gaza","Africa/Cairo"]},f=function(b){b=-b.getTimezoneOffset();return null!==b?b:0},g=function(){var b=f(new Date(2014,0,2)),d=f(new Date(2014,5,2)),c=b-d;return 0>c?b+",1":0<c?d+",1,s":b+",0"},e=function(){var b;if("undefined"!==typeof Intl&&"undefined"!==typeof Intl.DateTimeFormat&&(b=Intl.DateTimeFormat(),"undefined"!==typeof b&&"undefined"!==typeof b.resolvedOptions&&(b=b.resolvedOptions().timeZone)&&(-1<b.indexOf("/")||
"UTC"===b)))return b},c=function l(b,d,c){"undefined"===typeof d&&(d=864E5,c=36E5);var a=(new Date(b.getTime()-d)).getTime();b=b.getTime()+d;for(var e=(new Date(a)).getTimezoneOffset(),g=null;a<b-c;){var h=new Date(a);if(h.getTimezoneOffset()!==e){g=h;break}a+=c}return 864E5===d?l(g,36E5,6E4):36E5===d?l(g,6E4,1E3):g},b=function(b,d,c,a){if("N/A"!==c)return c;if("Asia/Beirut"===d){if("Africa/Cairo"===a.name&&13983768E5===b[6].s&&14116788E5===b[6].e||"Asia/Jerusalem"===a.name&&13959648E5===b[6].s&&
14118588E5===b[6].e)return 0}else if("America/Santiago"===d){if("America/Asuncion"===a.name&&14124816E5===b[6].s&&1397358E6===b[6].e||"America/Campo_Grande"===a.name&&14136912E5===b[6].s&&13925196E5===b[6].e)return 0}else if("America/Montevideo"===d){if("America/Sao_Paulo"===a.name&&14136876E5===b[6].s&&1392516E6===b[6].e)return 0}else if("Pacific/Auckland"===d&&"Pacific/Fiji"===a.name&&14142456E5===b[6].s&&13961016E5===b[6].e)return 0;return c},d=function(d,c){for(var e={},g=jstz.olson.dst_rules.zones,
h=g.length,f=a[c],l=0;l<h;l++){var B=g[l],p;p=g[l];for(var F=0,G=0;G<d.length;G++)if(p.rules[G]&&d[G]){if(d[G].s>=p.rules[G].s&&d[G].e<=p.rules[G].e)F=0,F+=Math.abs(d[G].s-p.rules[G].s),F+=Math.abs(p.rules[G].e-d[G].e);else{F="N/A";break}if(864E6<F){F="N/A";break}}p=F=b(d,c,F,p);"N/A"!==p&&(e[B.name]=p)}for(var H in e)if(e.hasOwnProperty(H))for(d=0;d<f.length;d++)if(f[d]===H)return H;return c},h=function(b){var a=function(){for(var b=[],d=0;d<jstz.olson.dst_rules.years.length;d++){var a;a=jstz.olson.dst_rules.years[d];
var e=(new Date(a,0,1,0,0,1,0)).getTime();a=(new Date(a,12,31,23,59,59)).getTime();for(var g=(new Date(e)).getTimezoneOffset(),h=null,f=null;e<a-864E5;){var l=new Date(e),p=l.getTimezoneOffset();p!==g&&(p<g&&(h=l),p>g&&(f=l),g=p);e+=864E5}a=h&&f?{s:c(h).getTime(),e:c(f).getTime()}:!1;b.push(a)}return b}();return function(b){for(var d=0;d<b.length;d++)if(!1!==b[d])return!0;return!1}(a)?d(a,b):b};return{determine:function(){var b=e();b||(b=jstz.olson.timezones[g()],"undefined"!==typeof a[b]&&(b=h(b)));
return{name:function(){return b}}}}}();jstz.olson=jstz.olson||{};
jstz.olson.timezones={"-720,0":"Etc/GMT+12","-660,0":"Pacific/Pago_Pago","-660,1,s":"Pacific/Apia","-600,1":"America/Adak","-600,0":"Pacific/Honolulu","-570,0":"Pacific/Marquesas","-540,0":"Pacific/Gambier","-540,1":"America/Anchorage","-480,1":"America/Los_Angeles","-480,0":"Pacific/Pitcairn","-420,0":"America/Phoenix","-420,1":"America/Denver","-360,0":"America/Guatemala","-360,1":"America/Chicago","-360,1,s":"Pacific/Easter","-300,0":"America/Bogota","-300,1":"America/New_York","-270,0":"America/Caracas",
"-240,1":"America/Halifax","-240,0":"America/Santo_Domingo","-240,1,s":"America/Asuncion","-210,1":"America/St_Johns","-180,1":"America/Godthab","-180,0":"America/Argentina/Buenos_Aires","-180,1,s":"America/Montevideo","-120,0":"America/Noronha","-120,1":"America/Noronha","-60,1":"Atlantic/Azores","-60,0":"Atlantic/Cape_Verde","0,0":"UTC","0,1":"Europe/London","60,1":"Europe/Berlin","60,0":"Africa/Lagos","60,1,s":"Africa/Windhoek","120,1":"Asia/Beirut","120,0":"Africa/Johannesburg","180,0":"Asia/Baghdad",
"180,1":"Europe/Moscow","210,1":"Asia/Tehran","240,0":"Asia/Dubai","240,1":"Asia/Baku","270,0":"Asia/Kabul","300,1":"Asia/Yekaterinburg","300,0":"Asia/Karachi","330,0":"Asia/Kolkata","345,0":"Asia/Kathmandu","360,0":"Asia/Dhaka","360,1":"Asia/Omsk","390,0":"Asia/Rangoon","420,1":"Asia/Krasnoyarsk","420,0":"Asia/Jakarta","480,0":"Asia/Shanghai","480,1":"Asia/Irkutsk","525,0":"Australia/Eucla","525,1,s":"Australia/Eucla","540,1":"Asia/Yakutsk","540,0":"Asia/Tokyo","570,0":"Australia/Darwin","570,1,s":"Australia/Adelaide",
"600,0":"Australia/Brisbane","600,1":"Asia/Vladivostok","600,1,s":"Australia/Sydney","630,1,s":"Australia/Lord_Howe","660,1":"Asia/Kamchatka","660,0":"Pacific/Noumea","690,0":"Pacific/Norfolk","720,1,s":"Pacific/Auckland","720,0":"Pacific/Majuro","765,1,s":"Pacific/Chatham","780,0":"Pacific/Tongatapu","780,1,s":"Pacific/Apia","840,0":"Pacific/Kiritimati"};jstz.olson.dst_rules={years:[2008,2009,2010,2011,2012,2013,2014],zones:[{name:"Africa/Cairo",rules:[{e:12199572E5,s:12090744E5},{e:1250802E6,s:1240524E6},{e:12858804E5,s:12840696E5},!1,!1,!1,{e:14116788E5,s:1406844E6}]},{name:"Africa/Casablanca",rules:[{e:12202236E5,s:12122784E5},{e:12508092E5,s:12438144E5},{e:1281222E6,s:12727584E5},{e:13120668E5,s:13017888E5},{e:13489704E5,s:1345428E6},{e:13828392E5,s:13761E8},{e:14142888E5,s:14069448E5}]},{name:"America/Asuncion",rules:[{e:12050316E5,s:12243888E5},
{e:12364812E5,s:12558384E5},{e:12709548E5,s:12860784E5},{e:13024044E5,s:1317528E6},{e:1333854E6,s:13495824E5},{e:1364094E6,s:1381032E6},{e:13955436E5,s:14124816E5}]},{name:"America/Campo_Grande",rules:[{e:12032172E5,s:12243888E5},{e:12346668E5,s:12558384E5},{e:12667212E5,s:1287288E6},{e:12981708E5,s:13187376E5},{e:13302252E5,s:1350792E6},{e:136107E7,s:13822416E5},{e:13925196E5,s:14136912E5}]},{name:"America/Goose_Bay",rules:[{e:122559486E4,s:120503526E4},{e:125704446E4,s:123648486E4},{e:128909886E4,
s:126853926E4},{e:13205556E5,s:129998886E4},{e:13520052E5,s:13314456E5},{e:13834548E5,s:13628952E5},{e:14149044E5,s:13943448E5}]},{name:"America/Havana",rules:[{e:12249972E5,s:12056436E5},{e:12564468E5,s:12364884E5},{e:12885012E5,s:12685428E5},{e:13211604E5,s:13005972E5},{e:13520052E5,s:13332564E5},{e:13834548E5,s:13628916E5},{e:14149044E5,s:13943412E5}]},{name:"America/Mazatlan",rules:[{e:1225008E6,s:12074724E5},{e:12564576E5,s:1238922E6},{e:1288512E6,s:12703716E5},{e:13199616E5,s:13018212E5},{e:13514112E5,
s:13332708E5},{e:13828608E5,s:13653252E5},{e:14143104E5,s:13967748E5}]},{name:"America/Mexico_City",rules:[{e:12250044E5,s:12074688E5},{e:1256454E6,s:12389184E5},{e:12885084E5,s:1270368E6},{e:1319958E6,s:13018176E5},{e:13514076E5,s:13332672E5},{e:13828572E5,s:13653216E5},{e:14143068E5,s:13967712E5}]},{name:"America/Miquelon",rules:[{e:12255984E5,s:12050388E5},{e:1257048E6,s:12364884E5},{e:12891024E5,s:12685428E5},{e:1320552E6,s:12999924E5},{e:13520016E5,s:1331442E6},{e:13834512E5,s:13628916E5},{e:14149008E5,
s:13943412E5}]},{name:"America/Santa_Isabel",rules:[{e:12250116E5,s:1207476E6},{e:12564612E5,s:12389256E5},{e:12885156E5,s:12703752E5},{e:13199652E5,s:13018248E5},{e:13514148E5,s:13332744E5},{e:13828644E5,s:13653288E5},{e:1414314E6,s:13967784E5}]},{name:"America/Santiago",rules:[{e:1206846E6,s:1223784E6},{e:1237086E6,s:12552336E5},{e:127035E7,s:12866832E5},{e:13048236E5,s:13138992E5},{e:13356684E5,s:13465584E5},{e:1367118E6,s:13786128E5},{e:13985676E5,s:14100624E5}]},{name:"America/Sao_Paulo",rules:[{e:12032136E5,
s:12243852E5},{e:12346632E5,s:12558348E5},{e:12667176E5,s:12872844E5},{e:12981672E5,s:1318734E6},{e:13302216E5,s:13507884E5},{e:13610664E5,s:1382238E6},{e:1392516E6,s:14136876E5}]},{name:"Asia/Amman",rules:[{e:1225404E6,s:12066552E5},{e:12568536E5,s:12381048E5},{e:12883032E5,s:12695544E5},{e:13197528E5,s:13016088E5},!1,!1,{e:14147064E5,s:13959576E5}]},{name:"Asia/Damascus",rules:[{e:12254868E5,s:120726E7},{e:125685E7,s:12381048E5},{e:12882996E5,s:12701592E5},{e:13197492E5,s:13016088E5},{e:13511988E5,
s:13330584E5},{e:13826484E5,s:1364508E6},{e:14147028E5,s:13959576E5}]},{name:"Asia/Dubai",rules:[!1,!1,!1,!1,!1,!1,!1]},{name:"Asia/Gaza",rules:[{e:12199572E5,s:12066552E5},{e:12520152E5,s:12381048E5},{e:1281474E6,s:126964086E4},{e:1312146E6,s:130160886E4},{e:13481784E5,s:13330584E5},{e:13802292E5,s:1364508E6},{e:1414098E6,s:13959576E5}]},{name:"Asia/Irkutsk",rules:[{e:12249576E5,s:12068136E5},{e:12564072E5,s:12382632E5},{e:12884616E5,s:12697128E5},!1,!1,!1,!1]},{name:"Asia/Jerusalem",rules:[{e:12231612E5,
s:12066624E5},{e:1254006E6,s:1238112E6},{e:1284246E6,s:12695616E5},{e:131751E7,s:1301616E6},{e:13483548E5,s:13330656E5},{e:13828284E5,s:13645152E5},{e:1414278E6,s:13959648E5}]},{name:"Asia/Kamchatka",rules:[{e:12249432E5,s:12067992E5},{e:12563928E5,s:12382488E5},{e:12884508E5,s:12696984E5},!1,!1,!1,!1]},{name:"Asia/Krasnoyarsk",rules:[{e:12249612E5,s:12068172E5},{e:12564108E5,s:12382668E5},{e:12884652E5,s:12697164E5},!1,!1,!1,!1]},{name:"Asia/Omsk",rules:[{e:12249648E5,s:12068208E5},{e:12564144E5,
s:12382704E5},{e:12884688E5,s:126972E7},!1,!1,!1,!1]},{name:"Asia/Vladivostok",rules:[{e:12249504E5,s:12068064E5},{e:12564E8,s:1238256E6},{e:12884544E5,s:12697056E5},!1,!1,!1,!1]},{name:"Asia/Yakutsk",rules:[{e:1224954E6,s:120681E7},{e:12564036E5,s:12382596E5},{e:1288458E6,s:12697092E5},!1,!1,!1,!1]},{name:"Asia/Yekaterinburg",rules:[{e:12249684E5,s:12068244E5},{e:1256418E6,s:1238274E6},{e:12884724E5,s:12697236E5},!1,!1,!1,!1]},{name:"Asia/Yerevan",rules:[{e:1224972E6,s:1206828E6},{e:12564216E5,s:12382776E5},
{e:1288476E6,s:12697272E5},{e:13199256E5,s:13011768E5},!1,!1,!1]},{name:"Australia/Lord_Howe",rules:[{e:12074076E5,s:12231342E5},{e:12388572E5,s:12545838E5},{e:12703068E5,s:12860334E5},{e:13017564E5,s:1317483E6},{e:1333206E6,s:13495374E5},{e:13652604E5,s:1380987E6},{e:139671E7,s:14124366E5}]},{name:"Australia/Perth",rules:[{e:12068136E5,s:12249576E5},!1,!1,!1,!1,!1,!1]},{name:"Europe/Helsinki",rules:[{e:12249828E5,s:12068388E5},{e:12564324E5,s:12382884E5},{e:12884868E5,s:1269738E6},{e:13199364E5,
s:13011876E5},{e:1351386E6,s:13326372E5},{e:13828356E5,s:13646916E5},{e:14142852E5,s:13961412E5}]},{name:"Europe/Minsk",rules:[{e:12249792E5,s:12068352E5},{e:12564288E5,s:12382848E5},{e:12884832E5,s:12697344E5},!1,!1,!1,!1]},{name:"Europe/Moscow",rules:[{e:12249756E5,s:12068316E5},{e:12564252E5,s:12382812E5},{e:12884796E5,s:12697308E5},!1,!1,!1,!1]},{name:"Pacific/Apia",rules:[!1,!1,!1,{e:13017528E5,s:13168728E5},{e:13332024E5,s:13489272E5},{e:13652568E5,s:13803768E5},{e:13967064E5,s:14118264E5}]},
{name:"Pacific/Fiji",rules:[!1,!1,{e:12696984E5,s:12878424E5},{e:13271544E5,s:1319292E6},{e:1358604E6,s:13507416E5},{e:139005E7,s:1382796E6},{e:14215032E5,s:14148504E5}]},{name:"Europe/London",rules:[{e:12249828E5,s:12068388E5},{e:12564324E5,s:12382884E5},{e:12884868E5,s:1269738E6},{e:13199364E5,s:13011876E5},{e:1351386E6,s:13326372E5},{e:13828356E5,s:13646916E5},{e:14142852E5,s:13961412E5}]}]};(function(a,f){"object"==typeof module&&module.exports?module.exports=f():"function"==typeof define&&define.amd?define(f):a.Spinner=f()})(this,function(){function a(b,d){b=document.createElement(b||"div");for(var c in d)b[c]=d[c];return b}function f(b){for(var d=1,c=arguments.length;d<c;d++)b.appendChild(arguments[d]);return b}function g(b,d,c,a){var e=["opacity",d,~~(100*b),c,a].join("-");c=.01+c/a*100;a=Math.max(1-(1-b)/d*(100-c),b);var g=m.substring(0,m.indexOf("Animation")).toLowerCase();p[e]||
(q.insertRule("@"+(g&&"-"+g+"-"||"")+"keyframes "+e+"{0%{opacity:"+a+"}"+c+"%{opacity:"+b+"}"+(c+.01)+"%{opacity:1}"+(c+d)%100+"%{opacity:"+b+"}100%{opacity:"+a+"}}",q.cssRules.length),p[e]=1);return e}function e(b,d){b=b.style;var c,a;d=d.charAt(0).toUpperCase()+d.slice(1);if(void 0!==b[d])return d;for(a=0;a<l.length;a++)if(c=l[a]+d,void 0!==b[c])return c}function c(b,d){for(var c in d)b.style[e(b,c)||c]=d[c];return b}function b(b){for(var d=1;d<arguments.length;d++){var c=arguments[d],a;for(a in c)void 0===
b[a]&&(b[a]=c[a])}return b}function d(b,d){return"string"==typeof b?b:b[d%b.length]}function h(d){this.opts=b(d||{},h.defaults,u)}function n(){function b(b,d){return a("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',d)}q.addRule(".spin-vml","behavior:url(#default#VML)");h.prototype.lines=function(a,e){function g(){return c(b("group",{coordsize:l+" "+l,coordorigin:-n+" "+-n}),{width:l,height:l})}function h(a,h,l){f(B,f(c(g(),{rotation:360/e.lines*a+"deg",left:~~h}),f(c(b("roundrect",
{arcsize:e.corners}),{width:n,height:e.scale*e.width,left:e.scale*e.radius,top:-e.scale*e.width>>1,filter:l}),b("fill",{color:d(e.color,a),opacity:e.opacity}),b("stroke",{opacity:0}))))}var n=e.scale*(e.length+e.width),l=2*e.scale*n,m=-(e.width+e.length)*e.scale*2+"px",B=c(g(),{position:"absolute",top:m,left:m});if(e.shadow)for(m=1;m<=e.lines;m++)h(m,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(m=1;m<=e.lines;m++)h(m);return f(a,B)};h.prototype.opacity=
function(b,d,c,a){b=b.firstChild;a=a.shadow&&a.lines||0;b&&d+a<b.childNodes.length&&(b=(b=(b=b.childNodes[d+a])&&b.firstChild)&&b.firstChild)&&(b.opacity=c)}}var l=["webkit","Moz","ms","O"],p={},m,q,u={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2E9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};h.defaults={};b(h.prototype,{spin:function(b){this.stop();var d=this,e=d.opts,g=
d.el=a(null,{className:e.className});c(g,{position:e.position,width:0,zIndex:e.zIndex,left:e.left,top:e.top});b&&b.insertBefore(g,b.firstChild||null);g.setAttribute("role","progressbar");d.lines(g,d.opts);if(!m){var h=0,f=(e.lines-1)*(1-e.direction)/2,n,l=e.fps,w=l/e.speed,p=(1-e.opacity)/(w*e.trail/100),q=w/e.lines;(function A(){h++;for(var b=0;b<e.lines;b++)n=Math.max(1-(h+(e.lines-b)*q)%w*p,e.opacity),d.opacity(g,b*e.direction+f,n,e);d.timeout=d.el&&setTimeout(A,~~(1E3/l))})()}return d},stop:function(){var b=
this.el;b&&(clearTimeout(this.timeout),b.parentNode&&b.parentNode.removeChild(b),this.el=void 0);return this},lines:function(b,e){function h(b,d){return c(a(),{position:"absolute",width:e.scale*(e.length+e.width)+"px",height:e.scale*e.width+"px",background:b,boxShadow:d,transformOrigin:"left",transform:"rotate("+~~(360/e.lines*n+e.rotate)+"deg) translate("+e.scale*e.radius+"px,0)",borderRadius:(e.corners*e.scale*e.width>>1)+"px"})}for(var n=0,l=(e.lines-1)*(1-e.direction)/2,B;n<e.lines;n++)B=c(a(),
{position:"absolute",top:1+~(e.scale*e.width/2)+"px",transform:e.hwaccel?"translate3d(0,0,0)":"",opacity:e.opacity,animation:m&&g(e.opacity,e.trail,l+n*e.direction,e.lines)+" "+1/e.speed+"s linear infinite"}),e.shadow&&f(B,c(h("#000","0 0 4px #000"),{top:"2px"})),f(b,f(B,h(d(e.color,n),"0 0 1px rgba(0,0,0,.1)")));return b},opacity:function(b,d,c){d<b.childNodes.length&&(b.childNodes[d].style.opacity=c)}});if("undefined"!==typeof document){q=function(){var b=a("style",{type:"text/css"});f(document.getElementsByTagName("head")[0],
b);return b.sheet||b.styleSheet}();var v=c(a("group"),{behavior:"url(#default#VML)"});!e(v,"transform")&&v.adj?n():m=e(v,"animation")}return h});var CTATConfig={Options:{},addProperty:function(a,f,g,e){g=g||f[0];Object.defineProperty(CTATConfig,a,{enumerable:!0,configurable:!1,writable:!e,value:g.toLowerCase()});var c={};f.forEach(function(b){c[b]=b.toLowerCase();Object.defineProperty(CTATConfig,a+"_is_"+b,{enumerable:!1,writable:!1,value:function(){return CTATConfig[this.prop].toLowerCase()==this.val}.bind({prop:a,val:c[b]})})});CTATConfig.Options[a]=c}};CTATConfig.addProperty("platform",["CTAT","Google","Undefined"],"CTAT",!0);
CTATConfig.addProperty("external",["Google","LTI","SCORM","noUI","None"],"None");CTATConfig.setExternal=function(a){CTATConfig.external=a};CTATConfig.addProperty("parserType",["XML","JSON"],"XML");"undefined"!==typeof module&&(module.exports=CTATConfig);var CTATGlobals={tutorRunning:!1,Tab:{Tracker:1,Focus:null,previousFocus:null},NameSpace:{svg:"http://www.w3.org/2000/svg",xml:"http://www.w3.org/2000/xmlns/",xlink:"http://www.w3.org/1999/xlink",ev:"http://www.w3.org/2001/xml-events",mathml:"http://www.w3.org/1998/Math/MathML"},EncodedParams:{authenticity_token:"authenticity_token",info:"info",question_file:"question_file",skills:"skills"},CommDisabled:!1,orientation:"portrait",ignoreInterfaceDescriptions:!0},useDebugging;
void 0===useDebugging&&(useDebugging=!1);var useDebuggingBasic;void 0===useDebuggingBasic&&(useDebuggingBasic=!1);var version="4.4.0",ctatcontainer="container",movieclips=[],canvasCalibrate=5,flashVars=null,mobileAPI=null,aVars=null;CTATGlobals.interfaceElement=null;var commMessageHandler=CTATGlobals.selectedTextInput=null,commLoggingLibrary=null,logHintSAI=null,logHintStepID="",nameTranslator=null,hints=[],hintIndex=0;CTATGlobals.suppressStudentFeedback=!1;CTATGlobals.confirmDone=!1;
var incompatibleBrowserMessage="Your browser does not support CTAT. Please update or replace your browser.";var CTATSandboxDriver={};function getSafeElementById(a){return document.getElementById(a)};var CTATGlobalFunctions={};function unhighlightall(a){if(CTATShellTools.component_descriptions){a=CTATShellTools.getAllComponents();for(var f=0;f<a.length;f++){var g=a[f];g.setHintHighlight&&g.setHintHighlight(!1,null)}}}CTATGlobalFunctions.stringToBoolean=function(a){switch(String(a).toLowerCase()){case "true":case "yes":case "1":return!0;case "false":case "no":case "0":case "":case null:return!1;default:return!!a}};
CTATGlobalFunctions.isInstructorMode=function(){var a=flashVars?flashVars.getRawFlashVars():null;return a&&a.deliverymode?"delivery"==a.deliverymode?!1:!0:!1};CTATGlobalFunctions.getLoggingLibrary=function(a){null==commLoggingLibrary&&(commLoggingLibrary=new CTATLoggingLibrary(!0));return commLoggingLibrary};CTATGlobalFunctions.setPreviewMode=function(a,f){CTATGlobalFunctions.isCTATObject(a)?a.setPreviewMode(f):a.previewMode=f};
CTATGlobalFunctions.setCenterTutor=function(a,f){CTATGlobalFunctions.isCTATObject(a)?a.setCenterTutor(f):a.centerTutor=f};CTATGlobalFunctions.setTutorWidth=function(a,f){CTATGlobalFunctions.isCTATObject(a)?a.setTutorWidth(f):a.width=f};CTATGlobalFunctions.setTutorHeight=function(a,f){CTATGlobalFunctions.isCTATObject(a)?a.setTutorHeight(f):a.height=f};CTATGlobalFunctions.setTutorDimensions=function(a,f,g){CTATGlobalFunctions.isCTATObject(a)?a.setTutorDimensions(f,g):(a.width=f,a.height=g)};
CTATGlobalFunctions.setTutorValue=function(a,f,g){CTATGlobalFunctions.isCTATObject(a)?a.setTutorValue(f,g):a[f]=g};CTATGlobalFunctions.setCommunicationMode=function(a,f){CTATGlobalFunctions.isCTATObject(a)?a.setCommunicationMode(f):a.tutoring_service_communication=f};CTATGlobalFunctions.setRemoteSocketURL=function(a,f){CTATGlobalFunctions.isCTATObject(a)?a.setRemoteSocketURL(f):a.remoteSocketURL=f};
CTATGlobalFunctions.setRemoteSocketPort=function(a,f){CTATGlobalFunctions.isCTATObject(a)?a.setRemoteSocketPort(f):a.remoteSocketPort=f};CTATGlobalFunctions.setProblemSummary=function(a){};CTATGlobalFunctions.isCTATObject=function(a){return"object"==typeof testConfig&&testConfig.getClassName?!0:!1};CTATGlobalFunctions.getCTATClassname=function(a){return"object"==typeof testConfig&&testConfig.getClassName?testConfig.getClassName():"object"};
CTATGlobalFunctions.toBoolean=function(a){return"boolean"===typeof a?a:"string"===typeof a?CTATGlobalFunctions.stringToBoolean(a):"number"===typeof a?0<a:a?!0:!1};function noenter(a){if(CTATConfig.platform_is_Google())return 0;a=a||window.event;return 13!==(a.keyCode||a.charCode)}CTATGlobalFunctions.isBlank=function(a){return!a||/^\s*$/.test(a)};function componentToHex(a){a=a.toString(16);return 1==a.length?"0"+a:a}
function rgbToHex(a,f,g){return"#"+componentToHex(a)+componentToHex(f)+componentToHex(g)}function hexToRgb(a){return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null}
function parseQueryStringArgs(a){ctatdebug("parseQueryStringArgs ()");ctatdebug("Query String: "+a);var f="?"==a.charAt(0)?a.substring(1):a;a={};if(f)for(var f=f.split("&"),g=0;g<f.length;g++){var e=f[g].split("=");a[decodeURIComponent(e[0])]=decodeURIComponent(e[1].replace(/\+/g," "))}return a}
function setOrientation(a){ctatdebug("setOrientation ("+a+")");switch(a){case -90:case 90:mobileAPI&&mobileAPI.processOrientationChange("landscape");break;default:mobileAPI&&mobileAPI.processOrientationChange("portrait")}}Object.hasOwnProperty("create")||(Object.create=function(){function a(){}return function(f){if(1!=arguments.length)throw Error("Object.create implementation only accepts one parameter.");a.prototype=f;return new a}}());
function thisMovie(a){return-1!=navigator.appName.indexOf("Microsoft")?window[a]:document[a]}function introspect(a,f,g,e){g=g||"";"number"!==this.typeOf(e)&&(e=1);var c=this.typeOf(f);a=[g,a," ",c," :"].join("");if("object"===c){if(0<e){g=[g,"  "].join("");for(var b in f)c=this.introspect(b,f[b],g,e-1),a=[a,"\n",c].join("");return a}return[a," ..."].join("")}return"null"===c?[a," null"].join(""):[a," ",f].join("")}
function findPointOfAttachment(a){ctatdebug("findPointOfAttachment ("+a+")");for(var f=0;f<movieclips.length;f++){var g=movieclips[f];ctatdebug("Examining: "+g.getName()+"...");if(!0===g.isRegistered(a))return g}return null}function findMovieClip(a){a=a.trim();ctatdebug("findMovieClip ("+a.trim()+")");for(var f=0;f<movieclips.length;f++){var g=movieclips[f];ctatdebug("Examining: "+g.getName()+"...");if(g.getName()==a)return g}return null}
function colName(a,f){ctatdebug("colName ("+a+")");for(var g="";0<=a;)g=String.fromCharCode(a%26+97)+g,a=Math.floor(a/26)-1;!0===f&&g.toUpperCase();return g}function selectText(a){}function urldecode(a){return decodeURIComponent((""+a).replace(/\+/g,"%20"))}function detectIE(){var a=window.navigator.userAgent,f=a.indexOf("MSIE "),g=a.indexOf("Trident/");return 0<f?parseInt(a.substring(f+5,a.indexOf(".",f)),10):0<g?(f=a.indexOf("rv:"),parseInt(a.substring(f+3,a.indexOf(".",f)),10)):!1}
function listProperties(a){ctatdebug("listProperties (l: "+a.length+")");for(var f in a)ctatdebug("["+f+"]")}function listPropertiesKV(a,f){ctatdebug("listPropertiesKV (size: "+a.length+")");if(1==f)for(f=0;f<a.length;f++)ctatdebug("["+f+"]: "+a[f]);else for(var g in a)ctatdebug("["+g+"]: "+a[g])}function listAllDivAttributes(a){ctatdebug("listAllDivAttributes ()");var f=0;a=a.attributes;for(var g=a.length;f<g;f++)pointer.ctatdebug("Attribute: "+a[f].nodeName+", with value: "+a[f].nodeValue)}
var getBackgroundDimensions=function(a){ctatdebug("Using url: "+$(a).css("background-image"));var f=new Image;f.src=$(a).css("background-image").replace(/url\(|\)$|"/ig,"");return f.width+" "+f.height},getBackgroundWidth=function(a){ctatdebug("Using url: "+$(a).css("background-image"));var f=new Image;f.src=$(a).css("background-image").replace(/url\(|\)$|"/ig,"");return f.width},getBackgroundHeight=function(a){ctatdebug("Using url: "+$(a).css("background-image"));var f=new Image;f.src=$(a).css("background-image").replace(/url\(|\)$|"/ig,
"");return f.height};function getIndicesOf(a,f,g){var e=0,c=a.length,b=[];g||(f=f.toLowerCase(),a=a.toLowerCase());for(;-1<(g=f.indexOf(a,e));)b.push(g),e=g+c;return b}CTATGlobalFunctions.formatColor=function(a){if(/^#[0-9a-f]{6}$/i.test(a))return a;var f=a.match(/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i);if(null!==f)return rgbToHex(Number(f[1]),Number(f[2]),Number(f[3]));f=a.match(/^#?([0-9a-f]{0,6})$/i);if(null!==f){for(a=f[1];6>a.length;)a="0"+a;return"#"+a}return a};
CTATGlobalFunctions.Gensym=function(){this.make_gensym=function(){var a="",e=0;return{set_prefix:function(c){a=String(c)},set_index:function(c){e=c},gensym:function(){var c=a+e;e+=1;return c}}};var a=this.make_gensym();a.set_index(2);var f=this.make_gensym();f.set_index(1);f.set_prefix("ctatdiv");return{z_index:a.gensym,div_id:f.gensym}};CTATGlobalFunctions.gensym=CTATGlobalFunctions.Gensym();var CTATBase=function(a,f){function g(b,d,c){null===b&&(b="unknownclass");null===d&&(d="nullinstance");return"["+b+":"+d+"] "+c}var e=a,c=f,b=this,d=!0;"undefined"!=CTATBase.DebuggingFilter[e]&&CTATBase.DebuggingFilter[e]&&(d=!1);this.getClassName=function(){return e};this.getClassname=function(){return e};this.setClassName=function(b){e=b};this.setName=function(b){c=b};this.getName=function(){return c};this.getUseDebugging=function(){return useDebugging};this.setUseDebugging=function(b){useDebugging=
b};this.toHHMMSS=function(b){var d=parseInt(b,10);b=Math.floor(d/3600);var c=Math.floor((d-3600*b)/60),d=d-3600*b-60*c;10>b&&(b="0"+b);10>c&&(c="0"+c);10>d&&(d="0"+d);return b+":"+c+":"+d};this.ctatdebug=function(c){if(d){var a=c;useDebuggingBasic?b.ctatdebugInternal(a,"UnknownClass"):(null===c&&(a="No message provided"),useDebugging&&b.ctatdebugInternal(a,b.getClassName()))}};this.ctatdebugObject=function(b){var d=0,c;for(c in b)this.ctatdebug("("+d+")"+c+": "+b[c]),d++};this.ctatdebugInternal=function(d,
c){if(null===d||void 0===d)d="No message!";""===d&&(d="Empty message!");if(useDebuggingBasic)c=g("Unknown","undefined",d),CTATBase.customconsole||(CTATBase.customconsole=getSafeElementById("customconsole")),CTATBase.customconsole?(CTATBase.customconsole.innerHTML+=c+"<br>",CTATBase.customconsole.scrollTop=CTATBase.customconsole.scrollHeight):console.log(c);else{null===c&&(c="UndefinedClass");null===d&&(d="No message");c=g(c,b.getName(),d);try{console.trace(c)}catch(l){}"google"==CTATConfig.platform?
Logger.log(c):(CTATBase.customconsole||(CTATBase.customconsole=getSafeElementById("customconsole")),null!==CTATBase.customconsole&&(CTATBase.customconsole.innerHTML+=c+"<br>",CTATBase.customconsole.scrollTop=CTATBase.customconsole.scrollHeight))}};this.ctatdebugObjectShallow=function(d){var c="",a;for(a in d)c+=a+", ";b.ctatdebugInternal("Object: "+c,"Global")};this.urldecode=function(b){return decodeURIComponent((b+"").replace(/\+/g,"%20"))};this.entitiesConvert=function(b){this.ctatdebug("entitiesConvert ()");
return this.urldecode(unescape(b))};this.entitiesGenerate=function(b){return b}};function formatLogMessageGoogle(a,f,g){g=(new CTATBase(a,f)).htmlEncode(g);return"["+a+":"+f+"] "+g}function ctatdebug(a){(useDebugging||useDebuggingBasic)&&null!==a&&("google"==CTATConfig.platform?Logger.log(formatLogMessageGoogle("CTATTutor","tutor",a)):(ctatdebug.debugPointer||(ctatdebug.debugPointer=new CTATBase("CTATTutor","tutor")),ctatdebug.debugPointer.ctatdebug(a,"CTATTutor")))}
Object.defineProperty(CTATBase,"DebuggingFilter",{enumerable:!1,configurable:!1,writable:!0,value:[]});"undefined"!==typeof module&&(module.exports=CTATBase);var CTATXML=function(){CTATBase.call(this,"CTATXML","xmlparser");this.parse=function(a){return this.parseXML(a)};this.parseXML=function(a){this.ctatdebug("parseXML ()");var f=null;try{"undefined"!==typeof $?f=$.parseXML(a):"undefined"!==typeof XMLParser?f=(new XMLParser).parseFromString(a):this.ctatdebug("Bottoming out, no parser configured!")}catch(g){return null!=f?this.ctatdebug("JQuery could not process the provided XML: "+g.message+" ("+f.parseError.errorCode+") ("+f.parseError.reason+") ("+
f.parseError.line+")"):this.ctatdebug("JQuery could not process the provided XML (xmlDoc==null): "+g.message),null}return null==f?(this.ctatdebug("Unspecified error parsing xml message. xmlDoc is null"),null):f.documentElement};this.getElementName=function(a){return a.nodeName};this.getElementValue=function(a){return a.nodeValue};this.getElementChildren=function(a){for(var f=[],g=0;g<a.childNodes.length;g++)1==a.childNodes[g].nodeType&&f.push(a.childNodes[g]);return f};this.getNodeTextValue=function(a){if(null==
a)return"";if(null==a.childNodes)return a.nodeValue;if(0==a.childNodes.length)return"";for(var f=a.childNodes,g=0;g<f.length;g++){var e=f[g];if("value"==e.nodeName||"Value"==e.nodeName){if(1==e.childNodes.length)return e.childNodes[0].nodeValue;if(0==e.childNodes.length)break;else return e.childNodes[1].nodeValue}}return a.childNodes[0].nodeValue};this.getValueNodesAsText=function(a){var f=this;return this.getElementChildren(a).reduce(function(a,e){"value"===f.getElementName(e)&&a.push(f.getNodeTextValue(e));
return a},[])};this.setNodeTextValue=function(a,f){if(null==a)return null;if(null==a.childNodes)return a.nodeValue;if(0==a.childNodes.length)return"";for(var g=a.childNodes,e=0;e<g.length;e++){var c=g[e];if("value"==c.nodeName||"Value"==c.nodeName){if(1==c.childNodes.length)return c.childNodes[0].nodeValue=f;if(0==c.childNodes.length)break;else return c.childNodes[1].nodeValue=f}}return a.childNodes[0].nodeValue=f};this.addElement=function(a,f,g,e){return a instanceof Element&&(f=String(f))?(g="<"+
f+">"+(e?"<![CDATA[":"")+String(g),g+=e?"]]\x3e":"",g+="</"+f+">",$(a).append(g).children().last().get()[0]):null};this.getElementAttr=function(a,f){if(!a.attributes)return this.ctatdebug("Warning: Element "+a.nodeName+" does not have any attributes"),"";for(var g=0;g<a.attributes.length;g++)if(a.attributes[g].nodeName==f)return a.attributes[g].nodeValue;return""};this.listElementAttr=function(a){this.ctatdebug("Listing "+a.attributes.length+" attributes for element "+a.nodeName+" ...");for(var f=
0;f<a.attributes.length;f++)this.ctatdebug(f+" name: "+a.attributes[f].nodeName+", value: "+a.attributes[f].nodeValue)};this.stringify=function(a){return this.xmlToString(a)};this.xmlToString=function(a){this.ctatdebug("xmlToString ()");return null==a?(this.ctatdebug("Error: xml data is null"),null):(new XMLSerializer).serializeToString(a)}};CTATXML.prototype=Object.create(CTATBase.prototype);CTATXML.prototype.constructor=CTATXML;"undefined"!==typeof module&&(module.exports=CTATXML);var CTATDefaultLanguagePack={HORIZONTAL:"LR",VERTICAL:"TB",LOADING:"Please wait while the tutor is being loaded",NEXTPROBLEM:"Retrieving the Next Problem...",CONGRATULATIONS_YOU_ARE_DONE:"Congratulations, you are done with this problem.",DONE_WITH_PROBLEM_SET:"You are done with this problem set.",SURE_YOU_ARE_DONE:"Are you sure you are done?",TUTORDISCONNECTED:"The tutor has disconnected. Please refresh the page.",OUTOFORDER:"You need to do other steps first, before doing the step you just worked on. You might request a hint for more help.",
DONE:"Done",HINT:"Hint",NEXT:"Next",PREVIOUS:"Previous",HIGHLIGHTEDSTEP:"Instead of the step you are working on, please work on the highlighted step.",NO_HINT_AVAILABLE:"No hint is available at this step.",DEFAULT_HINT_PREFIX_TEXT:'Please enter "',DEFAULT_HINT_SUFFIX_TEXT:'" in the highlighted field.',DEFAULT_HINT_PREFIX_SELECT:'Please select "',DEFAULT_HINT_SUFFIX_SELECT:'" from the highlighted menu.',DEFAULT_HINT_BUTTON:"Please click the highlighted button.",DEFAULT_HINT_PREFIX:'Please answer "',
DEFAULT_HINT_SUFFIX:'" on the highlighted element.',NOTDONE:"I'm sorry, but you are not done yet. Please continue working.",UNABLE_TO_LOAD:"Unable to load: ",FILE_IS_MISSING:" - Either the file is missing, you are trying to use the file:// protocol, there is a network barrier, or the URL is in a different domain and permission to retrieve data from that server is denied.",AUTHORPLEASECLOSE:"Authoring Tools disconnected. Please close this page.",ERROR_502:"Error contacting the server, please refresh the page and try again (HTTP status 502: gateway response).",
ERROR_CONN_TS:"Connection refused by tutoring service, please check your server or contact an administrator.",ERROR_CONN_LS:"Connection refused by the logging server, please check your connection or contact an administrator.",AWAITING_OTHER_COLLABORATORS:"Waiting for other team members...",YOUR_COLLABORATOR:"Your team member ",COLLABORATOR_QUIT_CLICK_OK:"has quit. Please click OK to exit, then restart the problem.",COLLABORATOR_QUIT_CLICK_X:"has quit. Please click on the red X at top right to exit, then restart the problem."},
CTATLanguageManager=function(){CTATBase.call(this,"CTATLanguageManager","theLanguagePack");var a=this;this.getString=function(f){a.ctatdebug("getString ("+f+") -> "+typeof CTATLanguagePack);if("undefined"!==typeof CTATLanguagePack){if(CTATLanguagePack[f])return CTATLanguagePack[f]}else a.ctatdebug("No custom language pack defined, using default...");return CTATDefaultLanguagePack[f]};this.filterString=function(f){a.ctatdebug("filterString ("+f+") -> "+typeof CTATLanguagePack);if("undefined"!==typeof CTATLanguagePack){if(CTATLanguagePack[f])return a.ctatdebug("Found tag in provided language pack, returning: "+
CTATLanguagePack[f]),CTATLanguagePack[f]}else a.ctatdebug("No custom language pack defined, using default...");return"undefined"!==typeof CTATDefaultLanguagePack&&CTATDefaultLanguagePack[f]?(a.ctatdebug("Found tag in default language pack, returning: "+CTATDefaultLanguagePack[f]),CTATDefaultLanguagePack[f]):f}};CTATLanguageManager.prototype=Object.create(CTATBase.prototype);CTATLanguageManager.prototype.constructor=CTATLanguageManager;CTATLanguageManager.theSingleton=new CTATLanguageManager;var CTATMsgType=function(){CTATBase.call(this,"CTATMsgType","")};CTATMsgType.findProperty=function(a,f){var g=a.toLowerCase(),e="<"+f.toLowerCase()+">";a=g.indexOf(e)+e.length;f=g.indexOf("</"+f.toLowerCase()+">");if(a<e.length||0>f)return null;e={};e.start=a;e.end=f;return e};
CTATMsgType.makeValues=function(a){if(null==a)return"";if("string"==typeof a)return a;if(a.constructor&&"Array"==a.constructor.name){if(!a.length)return"";for(var f=0,g,e="<value>"+(null==(g=a[f++])?"":g.toString());f<a.length;)e+="</value><value>"+(null==(g=a[f++])?"":g.toString());return e+"</value>"}return a.outerHTML?a.outerHTML:a.toString()};
CTATMsgType.setProperty=function(a,f,g){var e=CTATMsgType.findProperty(a,f),c;e?(c=a.slice(0,e.start),c+=CTATMsgType.makeValues(g),c+=a.slice(e.end,a.length)):(e=a.indexOf("</properties>"),c=a.slice(0,e),c+="<"+f+">"+CTATMsgType.makeValues(g)+"</"+f+">",c+=a.slice(e,a.length));return c};CTATMsgType.getProperty=function(a,f){return(f=CTATMsgType.findProperty(a,f))?a.slice(f.start,f.end):""};
CTATMsgType.valueToArray=function(a){if(!a.startsWith("<value>")||!a.endsWith("</value>"))return null;var f=new CTATXML;try{for(var g=f.getElementChildren(f.parse('<?xml version="1.0" encoding="UTF-16"?><root>'+a+"</root>")),e=[],c=0;c<g.length;++c)"value"==f.getElementName(g[c]).toLowerCase()&&e.push(f.getNodeTextValue(g[c]));return e}catch(b){return console.log("Error in CTATMsgType.valueToArray("+a+")",b),null}};
CTATMsgType.getValue=function(a,f){a=CTATMsgType.valueToArray(a);return!a||a.length<=f?null:a[f]};CTATMsgType.getMessageType=function(a){return CTATMsgType.getProperty(a,"MessageType")};CTATMsgType.getTransactionID=function(a){return CTATMsgType.getProperty(a,CTATMessage.TRANSACTION_ID_TAG)};CTATMsgType.setTransactionID=function(a,f){return CTATMsgType.setProperty(a,CTATMessage.TRANSACTION_ID_TAG,f)};
CTATMsgType.isCorrectOrIncorrect=function(a){return"string"==typeof a?CTATMsgType.CorrectTypes[a.toLowerCase()]?!0:!1:!1};CTATMsgType.hasTextFeedback=function(a){return"string"==typeof a?CTATMsgType.TextFeedbackTypes[a.toLowerCase()]?!0:!1:!1};CTATMsgType.isHintResponse=function(a){return"string"==typeof a?CTATMsgType.HintResponseTypes[a.toLowerCase()]?!0:!1:!1};
CTATMsgType.isDoneMessage=function(a){var f=CTATMsgType.getProperty(a,"Selection");a=CTATMsgType.getProperty(a,"Action");if(!f||!a)return!1;f=f.toString().toLowerCase();a=a.toString().toLowerCase();var g=CTATMsgType.DONE.toLowerCase();if(g!=f&&g!=CTATMsgType.getValue(f,0))return!1;f=CTATMsgType.BUTTON_PRESSED.toLowerCase();return f!=a&&f!=CTATMsgType.getValue(a,0)?!1:!0};
CTATMsgType.getSAIArraysFromElement=function(a,f){var g={selection:[],action:[],input:[]};a=f.getElementChildren(a);for(var e=0;e<a.length;e++){var c=a[e];switch(f.getElementName(c)){case "Selection":for(var c=f.getElementChildren(c),b=0;b<c.length;b++)g.selection.push(f.getNodeTextValue(c[b]));break;case "Action":c=f.getElementChildren(c);for(b=0;b<c.length;b++)g.action.push(f.getNodeTextValue(c[b]));break;case "Input":c=f.getElementChildren(c);for(b=0;b<c.length;b++)g.input.push(f.getNodeTextValue(c[b]));
break;case "properties":return CTATMsgType.getSAIArraysFromElement(c,f)}}return g};Object.defineProperty(CTATMsgType,"CorrectTypes",{enumerable:!1,configurable:!1,writable:!1,value:{correctaction:1,incorrectaction:1,lispcheckaction:1}});Object.defineProperty(CTATMsgType,"TextFeedbackTypes",{enumerable:!1,configurable:!1,writable:!1,value:{showhintsmessage:1,successmessage:1,buggymessage:1,wrongusermessage:1,nohintmessage:1,highlightmsg:1,showhintsmessagefromlisp:1}});
Object.defineProperty(CTATMsgType,"HintResponseTypes",{enumerable:!1,configurable:!1,writable:!1,value:{showhintsmessage:1,nohintmessage:1,showhintsmessagefromlisp:1}});Object.defineProperty(CTATMsgType,"BUGGY_MSG",{enumerable:!1,configurable:!1,writable:!1,value:"BuggyMsg"});Object.defineProperty(CTATMsgType,"DONE",{enumerable:!1,configurable:!1,writable:!1,value:"Done"});Object.defineProperty(CTATMsgType,"BUTTON_PRESSED",{enumerable:!1,configurable:!1,writable:!1,value:"ButtonPressed"});
Object.defineProperty(CTATMsgType,"DEFAULT_STUDENT_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Student"});Object.defineProperty(CTATMsgType,"DEFAULT_TOOL_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Tutor"});Object.defineProperty(CTATMsgType,"UNGRADED_TOOL_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Tutor (unevaluated)"});Object.defineProperty(CTATMsgType,"DEFAULT_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:CTATMsgType.DEFAULT_STUDENT_ACTOR});
Object.defineProperty(CTATMsgType,"ANY_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Any"});Object.defineProperty(CTATMsgType,"SHOW_ALL_FEEDBACK",{enumerable:!1,configurable:!1,writable:!1,value:"Show All Feedback"});Object.defineProperty(CTATMsgType,"DELAY_FEEDBACK",{enumerable:!1,configurable:!1,writable:!1,value:"Delay Feedback"});Object.defineProperty(CTATMsgType,"HIDE_ALL_FEEDBACK",{enumerable:!1,configurable:!1,writable:!1,value:"Hide All Feedback"});
Object.defineProperty(CTATMsgType,"HIDE_BUT_COMPLETE",{enumerable:!1,configurable:!1,writable:!1,value:"Hide feedback but require all steps"});Object.defineProperty(CTATMsgType,"HIDE_BUT_ENFORCE",{enumerable:!1,configurable:!1,writable:!1,value:"Hide feedback but enforce constraints"});Object.defineProperty(CTATMsgType,"DEFAULT_OUT_OF_ORDER_MESSAGE",{enumerable:!1,configurable:!1,writable:!1,value:CTATLanguageManager.theSingleton.filterString("HIGHLIGHTEDSTEP")});
Object.defineProperty(CTATMsgType,"NOT_DONE_MSG",{enumerable:!1,configurable:!1,writable:!1,value:CTATLanguageManager.theSingleton.filterString("NOTDONE")});Object.defineProperty(CTATMsgType,"TRACE_OUTCOME",{enumerable:!1,configurable:!1,writable:!1,value:"TraceOutcome"});Object.defineProperty(CTATMsgType,"PREVIOUS_FOCUS",{enumerable:!1,configurable:!1,writable:!1,value:"PreviousFocus"});Object.defineProperty(CTATMsgType,"ASSOCIATED_RULES",{enumerable:!1,configurable:!1,writable:!1,value:"AssociatedRules"});
Object.defineProperty(CTATMsgType,"BEGIN_RESTORE",{enumerable:!1,configurable:!1,writable:!1,value:"BeginRestore"});Object.defineProperty(CTATMsgType,"BEGIN_GO_TO_STATE",{enumerable:!1,configurable:!1,writable:!1,value:"BeginGoToState"});Object.defineProperty(CTATMsgType,"END_GO_TO_STATE",{enumerable:!1,configurable:!1,writable:!1,value:"EndGoToState"});Object.defineProperty(CTATMsgType,"BUGGY_MESSAGE",{enumerable:!1,configurable:!1,writable:!1,value:"BuggyMessage"});
Object.defineProperty(CTATMsgType,"CORRECT_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"CorrectAction"});Object.defineProperty(CTATMsgType,"HINT_REQUEST",{enumerable:!1,configurable:!1,writable:!1,value:"HintRequest"});Object.defineProperty(CTATMsgType,"INCORRECT_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"InCorrectAction"});Object.defineProperty(CTATMsgType,"INTERFACE_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"InterfaceAction"});
Object.defineProperty(CTATMsgType,"INTERFACE_IDENTIFICATION",{enumerable:!1,configurable:!1,writable:!1,value:"InterfaceIdentification"});Object.defineProperty(CTATMsgType,"SEND_WIDGET_LOCK",{enumerable:!1,configurable:!1,writable:!1,value:"SendWidgetLock"});Object.defineProperty(CTATMsgType,"PROBLEM_RESTORE_END",{enumerable:!1,configurable:!1,writable:!1,value:"ProblemRestoreEnd"});Object.defineProperty(CTATMsgType,"PROBLEM_SUMMARY_REQUEST",{enumerable:!1,configurable:!1,writable:!1,value:"ProblemSummaryRequest"});
Object.defineProperty(CTATMsgType,"PROBLEM_SUMMARY_RESPONSE",{enumerable:!1,configurable:!1,writable:!1,value:"ProblemSummaryResponse"});Object.defineProperty(CTATMsgType,"SET_PREFERENCES",{enumerable:!1,configurable:!1,writable:!1,value:"SetPreferences"});Object.defineProperty(CTATMsgType,"SHOW_HINTS_MESSAGE",{enumerable:!1,configurable:!1,writable:!1,value:"ShowHintsMessage"});Object.defineProperty(CTATMsgType,"SUCCESS_MESSAGE",{enumerable:!1,configurable:!1,writable:!1,value:"SuccessMessage"});
Object.defineProperty(CTATMsgType,"START_STATE_END",{enumerable:!1,configurable:!1,writable:!1,value:"StartStateEnd"});Object.defineProperty(CTATMsgType,"STATE_GRAPH",{enumerable:!1,configurable:!1,writable:!1,value:"StateGraph"});Object.defineProperty(CTATMsgType,"UNTUTORED_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"UntutoredAction"});Object.defineProperty(CTATMsgType,"GO_TO_STATE",{enumerable:!1,configurable:!1,writable:!1,value:"GoToState"});
Object.defineProperty(CTATMsgType,"INTERFACE_REBOOT",{enumerable:!1,configurable:!1,writable:!1,value:"InterfaceReboot"});Object.defineProperty(CTATMsgType,"CompletionValue",{enumerable:!1,configurable:!1,writable:!1,value:["incomplete","complete"]});CTATMsgType.prototype=Object.create(CTATBase.prototype);CTATMsgType.prototype.constructor=CTATMsgType;"undefined"!==typeof module&&(module.exports=CTATMsgType);var CTATVersionComparator=function(){CTATBase.call(this,"CTATVersionComparator","");this.compare=function(a,f){if(null===a||"undefined"===typeof a)return null===f||"undefined"===typeof f?0:-1;if(null===f||"undefined"===typeof f)return 1;var g=0,e=a.split("."),c=f.split("."),b;for(b=0;b<Math.min(e.length,c.length);b++)try{var d=parseInt(e[b]),h=parseInt(c[b]),g=d<h?-1:d>h?1:0;if(0!==g)return g}catch(n){if(g=e[b].toString()<c[b].toString()?-1:e[b].toString()>c[b].toString()?1:0,0!==g)return g}return b<
e.length?1:b<c.length?-1:a.toString()<f.toString()?-1:a.toString()>f.toString()?1:0}};CTATVersionComparator.prototype=Object.create(CTATBase.prototype);CTATVersionComparator.prototype.constructor=CTATVersionComparator;CTATVersionComparator.vc=new CTATVersionComparator;"undefined"!==typeof module&&(module.exports=CTATVersionComparator);var CTATExampleTracerSkill=function(a,f,g,e,c,b,d,h){CTATBase.call(this,"CTATExampleTracerSkill",f);var n=this,l=0,p=CTATExampleTracerSkill.SKILL_BAR_DELIMITER_v2_11;this.skillName=null==a||""==a.trim()?f:f+" "+a;this.pGuess=Number(g);Number.isNaN(n.pGuess)&&(n.pGuess=CTATExampleTracerSkill.DEFAULT_P_GUESS);this.pKnown=Number(e);Number.isNaN(n.pKnown)&&(n.pKnown=CTATExampleTracerSkill.DEFAULT_P_KNOWN);this.pLearn=Number(b);Number.isNaN(n.pLearn)&&(n.pLearn=CTATExampleTracerSkill.DEFAULT_P_LEARN);
this.pSlip=Number(c);Number.isNaN(n.pSlip)&&(n.pSlip=CTATExampleTracerSkill.DEFAULT_P_SLIP);this.history=/^0*[xX]([0-9a-fA-F]+)$/.test(d)?parseInt(d,16):/^(\-|\+)?[0-9]+$/.test(d)?parseInt(d,10):CTATExampleTracerSkill.DEFAULT_HISTORY;this.opportunityCount=Number.parseInt(h);Number.isNaN(n.opportunityCount)&&(n.opportunityCount=0);this.masteryThreshold=CTATExampleTracerSkill.DEFAULT_MASTERY_THRESHOLD;this.description=this.label=null;var m=function(b,d,c,a,e,g,h){this.skillName=b;this.pGuess=d;this.pKnown=
c;this.pLearn=a;this.pSlip=e;this.history=g;this.opportunityCount=h;this.getSkillName=function(){return this.skillName}};m.prototype.constructor=m;var q=[];this.getSkillName=function(){return n.skillName};this.getCategory=function(b){null==b&&(b=n.skillName);var d=b.indexOf(" ");return 0>d?"":b.substring(d+1)};this.setTransactionNumber=function(b){l=b};this.getUpdates=function(){return q};this.updatesToJSONforTutorshop=function(){return q.map(function(b){return n.toJSONforTutorshop(b)})};this.addUpdate=
function(b){q.push(new m(b.skillName,b.pGuess,b.pKnown,b.pLearn,b.pSlip,b.history,b.opportunityCount))};this.recordUpdate=function(b){n.updatePKnown(b);n.updateHistory(b);n.changeOpportunityCount(1);q.push(new m(n.skillName,n.pGuess,n.pKnown,n.pLearn,n.pSlip,n.history,n.opportunityCount))};this.updatePKnown=function(b){n.pKnown=CTATExampleTracerSkill.updatePKnownStatic(b,n.pGuess,n.pKnown,n.pSlip,n.pLearn);return n.pKnown};this.updateHistory=function(b){n.history=CTATExampleTracerSkill.updateHistoryStatic(b,
n.history);return n.history};this.changeOpportunityCount=function(b){n.opportunityCount+=b;return n.opportunityCount};this.getTransactionNumber=function(){return l};this.getSkillBarString=function(b){var d=this.getSkillName(),d=d+this.getSkillBarDelimiter()+n.pKnown,d=d+this.getSkillBarDelimiter()+(this.hasReachedMastery()?"1":"0");!0===b&&(d=d+this.getSkillBarDelimiter()+this.getLabel());return d.toString()};this.getSkillBarDelimiter=function(){return p};this.toXML=function(b){var d;d=""+(' name="'+
CTATExampleTracerSkill.getName(n.skillName)+'"');d+=' category="'+n.getCategory()+'"';d+=' label="'+n.getLabel()+'"';d+=' description="'+n.getDescription()+'"';d+=' pKnown="'+Number(n.pKnown).toString()+'"';d+=' pLearn="'+Number(n.pLearn).toString()+'"';d+=' pGuess="'+Number(n.pGuess).toString()+'"';d+=' pSlip="'+Number(n.pSlip).toString()+'"';d+=' history="'+n.history+'"';d+=' opportunityCount="'+n.opportunityCount+'"';return b?"&lt;Skill"+d+" /&gt;":"<Skill"+d+" />"};this.toJSONforTutorshop=function(b){var d=
{};b||(b=n);d.name=CTATExampleTracerSkill.getName(b.getSkillName());d.category=CTATExampleTracerSkill.getCategory(b.getSkillName());d.p_known=b.pKnown;d.p_learn=b.pLearn;d.p_guess=b.pGuess;d.p_slip=b.pSlip;d.history=b.history;d.opportunity_count=b.opportunityCount;return d};this.getPKnown=function(){return n.pKnown};this.getPLearn=function(){return n.pLearn};this.getPGuess=function(){return n.pGuess};this.getPSlip=function(){return n.pSlip};this.getHistory=function(){return n.history};this.getOpportunityCount=
function(){return n.opportunityCount};this.setOpportunityCount=function(b){n.opportunityCount=Number(b)||0};this.hasReachedMastery=function(){return null===n.pKnown||"undefined"===typeof n.pKnown?!1:n.pKnown>=n.masteryThreshold};this.getLabel=function(){return!n.label||1>n.label.length?CTATExampleTracerSkill.getName(n.skillName):n.label};this.getDescription=function(){return!n.description||1>n.description.length?n.skillName:n.description};this.setVersion=function(b){null!==b&&"undefined"!==typeof b&&
0<b.length&&(p=CTATExampleTracerSkill.versionToSkillBarDelimiter(b))};this.setLabel=function(b){n.label=b};this.setDescription=function(b){n.description=b};CTATExampleTracerSkill.makeStepID=function(b,d){for(var c="",a=0,e=b;2>a++;e=d)if(!(null===e||"undefined"===typeof e||1>e.length)){for(var g=!1,h=0;h<e.length;h++)if(null!==e[h]&&"undefined"!==typeof e[h]){var f=e[h].toString();1>f.length||e===b&&("hint".toString().toUpperCase()===f.toString().toUpperCase()||"help".toString().toUpperCase()===f.toString().toUpperCase())||
e===d&&CTATMsgType.PREVIOUS_FOCUS.toString().toUpperCase()===f.toString().toUpperCase()||(c=c+(g?",":"[")+f,g=!0)}!0===g&&(c+="]")}return c.toString()};CTATExampleTracerSkill.updateHistoryStatic=function(b,d){var c=1<<CTATExampleTracerSkill.MAX_INTEGER_SHIFT;b=d<<1|(b.toString().toUpperCase()===CTATExampleTracerSkill.CORRECT.toString().toUpperCase()?1:0);return b&c?b^c:b};CTATExampleTracerSkill.updatePKnownStatic=function(b,d,c,a,e){var g=0;if(b.toString().toUpperCase()===CTATExampleTracerSkill.CORRECT.toString().toUpperCase())b=
+(c*(1-a)),g=+(b/(b+ +(d*(1-c))));else if(b.toString().toUpperCase()===CTATExampleTracerSkill.INCORRECT.toString().toUpperCase()||b.toString().toUpperCase()===CTATExampleTracerSkill.HINT.toString().toUpperCase())b=+(c*a),g=+(b/(b+ +((1-c)*(1-d))));return+(g+e*(1-g))};CTATExampleTracerSkill.getName=function(b){var d=b.indexOf(" ");return 0>d?b:b.substring(0,d)};CTATExampleTracerSkill.getCategory=function(b){b=null==b?"":String(b);var d=b.indexOf(" ");return 0>d?"":b.substring(d+1)};CTATExampleTracerSkill.versionToSkillBarDelimiter=
function(b){return null===b||"undefined"===typeof b?CTATExampleTracerSkill.SKILL_BAR_DELIMITER_v2_10:0<=CTATVersionComparator.vc.compare(b,"2.11")?CTATExampleTracerSkill.SKILL_BAR_DELIMITER_v2_11:CTATExampleTracerSkill.SKILL_BAR_DELIMITER_v2_10}};CTATExampleTracerSkill.fromJSON=function(a){if(!a)return null;var f=new CTATExampleTracerSkill("",""),g;for(g in a)a.hasOwnProperty(g)&&"function"!=typeof a[g]&&(f[g]=a[g]);return f};
Object.defineProperty(CTATExampleTracerSkill,"MAX_INTEGER_SHIFT",{enumerable:!1,configurable:!1,writable:!1,value:31});Object.defineProperty(CTATExampleTracerSkill,"HINT",{enumerable:!1,configurable:!1,writable:!1,value:"hint"});Object.defineProperty(CTATExampleTracerSkill,"CORRECT",{enumerable:!1,configurable:!1,writable:!1,value:"correct"});Object.defineProperty(CTATExampleTracerSkill,"INCORRECT",{enumerable:!1,configurable:!1,writable:!1,value:"incorrect"});
Object.defineProperty(CTATExampleTracerSkill,"SKILL_BAR_DELIMITER_v2_10",{enumerable:!1,configurable:!1,writable:!1,value:"="});Object.defineProperty(CTATExampleTracerSkill,"SKILL_BAR_DELIMITER_v2_11",{enumerable:!1,configurable:!1,writable:!1,value:"`"});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_MASTERY_THRESHOLD",{enumerable:!1,configurable:!1,writable:!1,value:.95});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_P_GUESS",{enumerable:!1,configurable:!1,writable:!1,value:.2});
Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_P_KNOWN",{enumerable:!1,configurable:!1,writable:!1,value:.3});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_P_SLIP",{enumerable:!1,configurable:!1,writable:!1,value:.3});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_P_LEARN",{enumerable:!1,configurable:!1,writable:!1,value:.15});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_HISTORY",{enumerable:!1,configurable:!1,writable:!1,value:0});CTATExampleTracerSkill.prototype=Object.create(CTATBase.prototype);
CTATExampleTracerSkill.prototype.constructor=CTATExampleTracerSkill;"undefined"!==typeof module&&(module.exports=CTATExampleTracerSkill);var CTATProblem=function(){CTATBase.call(this,"CTATProblem","problem");var a="",f="",g="tutor",e="",c="",b=[],d=[],h="notstarted";this.setState=function(b){h=b};this.getState=function(){return h};this.setLabel=function(b){a=b};this.getLabel=function(){return a};this.setDescription=function(b){f=b};this.getDescription=function(){return f};this.setTutorFlag=function(b){g=b};this.getTutorFlag=function(){return g};this.setProblemFile=function(b){e=b};this.getProblemFile=function(){return e};this.setStudentInterface=
function(b){c=b};this.getStudentInterface=function(){return c};this.addSkillOpps=function(c){b.push(c);d.push(new CTATExampleTracerSkill(c.category,c.name))};this.getSkillOpps=function(){return b};this.getSkills=function(){return d}};CTATProblem.prototype=Object.create(CTATBase.prototype);CTATProblem.prototype.constructor=CTATProblem;CTATProblem.prototype.toString=function(){return this.getProblemFile()+" on "+this.getStudentInterface()};var CTATProblemSet=function(){CTATBase.call(this,"CTATProblemSet","problemset");var a=this,f=[];this.addProblem=function(a){f.push(a)};this.getProblems=function(){return f};this.getProblemSize=function(){return f.length};this.getFirstProblem=function(){a.ctatdebug("getFirstProblem () problems.length "+f.length);return 0==f.length?null:f[0]}};CTATProblemSet.prototype=Object.create(CTATBase.prototype);CTATProblemSet.prototype.constructor=CTATProblemSet;var CTATPackage=function(){CTATBase.call(this,"CTATPackage","packagemanager");var a=this,f=new CTATXML,g="",e="",c="",b=new CTATProblemSet,d=[b],h={};this.init=function(b){a.ctatdebug("init ()");if(null==b)a.ctatdebug("Error: document root to be parsed is null.");else{var d=f.getElementName(b);a.ctatdebug("Root name: "+d);if(!/Package/i.test(d))return b=g.substring(g.lastIndexOf("/")+1),a.addProblem(g,c,b,b,b);b=f.getElementChildren(b);for(d=0;d<b.length;d++){var e=b[d],n=f.getElementName(e);a.ctatdebug("Examining element: "+
f.getElementName(e));switch(n){case "Problems":a.processProblemsElement(e);break;case "ProblemSets":a.processProblemSetsElement(e);break;case "Assets":h=a.processAssetsElement(e,h)}}}};this.processProblemsElement=function(b){b=f.getElementChildren(b);a.ctatdebug("CTATPackage.processProblemsElement ... nChildren="+b.length);for(var d=[],c=0;c<b.length;c++){var e=b[c],g=f.getElementAttr(e,"problem_file"),n=f.getElementAttr(e,"student_interface"),v=f.getElementAttr(e,"name"),w=f.getElementAttr(e,"label"),
B=f.getElementAttr(e,"description");h[g]=g;h[n]=n;a.ctatdebug("Problem ["+c+"] desc: "+B+", ui: "+n+", brd: "+g);g=a.addProblem(g,n,v,w,B);g.setTutorFlag(f.getElementAttr(e,"tutor_flag"));e=f.getElementChildren(e);for(n=0;n<e.length;n++)if("Skills"==f.getElementName(e[n]))for(v=f.getElementChildren(e[n]),w=0;w<v.length;w++){var B=v[w],C=0;g.addSkillOpps({name:f.getElementAttr(B,"name"),category:f.getElementAttr(B,"category"),opportunities:Number.isNaN(C=Number.parseInt(f.getElementAttr(B,"occurrences")),
10)?0:C})}d.push(g)}console.log("CTATPackage.processProblemsElement result",d);return d};this.processProblemSetsElement=function(b){b=f.getElementChildren(b);a.ctatdebug("CTATPackage.processProblemSetsElement ... nChildren="+b.length);for(var d=0;d<b.length;d++);return[]};this.processAssetsElement=function(b,d){b=f.getElementChildren(b);a.ctatdebug("CTATPackage.processAssetsElement ... nChildren="+b.length);for(var c=0;c<b.length;c++){var e=b[c],g;"Asset"==f.getElementName(e)&&"undefined"!=d[g=f.getElementAttr(e,
"name")]&&(d[g]=f.getElementAttr(e,"asset_locator"))}return d};this.addProblem=function(b,d,c,e,g){var h=new CTATProblem;h.setProblemFile(b);h.setStudentInterface(d);h.setName(c?c:b);h.setLabel(e?e:b);h.setDescription(g?g:b);a.ctatdebug("Adding problem ...");a.getProblemSets()[0].addProblem(h);return h};this.getRelativePath=function(b,d){return d?CTATPackage.makeRelativePath(h[b],h[d]):h[b]};this.setURLPrefix=function(b){e=b};this.getURLPrefix=function(){return e};this.setPackageURL=function(b){g=
b};this.getPackageURL=function(){return g};this.setDefaultStudentInterface=function(b){c=b};this.getDefaultStudentInterface=function(){return c};this.getProblems=function(){return b};this.getProblemSets=function(){return d}};CTATPackage.prototype=Object.create(CTATBase.prototype);CTATPackage.prototype.constructor=CTATPackage;
CTATPackage.makeRelativePath=function(a,f){if(!f)return a;if(!a)return f;a=String(a).split("/");f=String(f).split("/");for(var g=0,e=0,c="";g<a.length&&e<f.length&&a[g]==f[e];)e=++g;for(;g++<a.length-1;)c+="../";for(;e<f.length-1;)c=c+f[e++]+"/";return c+f[e]};var CTATConnectionBase=function(a,f){CTATBase.call(this,"CTATConnectionBase","ctatconnection");var g=-1,e="",c="http";this.setURL=function(b){e=b};this.getURL=function(){return e};this.setID=function(b){g=b};this.getID=function(){return g};this.setSocketType=function(b){c=b};this.getSocketType=function(){return c}};CTATConnectionBase.prototype=Object.create(CTATBase.prototype);CTATConnectionBase.prototype.constructor=CTATConnectionBase;var CTATConnection=function(a){function f(){d.ctatdebug("init ()");var b=flashVars?flashVars.getRawFlashVars():g?g:{},b=b.session_id?b.session_id:"dummySession";if(null!==e){"dummySession"==b&&d.ctatdebug("Unable to find CTAT session information from environment, trying OLI ...");try{e.setRequestHeader("Content-type",c.contentType),e.setRequestHeader("ctatsession",b)}catch(l){alert("HTTP object creation error: "+l.message)}}else"undefined"==typeof $?alert("Internal error: http object is null right after creation"):
c.headers.ctatsession=b;d.ctatdebug("init () done")}CTATConnectionBase.call(this,"CTATConnection");var g=a,e=null,c={contentType:"text/plain",data:null,processData:!1,method:"POST",mimeType:"text/html",headers:{}},b=!1,d=this,h=null;d.setSocketType("http");this.setContentType=function(b){c.contentType=b};this.getContentType=function(){return c.contentType};this.setConsumed=function(c){b=c;d.ctatdebug("consumed: "+b)};this.getConsumed=function(){d.ctatdebug("consumed: "+b);return b};this.assignReceiveFunction=
function(b){h=b;e&&"undefined"!=typeof e.onreadystatechange&&(e.onreadystatechange=b)};this.assignFailFunction=function(b){c.error=b;e&&"function"==typeof e.error&&e.error(b)};this.setData=function(b){c.data=b};this.getData=function(){return c.data};this.getHTTPObject=function(){return e};this.getMethod=function(){return c.method};this.setMethod=function(b){c.method=b};this.send=function(){d.ctatdebug("send ()");var b=d.getHTTPObject(),a=function(){d.ctatdebug("Networking error!")};b&&(b.onerror=
a);try{b&&b.open(d.getMethod(),d.getURL(),!0)}catch(p){d.ctatdebug("Error in newConnection.httpObject.open: "+p.message);return}f();try{"undefined"!=typeof $?e=b=$.ajax(d.getURL(),c).done(h).fail(a):c.data?b.send(c.data):b.send()}catch(p){this.ctatdebug("Error in newConnection.httpObject.send: "+p.message)}};this.then=function(b,c){var a=e&&"function"==typeof e.then;d.ctatdebug("CTATConnection.then() supported "+a+", done & fail:\n  "+b+",\n  "+c);return a?e.then(b,c):Promise.resolve("CTATConnection.then() not supported").then(b,
c)};d.ctatdebug("createHTTPObject ()");e=new XMLHttpRequest;if("undefined"!=typeof $)e=null;else if(window.XMLHttpRequest)d.ctatdebug("Creating regular XMLHttpRequest ..."),e=new XMLHttpRequest,e.overrideMimeType&&e.overrideMimeType("text/html");else if(d.ctatdebug("Trying alternative HTTP object creation ..."),window.ActiveXObject){d.ctatdebug("Detected window.ActiveXObject ...");try{d.ctatdebug("Creating Msxml2.XMLHTTP ..."),e=new ActiveXObject("Msxml2.XMLHTTP")}catch(n){try{d.ctatdebug("Creating Microsoft.XMLHTTP ..."),
e=new ActiveXObject("Microsoft.XMLHTTP")}catch(l){alert("Error: Unable to create HTTP Request Object: "+l.message)}}}else alert("Internal error: an HTTP connection object could not be created")};CTATConnection.prototype=Object.create(CTATConnectionBase.prototype);CTATConnection.prototype.constructor=CTATConnection;var CTATGuid={s4:function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},guid:function(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()}};var CTATConfiguration=function(){CTATBase.call(this,"CTATConfiguration","config");var a=this,f=0,g=null,e=null,c=null,b=null;this.raw={admit_code:"ies",authenticity_token:"",auth_token:"none",BehaviorRecorderMode:"AuthorTimeTutoring",class_name:"DefaultClass",curriculum_service_url:"",connection:"javascript",dataset_level_name:"none",dataset_level_type:"ProblemSet",dataset_name:"none",expire_logout_url:"none",info:"",instructor_name:"none",instrumentation_log:"off",lcId:"none",Logging:"None",log_service_url:"http://pslc-qa.andrew.cmu.edu/log/server",
log_to_disk_directory:".",problem_name:"none",problem_position:"none",problem_started_url:"none",problem_state_status:"empty",question_file:"",refresh_session_url:"none",remoteSocketPort:"20080",remoteSocketSecurePort:"20443",remoteSocketURL:"127.0.0.1",restore_problem_url:"",reuse_swf:"false",run_problem_url:"none",school_name:"none",SessionLog:"true",session_id:CTATGuid.guid(),session_timeout:"none",show_debug_traces:"false",skills:"",source_id:"PACT_CTAT_HTML5",student_interface:"none",student_problem_id:"none",
study_condition_name:"none",study_condition_type:"none",study_condition_description:"none",study_name:"Study1",target_frame:"_parent",TutorShopDeliveryMethod:"sendandload",tutoring_service_communication:"javascript",user_guid:"none",wmode:"opaque",ssl:"off",sui:"",centerTutor:!1,previewMode:!1,width:550,height:450};this.assignRawFlashVars=function(b){a.ctatdebug("assignRawFlashVars() raw['session_id'] "+a.raw.session_id+", aData['session_id'] "+b.session_id);a.raw=b;a.preParse()};this.getRawFlashVars=
function(){return a.raw};this.getSingleParameterValues=function(b){var d=[];if(!b)return d;var c=a.getRawFlashVars(),e;for(e in b){var g=b[e];c[g]&&"none"!=c[g]&&d.push(c[g])}return d};this.usingFlash=function(){return this.getSingleParameterValues(["student_interface","swf_name"]).some(function(b){return 0<=b.search(/[.]swf$/i)})};this.generateDefaultConfiguration=function(b,c){var d={},e=0,g=0;if(b)for(var h in b)d[h]=b[h],e++;a.ctatdebug("generateDefaultConfiguration() nDefaults "+e+", result['session_id'] "+
d.session_id);if("undefined"!=typeof c&&null!=c)for(h in c)d[h]=c[h],g++;a.ctatdebug("generateDefaultConfiguration() nLocalVars "+g);c=b=null;if(window&&window.frameElement&&(c=window.frameElement.getAttribute("data-params"))){b=JSON.parse(c);console.log("setting data params from iframe attr");for(var f in b)"object"==typeof b[f]&&(b[f]=JSON.stringify(b[f])),d[f]=CTATGlobals.EncodedParams[f]?decodeURIComponent(b[f].replace(/\+/g,"%20")):b[f],console.log("set "+f+" to "+d[f])}if(null===b)for(f=$('object param[name="flashvars"]'),
a.ctatdebug("generateDefaultConfiguration() objs "+f),b=0;b<f.length;++b)if(c=$(f[b]).attr("value"),a.ctatdebug("generateDefaultConfiguration() fVarsAsString "+c),c&&(c=parseQueryStringArgs(c))&&c.question_file)for(var u in c)d[u]=c[u];ctatdebug("tutorPrep ("+d+")");u={};if(null===d||void 0===d)ctatdebug("tutorPrep(): Internal error: null argument passed");else{ctatdebug("parseQueryString ()");f=location.search;ctatdebug("Query String: "+f);b="?"==f.charAt(0)?f.substring(1):f;f={};if(b)for(b=b.split("&"),
c=0;c<b.length;c++){e=b[c].split("=");ctatdebug("Setting flashvar "+e[0]+", to: "+decodeURIComponent(e[1].replace(/\+/g," ")));f[decodeURIComponent(e[0])]="";for(g=1;g<e.length;g++)f[decodeURIComponent(e[0])]+=(1<g?"=":"")+decodeURIComponent(e[g].replace(/\+/g," "));ctatdebug("Decoded args: "+f[decodeURIComponent(e[0])])}null!==f&&(ctatdebug("tutorPrep(): Assigning parsed arguments ..."),u=f);f=!1;for(var v in u)if(u.hasOwnProperty(v))switch(ctatdebug("Processing external FlashVar "+v+"("+u[v]+")"),
v){case "GENERATED":"on"==u[v]&&(d.session_id=CTATGuid.guid(),f=!0);break;case "BRD":d.question_file=u[v];break;case "BRMODE":d.BehaviorRecorderMode=u[v];break;case "PROBLEM":d.problem_name=u[v];break;case "DATASET":d.dataset_name=u[v];break;case "LEVEL1":d.dataset_level_name1=u[v];break;case "TYPE1":d.dataset_level_type1=u[v];break;case "LEVEL2":d.dataset_level_name2=u[v];break;case "TYPE2":d.dataset_level_type2=u[v];break;case "LEVEL3":d.dataset_level_name3=u[v];break;case "TYPE3":d.dataset_level_type3=
u[v];break;case "LEVEL4":d.dataset_level_name4=u[v];break;case "TYPE4":d.dataset_level_type4=u[v];break;case "USER":d.user_guid=u[v];break;case "SESSION":!1===f&&(d.session_id=u[v]);break;case "SOURCE":d.source_id=u[v];break;case "LOGTYPE":d.Logging=u[v];break;case "PORT":d.remoteSocketPort=u[v];break;case "REMOTEURL":d.remoteSocketURL=u[v];break;case "DISKDIR":d.log_to_disk_directory=u[v];break;case "log_service_url":d.log_service_url=u[v];break;case "URL":d.log_service_url=u[v];break;case "LOGURL":d.log_service_url=
u[v];break;case "CONNECTION":d.tutoring_service_communication=u[v];break;case "SUI":d.sui=u[v];break;case "VAR1":d.var1=u[v];break;case "VAL1":d.val1=u[v];break;case "VAR2":d.var2=u[v];break;case "VAL2":d.val2=u[v];break;case "VAR3":d.var3=u[v];break;case "VAL3":d.val3=u[v];break;case "VAR4":d.var4=u[v];break;case "VAL4":d.val4=u[v];break;case "SLOG":case "SessionLog":d.SessionLog=u[v];break;case "KEYBOARDGROUP":"Disabled"==u[v]&&(d.keyboard="disabled");"Auto"==u[v]&&(d.keyboard="auto");"On"==u[v]&&
(d.keyboard="on");break;default:d[v]=u[v]}}v=d||{};if(sessionStorage&&"function"==typeof sessionStorage.getItem){u=sessionStorage.getItem(CTATConfiguration.INIT_PARAMS);try{for(var w in u=JSON.parse(u))v[w]=u[w]}catch(B){console.log("Error parsing",CTATConfiguration.INIT_PARAMS,B)}sessionStorage.removeItem("Init-Params")}return d};this.addCustomField=function(b,c){b&&(++f,a.raw["custom_field_name"+f]=String(b),a.raw["custom_field_value"+f]=c);return f};this.getCustomFields=function(){var b={},c;for(c in a.raw){var e=
/^custom_field_name([0-9]+)$/.exec(c),g=a.raw[c];e&&g&&(b[g]=a.raw["custom_field_value"+e[1]])}return b};this.setTimeZone=function(b){a.ctatdebug("setTimeZone ("+b+")");null==b||""==b||void 0==b?(b=jstz.determine(),a.ctatdebug("Assigning detected timezone: "+b.name()),b=b.name()):(50<b.length&&(b=b.substr(0,50)),3!=b.length&&4!=b.length||a.ctatdebug("3 and 4 letter time zone abbreviations are deprecated. See list of tz database zone names for better options"));null!=a.raw&&(a.raw.timezone=b)};this.getTimeZone=
function(){return null!=a.raw&&a.raw.timezone?a.raw.timezone:"UTC"};this.listWithAmpersands=function(){var b="",c;for(c in a.raw)var e=c+"="+encodeURIComponent(a.raw[c]),b=""!=b?b+"&"+e:e;a.ctatdebug("CTATConfiguration.listWithAmpersands() result "+b.substring(0,25)+"...");return b};this.listFlashVars=function(){ctatdebug("listFlashVars ()");for(var b in a.raw)ctatdebug("["+b+"]: "+a.raw[b])};this.preParse=function(){ctatdebug("preParse ()");if(void 0==a.raw.dataset_name||void 0==a.raw.dataset_name)a.raw.dataset_name=
"DefaultDataset";var b=null;do b=!1,void 0!=a.raw["custom_field_name"+(f+1)]&&(b=!0,++f);while(b);["VAR","var"].forEach(function(d){"undefined"!=typeof(b=a.raw[d])&&a.addCustomField(d,b)})};this.getDatasetNames=function(){a.ctatdebug("getDatasetNames ()");if(null!=g)return g;g={};g=[];for(var b=0,c=!0;1==c;){var c=!1,e="dataset_level_name"+(b+1);null!=a.raw[e]&&(a.ctatdebug("Adding: "+e+","+a.raw[e]),g[b]=a.raw[e],c=!0,b++)}return g};this.getDatasetTypes=function(){a.ctatdebug("getDatasetTypes ()");
if(null!=e)return e;e=[];for(var b=0,c=!0;1==c;){var c=!1,g="dataset_level_type"+(b+1);null!=a.raw[g]&&(a.ctatdebug("Adding: "+g+","+a.raw[g]),e[b]=a.raw[g],c=!0,b++)}return e};this.getConditionNames=function(){var b=[],c=0;void 0!=a.raw.study_condition_name&&""!=a.raw.study_condition_name&&(b.push(a.raw.study_condition_name),c++);for(var e=0,g=!0;1==g;){var g=!1,f="study_condition_name"+(e+1);null!=a.raw[f]&&(a.ctatdebug("Adding: "+f+","+a.raw[f]),b[e+c]=a.raw[f],g=!0,e++)}return b};this.getConditionTypes=
function(){c=[];var b=0;void 0!=a.raw.study_condition_type&&""!=a.raw.study_condition_type&&(c.push(a.raw.study_condition_type),b++);for(var e=0,g=!0;1==g;){var g=!1,f="study_condition_type"+(e+1);null!=a.raw[f]&&(a.ctatdebug("Adding: "+f+","+a.raw[f]),c[e+b]=a.raw[f],g=!0,e++)}return c};this.getConditionDescriptions=function(){a.ctatdebug("getConditionDescriptions ()");b=[];var d=0;a.raw.study_condition_description&&""!==a.raw.study_condition_description&&(a.ctatdebug("Adding study_condition_description: "+
a.raw.study_condition_description),b.push(a.raw.study_condition_description),d++);for(var c=0,e=!0;!0===e;){var e=!1,g="study_condition_description"+(c+1);null!=a.raw[g]&&(a.ctatdebug("Adding: "+g+","+a.raw[g]),b[c+d]=a.raw[g],e=!0,c++)}return b};this.get=function(b){return a.raw[b]};this.set=function(b,c){b&&(a.raw[b]=c)};this.setParams=function(b){if(b)for(var d in b)a.set(d,b[d])};this.isInstructorMode=function(){var b=this.getRawFlashVars();return b&&b.deliverymode?"delivery"==b.deliverymode?
!1:!0:!1};this.getLoggingLibrary=function(){null===commLoggingLibrary&&(commLoggingLibrary=new CTATLoggingLibrary(!0));return commLoggingLibrary};this.setPreviewMode=function(b,c){a.raw.previewMode=c};this.setCenterTutor=function(b,c){a.raw.centerTutor=c};this.setTutorWidth=function(b,c){a.raw.width=c};this.setTutorHeight=function(b,c){a.raw.height=c};this.setTutorDimensions=function(b,c,e){a.raw.width=c;a.raw.height=e};this.setTutorValue=function(b,c,e){a.raw[c]=e};this.setCommunicationMode=function(b,
c){a.raw.tutoring_service_communication=c};this.setRemoteSocketURL=function(b,c){a.raw.remoteSocketURL=c};this.setRemoteSocketPort=function(b,c){a.raw.remoteSocketPort=c}};CTATConfiguration.INIT_PARAMS="Init-Params";CTATConfiguration.prototype=Object.create(CTATBase.prototype);CTATConfiguration.prototype.constructor=CTATConfiguration;flashVars=CTATConfiguration.theConfObject=null;
CTATConfiguration.generateDefaultConfigurationObject=function(a,f){if(!CTATConfiguration.theConfObject){CTATConfiguration.theConfObject=new CTATConfiguration;var g=CTATConfiguration.theConfObject.generateDefaultConfiguration(CTATConfiguration.theConfObject.raw,a);CTATConfiguration.theConfObject.assignRawFlashVars(g);"none"==CTATConfiguration.theConfObject.get("session_id")&&CTATConfiguration.theConfObject.set("session_id",CTATGuid.guid());flashVars=CTATConfiguration.theConfObject;console.log("CTATConfiguration.generateDefaultConfigurationObject() flashVars.getRawFlashVars()['session_id'] "+
flashVars.getRawFlashVars().session_id);console.log("flashVars.getRawFlashVars()['remoteSocketPort'] "+flashVars.getRawFlashVars().remoteSocketPort)}"Default"!=f&&"OLI"!=f||CTATConfiguration.theConfObject.setParams(a);return CTATConfiguration.theConfObject};CTATConfiguration.getRawFlashVars=function(){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.getRawFlashVars()};
CTATConfiguration.get=function(a){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.get(a)};CTATConfiguration.set=function(a,f){CTATConfiguration.generateDefaultConfigurationObject();CTATConfiguration.theConfObject.set(a,f)};CTATConfiguration.getCustomFields=function(){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.getCustomFields()};
CTATConfiguration.addCustomField=function(a,f){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.addCustomField(a,f)};CTATConfiguration.setParams=function(a){CTATConfiguration.generateDefaultConfigurationObject();CTATConfiguration.theConfObject.setParams(a)};CTATConfiguration.getSingleParameterValues=function(a){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.getSingleParameterValues(a)};
CTATConfiguration.usingFlash=function(){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.usingFlash()};CTATConfiguration.prototype.set=CTATConfiguration.prototype.set;CTATConfiguration.prototype.get=CTATConfiguration.prototype.get;var CTATWSConnection=function(a){CTATConnectionBase.call(this,"CTATWSConnection");var f="",g=!1,e=this,c=null,b=[],d=!1,h=0,n=0,l=null,p=null;e.setSocketType("ws");this.setConsumed=function(b){g=b;e.ctatdebug("consumed: "+g)};this.getConsumed=function(){e.ctatdebug("consumed: "+g);return g};this.assignReceiveFunction=function(b){l=b};this.assignCloseFunction=function(b){p=b};this.setData=function(b){f=b};this.getData=function(){return f};this.init=function(){ctatdebug("init ("+e.getURL()+"); websocket "+
c);null==c&&(c=new WebSocket(e.getURL()),c.addEventListener("open",function(a){ctatdebug("STATUS: open");d=!0;ctatdebug("Connection open, flushing outgoing queue ...");h=(new Date).getTime();if(0<b.length){for(a=0;a<b.length;a++)c.send(b[a]);b=[]}}),c.addEventListener("message",function(b){n=(new Date).getTime();ctatdebug("STATUS: message after "+(n-h)+" ms");ctatdebug("Received: "+b.data);l?l(b.data):ctatdebug("Error: no processing function provided")}),c.addEventListener("close",function(b){ctatdebug("STATUS: close; "+
(b?"code "+b.code+", reason "+b.reason:"no event"));d=!1;c.close(1E3,b?b.reason?b.reason:"received close code "+b.code:"no close event received");p&&p(b)}),c.addEventListener("error",function(b){ctatdebug("STATUS: error; "+(b?b.type:"no event"));d=!1;c.close(1E3,"client closing in response to error")}),ctatdebug("init () done"))};this.send=function(){ctatdebug("send ()");e.init();!1===d?(ctatdebug("Connection not ready yet, storing ..."),b.push(f)):(ctatdebug("Connection ready, sending data ..."),
h=(new Date).getTime(),c.send(f))};this.getWebSocket=function(){return c};this.close=function(b,a){d=!1;p=a||p;c.close(1E3,b||"no reason")}};CTATWSConnection.prototype=Object.create(CTATConnectionBase.prototype);CTATWSConnection.prototype.constructor=CTATWSConnection;var CTATCanvasComponent=function(a){var f=this,g=[];this.addShape=function(a){g.push(a)};this.hideShape=function(a){for(var c=0;c<g.length;c++)if(g[c].getName()==a){g[c].modifyCanvasCSS("visibility","hidden");break}};this.showShape=function(a){for(var c=0;c<g.length;c++)if(g[c].getName()==a){g[c].modifyCanvasCSS("visibility","visible");break}};this.hideComponent=function(){for(var a=0;a<g.length;a++)g[a].modifyCanvasCSS("visibility","hidden")};this.showComponent=function(){for(var a=0;a<g.length;a++)g[a].modifyCanvasCSS("visibility",
"visible")};this.moveShape=function(a,c,b){for(var d=0;d<g.length;d++)if(g[d].getName()==a){g[d].modifyCanvasCSS("left",c+"px");g[d].modifyCanvasCSS("top",b+"px");break}};this.moveComponent=function(a,c){for(var b=0;b<g.length;b++)g[b].modifyCanvasCSS("left",a+"px"),g[b].modifyCanvasCSS("top",c+"px")};this.removeShape=function(a){for(var c=0,b=0;b<g.length;b++)if(g[b].getName()==a){c=b;break}g[c].detatchCanvas();g.splice(c,1)};this.removeComponent=function(){for(;0<g.length;)f.removeShape(g[0].getName())}};var scrimIsUp=!1,errorScrim=!1,waitScrim=!0,warnScrim=!1,connectionScrim=!1,authorTimeSet=!0,inAuthorTime=!0,CTATScrim=function(){function a(){warnScrim=!1;w.scrimDown()}function f(b){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&w.scrimDownForced(),w.ctatdebug("errScrimUp ("+b+")"),!0===errorScrim?!0===d&&(d=!1,getSafeElementById(ctatcontainer).removeChild(u)):!0===warnScrim&&(d=!0),w.scrimUp(b))}function g(b,d){w.ctatdebug("makeHTMLButton ()");var c=document.createElement("input");c.type="button";
c.value=d;b?(w.ctatdebug("clickHandle!=null"),c.onclick=b):(w.ctatdebug("clickHandle==null"),c.onclick=w.defaultClickHandler);c.id=d;c.setAttribute("class","scrimButton");return c}CTATBase.call(this,"CTATScrim","__undefined__");var e="",c=!1,b=!1,d=!1,h=null,n=null,l=new CTATCanvasComponent("CTAT Scrim"),p=[],m=null,q=null,u=null,v=null,w=this;this.scrimUp=function(f,p){if("google"!=CTATConfig.platform){w.ctatdebug("scrimUp ("+f+", "+p+")");if(p)return setTimeout(w.scrimUp.bind(w,f),p);f=CTATGlobals.languageManager.filterString(f);
w.ctatdebug("Message: "+f);!0===scrimIsUp?(e=!0===waitScrim?f:e+(" \n "+f),l.removeComponent(),w.removeHTMLElements()):(e=f,scrimIsUp=!0);w.ctatdebug("scrimUp() to call drawScrim() scrimIsUp "+scrimIsUp);w.ctatdebug("drawScrim ()");if("google"==CTATConfig.platform)w.ctatdebug("This is not available for now when we're in this environment");else if($('<div id="scrim" class="ctatpageoverlay"></div>').appendTo("body"),$("#scrim").css("z-index",1E3),"google"!=CTATConfig.platform&&($("#scrimpanel").empty(),
$("#scrim").append('<div class="css3-windows-7"><div class="fenster"><h4 class="titel"></h4><div id="scrimpanel" class="inhalt"><br>'+e+"<br><br></div></div></div>"),!0===d&&(waitScrim=!1,u=g(a,"close"),$(u).appendTo("#scrimpanel")),!0===c&&(waitScrim=!1,m=g(h,"yes"),$(m).appendTo("#scrimpanel"),c=!1),!0===b&&(waitScrim=!1,q=g(n,"no"),$(q).appendTo("#scrimpanel"),b=!1),!0===waitScrim)){w.ctatdebug("Adding spinner ...");$("#scrimpanel").append("<br>");f=$('<div id="scrim_spin">');f.css("width",
"100%");f.css("position","relative");$("#scrimpanel").append(f);try{var B=(new Spinner({className:"scrim_spinner"})).spin();$("#scrim_spin").append(B.el)}catch(G){(G instanceof ReferenceError||G instanceof TypeError)&&w.ctatdebug('Spinner is not available, please include it in the build or add <script src="node_modules/spin.js/spin.min.js">\x3c/script> to the html file.',G,typeof G)}}}};this.waitScrimUp=function(){w.ctatdebug("waitScrimUp () CTATConfig.platform "+CTATConfig.platform+", scrimIsUp "+
scrimIsUp);"google"!=CTATConfig.platform&&(!0===scrimIsUp&&w.scrimDownForced(),waitScrim=!0,w.scrimUp(CTATGlobals.languageManager.getString("LOADING")),w.ctatdebug("return from waitScrimUp(): scrimIsUp "+scrimIsUp))};this.nextProblemScrimUp=function(){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&w.scrimDownForced(),w.ctatdebug("nextProblemScrimUp ()"),w.scrimUp(CTATGlobals.languageManager.getString("NEXTPROBLEM")))};this.OKScrimUp=function(a,e){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&w.scrimDownForced(),
w.ctatdebug("OKScrimUp ("+a+","+e+")"),waitScrim=b=c=d=warnScrim=errorScrim=!1,w.scrimUp(a),v=g(e,"OK"),$(v).appendTo("#scrimpanel"))};this.confirmScrimUp=function(d,a,e){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&w.scrimDownForced(),w.ctatdebug("confirmScrimUp ("+d+","+a+","+e+")"),b=c=!0,n=e,h=a,w.scrimUp(d))};this.errorScrimUp=function(b){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&w.scrimDownForced(),!1===authorTimeSet?(w.ctatdebug("we don't know if we're in authorTime or not yet so we're just going to hold onto the messasge"),
p.push("ERROR: "+b),errorScrim=!0):!1===inAuthorTime?w.ctatdebug("We're not in authorTime, student's don't need to see our design mistakes"):(errorScrim=!0,f("ERROR: "+b)))};this.warningScrimUp=function(b){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&w.scrimDownForced(),!1===authorTimeSet?(w.ctatdebug("we don't know if we're in authorTime or not yet so we're just going to hold onto the messasge"),p.push("WARNING: "+b),warnScrim=!0):!1===inAuthorTime?w.ctatdebug("We're not in authorTime, student's don't need to see our design mistakes"):
(warnScrim=!0,f("WARNING: "+b)))};this.handleTSDisconnect=function(){connectionScrim=!0;w.scrimUp(CTATGlobals.languageManager.getString("TUTORDISCONNECTED"))};this.removeHTMLElements=function(){};this.scrimDown=function(){"google"!=CTATConfig.platform&&(!1===scrimIsUp?w.ctatdebug("The scrim isn't up, returning"):!0===errorScrim?w.ctatdebug("The scrim is up to describe errors to the user, leave it up!"):!0===warnScrim?w.ctatdebug("The scrim is up to display warnings to the user, leave it up!"):!0===
connectionScrim?w.ctatdebug("The scrim is up for a connection issue leave it up!"):w.scrimDownForced())};this.scrimDownForced=function(){w.ctatdebug("enter scrimDownForced() scrimIsUp "+scrimIsUp);$("#scrim").remove();l.removeComponent();w.removeHTMLElements();waitScrim=scrimIsUp=!1;e="";w.ctatdebug("exit scrimDownForced() scrimIsUp "+scrimIsUp)};this.defaultClickHandler=function(){w.ctatdebug("defaultClickHandler ()");w.scrimDown()};this.setInAuthorTime=function(b){w.ctatdebug("setting inAuthorTime = "+
b);authorTimeSet=!0;inAuthorTime=b;if(!b)warnScrim=errorScrim=!1,d&&null.removeChild(u);else if(errorScrim||warnScrim)for(var c in p)f(c)};this.getInAuthorTime=function(){return inAuthorTime}};CTATScrim.prototype=Object.create(CTATBase.prototype);CTATScrim.prototype.constructor=CTATScrim;CTATGlobals.languageManager=CTATLanguageManager.theSingleton;CTATScrim.scrim=new CTATScrim;var CTAT=function(){};"undefined"!=typeof window&&null!=window&&(window.CTAT=CTAT);"undefined"!==typeof module&&(module.exports=CTAT);CTAT.ToolTutor={interfaceMessages:[],tutorMessages:[]};
Object.defineProperty(CTAT.ToolTutor,"message_handler",{enumerable:!0,get:function(){if(window.hasOwnProperty("getInterfaceObject")&&"function"===typeof window.getInterfaceObject)return window.getInterfaceObject();if(window.hasOwnProperty("interfaceObject"))return window.interfaceObject;this.hasOwnProperty("_interface")||(this._interface=null);return this._interface},set:function(a){window.hasOwnProperty("interfaceObject")?window.interfaceObject=a:this._interface=a;return a}});
Object.defineProperty(CTAT.ToolTutor,"tutor",{enumerable:!0,get:function(){if(window.hasOwnProperty("getTutorObject")&&"function"===typeof window.getTutorObject)return window.getTutorObject();if(window.hasOwnProperty("tutorObject"))return window.tutorObject;this.hasOwnProperty("_tutor")||(this._tutor=null);return this._tutor},set:function(a){window.hasOwnProperty("tutorObject")?window.tutorObject=a:this._tutor=a;return a}});
CTAT.ToolTutor.registerTutor=function(a){if(window.hasOwnProperty("registerTutor")&&"function"===typeof window.registerTutor)return window.registerTutor(a);if(this.tutor=a)for(;0<this.tutorMessages.length;)this.sendToTutor(this.tutorMessages.shift())};
CTAT.ToolTutor.sendToInterface=function(a){return window.hasOwnProperty("sendToInterface")&&"function"===typeof window.sendToInterface?window.sendToInterface.apply(null,arguments):this.message_handler?this.message_handler.receiveFromTutor(a):commMessageHandler?commMessageHandler.processMessage(a):this.interfaceMessages.push(a)};CTAT.ToolTutor.registerInterfaceMessageHandler=function(a){"string"===typeof a&&(a=document.getElementById(a));if(this.message_handler=a)for(;0<this.interfaceMessages.length;)this.sendToInterface(this.interfaceMessages.shift())};
CTAT.ToolTutor.registerInterface=function(a){if(window.hasOwnProperty("registerInterface")&&"function"===typeof window.registerInterface)return window.registerInterface(a);this.registerInterfaceMessageHandler(a)};CTAT.ToolTutor.sendToTutor=function(a){return window.hasOwnProperty("sendToTutor")&&"function"===typeof window.sendToTutor?window.sendToTutor(a):this.tutor?this.tutor.receiveFromInterface(a):this.tutorMessages.push(a)};
CTAT.ToolTutor.reboot=function(a,f,g){var e="undefined"!=typeof location&&location&&location.href?location.href:null;e&&console.log("ToolTutor.reboot("+a+"), setting location to "+e,g);return e&&!CTATConfiguration.get("editorMode")?(g&&sessionStorage&&"function"==typeof sessionStorage.setItem&&sessionStorage.setItem(CTATConfiguration.INIT_PARAMS,JSON.stringify(g)),f?location.replace(e):setTimeout(location.replace.bind(location),600,e),!0):!1};var CTATTutorMessageBuilder=function(){CTATBase.call(this,"CTATTutorMessageBuilder","__undefined__")};CTATTutorMessageBuilder.isHint=function(a){return null===a||"undefined"===typeof a?!1:0===a.toString().toLowerCase().indexOf(CTATTutorMessageBuilder.HINT.toLowerCase())};CTATTutorMessageBuilder.isCorrect=function(a){if(null===a||"undefined"===typeof a)return!1;a=a.toString().toLowerCase();return 0===a.indexOf(CTATTutorMessageBuilder.CORRECT.toLowerCase())?!0:0===a.indexOf(CTATExampleTracerLink.SUCCESS.toLowerCase())};
CTATTutorMessageBuilder.prototype=Object.create(CTATBase.prototype);CTATTutorMessageBuilder.prototype.createInCorrectActionMessage=function(a,f){this.ctatdebug("createInCorrectActionMessage ()");a="<message><verb>SendNoteProperty</verb><properties><MessageType>InCorrectAction</MessageType>"+("<transaction_id>"+a+"</transaction_id>");this.ctatdebug("In CTATTutorMessageBuilder "+f);a+=f.toXMLString(!1);return a+"</properties></message>"};
CTATTutorMessageBuilder.prototype.createCorrectActionMessage=function(a,f){this.ctatdebug("createCorrectActionMessage ()");a="<message><verb>SendNoteProperty</verb><properties><MessageType>CorrectAction</MessageType>"+("<transaction_id>"+a+"</transaction_id>")+f.toXMLString(!1);return a+"</properties></message>"};
CTATTutorMessageBuilder.prototype.createAssociatedRulesMessageForHint=function(a,f,g,e,c,b,d,h,n){d=void 0==d?a.length:d;h=void 0==h?1:h;f="<message><verb>SendNoteProperty</verb><properties><MessageType>AssociatedRules</MessageType><Indicator>Hint</Indicator>"+(f?f:new CTATSAI("","","")).toXMLString();f+="<TutorAdvice>";for(var l=0;l<a.length;l++)f+="<value><![CDATA["+a[l]+"]]\x3e</value>";f=f+("</TutorAdvice><TotalHintsAvailable>"+d+"</TotalHintsAvailable><CurrentHintNumber>"+h+"</CurrentHintNumber>")+
("<Actor>"+g+"</Actor>")+this.fmtSkillBarVector(e);f+="<skillBarDelimiter><![CDATA[`]]\x3e</skillBarDelimiter>";if(c||0===c)f+="<StepID>"+c+"</StepID>";f+="<transaction_id>"+b+"</transaction_id>";f+="<LogAsResult>true</LogAsResult>";f+=this.formatCustomFields(n);return f+="</properties></message>"};
CTATTutorMessageBuilder.prototype.createAssociatedRulesMessageForAction=function(a,f,g,e,c,b,d,h,n,l,p,m){this.ctatdebug("TMB.createAssociatedRulesMessageForAction(indicator "+a+", sai "+f+", actor "+g+", studentSAI "+e+",\n  skillBarVector "+c+", stepID "+b+", transactionID "+d+",\n  tutorAdvice "+h+", outOfOrder "+n+", traceOutcome "+p+", buggyStepID "+m);var q="<message><verb>SendNoteProperty</verb><properties><MessageType>AssociatedRules</MessageType>",q=q+("<Indicator>"+(CTATTutorMessageBuilder.isCorrect(a)?
"Correct":"InCorrect")+"</Indicator>"),q=q+(f?f:new CTATSAI("","","")).toXMLString();a=e.toXMLString().replace("<Selection>","<StudentSelection>").replace("<Action>","<StudentAction>").replace("<Input>","<StudentInput>");a=a.replace("</Selection>","</StudentSelection>").replace("</Action>","</StudentAction>").replace("</Input>","</StudentInput>");q+=a;q+="<Actor>"+g+"</Actor>";q+=this.fmtSkillBarVector(c);q+="<skillBarDelimiter><![CDATA[`]]\x3e</skillBarDelimiter>";q+="<StepID>"+b+"</StepID>";m&&
(q+="<BuggyStepID>"+m+"</BuggyStepID>");q+="<transaction_id>"+d+"</transaction_id>";h&&(h=h instanceof Array?h:[h],q+="<TutorAdvice>",h.forEach(function(b){return q+="<value><![CDATA["+b+"]]\x3e</value>"}),q+="</TutorAdvice>",q+="<TotalHintsAvailable>"+h.length+"</TotalHintsAvailable><CurrentHintNumber>1</CurrentHintNumber>");q+="<LogAsResult>true</LogAsResult>";q+="<end_of_transaction>"+(h?!1:!0)+"</end_of_transaction>";q+="undefined"!=typeof n&&n?"<OutOfOrder>true</OutOfOrder>":"";q+=p?"<"+CTATMsgType.TRACE_OUTCOME+
">"+p+"</"+CTATMsgType.TRACE_OUTCOME+">":"";q+=this.formatCustomFields(l);return q+="</properties></message>"};CTATTutorMessageBuilder.prototype.formatCustomFields=function(a){var f="";if(a)for(var g in a)a.hasOwnProperty(g)&&(f+="<custom_field><name>"+g+"</name><value>"+(null==a[g]?"":a[g].toString())+"</value></custom_field>");return f?"<custom_fields>"+f+"</custom_fields>":""};
CTATTutorMessageBuilder.prototype.isDoneStep=function(a,f){f[0]=!1;var g=a.getIndicator();if(!g)return!1;var e=a.getStudentSelection();e||(e=a.getProperty("tool_selection"));f[0]=CTATTutorMessageBuilder.isCorrect(indicator);a="done"==e;this.ctatdebug("isDoneStep() indicatorObj "+g+", selectionObj "+e+", correct[0] "+f[0]+", result "+a);return a};
CTATTutorMessageBuilder.prototype.createHintMessage=function(a,f,g,e){g="<message><verb>SendNoteProperty</verb><properties><MessageType>ShowHintsMessage</MessageType><HintsMessage>";for(var c=0;c<a.length;c++)g+="<value><![CDATA["+a[c]+"]]\x3e</value>";g+="</HintsMessage>";f&&f.toXMLString&&(g+=f.toXMLString());return g+("<transaction_id>"+e+"</transaction_id>")+"</properties></message>"};
CTATTutorMessageBuilder.prototype.createErrorMessage=function(a,f){a="<message><verb>SendNoteProperty</verb><properties><MessageType>TutoringServiceError</MessageType><ErrorType>"+a+"</ErrorType><Details>"+(f?f:"");return a+="</Details></properties></message>"};
CTATTutorMessageBuilder.prototype.createSuccessMessage=function(a,f){f=f instanceof Array?f:[f];var g="<message><verb>SendNoteProperty</verb><properties><MessageType>SuccessMessage</MessageType>",g=g+"<SuccessMsg>";f.forEach(function(a){return g+="<value><![CDATA["+a+"]]\x3e</value>"});g+="</SuccessMsg>";g+="<transaction_id>"+a+"</transaction_id>";g+="<end_of_transaction>true</end_of_transaction>";return g+="</properties></message>"};
CTATTutorMessageBuilder.prototype.createBuggyMessage=function(a,f){f=f instanceof Array?f:[f];var g="<message><verb>SendNoteProperty</verb><properties><MessageType>BuggyMessage</MessageType>",g=g+"<BuggyMsg>";f.forEach(function(a){return g+="<value><![CDATA["+a+"]]\x3e</value>"});g+="</BuggyMsg>";g+="<transaction_id>"+a+"</transaction_id>";g+="<end_of_transaction>true</end_of_transaction>";return g+="</properties></message>"};
CTATTutorMessageBuilder.prototype.createLockWidgetMsg=function(a){return"<message><verb>SendNoteProperty</verb><properties><MessageType>SendWidgetLock</MessageType>"+("<WidgetLockFlag>"+a+"</WidgetLockFlag>")+"</properties></message>"};
CTATTutorMessageBuilder.prototype.createMessage=function(a,f){var g="<message><verb>SendNoteProperty</verb><properties><MessageType>"+a+"</MessageType>";if(f)for(var e in f)g+="<"+e+">"+f[e]+"</"+e+">";g+="</properties></message>";this.ctatdebug("CTATTutorMessageBuilder.createMessage("+a+", "+f+") returns "+g);return g};
CTATTutorMessageBuilder.prototype.createStateGraphMessage=function(a,f,g,e,c,b,d){a="<message><verb>SendNoteProperty</verb><properties><MessageType>StateGraph</MessageType>"+("<caseInsensitive>"+a+"</caseInsensitive>")+("<unordered>"+f+"</unordered>")+("<lockWidget>"+g+"</lockWidget>");a+="<suppressStudentFeedback>"+e+"</suppressStudentFeedback>";a+="<highlightRightSelection>"+c+"</highlightRightSelection>";a+="<confirmDone>"+b+"</confirmDone>";a+="<skillBarDelimiter><![CDATA[`]]\x3e</skillBarDelimiter>";
a+=this.fmtSkillBarVector(d);return a+="</properties></message>"};CTATTutorMessageBuilder.prototype.fmtSkillBarVector=function(a){var f="";if(void 0!==a&&null!==a&&0<a.length){for(var f=f+"<Skills>",g=0;g<a.length;g++)f+="<value><![CDATA["+a[g]+"]]\x3e</value>";f+="</Skills>"}return f};
CTATTutorMessageBuilder.prototype.createHighlightWidgetMessage=function(a,f,g,e){a="<message><verb>SendNoteProperty</verb><properties><MessageType>HighlightMsg</MessageType>"+("<HighlightMsgText>"+g+"</HighlightMsgText>")+("<Selection><value>"+a+"</value></Selection>")+("<Action><value>"+f+"</value></Action>");a+="<transaction_id>"+e+"</transaction_id>";a+="<end_of_transaction>true</end_of_transaction>";return a+="</properties></message>"};
Object.defineProperty(CTATTutorMessageBuilder,"TRIGGER",{enumerable:!1,configurable:!1,writable:!1,value:"trigger"});Object.defineProperty(CTATTutorMessageBuilder,"SUBTYPE",{enumerable:!1,configurable:!1,writable:!1,value:"subtype"});Object.defineProperty(CTATTutorMessageBuilder,"TUTOR_PERFORMED",{enumerable:!1,configurable:!1,writable:!1,value:"tutor-performed"});Object.defineProperty(CTATTutorMessageBuilder,"HINT",{enumerable:!1,configurable:!1,writable:!1,value:"Hint"});
Object.defineProperty(CTATTutorMessageBuilder,"CORRECT",{enumerable:!1,configurable:!1,writable:!1,value:"Correct"});CTATTutorMessageBuilder.prototype.constructor=CTATTutorMessageBuilder;"undefined"!==typeof module&&(module.exports=CTATTutorMessageBuilder);var CTATLMS={identifier:null,initLMSConnection:function(){},closeLMSConnection:function(){},setValue:function(a,f){},getValue:function(a){return null},saveProblemState:function(a){if(CTATConfiguration.get("restoreProblemUrl")&&CTATConfiguration.get("curriculum_service_url")){var f=[],g;for(g in a)f.push(g+"="+encodeURIComponent(a[g]));$.post(CTATConfiguration.get("curriculum_service_url"),f.join("&"),null,"application/x-www-form-urlencoded")}},getProblemState:function(a){CTATConfiguration.get("restoreProblemUrl")?
$.get(CTATConfiguration.get("restoreProblemUrl"),"",null,"text").done(function(f){a(f)}).fail(function(f,g,e){a(null);f=(new CTATTutorMessageBuilder).createErrorMessage("Load ProblemState Error",g+" "+e);CTAT.ToolTutor.sendToInterface(f,!0)}):a(null)},gradeStudent:function(a,f){},logEvent:function(a){},processProblemSummary:function(a){},visibilityChange:function(a){},exitTutor:null,is:{},init:{}};
CTATLMS.init.StandAlone=function(){CTATLMS.identifier=null;CTATLMS.initLMSConnection=function(){};CTATLMS.closeLMSConnection=function(){};CTATLMS.commit=function(){};CTATLMS.setValue=function(){};CTATLMS.getValue=function(){return null};CTATLMS.logEvent=function(a){};CTATLMS.saveProblemState=function(){};CTATLMS.getProblemState=function(a){return a(null)};CTATLMS.gradeStudent=function(){};CTATLMS.processProblemSummary=function(){}};CTATLMS.is.SCORM=function(){return window.location.search&&/[?&;]mode=SCORM/i.test(window.location.search)};
CTATLMS.init.SCORM=function(){var a=!1;CTATLMS.identifier="SCORM";CTATLMS.initLMSConnection=function(){if(!0!==a){window.parent.doLMSInitialize();var f=CTATLMS.getValue("cmi.core.lesson_status");CTATConfiguration.set("problem_state_status",f);"not attempted"==f&&CTATConfiguration.set("problem_state_status","incomplete");"passed"==f&&CTATConfiguration.set("problem_state_status","completed");"failed"==f&&CTATConfiguration.set("problem_state_status","incomplete");"browsed"==f&&CTATConfiguration.set("problem_state_status",
"incomplete");CTATLMS.setValue("cmi.core.lesson_status","incomplete");a=!0}};CTATLMS.commit=window.parent.doLMSCommit;CTATLMS.closeLMSConnection=window.parent.doLMSFinish;CTATLMS.setValue=window.parent.doLMSSetValue;CTATLMS.getValue=window.parent.doLMSGetValue;CTATLMS.logEvent=function(a){};CTATLMS.saveProblemState=function(a){return CTATLMS.setValue("cmi.suspend_data",a.problem_state)};CTATLMS.getProblemState=function(a){var g=CTATLMS.getValue("cmi.suspend_data");if(!g&&window.parent&&"function"==
typeof window.parent.doLMSGetLastError){var e=window.parent.doLMSGetLastError();if(0!=e)return console.log("Empty result with error "+e+" from LMS.getValue('cmi.suspend_data'):",window.parent.doLMSGetErrorString?window.parent.doLMSGetErrorString(e):""),a(null)}return a(g)};CTATLMS.gradeStudent=function(a,g){CTATLMS.setValue("cmi.core.score.min",0);CTATLMS.setValue("cmi.core.score.max",100);return CTATLMS.setValue("cmi.core.score.raw",Number((a/g).toFixed(2).replace(/[.]/,"")))};CTATLMS.processProblemSummary=
function(a){a=a.getXMLObject();["cmi.core.lesson_status","cmi.core.score.raw","cmi.core.exit","cmi.core.session_time"].forEach(function(a){var e=this.getElementsByTagName(a);CTATLMS.setValue(a,$("<div>").html(e[0].innerHTML).text())},a);CTATLMS.commit();CTATLMS.closeLMSConnection()};CTATLMS.initLMSConnection()};CTATLMS.is.XBlock=function(){return window.location.search&&/[?&;]mode=XBlock/i.test(window.location.search)};
CTATLMS.init.XBlock=function(){var a=document.referrer?(new URL(document.referrer)).origin:"";CTATLMS.identifier="XBlock";CTATLMS.initLMSConnection=function(){};CTATLMS.closeLMSConnection=function(){};CTATLMS.commit=function(){};CTATLMS.setValue=function(a,g){};CTATLMS.getValue=function(a){return null};CTATLMS.saveProblemState=function(f){parent.postMessage({action:"save_problem_state",input:window.btoa(f.problem_state)},a)};CTATLMS.getProblemState=function(a){return a(window.atob(CTATConfiguration.get("saveandrestore")))};
CTATLMS.gradeStudent=function(f,g){parent.postMessage({action:"grade",input:{value:f,max:g}},a)};CTATLMS.logEvent=function(f){parent.postMessage({action:"log",input:f},a)};CTATLMS.processProblemSummary=function(a){}};CTATLMS.is.Authoring=function(){return window.location.search&&/[?&;]mode=AUTH(ORING)?/i.test(window.location.search)};CTATLMS.is.ToolsListener=function(){return window.location.search&&/[?&;]mode=ctatAsListener/i.test(window.location.search)};
CTATLMS.is.OLI=function(){return window.frameElement&&window.frameElement.getAttribute("data-superactivityserver")||"undefined"!=typeof CTATTarget&&"OLI"==CTATTarget};CTATLMS.is.TutorShop=function(){return window.frameElement&&/"LMS":\s*"TutorShop"/i.test(window.frameElement.getAttribute("data-params"))};
CTATLMS.init.TutorShop=function(){CTATLMS.identifier="TutorShop";CTATLMS.initLMSConnection=function(){};CTATLMS.closeLMSConnection=function(){};CTATLMS.commit=function(){};CTATLMS.setValue=function(a,f){};CTATLMS.getValue=function(a){return null};CTATLMS.logEvent=function(a){};CTATLMS.lastSaveTime=Date.now();CTATLMS.lastSave=Promise.resolve("CTATLMS.lastSaveTime "+Date(CTATLMS.lastSaveTime));CTATLMS.saveProblemState=function(a,f,g){return CTATLMS.lastSave=CTATLMS.lastSave.then(function(e){if((f=f||
CTATConfiguration.get("curriculum_service_url"))&&(g||CTATConfiguration.get("restore_problem_url"))){var c=CTATLMS.lastSaveTime;console.log("CTATLMS elapsed",(CTATLMS.lastSaveTime=Date.now())-c,"r: "+e+"; data",a);a.session_id=a.session_id?a.session_id:"dummySession";e=new FormData;for(var b in a)e.append(b,a[b]);return fetch(f,{method:"POST",body:e,headers:new Headers({Accept:"application/json"})}).then(function(b){return b.ok?b.text():"Error "+b.status+": "+b.statusText})}return Promise.resolve("not saving: restore_problem_url or curriculum_service_url null")},
function(a){var c=CTATLMS.lastSaveTime;console.log("CTATLMS error on lastSaveTime",Date(c),"e: "+a+";");CTATLMS.lastSaveTime=Date.now();return Promise.reject("CTATLMS error on lastSaveTime "+Date(c)+": "+(a&&a.toString()))})};CTATLMS.getProblemState=function(a){CTATConfiguration.get("restoreProblemUrl")?$.get(CTATConfiguration.get("restoreProblemUrl"),"",null,"text").done(function(f){a(f)}).fail(function(f,g,e){a(null);f=(new CTATTutorMessageBuilder).createErrorMessage("Load ProblemState Error",g+
" "+e);CTAT.ToolTutor.sendToInterface(f,!0)}):a(null)};CTATLMS.gradeStudent=function(){};CTATLMS.processProblemSummary=function(a){a=a.getXMLObject().getElementsByTagName("ProblemSummaryJSON");a=CTATCurriculumService.formatProblemSummary(a[0].textContent);var f=CTATConfiguration.get("curriculum_service_url");return CTATLMS.saveProblemState(a,f,"problemsummary")};CTATLMS.visibilityChange=function(a){"visibilitychange"==a.type&&"hidden"==document.visibilityState&&CTATCurriculumService.sendProblemSummary(CTAT.ToolTutor.tutor.getProblemSummary(),
!0)};CTATLMS.exitTutor=function(a){try{var f=top.document.getElementById("dialog");f&&"function"==typeof f.dispatchEvent&&f.dispatchEvent(new CustomEvent("dialogclose",{detail:{date:(new Date).toGMTString(),data:a}}))}catch(g){(console.trace||console.log)("Error dispatching 'dialogclose' event:",g)}}};CTATLMS.is.Assistments=function(){return CTATTarget&&"ASSISTMENTS"==CTATTarget};var evt=new Event("ctatlms");console.log("CTATLMS.js dispatch send evt",evt);
try{parent.dispatchEvent(evt),console.log("CTATLMS.js dispatch return from evt",evt)}catch(a){console.log("CTATLMS.js error on parent.dispatchEvent",a)};var bundleFormatter="",inBundle=!1,useBundling=!1,useOLIEncoding=!1,CTATCommLibrary=function(a,f){function g(){return 1<(CTATConfiguration.get("collaborators")||"").split(/,/).length?CTATConfiguration.getCustomFields()["Team ID"]:""}CTATBase.call(this,"CTATCommLibrary",a);var e=authenticityToken="",c=0,b=[],d=null,h=a?a:null,n=null==f?!0:f,l=!0,p=null,m=this,q="http",u="ERROR_CONN_TS",v="",w=0;this.teamMembers={};this.setUseCommSettings=function(b){l=b};this.getUseCommSettings=function(){return l};
this.setConnectionRefusedMessage=function(b){u=b};this.sendTutorReady=function(b){var d=CTATConfiguration.get("collaborators")||"",c=CTATConfiguration.get("user_guid"),a=CTATCommShell.commShell.getGotProblemRestoreEnd();console.log("sendTutorReady collaborators",d,"otm",b,"teamMembers",this.teamMembers,"gotProblemRestoreEnd",a);if(b&&b[c]&&-1!=b[c].subscribed||!a)return b;a=this.teamMembers[c]||{};a.subscribed||(a.username=c,a.subscribed=Date.now(),this.teamMembers[c]=a);var c=0,e;for(e in this.teamMembers){if(-1==
this.teamMembers[e].subscribed)return b;c++}e={command:"tutorready",id:g(),username:CTATConfiguration.get("user_guid"),teamMembers:this.teamMembers};parent.postMessage(e,location.origin);try{parent.parent!==parent&&parent.parent.postMessage(e,parent.parent.location.origin)}catch(E){console.log("Error trying access to parent.parent",E)}c>=d.split(/,/).length&&CTATScrim.scrim.scrimDown();return b};this.interpretCollab=function(b){ctatdebug("Interpret collab:",b.command,b);var d=null;if("tutorready"==
b.command&&b.username!=CTATConfiguration.get("user_guid")){var c=CTATConfiguration.get("collaborators"),a=0,e=(c||"").split(",");for(console.log("interpretCollab",c,"teamMembers",this.teamMembers,"cNames",e);a<e.length;++a){c=this.teamMembers[e[a]]||{};if(-1==c.subscribed){console.log("collaborator quit:",e[a],c,new Date);break}b.username==e[a]&&(c.username=b.username,c.subscribed=Date.now(),this.teamMembers[e[a]]=c);if(!c.subscribed){console.log("collaborator still missing:",e[a],c,new Date);break}}this.sendTutorReady(b.teamMembers);
a>=e.length&&CTATScrim.scrim.scrimDown()}else"message"==b.command?b.from!=CTATConfiguration.get("user_guid")?d=b.data:ctatdebug("Own message echoed: "+b.data):"unsubscribed"==b.command?(a=this.teamMembers[b.from||","])&&-1!=a.subscribed&&(a.subscribed=-1,a=CTATGlobals.languageManager.filterString("YOUR_COLLABORATOR")+(b.from||"")+" ",b.from==CTATConfiguration.get("user_guid")?ctatdebug("Own unsubscribe received "+b):"function"==typeof exitTutor?(a+=CTATGlobals.languageManager.filterString("COLLABORATOR_QUIT_CLICK_OK"),
console.log("scrimUp("+a+")",new Date,exitTutor),CTATScrim.scrim.OKScrimUp(a,exitTutor)):(a+=CTATGlobals.languageManager.filterString("COLLABORATOR_QUIT_CLICK_X"),console.log("scrimUp("+a+")",new Date,typeof exitTutor),CTATScrim.scrim.scrimUp(a,w))):"subscribed"==b.command?b.team_members?console.log("subscribed from "+b.from+": teamMembers",this.teamMembers,"data.team_members",b.team_members):console.log("interpretCollab: team_members property missing",b):"requestexit"==b.command&&(a=b.data,console.log("OKscrimUp or scrimUp("+
a+")",new Date,typeof exitTutor),"function"==typeof CTATLMS.exitTutor?CTATScrim.scrim.OKScrimUp(a,CTATLMS.exitTutor.bind(null,a)):CTATScrim.scrim.scrimUp(a,w));"function"==typeof document.dispatchEvent&&document.dispatchEvent(new CustomEvent("receiveFromCollaborator",{detail:b}));return d};this.setSocketType=function(b){q=b;if(m.hasWebSocket()||m.hasPostMessage())$(window).on("message",function(b){if(b.originalEvent.origin===window.location.origin&&(b=b.originalEvent?b.originalEvent.data:null,console.log("message from "+
b.from+":",b),b))if(h){if(b=m.interpretCollab(b))h.processMessage(b),m.hasPostMessage()||CTAT.ToolTutor.sendToTutor(b)}else console.log("No http handler defined for websocket listener.")})};this.getSocketType=function(){return q};this.setScrimWait=function(b){w=b};this.hasSecureSocket=function(){return/https/i.test(q)||/wss/i.test(q)};this.hasJavaScriptConnection=function(){return/javascript/i.test(q)};this.hasWebSocket=function(){return/websocket/i.test(q)};this.hasPostMessage=function(){return/postmessage/i.test(q)};
this.assignHandler=function(b){h=b};this.assignMessageListener=function(b){p=b};this.encodeVariables=function(b){m.ctatdebug("encodeVariables ()");for(var d="",c=0;c<b.length;c++){var a=b[c];0<c&&(d+="&");d+=a.name;d+="=";d+=encodeURIComponent(a.value)}return d};this.encodeVariablesOLI=function(b){m.ctatdebug("encodeVariablesOLI ()");for(var d="",c=0;c<b.length;c++){var a=b[c];0<c&&(d+="&");d+=a.name;d+="=";d+=encodeURIComponent(a.value)}return d};this.createConnection=function(a,e,g){m.ctatdebug("createConnection () canBeWebSocket "+
g);g="undefined"==typeof g?!0:!1!==g;if(!e)return new CTATConnection(a);if(g&&m.hasWebSocket())return g=this.findWSConnection(e),g||(g=new CTATWSConnection(a),g.setID(c),g.setURL(e),g.assignReceiveFunction(this.processWSReply),g.assignCloseFunction(this.processWSClose),b.push(g),c++),g;g=new CTATConnection(a);g.setID(c);g.setURL(e);g.assignReceiveFunction(m.processReply);b.push(g);c++;return d=g};this.findWSConnection=function(d){ctatdebug("findWSConnection( "+d+" )");d=m.editSocketURLForHTTPS(d);
for(var c=0;c<b.length;c++){var a=b[c];ctatdebug("checking: socketType = "+a.getSocketType()+" URL = "+a.getURL());if("ws"==a.getSocketType()&&a.getURL()==d)return a}return null};this.startBundle=function(){m.ctatdebug("startBundle ()");!1===useBundling?this.ctatdebug("Not using bundling, bump"):(bundleFormatter='<?xml version="1.0" encoding="UTF-8"?><message><verb/><properties><MessageType>MessageBundle</MessageType><messages>',inBundle=!0)};this.endBundle=function(){m.ctatdebug("endBundle ()");
!1===useBundling?m.ctatdebug("Not using bundling, bump"):(inBundle=!1,bundleFormatter+="</messages></properties></message>",m.sendXML(bundleFormatter))};this.setFixedURL=function(b){e=b};this.getURL=function(){m.ctatdebug("getURL ()");if(""!==e)return m.ctatdebug("Returning fixedURL: "+e),e;var b=flashVars.getRawFlashVars(),d="http://";m.hasSecureSocket()&&(d="https://");d=d+b.remoteSocketURL+":"+b.remoteSocketPort;b.remoteSocketURL&&-1!=b.remoteSocketURL.indexOf("http")&&(d=b.remoteSocketURL+":"+
b.remoteSocketPort);return d};this.sendXML=function(b,d){m.ctatdebug("Sending: "+b);m.ctatdebug("sendXML ("+b+")");h.updateLastActionTimestamp&&h.updateLastActionTimestamp();if(!0===useBundling&&!0===inBundle)m.ctatdebug("Bundling ..."),bundleFormatter+=b;else{bundleFormatter=b;flashVars.getRawFlashVars();b=this.getURL();var c=bundleFormatter;-1==bundleFormatter.indexOf("<?xml")&&(c='<?xml version="1.0" encoding="UTF-8"?>'+bundleFormatter);m.getUseCommSettings()&&m.hasJavaScriptConnection()?(m.sendToToolsOrCollaborators(b,
c,d),CTATConfiguration.get("noLocalTrace")||CTAT.ToolTutor.sendToTutor(c)):m.send_post(b,c)}};this.sendToToolsOrCollaborators=function(b,d,c){return!m.hasWebSocket()||"ctatAsListener"!=CTATConfiguration.get("mode")&&"undefined"!=typeof c&&!1===c?!1:(this.send_post(b,d),!0)};this.sendXMLNoBundle=function(b){m.ctatdebug("sendXMLNoBundle ("+b+")");bundleFormatter=b;h.updateLastActionTimestamp&&h.updateLastActionTimestamp();var d=this.getURL(),c=b;-1==b.indexOf("<?xml")&&(c='<?xml version="1.0" encoding="UTF-8"?>'+
b);flashVars.getRawFlashVars();m.getUseCommSettings()&&m.hasJavaScriptConnection()?(m.sendToToolsOrCollaborators(d,c),CTAT.ToolTutor.sendToTutor(c)):this.send_post(d,c)};this.sendXMLURL=function(b,d,c){ctatdebug("sendXMLURL ("+d+", "+c+")");var a=b;-1==b.indexOf("<?xml")&&(a='<?xml version="1.0" encoding="UTF-8"?>'+b);flashVars.getRawFlashVars();m.ctatdebug("Sending: "+a);h.updateLastActionTimestamp&&h.updateLastActionTimestamp();this.getUseCommSettings()&&m.hasJavaScriptConnection()?(m.sendToToolsOrCollaborators(d,
a),c||CTAT.ToolTutor.sendToTutor(a)):this.send_post(d,a)};this.send_post_variables=function(b,d){m.ctatdebug("send_post_variables ("+b+")");flashVars.getRawFlashVars();d=!1===useOLIEncoding?this.encodeVariables(d):this.encodeVariablesOLI(d);this.ctatdebug("Sending: "+d);h.updateLastActionTimestamp&&h.updateLastActionTimestamp();if(!0===CTATGlobals.CommDisabled)return m.ctatdebug("Communications globally disabled, please check your settings"),Promise.reject("Communications globally disabled, please check your settings");
var c=m.createConnection(CTATConfiguration.getRawFlashVars(),b,!1);c.setContentType("application/x-www-form-urlencoded");m.ctatdebug("CTATCommLibrary.send_post_variables() data to send:\n  "+d);null!==p&&p.processOutgoing(d);c.setURL(b);c.setData(d);c.assignReceiveFunction(m.processReply);c.send();return c};this.formPostMessage=function(b){return{command:"message",id:g(),user_guid:CTATConfiguration.get("user_guid"),data:b}};this.send_post=function(b,d){ctatdebug("send_post ("+b+")");if(!0===CTATGlobals.CommDisabled)m.ctatdebug("Communications globally disabled, please check your settings");
else{ctatdebug("Outgoing on wire, "+(m.hasPostMessage()?"to post":"no post")+"; data "+d);var c=flashVars.getRawFlashVars(),a=b;if(m.hasPostMessage())d=m.formPostMessage(d),d.dest="sendToTutor",parent.postMessage(d,location.origin);else{if(m.hasWebSocket()){if(CTATCommShell.commShell.hasTutorShopCable()){parent.postMessage(m.formPostMessage(d),location.origin);return}b&&(ctatdebug("opening websocket connection: url "+b),a=b.replace(/https?:/,"ws:"),a=m.editSocketURLForHTTPS(a),ctatdebug("opening websocket connection to "+
a))}b=m.createConnection(c,a);b.setData(d);null!==p&&p.processOutgoing(d);b.send()}}};this.processReply=function(d,c,a){m.ctatdebug("processReply ("+b.length+","+d+", ...)");"undefined"==typeof a&&"function"==typeof this.getHTTPObject&&this.getHTTPObject();c=0;d=[];var e;for(e=0;e<b.length;e++){var g=b[e];if(g&&"function"==typeof g.getHTTPObject){var f=g.getHTTPObject();m.ctatdebug("Testing connection entry["+e+"]: readyState & status: "+(f?f.readyState+" & "+f.status:"null")+", consumed: "+g.getConsumed());
f&&(4==f.readyState&&!1===g.getConsumed()?(m.ctatdebug("Investigating request response: "+c+" -> "+f.status+", for: "+g.getURL()),a=!1,0===f.status&&(a=!0,m.ctatdebug("Received message (status 0): ("+f.responseText+"), status: "+f.status),n&&CTATScrim.scrim.errorScrimUp(CTATGlobals.languageManager.filterString(u))),408==f.status&&(a=!0,m.ctatdebug("Received message (status 408): "+f.responseText),CTATScrim.scrim.scrimDown()),502==f.status&&(a=!0,m.ctatdebug("Received message (status 502): "+f.responseText),
n&&CTATScrim.scrim.errorScrimUp(CTATGlobals.languageManager.filterString(ERROR_502))),200<=f.status&&208>=f.status?(a=!0,m.ctatdebug("Processing 200 response ..."),null!==h?(d.push(f.responseText),null!==p&&p.processIncoming(f.responseText)):m.ctatdebug("Error: httphandler is null, can't process response!")):h&&h.processError&&(a=!0,m.ctatdebug("Processing non-200 response, status "+f.status),h.processError(f.status,f.responseText)),!1===a&&m.ctatdebug("Error: status not handled for: "+f.status),
m.ctatdebug("Marking connection as consumed ..."),g.setConsumed(!0)):(0===f.readyState&&m.ctatdebug("Received message (status 0, request not initialized)"),1===f.readyState&&m.ctatdebug("Received message (status 1, server connection established)"),2===f.readyState&&m.ctatdebug("Received message (status 2, request received)"),3===f.readyState&&m.ctatdebug("Received message (status 3, processing request)")),c++)}}m.cleanup();for(c=0;c<d.length;c++)m.ctatdebug("Processing incoming message: "+c),a=d[c],
-1!=a.indexOf("status=success")?m.ctatdebug("Info: logging success message received, not propagating to message handler"):h&&h.processMessage&&(m.ctatdebug("Processing incoming message: "+a),h.processMessage(a))};this.processWSReply=function(b){m.ctatdebug("processWSReply() length "+(null===b?null:b.toString().length));"string"==typeof b&&(null!==p&&p.processIncoming(b),-1!=b.indexOf("status=success")?m.ctatdebug("processWSReply() logging success message received, not propagating to message handler: "+
b):(m.ctatdebug("Processing incoming message: "+b),h.processMessage(b)))};this.processWSClose=function(b){m.ctatdebug("processWSClose("+b+")");b instanceof CloseEvent&&m.ctatdebug("CloseEvent: code "+b.code+", reason "+b.reason+", wasClean "+b.wasClean);CTATLMS.is.Authoring()||CTATLMS.is.ToolsListener()?CTATScrim.scrim.scrimUp(CTATGlobals.languageManager.filterString("AUTHORPLEASECLOSE")):CTATScrim.scrim.handleTSDisconnect()};this.cleanup=function(){m.ctatdebug("cleanup ()");m.ctatdebug("checkEntries() httprequests.length "+
b.length);for(var d=0,c=b.length-1;0<=c;c--){var a=b[c];if(a)if(!0===a.getConsumed())m.ctatdebug("checkEntries() removing["+c+"] ID: "+a.getID()),b.splice(c,1),d++;else if("function"==typeof a.getHTTPObject){var e=a.getHTTPObject();m.ctatdebug("checkEntries() checking["+c+"], readyState: "+(e?e.readyState:"null")+", consumed: "+a.getConsumed())}}m.ctatdebug("Removed "+d+" entries")};this.retrieveProblemFile=function(b,d,c,a,e){"function"==typeof CTATScrim&&CTATScrim.scrim&&n&&CTATScrim.scrim.waitScrimUp();
var g=/\.([A-z]*)$/.exec(b);g&&g[1]&&"nools"===g[1].toLowerCase()?(console.log("got a nools file:",b),c.processNools(b,a,e)):(console.log("got an xml file, maybe:",b),m.retrieveXMLFile(b,d,c,a,e))};this.getFileRequest=function(b,d,c){var a=-1!=(location.href?location.href:b).indexOf("file://")?!0:!1;location.href||m.ctatdebug("We can't check location.href in the current configuration");if(a)c=(new CTATTutorMessageBuilder).createErrorMessage("","Unable to load: "+b+" - You are trying to use the file:// protocol, which is not allowed in this browser."),
m.ctatdebug("onerror GET for fileName "+c),CTAT.ToolTutor.sendToInterface(c,!0);else return v=b,b=new CTATConnection,b.assignReceiveFunction(function(b,c,a){"undefined"==typeof a&&(a="function"==typeof this.getHTTPObject&&this.getHTTPObject());m.ctatdebug("onready... GET for xmlFile xmlhttp "+a+", .readyState & .status "+(a?a.readyState+" & "+a.status:""));a&&4!=a.readyState||(a&&200<=a.status&&208>=a.status&&d(a),a&&404==a.status&&(b=(new CTATTutorMessageBuilder).createErrorMessage("Unable to download file",
"("+v+") not found"),m.ctatdebug("Error loading xmlFile "+v+": "+b),CTAT.ToolTutor.sendToInterface(b,!0)))}),b.assignFailFunction(c),b};this.retrieveXMLFile=function(b,d,c,a,e){m.ctatdebug("retrieveXMLFile ("+b+")");d=this.getFileRequest(b,function(b){b.responseXML?(m.ctatdebug("parsing brd xml using something else"),b=b.responseXML.documentElement):(m.ctatdebug("parsing brd xml using node"),b=(new CTATXML).parseXML(b.responseText));if(null===b){var d=(new CTATTutorMessageBuilder).createErrorMessage("Error: empty or null xmlFile "+
v);m.ctatdebug("Error parsing xmlFile "+v+": "+d);CTAT.ToolTutor.sendToInterface(d,!0)}c.processXML(b,a,e)},function(){var b=(new CTATTutorMessageBuilder).createErrorMessage("",CTATGlobals.languageManager.getString("UNABLE_TO_LOAD")+v+CTATGlobals.languageManager.getString("FILE_IS_MISSING"));m.ctatdebug("onerror GET for xmlFile "+b);CTAT.ToolTutor.sendToInterface(b,!0);c.processXML(null,a,e)});d.setMethod("GET");d.setURL(b);d.setContentType("text/plain");d.send()};this.retrieveJSONFile=function(b,
d){m.ctatdebug("retrieveJSONFile ("+b+")");var c=this.getFileRequest(b,function(){4==c.readyState&&200<=c.status&&208>=c.status&&204!=c.status&&(m.ctatdebug("Successfully retrieved file: "+b),d(JSON.parse(c.responseText)))},function(){var b=(new CTATTutorMessageBuilder).createErrorMessage("","Unable to load: "+v+" - Either you are trying to use the  file:// protocol, there is a firewall between the tutor and BRD, or the BRD is on a different domain and permission to retrieve data from that server is denied.");
m.ctatdebug("onerror GET for xmlFile "+b);CTAT.ToolTutor.sendToInterface(b,!0)});c.open("GET",b,!0);c.setRequestHeader("Content-type","text/plain");c.send()};this.retrieveFile=function(b,d){m.ctatdebug("retrieveFile ("+b+")");var c=this.getFileRequest(b,function(){4==c.readyState&&200<=c.status&&208>=c.status&&(m.ctatdebug("Successfully retrieved file: "+b),d(c.responseText))},function(){var b=(new CTATTutorMessageBuilder).createErrorMessage("","Unable to load: "+v+" - Either you are trying to use the  file:// protocol, there is a firewall between the tutor and BRD, or the BRD is on a different domain and permission to retrieve data from that server is denied.");
m.ctatdebug("onerror GET for xmlFile "+b);CTAT.ToolTutor.sendToInterface(b,!0)});c.open("GET",b,!0);c.setRequestHeader("Content-type","text/plain");c.send()};this.then=function(b,c){return d&&"function"==typeof d.then?d.then(b,c):Promise.resolve("CTATCommLibrary.then() not supported").then(b,c)}};CTATCommLibrary.setAuthenticityToken=function(a){Array.isArray(a)&&(a=0<a.length?a[0]:"");a&&(CTATCommLibrary.authenticityToken=decodeURIComponent(a))};CTATCommLibrary.getAuthenticityToken=function(a){return CTATCommLibrary.authenticityToken};
CTATCommLibrary.addAuthenticityToken=function(a){return CTATCommLibrary.authenticityToken&&(""===a||0>a.search(/authenticity_token=/)&&0<=a.search(/^[?]?[^?&=><]+=?[^&=]*(&[^?&=><]+=?[^&=]*)*$/))?""+a+(a?"&":"")+"authenticity_token="+encodeURIComponent(CTATCommLibrary.authenticityToken):a};CTATCommLibrary.prototype=Object.create(CTATBase.prototype);CTATCommLibrary.prototype.constructor=CTATCommLibrary;
CTATCommLibrary.prototype.editSocketURLForHTTPS=function(a){if(a&&!/[^0-9]127[.]0[.]0[.]1[^0-9]/.test(a)&&"https:"===window.top.location.protocol){ctatdebug("We're embedded in an https window, using wss...");a=a.replace("ws:","wss:");var f=CTATConfiguration.get("remoteSocketSecurePort");f&&(a=a.replace(/(wss:\/\/[^:]{1,}:)\d{1,}/,"$1"+f));ctatdebug("url after replace: "+a)}return a};var CTATArgument=function(){var a="",f="Undefined",g="String",e="text";this.setValue=function(c){f=c};this.getValue=function(){return f};this.setName=function(c){a=c};this.getName=function(){return a};this.setType=function(c){g=c};this.getType=function(){return g};this.setFormat=function(c){e=c};this.getFormat=function(){return e}};CTATArgument.prototype.clone=function(){var a=new CTATArgument;a.setValue(this.getValue());a.setType(this.getType());a.setFormat(this.getFormat());return a};
"undefined"!==typeof module&&(module.exports=CTATArgument);var CTATHTMLManager=function(){var a=null,f="";this.urldecode=function(a){return decodeURIComponent((a+"").replace(/\+/g,"%20"))};this.showEntities=function(){ctatdebug("showEntities ()");for(var g,e=0;e<a.length;e++)g=a[e],ctatdebug(g)};this.initEntities=function(){null==a&&(a=[],a["&amp;"]="*!*",a["&nbsp;"]="\u00a0",a["&iexcl;"]="\u00a1",a["&cent;"]="\u00a2",a["&pound;"]="\u00a3",a["&curren;"]="\u00a4",a["&yen;"]="\u00a5",a["&brvbar;"]="\u00a6",a["&sect;"]="\u00a7",a["&uml;"]="\u00a8",a["&copy;"]=
"\u00a9",a["&reg;"]="\u00ae",a["&deg;"]="\u00b0",a["&plusmn;"]="\u00b1",a["&sup1;"]="\u00b9",a["&sup2;"]="\u00b2",a["&sup3;"]="\u00b3",a["&acute;"]="\u00b4",a["&micro;"]="\u00b5",a["&frac14;"]="\u00bc",a["&frac12;"]="\u00bd",a["&frac34;"]="\u00be",a["&iquest;"]="\u00bf",a["&Agrave;"]="\u00c0",a["&Aacute;"]="\u00c1",a["&Acirc;"]="\u00c2",a["&Atilde;"]="\u00c3",a["&Auml;"]="\u00c4",a["&Aring;"]="\u00c5",a["&AElig;"]="\u00c6",a["&Ccedil;"]="\u00c7",a["&Egrave;"]="\u00c8",a["&Eacute;"]="\u00c9",a["&Ecirc;"]=
"\u00ca",a["&Euml;"]="\u00cb",a["&Igrave;"]="\u00cc",a["&Iacute;"]="\u00cd",a["&Icirc;"]="\u00ce",a["&Iuml;"]="\u00cf",a["&ETH;"]="\u00d0",a["&Ntilde;"]="\u00d1",a["&Ograve;"]="\u00d2",a["&Oacute;"]="\u00d3",a["&Ocirc;"]="\u00d4",a["&Otilde;"]="\u00d5",a["&Ouml;"]="\u00d6",a["&Oslash;"]="\u00d8",a["&Ugrave;"]="\u00d9",a["&Uacute;"]="\u00da",a["&Ucirc;"]="\u00db",a["&Uuml;"]="\u00dc",a["&Yacute;"]="\u00dd",a["&THORN;"]="\u00de",a["&szlig;"]="\u00df",a["&agrave;"]="\u00e0",a["&aacute;"]="\u00e1",a["&acirc;"]=
"\u00e2",a["&atilde;"]="\u00e3",a["&auml;"]="\u00e4",a["&aring;"]="\u00e5",a["&aelig;"]="\u00e6",a["&ccedil;"]="\u00e7",a["&egrave;"]="\u00e8",a["&eacute;"]="\u00e9",a["&ecirc;"]="\u00ea",a["&euml;"]="\u00eb",a["&igrave;"]="\u00ec",a["&iacute;"]="\u00ed",a["&icirc;"]="\u00ee",a["&iuml;"]="\u00ef",a["&eth;"]="\u00f0",a["&ntilde;"]="\u00f1",a["&ograve;"]="\u00f2",a["&oacute;"]="\u00f3",a["&ocirc;"]="\u00f4",a["&otilde;"]="\u00f5",a["&ouml;"]="\u00f6",a["&oslash;"]="\u00f8",a["&ugrave;"]="\u00f9",a["&uacute;"]=
"\u00fa",a["&ucirc;"]="\u00fb",a["&uuml;"]="\u00fc",a["&yacute;"]="\u00fd",a["&thorn;"]="\u00fe",a["&yuml;"]="\u00ff",a["&gt;"]=">",a["&lt;"]="<",a["&#61;"]="=",a["&361;"]="=",a["&quot;"]='"');ctatdebug("(singleQuoteEscape==true) Replacing &apos; with: \\'");a["&apos;"]="\\'"};this.entitiesConvert=function(a){ctatdebug("entitiesConvert ()");return this.urldecode(unescape(a))};this.entitiesGenerate=function(a){return f=a};this.htmlEncode=function(a){return a};this.htmlDecode=function(a){return"undefined"!==
typeof $?$("<div/>").html(a).text():"undefined"!==typeof Entities?(new Entities).decode(a):a}};"undefined"!==typeof module&&(module.exports=CTATHTMLManager);var CTATStringUtil=function(){this.String2Boolean=function(a){switch(a){case "0":case "false":case "no":case "FALSE":case "NO":case "No":return!1}return!0};this.replaceString=function(a,f,g){return a.replace(f,g)}};"undefined"!==typeof module&&(module.exports=CTATStringUtil);var CTATSAI=function(a,f,g,e){CTATBase.call(this,"CTATSAI","sai");var c=new CTATStringUtil,b="undefined",d=[],h=[],n=[],l=[],p=null,m=this,p="xml"==CTATConfig.parserType?new CTATXML:new CTATJSON;this.getArguments=function(){return n};this.getArgument=function(b){if(0==n.length){var d=new CTATArgument;n.push(d)}return n[b]};this.getArgumentsTyped=function(){m.ctatdebug("getArgumentsTyped");var b,d=[];for(b=0;b<n.length;b++){var a=n[b];"Boolean"===a.getType()?(m.ctatdebug("Adding Boolean argument ("+
a.getValue()+") ..."),d.push(c.String2Boolean(a.getValue()))):"Number"===a.getType()?(m.ctatdebug("Adding Number argument ("+a.getValue()+") ..."),d.push(Number(a.getValue()))):"String"===a.getType()?"No_Value"===a.getValue()?(m.ctatdebug("Detected default argument ("+a.getValue()+"), setting contents to null instead"),d.push(null)):d.push(String(a.getValue())):m.ctatdebug("Unrecognized argument type: "+a.getType()+" in "+m.toSerializedString()+" IGNORING IT!!!")}m.ctatdebug("Resulting arguments: "+
d);return d};this.addSelection=function(b,c){var a=new CTATArgument;a.setValue(b);void 0!=c&&null!=c&&a.setType(c);d.push(a)};this.addAction=function(b){h.push(b)};this.checkDefaultArgument=function(){m.ctatdebug("checkDefaultArgument ()");if(0===n.length){m.ctatdebug("Adding default argument ...");var b=new CTATArgument;n.push(b)}};this.setArgument=function(b,d){m.checkDefaultArgument();for(var c=n.length;c<=b;++c)n.push(new CTATArgument);b=n[b];b.setValue(d);return b};this.addArgument=function(b,
d,c){this.ctatdebug("addArgument ("+b+","+d+","+c+")");var a=new CTATArgument;a.setValue(b);a.setType(d);a.setFormat(c);n.push(a);return a};this.addExistingArgument=function(b){n.push(b);return b};this.setSAI=function(d,c,a,e,g){m.setSelection(Array.isArray(d)?0<d.length?d[0]:"":d);m.setAction(Array.isArray(c)?0<c.length?c[0]:"":c);m.setInput(Array.isArray(a)?0<a.length?a[0]:"":a);m.setType(e);b=g};this.setInput=function(b){m.ctatdebug("setInput("+b+")");m.checkDefaultArgument();m.getArgument(0).setValue(b)};
this.getInputObject=function(){return 0===n.length?null:n[0]};this.getInput=function(){return 0===n.length?"":m.getArgument(0).getValue()};this.setType=function(b){m.checkDefaultArgument();m.getArgument(0).type=b};this.getType=function(){return 0===n.length?"":m.getArgument(0).type};this.setFormat=function(b){m.checkDefaultArgument();m.getArgument(0).setFormat(b)};this.getFormat=function(){return 0===n.length?"":m.getArgument(0).getFormat()};this.toString=function(){return"["+String(m.getSelection())+
","+String(m.getAction())+","+String(m.getInput())+"]"};this.setSelection=function(b,c){var a=m.getSelectionObject();null==a?(a=new CTATArgument,a.setValue(b),void 0!=c&&null!=c&&a.setType(c),d.push(a)):a.setValue(b)};this.getSelectionObject=function(){return 0==d.length?null:d[0]};this.getSelection=function(){if(0==d.length)return null;var b=d[0];return"object"===typeof b?b.getValue():b};this.setAction=function(b){0<h.length?h[0]=b:h.push(b)};this.getAction=function(){return 0==h.length?null:h[0]};
this.appendToSelectionArray=function(b,c){var a=new CTATArgument;a.setValue(String(b));void 0!=c&&null!=c&&a.setType(c);d.push(a)};this.setSelectionArray=function(b){d=[];for(var c=0;c<b.length;c++)m.appendToSelectionArray(b[c],"String")};this.getSelectionArray=function(){for(var b=[],c=0;c<d.length;c++){var a=d[c];"object"===typeof a?b.push(d[c].getValue()):b.push(a)}return b};this.appendToActionArray=function(b){null==b?h.push(""):h.push(String(b))};this.setActionArray=function(b){h=null==b?[]:
Array.isArray(b)?b.slice():[String(b)]};this.getActionArray=function(){return h};this.appendToInputArray=function(b){m.ctatdebug("appendToInputArray ("+b+")");null==b?m.addArgument("","String","text"):m.addArgument(b,"String","text")};this.setInputArray=function(b){n=[];if(null!=b)for(var d=0;d<b.length;d++)m.appendToInputArray(b[d])};this.getInputArray=function(){m.ctatdebug("getInputArray ("+n.length+")");l=[];for(var b=0;b<n.length;b++){var d=n[b];"object"===typeof d?(m.ctatdebug("Adding object value ("+
d.getValue()+") to temp input array"),l.push(d.getValue())):(m.ctatdebug("Adding string value ("+d+") to temp input array"),l.push(d))}return l};this.setPrompt=function(d){b=d};this.getPrompt=function(){return b};this.propagate=function(b){m.ctatdebug("propagate ()");b=b.getArguments();for(var d=0;d<b.length;d++){var c=b[d],a=n[d];if(null===c||null===a){m.ctatdebug("Internal error: argument lists do not align between received SAI and source SAI");break}a.setValue(c.getValue())}};this.fromString=function(b){b=
p.parse(b);m.fromXML(b)};this.fromXML=function(b){m.ctatdebug("fromXML ()");n=[];b=p.getElementChildren(b);for(var d,c=0;c<b.length;c++){var a=b[c];if("selection"==p.getElementName(a)||"Selection"==p.getElementName(a)){for(var e=p.getElementChildren(a),g=!1,f=0;f<e.length;f++)d=e[f],"value"==p.getElementName(d)&&(d=p.getNodeTextValue(d),1>f?m.setSelectionArray(d):m.appendToSelectionArray(d),g=!0,m.setSelection(d));!1===g&&(d=p.getNodeTextValue(a),m.setSelectionArray(d),m.setSelection(d))}if("action"==
p.getElementName(a)||"Action"==p.getElementName(a)){e=p.getElementChildren(a);g=!1;for(f=0;f<e.length;f++)d=e[f],"value"==p.getElementName(d)&&(d=p.getNodeTextValue(d),1>f?m.setActionArray(d):m.appendToActionArray(d),g=!0,m.setAction(d));!1===g&&(d=p.getNodeTextValue(a),m.setActionArray(d),m.setAction(d))}if("inputArray"==p.getElementName(a)||"value"==p.getElementName(a)||"Input"==p.getElementName(a)){d=p.getElementChildren(a);var h;n=[];e=new CTATHTMLManager;g=new CTATArgument;f=0;n.push(g);for(var l=
0;l<d.length;l++){var q=d[l];"value"==p.getElementName(q)&&(h=p.getElementChildren(q),null!==h?(m.ctatdebug("Parsing SAI input ..."),m.ctatdebug("Childnodes: "+h.length),1===h.length?(h=e.htmlDecode(p.getNodeTextValue(q)),m.ctatdebug("Setting new value to: "+h),g.setValue(h)):(h=e.htmlDecode(p.getNodeTextValue(q)),m.ctatdebug("Setting new value to: "+h),g.setValue(h),g.setName(q.attributes.getNamedItem("name").value),g.setType(q.attributes.getNamedItem("type").value),g.setFormat(q.attributes.getNamedItem("format").value),
f++),1>l?m.setInputArray(h):m.appendToInputArray(h)):(q=e.htmlDecode(p.getNodeTextValue(q)),m.ctatdebug("Setting new value to: "+q),g.setValue(q),1>l?m.setInputArray(q):m.appendToInputArray(q)))}}if("prompt"==p.getElementName(a)||"Prompt"==p.getElementName(a))m.ctatdebug("Parsing prompt ..."),m.setPrompt(p.getNodeTextValue(a))}m.checkDefaultArgument()};this.appendFromElement=function v(b,d,c,a,e){m.ctatdebug("appendFromElement ()");a=String(p.getElementName(d)).toLowerCase();if(a==b||"value"==a)if(a=
p.getElementChildren(d),!Array.isArray(a)||1>a.length)0==e?c.push(p.getNodeTextValue(d)):m.appendToInputArray(p.getNodeTextValue(d));else for(d=0;d<a.length;++d)v(b,a[d],c,d,e)};this.setArrayFromElements=function(b){m.ctatdebug("setArrayFromElements ()");if(!b||!Array.isArray(b)||1>b.length)m.ctatdebug("can't get name: don't know whether selection, action or input");else{var c,a=String(p.getElementName(b[0])).toLowerCase();switch(a){case "selection":m.ctatdebug("Processing selection field ...");d=
[];for(c=0;c<b.length;++c)m.appendFromElement(a,b[c],d,c,!1);break;case "action":m.ctatdebug("Processing action field ...");h=[];for(c=0;c<b.length;++c)m.appendFromElement(a,b[c],h,c,!1);break;case "input":m.ctatdebug("Processing input field ...");n=[];for(c=0;c<b.length;++c)m.appendFromElement(a,b[c],n,c,!0);break;default:console.log('CTATSAI.setArrayFromElements(): unexpected element name "'+a+'"');return}m.ctatdebug("CTATSAI.setArrayFromElements() eltName "+a+", length "+c+", selectionArray "+
m.getSelectionArray()+", actionArray "+m.getActionArray()+", inputArray "+m.getInputArray())}};this.fromXMLInternal=function(b){m.ctatdebug("fromXMLInternal ()");new CTATXML;n=[];b=p.getElementChildren(b);for(var d,c=0;c<b.length;c++){var a=b[c];if("selection"==p.getElementName(a)||"Selection"==p.getElementName(a)){for(var e=p.getElementChildren(a),g=!1,f=0;f<e.length;f++)d=e[f],"value"==p.getElementName(d)&&(d=p.getNodeTextValue(d),1>f?m.setSelectionArray(d):m.appendToSelectionArray(d),g=!0,m.setSelection(d));
!1===g&&(d=p.getNodeTextValue(a),m.setSelectionArray(d),m.setSelection(d))}if("action"==p.getElementName(a)||"Action"==p.getElementName(a)){e=a.childNodes;g=!1;for(f=0;f<e.length;f++)d=e[f],"value"==p.getElementName(d)&&(d=p.getNodeTextValue(d),1>f?m.setActionArray(d):m.appendToActionArray(d),g=!0,m.setAction(d));!1===g&&(d=p.getNodeTextValue(a),m.setActionArray(d),m.setAction(d))}if("inputArray"==p.getElementName(a)||"Input"==p.getElementName(a)){d=a.childNodes;n=[];var e=new CTATHTMLManager,g=new CTATArgument,
f=0,h;n.push(g);for(var l=0;l<d.length;l++)if(h=d[l],"value"==p.getElementName(h)){var q=p.getElementChildren(h);null!==q?(m.ctatdebug("Parsing SAI input ..."),m.ctatdebug("Childnodes: "+q.length),1===q.length?(h=e.htmlDecode(p.getNodeTextValue(h)),m.ctatdebug("Setting new value to: "+h),g.setValue(h)):(h=e.htmlDecode(p.getNodeTextValue(h)),m.ctatdebug("Setting new value to: "+h),g.setValue(h),g.setName(p.getElementAttr("name")),g.setType(p.getElementAttr("type")),g.setFormat(p.getElementAttr("format")),
f++)):(h=e.htmlDecode(p.getNodeTextValue(h)),m.ctatdebug("Setting new value to: "+h),g.setValue(h));1>l?m.setInputArray(h):m.appendToInputArray(h)}}if("prompt"==p.getElementName(a)||"Prompt"==p.getElementName(a))m.ctatdebug("Parsing prompt ..."),m.setPrompt(p.getNodeTextValue(a))}m.checkDefaultArgument()};this.toXMLString=function(b){m.ctatdebug("toXMLString ()");return b?m.toLSxmlString():m.toTSxmlString()};this.toLSxmlString=function(){m.ctatdebug("toLSxmlString ()");for(var b="",c=0;c<d.length;c++){var a=
d[c];"object"===typeof a?(b="String"!=a.getType()?b+('<selection type="'+a.getType()+'">'):b+"<selection>",b+=a.getValue()+"</selection>"):b+="<selection>"+a+"</selection>"}b+="<action>"+m.getAction();for(c=1;c<h.length;c++)b+="</action><action>"+h[c];b+="</action>";for(c=0;c<n.length;c++)a=n[c],b="object"===typeof a?"String"!=a.getType()?b+('<input type="'+a.getType()+'"><![CDATA['+a.getValue()+"]]\x3e</input>"):b+("<input><![CDATA["+a.getValue()+"]]\x3e</input>"):b+("<input><![CDATA["+a+"]]\x3e</input>");
return b};this.toTSxmlString=function(){m.ctatdebug("toTSxmlString ()");var b;b="<Selection><value>"+m.getSelection();for(var c=1;c<d.length;c++){var a=d[c];b="object"===typeof a?b+("</value><value>"+a.getValue()):b+("</value><value>"+a)}b+="</value></Selection><Action><value>"+m.getAction();for(c=1;c<h.length;c++)b+="</value><value>"+h[c];b+="</value></Action><Input>";if(1<n.length)for(c=0;c<n.length;c++)a=n[c],b+='<value fmt="text" name="'+a.getName()+'" type="'+a.getType()+'"><![CDATA['+a.getValue()+
"]]\x3e</value>";else b+="<value><![CDATA["+m.getInput()+"]]\x3e</value>";return b+"</Input>"};this.toSerializedString=function(){var b;b=""+("<selection>"+m.getSelection()+"</selection><action>"+m.getAction()+"</action><inputArray>");for(var d=0;d<n.length;d++){var c=n[d];b+='<value fmt="text" name="'+c.getName()+'" type="'+c.getType()+'">'+c.getValue()+"</value>"}return b+"</inputArray>"};this.clone=function(){m.ctatdebug("clone ()");for(var b=new CTATSAI(m.getSelection(),m.getAction(),m.getInput(),
m.getPrompt()),d=0;d<m.getArguments().length;++d)b.setArgument(d,m.getArgument(d).clone());b.setSelectionArray(m.getSelectionArray().slice());b.setActionArray(m.getActionArray().slice());b.setInputArray(m.getInputArray().slice());m.ctatdebug("CTATSAI.clone() this "+m+", clone "+b+", clone inputArray "+b.getInputArray());return b};this.isDone=function(){var b=m.getSelection(),d=m.getAction();return null==b||null==d?!1:"done"==b.toString().toLowerCase()&&"buttonpressed"==d.toString().toLowerCase()};
var q=!1;if(Array.isArray(a)&&Array.isArray(f)&&(Array.isArray(g)||null==g)&&(m.setSelectionArray(a),m.setActionArray(f),m.setInputArray(g),q=!0,0<a.length&&0<f.length)){m.setSAI(a[0],f[0],null==g?null:g[0],"String",e);return}null!==a&&""!==a&&m.setSelection(a);null!==a&&(m.setSAI(a,f,g,"String",e),q||(m.setSelectionArray(Array.isArray(a)?a:[a]),m.setActionArray(Array.isArray(f)?f:[f]),m.setInputArray(Array.isArray(g)?g:[g]),q=!0))};CTATSAI.prototype=Object.create(CTATBase.prototype);
CTATSAI.prototype.constructor=CTATSAI;CTATSAI.delayedActionRegExp=/^([^:]+):([0-9]+)$/;"undefined"!==typeof module&&(module.exports=CTATSAI);var CTATSkill=function(){CTATBase.call(this,"CTATSkill","skill");var a="",f="",g="",e="",c=0,b="",d=!1,h="",n="",l="",p="",m=0,q=0;this.setSkillName=function(b){a=b};this.setDisplayName=function(b){f=b};this.setModelName=function(b){e=b};this.setCategory=function(b){g=b};this.setLevel=function(b){!0===isNaN(b)?ctatdebug("Error: attempting to set a level to NaN"):(c=b,this.setPKnown(String(c)))};this.setDescription=function(d){b=d};this.getSkillName=function(){return a};this.getDisplayName=function(){return f};
this.hasDisplayName=function(){return""!==f&&null!==f};this.getModelName=function(){return e};this.hasCategory=function(){return""!==g};this.hasModelName=function(){return""!==e};this.getCategory=function(){return g};this.getLevel=function(){return c};this.getDescription=function(){return b};this.setTouched=function(b){d=b};this.getTouched=function(){return d};this.toXMLString=function(){return""};this.toSetPreferencesXMLString=function(){var d='<skill label="'+f+'" pSlip="'+n+'" description="'+b;
return d+='" pKnown="'+l+'" category="'+g+'" pLearn="'+p+'" name="'+a+'" pGuess="'+h+'" history="'+m+'" opportunityCount="'+q+'" />'};this.setPGuess=function(b){h=b};this.getPGuess=function(){return h};this.setPSlip=function(b){n=b};this.getPSlip=function(){return n};this.setPLearn=function(b){p=b};this.getPLearn=function(){return p};this.setPKnown=function(b){l=b};this.getPKnown=function(){return l};this.setSkillHistory=function(b){m=Number(b)||0};this.getSkillHistory=function(){return m};this.setSkillOpportunityCount=
function(b){q=Number(b)||0};this.getSkillOpportunityCount=function(){return q}};CTATSkill.prototype=Object.create(CTATBase.prototype);CTATSkill.prototype.constructor=CTATSkill;var CTATSkillSet=function(){CTATBase.call(this,"CTATSkillSet","skills");this.internalSkillSet=[];var a=this,f=!1;this.fromJSONforTutorshop=function(g){try{this.internalSkillSet=[],JSON.parse(g,function(e,c){if(Number.isInteger(Number(e))&&c.name)a.addSkill(c.name,c.p_known,.95,c.description,c.label,c.category,c.p_guess,c.p_learn,c.p_slip,c.history,c.opportunity_count);else switch(e){case "skills":case "":break;default:return c}})}catch(e){console.log("Error parsing as JSON",e,"\n  jsonStr",g)}f=!0};
this.fromDataParams=function(g,e){this.ctatdebug("CTATSkillSet.fromDataParams() Raw: "+g);if(g)return g=e?g:decodeURIComponent(g.replace(/\+/g," ")),g=g.startsWith("<")?a.fromXMLString(g):a.fromJSONforTutorshop(g),f=!0,g;this.ctatdebug("Warning: skill object is null or empty.")};this.fromXMLString=function(a){this.ctatdebug("fromXMLString () aSkills: "+a);if(null!==/\/<value>.+<\/value>/.exec(a))this.parseByValue(a);else{var e=(new CTATXML).parseXML(a);this.parseByAttributes(e,a)}f=!0;this.ctatdebug("fromXMLString () done")};
this.fromXMLData=function(a,e){this.ctatdebug("fromXMLData ()");null!==/\/<value>.+<\/value>/.exec(e)?this.parseByValue(e):this.parseByAttributes(a);f=!0;this.ctatdebug("fromXMLData () done")};this.parseByValue=function(g){this.ctatdebug("parseByValue()");if(g){g=g.childNodes;for(var e=new CTATXML,c=0;c<g.length;c++){var b=e.getNodeTextValue(g[c]).split("`"),d=b[0].split(" ");4==b.length?this.addSkill(d[0],b[1],b[2],b[3],b[3],d[1]):this.addSkill(d[0],b[1],b[2],b[3],b[4],d[1])}f=!0}else a.ctatdebug("Error: aSkills is null")};
this.parseDOM=function(a){this.ctatdebug("parseDOM()");var e=new CTATXML;a=e.getElementChildren(a);for(var c=0;c<a.length;c++){var b=e.getNodeTextValue(a[c]).split("`"),d=b[0].split(" ");4==b.length?this.addSkill(d[0],b[1],b[2],b[3],b[3],d[1]):this.addSkill(d[0],b[1],b[2],b[3],b[4],d[1])}f=!0};this.parseByAttributes=function(g){this.ctatdebug("parseByAttributes()");if(g)if(g=g.childNodes){for(var e=0;e<g.length;e++){var c=g[e];if("Skill"==c.nodeName||"skill"==c.nodeName){this.ctatdebug("Parsing node ("+
e+"): "+c.nodeName+" -> "+c.nodeValue);var b=c.attributes.getNamedItem("name");if(b=b?b.value:""){var d=c.attributes.getNamedItem("pKnown"),d=d?d.value:"",h=c.attributes.getNamedItem("description"),h=h?h.value:"",n=c.attributes.getNamedItem("label"),n=n?n.value:"",l=c.attributes.getNamedItem("category"),l=l?l.value:"",p=c.attributes.getNamedItem("pGuess"),p=p?p.value:"",m=c.attributes.getNamedItem("pLearn"),m=m?m.value:"",q=c.attributes.getNamedItem("pSlip"),q=q?q.value:"",u=c.attributes.getNamedItem("history"),
u=u?u.value:"",c=(c=c.attributes.getNamedItem("opportunityCount"))?c.value:"";this.addSkill(b,d,.95,h,n,l,p,m,q,u,c)}}}f=!0}else this.ctatdebug("Error: list of skill xml elements is null");else a.ctatdebug("Error: aSkills is null")};this.getSkillSet=function(){return this.internalSkillSet};this.getSize=function(){return this.internalSkillSet.length};this.addSkill=function(a,e,c,b,d,f,n,l,p,m,q){this.ctatdebug("addSkill() name = "+a+" level = "+e+" mastery = "+c+" aDescription = "+b+" adisplayName = "+
d+" aCategory = "+f+" pguess= "+n+" plearn = "+l+" pslip = "+p+" history = "+m+" oppCt = "+q);a=this.setSkillLevel(a,e,c);this.ctatdebug("Configuring "+a.getDisplayName());b&&a.setDescription(b);d&&a.setDisplayName(d);f&&a.setCategory(f);(n||0===n)&&a.setPGuess(n);(l||0===l)&&a.setPLearn(l);(p||0===p)&&a.setPSlip(p);a.setSkillHistory(m);a.setSkillOpportunityCount(q);return a};this.addSkillAsObject=function(a){this.addSkill(a.name,a.level,a.mastery,a.description,a.label,a.category,a.pGuess,a.pLearn,
a.pSlip,"","")};this.setSkillLevel=function(a,e,c){this.ctatdebug("setSkillLevel ("+a+","+e+","+c+")");c=this.getSkill(a);null===c?(this.ctatdebug("Skill not found, creating new one ..."),c=new CTATSkill,c.setSkillName(a),c.setLevel(e),this.internalSkillSet.push(c)):(this.ctatdebug("Skill found, adjusting ..."),c.setLevel(1),c.setLevel(e));c.setTouched(!0);return c};this.getSkill=function(a){this.ctatdebug("getSkill ("+a+") -> "+this.internalSkillSet.length);if(!a)return null;for(var e=0;e<this.internalSkillSet.length;e++){var c=
this.internalSkillSet[e];if(c.getSkillName()==a)return this.ctatdebug("Returning: "+e),c}return null};this.getSkillLevel=function(a){if(!a)return-1;for(var e in this.internalSkillSet)if(e.getSkillName()==a)return e.getLevel();return-1};this.getTouched=function(){this.ctatdebug("getTouched ()");for(var a=[],e=0;e<this.internalSkillSet.length;e++){var c=this.internalSkillSet[e];!0===c.getTouched()&&(this.ctatdebug("Adding touched skill: "+c.getSkillName()),a.push(c))}return a};this.untouchSkills=function(){this.ctatdebug("untouchSkills ()");
for(var a=0;a<this.internalSkillSet.length;a++)this.internalSkillSet[a].setTouched(!1)};this.toSetPreferencesXMLString=function(){var a=this.internalSkillSet.length;this.ctatdebug("toSetPreferencesXMLString (): nSkills "+a);if(1>a&&!f)return"";for(var e="<skills>",c=0;c<a;c++)e+=this.internalSkillSet[c].toSetPreferencesXMLString();return e+"</skills>"};this.toLogString=function(){this.ctatdebug("toLogString ("+this.internalSkillSet.length+")");for(var a="",e=0;e<this.internalSkillSet.length;e++){var c=
this.internalSkillSet[e],a=a+('<skill probability="'+c.getLevel()+'"><name>'+c.getSkillName()+"</name>");c.hasCategory()&&(a+="<category>"+c.getCategory()+"</category>");c.hasModelName()&&(a+="<model_name>"+c.getModelName()+"</model_name>");a+="</skill>"}return a}};CTATSkillSet.prototype=Object.create(CTATBase.prototype);CTATSkillSet.prototype.constructor=CTATSkillSet;CTATSkillSet.skills=null;"undefined"!==typeof module&&(module.exports=CTATSkillSet);function CTATJSONObject(a,f){this.name=a||"";this.value=f||null}
var transformArray=[],CTATJSON=function(){CTATBase.call(this,"CTATJSON","json");var a=null,f=0;this.isJSONObject=function(a){return a.ctat?!0:!1};this.parse=function(a){return this.parseJSON(a)};this.parseJSON=function(g){this.ctatdebug("parseJSON ()");a=null;if("string"==typeof g){this.ctatdebug("Parsing JSON as a string ... ");try{a=JSON.parse(g)}catch(c){return this.ctatdebug("Error parsing JSON message: "+c.message),a=null}this.ctatdebug("Successfully parsed JSON string")}this.ctatdebug("JSON string has already been parsed, assigning as an object ...");for(var e in a)return this.ctatdebug("Creating internal JSON object with name: "+
e),g=new CTATJSONObject,g.name=e,g.value=a[e],g;return null};this.getElementName=function(a){return"object"!=typeof a?(this.ctatdebug("Internal error, the provided element is not of type CTATJSONObject, instead we found: "+typeof a),null):a.name};this.getElementValue=function(a){return null==a?(this.ctatdebug("Error: anElement is null"),null):"object"!=typeof a?(this.ctatdebug("Internal error, the provided element is not of type CTATJSONObject, instead we found: "+typeof a),null):a.value};this.getElementChildren=
function(a){if(null==a)return this.ctatdebug("Error: anElement is null"),null;if("object"!=typeof a)return this.ctatdebug("Internal error, the provided element is not of type CTATJSONObject, instead we found: "+typeof a),null;var e=a.value,c=[],b;for(b in e){var d=e[b];if("string"==typeof d)a=new CTATJSONObject,a.name=b,a.value=d,c.push(a);else if(null==d[0]||void 0==d[0])a=new CTATJSONObject,a.name=b,a.value=d,c.push(a);else for(var g in d)a=new CTATJSONObject,a.name=b,a.value=d[g],c.push(a)}return c};
this.getNodeTextValue=function(a){if("string"!=typeof a.value){var e=null;for(e in a.value)if("content"==e)return a.value[e].toString();for(e in a.value)if("value"==e)return a.value[e].toString()}return a.value};this.getElementAttr=function(a,e){a=a.value;for(var c in a)if(c==e)return a[c];return null};this.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)};this.walkDOM=function(a){this.ctatdebug("walkDOM () >>>>>>>>>>>>>>>>>>");f=0;this.walk(a);this.ctatdebug("walkDOM () <<<<<<<<<<<<<<<<<<")};
this.walk=function(a){f++;if(!(5<f)){var e=0,c;for(c in a){var b=a[c];this.ctatdebug("("+e+") typeof (key): "+typeof c+" -> typeof(value): "+typeof b+"("+b.length+")");"string"!=typeof b?(this.ctatdebug("walk ("+c+")"),this.walk(b)):this.ctatdebug("walk ("+c+") : "+b);e++}}};this.stringify=function(a){return this.toJSONString(a)};this.toJSONString=function(a){return JSON.stringify(a,null,2)};this.syntaxHighlight=function(a){"string"!=typeof a&&(a=JSON.stringify(a,void 0,2));a=a.replace(/&/g,"&amp;").replace(/</g,
"&lt;").replace(/>/g,"&gt;");return a.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(a){var c="number";/^"/.test(a)?c=/:$/.test(a)?"key":"string":/true|false/.test(a)?c="boolean":/null/.test(a)&&(c="null");return'<span class="'+c+'">'+a+"</span>"})}};CTATJSON.prototype=Object.create(CTATBase.prototype);CTATJSON.prototype.constructor=CTATJSON;"undefined"!==typeof module&&(module.exports=CTATJSON);var CTATMessage=function(a){function f(b){var c=[],a=d.getElementChildren(b);this.ctatdebug("CTATMessage.parseCustomFields("+d.stringify(b)+"): valueElts.length "+a.length);for(b=0;b<a.length;++b){var e=a[b];"value"!=d.getElementName(e)?console.log("CTATMessage.parseRules(): unexpected element name "+d.getElementName(e)+" at custom_fields["+b+"]"):(e=d.getNodeTextValue(e))&&c.push(e)}return c}function g(b){var c={},a=d.getElementChildren(b);this.ctatdebug("CTATMessage.parseCustomFields("+d.stringify(b)+
"): cfElts.length "+a.length);for(b=0;b<a.length;++b){var e=a[b];if("custom_field"==d.getElementName(e)){for(var g=null,f=null,e=d.getElementChildren(e),h=0,l=0;h<e.length&&2>l;++h){var n=e[h];switch(d.getElementName(n)){case "name":g=d.getNodeTextValue(n);l++;break;case "value":f=d.getNodeTextValue(n),l++}}g&&(c[g]=f?f:"",this.ctatdebug("CTATMessage.parseCustomFields(): result["+g+"]="+c[g]+";"))}}return c}CTATBase.call(this,"CTATMessage","message");CTATMessage.makeTransactionId=function(){return CTATGuid.guid()};
var e=a,c=null,b=null,d=null;void 0==a&&(e=null);d="xml"==CTATConfig.parserType?new CTATXML:new CTATJSON;e&&(this.ctatdebug("messageParser "+d+", messageObj "+e),e.children&&this.ctatdebug(e.children));var h="ungraded",n=!1,l=!1,p=new CTATSkillSet,m="",q="",u="",v="",w="",B=!0,C,F=null,G=null,H=null,E=!1;this.setURL=function(b){C=b};this.getURL=function(){return C};this.assignSAI=function(b){l=!0;F=b};this.setTransactionID=function(b){q=b};this.getTransactionID=function(){return q};this.setGradeResult=
function(b){h=b};this.getGradeResult=function(){return h};this.getXMLObject=function(){return e};this.getSkillsObject=function(){return p};this.getCustomFields=function(){return G};this.getRules=function(){return H};this.getSuccessMessage=function(){return u};this.getBuggyMsg=function(){return v};this.getHighlightMsg=function(){return w};this.parse=function(){this.ctatdebug("parse ()");if(null!==e){this.ctatdebug("messageParser: "+d);this.ctatdebug("Root name: "+d.getElementName(e));"tool_message"==
d.getElementName(e)?(this.ctatdebug("Detected tool message"),m="tool_message"):"message"!=d.getElementName(e)?(this.ctatdebug("Detected log message"),n=!0,m=d.getElementName(e)):(this.ctatdebug("Detected regular message"),n=!1,this.parseMessageType());this.parseTransactionID();this.parseSAI();for(var a=d.getElementChildren(e),g=0;g<a.length;g++){var f=a[g];"properties"==d.getElementName(f)&&(ctatdebug("Found a 'properties' element ... "),c=f,b=d.getElementChildren(f))}this.ctatdebug("Message "+m+
", with transaction id: "+q)}};this.parseSAI=function(){this.ctatdebug("parseSAI ()");var b="",c="",a="",h="",B=[],q=[],E=[];if("tool_message"==m){this.ctatdebug("Parsing s, a and i");b=d.getElementChildren(e);for(c=0;c<b.length;c++)if(a=b[c],"tool_message"==d.getElementName(a))for(a=d.getElementChildren(a),h=0;h<a.length;h++)B=a[h],"event_descriptor"==d.getElementName(B)&&(F=new CTATSAI,F.fromXMLInternal(B));l=!0}else{if(n){this.ctatdebug("isLogMessage ...");for(var L=d.getElementChildren(e),N=0;N<
L.length;N++){var R=L[N];if("event_descriptor"==d.getElementName(R))for(var R=d.getElementChildren(R),Q=0;Q<R.length;Q++){var z=R[Q];"selection"==d.getElementName(z)&&(b=d.getNodeTextValue(z),B.push(z));"action"==d.getElementName(z)&&(c=d.getNodeTextValue(z),q.push(z));"input"==d.getElementName(z)&&(a=d.getNodeTextValue(z),E.push(z));"prompt"==d.getElementName(z)&&(h=d.getNodeTextValue(z))}}}else for(this.ctatdebug("!isLogMessage ..."),L=d.getElementChildren(e),N=0;N<L.length;N++)if(R=L[N],"properties"==
d.getElementName(R))for(R=d.getElementChildren(R),Q=0;Q<R.length;Q++){var z=R[Q],T=d.getElementName(z);this.ctatdebug("Nodename: "+T);switch(T){case "URL":C=d.getNodeTextValue(z);break;case "Skills":p.parseByValue(z);break;case "SuccessMsg":u=d.getValueNodesAsText(z);u instanceof Array&&1>u.length&&(u=[d.getNodeTextValue(z)]);break;case "BuggyMsg":v=d.getValueNodesAsText(z);v instanceof Array&&1>v.length&&(v=[d.getNodeTextValue(z)]);break;case "Selection":b=d.getNodeTextValue(z);B.push(z);break;case "Action":c=
d.getNodeTextValue(z);q.push(z);break;case "Input":a=d.getNodeTextValue(z);E.push(z);break;case "prompt":h=d.getNodeTextValue(z);break;case "HighlightMsgText":w=d.getNodeTextValue(z);break;case "custom_fields":G=g(z);break;case "Rules":H=f(z)}}this.ctatdebug("SAI: "+b+","+c+","+a);""!==b&&null!==b?(F=new CTATSAI(b,c,a,h),F.setArrayFromElements(B),F.setArrayFromElements(q),F.setArrayFromElements(E),l=!0):(this.ctatdebug("No SAI found"),l=!1);this.ctatdebug("parseSAI () done, hassai: "+l+", ("+b+","+
c+","+a+","+h+")")}};this.parseTransactionID=function(){this.ctatdebug("parseTransactionID()");if("tool_message"!=m){if(!n)for(var b=d.getElementChildren(e),c=0;c<b.length;c++){var a=b[c];if("properties"==d.getElementName(a))for(var a=d.getElementChildren(a),g=0;g<a.length;g++){var f=a[g];"transaction_id"==d.getElementName(f)&&(q=d.getNodeTextValue(f))}}this.ctatdebug("parseTransactionID() done, id: "+q)}};this.parseMessageType=function(){this.ctatdebug("parseMessageType()");for(var b=d.getElementChildren(e),
c=0;c<b.length;c++){var a=b[c];if("properties"==d.getElementName(a))for(var a=d.getElementChildren(a),g=0;g<a.length;g++){var f=a[g];"MessageType"==d.getElementName(f)&&(m=d.getNodeTextValue(f))}}this.ctatdebug("parseMessageType() -> "+m)};this.getMessageType=function(){return m};this.getTransactionID=function(){return q};this.getSAI=function(){return l?F:new CTATSAI};this.getSelection=function(){return l?F.getSelection():""};this.getAction=function(){return l?F.getAction():""};this.getInput=function(){return l?
F.getInput():""};this.getSelectionArray=function(){return l?F.getSelectionArray():[]};this.getActionArray=function(){return l?F.getActionArray():[]};this.getInputArray=function(){return l?F.getInputArray():[]};this.getXML=function(){return e};this.getXMLString=function(b){if(e.xml)return e.xml;if(XMLSerializer)return(new XMLSerializer).serializeToString(e);alert("ERROR: Extremely old browser");return""};this.getIndicator=function(){return"AssociatedRules"!=m?"":this.getProperty("Indicator")};this.getIndicatorSub=
function(){return"AssociatedRules"!=m?"":this.getProperty("IndicatorSub")};this.setProperty=function(a,e){this.ctatdebug("setProperty ("+a+","+e+")");if(null!==b){for(var g=0;g<b.length;g++){var f=b[g];if(d.getElementName(f)==a)return d.setNodeTextValue(f,e)}a=d.addElement(c,a,e);b.push(a);return e}this.ctatdebug("Internal error: no messageProperties object available");return null};this.getProperty=function(c){if(!n)if(null!==b)for(var a=0;a<b.length;a++){var e=b[a];if(d.getElementName(e)==c)return d.getNodeTextValue(e)}else this.ctatdebug("Internal error: no messageProperties object available");
return""};this.hasProperty=function(b){b=this.getProperty(b);return!n&&""!==b};this.hasSAI=function(){return l};this.isEndOfTransaction=function(){return"true"==this.getProperty("end_of_transaction")?!0:!1};this.isLogMessageType=function(){return n};this.hasStudentSAI=function(){return!1};this.getStudentSelection=function(){return null.getSelection()};this.getStudentAction=function(){return null.getAction()};this.getStudentInput=function(){return null.getInput()};this.getStudentSAI=function(){return null};
this.getToolSelection=function(){return""};q=CTATMessage.makeTransactionId();this.parse();this.init=function(b){this.setMessageType(b)};this.setSelection=function(b){F&&F.setSelection(b)};this.setAction=function(b){F&&F.setAction(b)};this.setInput=function(b){F&&F.setInput(b)};this.lockTransactionId=function(b){if(null===b||"undefined"===typeof b||1>b.length)throw new CTATExampleTracerException("lockTranactionId() argument "+b+" must be a valid id");this.setProperty(CTATMessage.TRANSACTION_ID_TAG,
b);E=!0};this.setMessageType=function(b){this.setProperty(CTATMessage.MESSAGE_TYPE,b);m=b};this.setTransactionId=function(b){if(!E){if(null===b||"undefined"===typeof b||1>b.length)b=CTATMessage.makeTransactionId();this.setProperty(CTATMessage.TRANSACTION_ID_TAG,b)}};this.suppressLogging=function(){B=!1};this.isLoggingSuppressed=function(){return!B};CTATMessage.create=function(b,d){d=new CTATMessage;d.init(b);return d}};
CTATMessage.fromString=function(a){try{var f=(new CTATXML).parseXML(a);return new CTATMessage(f)}catch(g){return console.log("CTATMessage.fromString: error ",g,"str:\n",a),null}};Object.defineProperty(CTATMessage,"MESSAGE_TYPE",{enumerable:!1,configurable:!1,writable:!1,value:"MessageType"});Object.defineProperty(CTATMessage,"TRANSACTION_ID_TAG",{enumerable:!1,configurable:!1,writable:!1,value:"transaction_id"});CTATMessage.prototype=Object.create(CTATBase.prototype);
CTATMessage.prototype.constructor=CTATMessage;"undefined"!==typeof module&&(module.exports=CTATMessage);var CTATSkills=function(a){CTATBase.call(this,"CTATSkills",a?String(a.length):"");var f={},g=0;a.forEach(function(b){f[b.getSkillName().toLowerCase()]=b});var e=new Set,c=!1,b=this;this.toXML=function(b,c){c||(c="");var d=b?"&lt;Skills&gt;":"<Skills>",a=d.length,e;for(e in f)f.hasOwnProperty(e)&&f[e]&&(d+=c+f[e].toXML(b));d+=c&&d.length>a?"\n":"";return d+(b?"&lt;/Skills&gt;":"</Skills>")};this.getAllSkills=function(){var b=[],c;for(c in f)f.hasOwnProperty(c)&&f[c]&&b.push(f[c]);return b};this.addSkill=
function(d,c){if(!b.getSkill(d.getSkillName())||c)f[d.getSkillName().toLowerCase()]=d};this.updateSkill=function(d,c,a){var f=null,h=b.getSkill(c);null!==h&&"undefined"!==typeof h&&(h.setTransactionNumber(g),c=a+" "+c,e.has(c)||(e.add(c),h.recordUpdate(d)),CTATExampleTracerSkill.CORRECT.toString().toUpperCase()===d.toString().toUpperCase()&&e.delete(c),f=h);return f};this.startTransaction=function(){++g};this.getSkill=function(d){var c=null===d||"undefined"===typeof d?null:d.toLowerCase(),c=f[c];
b.ctatdebug("CTATSkills.getSkill("+d+") returns "+c);return c};this.getSkillBarVector=function(b,c){var d=[],a;for(a in f)!0===f.hasOwnProperty(a)&&(!0!==c&&f[a].getTransactionNumber()!==g||d.push(f[a].getSkillBarString(b)));return d};this.setExternallyDefined=function(b){c=!!b};this.getExternallyDefined=function(){return c};this.setVersion=function(b){for(var d in f)!0===f.hasOwnProperty(d)&&f[d].setVersion(b)};this.toJSONforTutorshop=function(){var b=[],c;for(c in f)!0===f.hasOwnProperty(c)&&b.push(f[c].toJSONforTutorshop());
return b};this.toJSON=function(d){b.ctatdebug("CTATSkills.toJSON("+d+") to return "+("pSummarySkills"==d?b.getAllSkills():b[d]));if(!d)return b;switch(d){case "pSummarySkills":return b.getAllSkills();case "pSummaryUpdates":return b.getAllUpdates();case "psSkills":var c=[];e.forEach(function(b){return c.push(b)});return c;default:return b[d]}};this.getSkillUpdates=function(d){var c=b.getSkill(d),c=c?c.getUpdates():[];b.ctatdebug("CTATSkills.getSkillUpdates("+d+") returns length "+c.length);return c};
this.getAllUpdates=function(){var c=[];b.getAllSkills().forEach(function(b){return c=c.concat(b.getUpdates())});b.ctatdebug("CTATSkills.getAllUpdates() returns length "+c.length);return c};this.updatesToJSONforTutorshop=function(){var c=[];b.getAllSkills().forEach(function(b){return c=c.concat(b.updatesToJSONforTutorshop())});b.ctatdebug("CTATSkills.getAllUpdates() returns length "+c.length);return c};this.restoreUpdates=function(c){c&&c.forEach(function(c){var d=b.getSkill(c.skillName);d&&d.addUpdate(c)})};
this.fromJSON=function(c){c instanceof Array&&c.forEach(function(b){return e.add(b)});return b}};
CTATSkills.fromJSONforTutorshop=function(a,f){switch(a){case "name":case "category":case "p_known":case "p_learn":case "p_guess":case "p_slip":case "history":case "opportunity_count":return f;case "skills":return a=new CTATSkills(f),a.setExternallyDefined(!0),a;case "":return f}if(Number.isInteger(Number(a)))return new CTATExampleTracerSkill(f.category,f.name,f.p_guess,f.p_known,f.p_slip,f.p_learn,f.history,f.opportunity_count)};
CTATSkills.parseSkills=function(a,f){var g=[];f||(f=new CTATXML);try{for(var e=f.getElementChildren(a),c=0;c<e.length;c++){var b=f.getElementName(e[c]);if(b&&"skill"==b.toLowerCase()){var d=f.getElementAttr(e[c],"name");if(d&&""!=d.trim()){var h=f.getElementAttr(e[c],"label"),n=f.getElementAttr(e[c],"pSlip"),l=f.getElementAttr(e[c],"description"),p=f.getElementAttr(e[c],"pKnown"),m=f.getElementAttr(e[c],"category"),q=f.getElementAttr(e[c],"pLearn"),u=f.getElementAttr(e[c],"pGuess"),v=f.getElementAttr(e[c],
"history"),w=new CTATExampleTracerSkill(m,d,u,p,n,q,v);w.setOpportunityCount(f.getElementAttr(e[c],"opportunityCount"));w.setLabel(h);w.setDescription(l);g.push(w)}}}}catch(B){console.log("Error in CTATSkills.parseSkills",B,"\n skillsElt",a)}return g};CTATSkills.prototype=Object.create(CTATBase.prototype);CTATSkills.prototype.constructor=CTATSkills;"undefined"!==typeof module&&(module.exports=CTATSkills);var CTATSequencer=function(a,f){CTATBase.call(this,"CTATSequencer","sequencer");"undefined"!=typeof location&&"basic"==location.search.replace(/.*[?&]show_debug_traces=([^&]*)&?.*/,"$1")&&(useDebuggingBasic=!0);CTATLMS.is.OLI()&&(useDebuggingBasic=!0);var g=this,e=new CTATPackage,c=new CTATXML,b=null,d="sequential",h=null,n=f||function(b){console.log("CTATSequencer default CTATLMSListener",b)},l=new CTATSkills([]);this.currentIndex=-1;this.iframeId="ctat_inner_frame";this.setAlgorithm=function(b){d=
b};this.getAlgorithm=function(){return d};this.handlePackageRetrieval=function(b){g.ctatdebug("handlePackageRetrieval ()");e.init(b);null!=h&&h(e,g.currentIndex+1)};this.processXML=function(b){g.ctatdebug("parseXML ()");e.init(b);null!=h&&h(e,g.currentIndex+1)};this.init=function(d,a,f,l,n,w){g.ctatdebug("CTATSequencer.init ("+d+", "+a+", "+f+", "+l+", "+n+", "+w+")");!Number.isNaN(w=Number(w))&&0<=w&&(g.currentIndex=w-1);g.iframeId=l||g.iframeId;e.setPackageURL(d);e.setURLPrefix(f);e.setDefaultStudentInterface(n);
h=a||g.runNextProblem.bind(g);b=new CTATCommLibrary(null,!1);b.retrieveXMLFile(d,c,this);addEventListener("message",function(b){var c=document.getElementById(g.iframeId);g.ctatdebug("CTATSequencer.init() iframe "+c+", evt.data "+b.data);if(b.data&&/tutorready/i.test(b.data.command))try{c.contentWindow.CTATCommShell.commShell.assignDoneProcessor(g.advanceToNextProblem.bind(g))}catch(F){throw Error("CTATSequencer.init() error adding listener to iframe '"+g.iframeId+": "+F);}})};this.getSequenceType=
function(){return"fixed"};this.getCurrentIndex=function(){return g.currentIndex};this.advanceToNextProblem=function(b){g.ctatdebug("advanceToNextProblem()\n psResp "+b);g.processProblemSummaryResponse(b);g.runNextProblem()};this.processProblemSummaryResponse=function(b){try{var d=(new CTATMessage(c.parse(b))).getProperty("ProblemSummary");g.ctatdebug("processProblemSummaryResponse typeof(ps)"+typeof d+", ps "+d);for(var a=c.parse(d),e=c.getElementChildren(a),d=0;d<e.length;++d)if(/^skills$/i.test(c.getElementName(e[d]))){var f=
CTATSkills.parseSkills(e[d],c);g.ctatdebug("processProblemSummaryResponse skillList.length "+(f?f.length:null));f.forEach(function(b){l.addSkill(b,!0)});break}}catch(w){console.log("Error in processProblemSummaryResponse",w,"\n psResp",b)}};this.getProblemSetSize=function(){g.ctatdebug("getProblemSetSize ()");var b=e.getProblemSets();return 0==b.length?(g.ctatdebug("Error: no problem sets available, trying list of problems directly ..."),e.getProblems().getProblemSize()):b[0].getProblemSize()};this.getFirstProblem=
function(){g.ctatdebug("getFirstProblem(): currentIndex "+g.currentIndex);g.currentIndex=-1;return g.getNextProblem()};this.getProblemList=function(){g.ctatdebug("getProblemList ()");var b=e.getProblemSets();return 0==b.length?(g.ctatdebug("Error: no problem sets available, trying list of problems directly ..."),e.getProblems()):b[0].getProblems()};this.runNextProblem=function(){var b=g.getNextProblem();g.ctatdebug("CTATSequencer.runNextProblem() "+b);return g.runProblem(b)||CTATScrim.scrim.scrimUp(CTATLanguageManager.theSingleton.filterString("DONE_WITH_PROBLEM_SET"))||
null};this.runProblem=function(b){if(!b)return null;var c=document.getElementById(g.iframeId);g.ctatdebug("CTATSequencer.runProblem("+b+") iframe "+c);if(!c)throw Error("CTATSequencer.runProblem("+b+"): iframe '"+g.iframeId+"' not found");var d={};Object.assign(d,CTATConfiguration.getRawFlashVars());d.dataset_level_name1||(d.dataset_level_name1=b.getProblemFile(),d.dataset_level_type1="Activity");d.problem_name=b.getProblemFile();d.question_file=e.getRelativePath(b.getStudentInterface(),b.getProblemFile());
d.student_interface=b.getStudentInterface();d.skills=encodeURIComponent(g.getRevisedSkills(b.getSkills()).toXML());c.setAttribute("data-params",JSON.stringify(d));c.src=e.getURLPrefix()+e.getRelativePath(b.getStudentInterface())+(d.mode?"?MODE="+d.mode:"");return b};this.getRevisedSkills=function(b,c){b.forEach(function(b){l.addSkill(b,c)});return l};this.getNextProblem=function(){g.ctatdebug("getNextProblem(): currentIndex "+g.currentIndex);var b=e.getProblemSets();return 0==b.length?(g.ctatdebug("Error: no problem sets available, trying list of problems directly ..."),
e.getProblems()[++g.currentIndex]):b[0].getProblems()[++g.currentIndex]};this.addProblem=function(b,c,d,a,g){e.addProblem(b,c,d,a,g)};CTATConfiguration.generateDefaultConfigurationObject(a,"undefined"==typeof CTATTarget?void 0:CTATTarget);addEventListener("ctatlms",function(b){console.log("CTATSequencer ctatlms listener evt",b);n(b)})};CTATSequencer.prototype=Object.create(CTATBase.prototype);CTATSequencer.prototype.constructor=CTATSequencer;
Object.defineProperty(CTATSequencer,"PackageListURI",{enumerable:!1,configurable:!1,writable:!1,value:/^([^?]*\/)?package[.]xml$/i});var CTATActionEvaluationData=function(a){CTATBase.call(this,"CTATActionEvaluationData","actionevaluation");var f=0,g=0,e="",c=a;this.setClassification=function(b){this.classification=b};this.isHint=function(){return"HINT"==c};this.hasClassification=function(){return!0};this.setCurrentHintNumber=function(b){f=b};this.setTotalHintsAvailable=function(b){g=b};this.setHintID=function(b){e=b};this.getClassification=function(){return""};this.setEvaluation=function(b){c=b};this.getEvaluation=function(){return c};
this.getAttributeString=function(){var b="";if(!this.isHint())return b;b+='current_hint_number="'+f+'" ';b+='total_hints_available="'+g+'" ';""!==e&&(b+='hint_id="'+e+'" ');return b}};CTATActionEvaluationData.prototype=Object.create(CTATBase.prototype);CTATActionEvaluationData.prototype.constructor=CTATActionEvaluationData;var CTATVariable=function(){this.value=this.name=""};var CTATCurriculumService=function(a){CTATBase.call(this,"CTATCurriculumService","curriculum_service");var f=this;this.sendSummary=function(g,e){f.ctatdebug("sendSummary ()");var c=g.getXMLObject(),b=c.getElementsByTagName("ProblemSummary"),b=$("<div>").html(b[0].innerHTML).text();g=CTATConfiguration.getRawFlashVars().curriculum_service_url;var d=new CTATXML,h=d.parse(b),d=d.getElementAttr(h,"CompletionStatus");CTATLMS.is.TutorShop()&&(b=c.getElementsByTagName("ProblemSummaryJSON"),b=b[0].textContent);
if(g)return c=CTATCurriculumService.formatProblemSummary(b),b=null,d&&d.toLowerCase().startsWith("complete")&&(CTATScrim.scrim.nextProblemScrimUp(),b=f.processIncoming.bind(f,e),a.assignMessageListener(f),a.assignHandler(f)),e?e.then(b):a.send_post_variables(g,c);if("complete"==d){var n=CTATGlobals.languageManager.getString("CONGRATULATIONS_YOU_ARE_DONE");CTATScrim.scrim.OKScrimUp(n,function(){var b=CTATShellTools.getAllComponents(),c=b.find(function(b){return"CTATHintWindow"===b.getClassName()});
c&&c.showFeedback(n);b.forEach(function(b){return b.lock()});CTATScrim.scrim.scrimDown()})}return Promise.resolve(b)};this.processOutgoing=function(a){f.ctatdebug('CTATCurriculumService.processOutgoing("'+a+'")')};this.processIncoming=function(g){var e=CTATConfiguration.get("run_problem_url");console.log("CTATCurriculumService.processIncoming(",g,"), parent.location.replace "+parent.location.replace+', runProblemUrl "'+e+'"');e&&parent&&parent.location&&(g=g&&"function"==typeof g.then?g:a)&&g.then(function(c){console.log("loggingLib resolve arg",
c);parent.location.replace(e)},function(c){console.log("CTATCurriculumService: error from loggingLib",c,"now",Date.now(),"msElapsed",Date.now()-Number(c),"\n***proceeding to next problem",e);parent.location.replace(e)})};this.processMessage=function(a){this.ctatdebug("CTATCurriculumService.processMessage("+(a?a.substring(0,30)+"...":"")+")")};this.checkProtocol=function(a){return"localhost"==a||"127.0.0.1"==a?!0:null===/^http[s]?:\/\/([^\/]+)\//.exec(a)||4096<=a.length?!1:!0}};
CTATCurriculumService.prototype=Object.create(CTATBase.prototype);CTATCurriculumService.prototype.constructor=CTATCurriculumService;CTATCurriculumService.formatProblemSummary=function(a){var f={};["user_guid","session_id","authenticity_token","school_name"].forEach(function(a){return f[a]=CTATConfiguration.get(a)});f.summary=a;f.targetFrame=CTATConfiguration.get("target_frame");f.reuseSWF=CTATConfiguration.get("reuse_swf");return f};
CTATCurriculumService.sendProblemSummary=function(a,f){var g=CTATConfiguration.get("curriculum_service_url");if(!g||!a)return Promise.reject("no curriculum_service_url or problem summary");a=CTATLMS.is.TutorShop()?a.toJSONforTutorshop():a.toXML(!0);a=CTATCurriculumService.formatProblemSummary(a);console.log("CTATCurriculumService.sendProblemSummary",g,a);if(f){f=new FormData;for(var e in a)f.set(e,a[e]);return Promise.resolve(navigator.sendBeacon(g,f))}return $.post(g,a)};var CTATLogMessageBuilder=function(){CTATBase.call(this,"CTATLogMessageBuilder","logmessagebuilder");var a=this,f=[],g=[],e="";this.getStepID=function(){return e};this.setContextName=function(c){CTATLogMessageBuilder.contextGUID=c};this.getContextName=function(){return CTATLogMessageBuilder.contextGUID};this.makeSessionElement=function(){var c=flashVars.getRawFlashVars();return void 0!=c.log_session_id&&null!=c.log_session_id?"<session_id>"+c.log_session_id+"</session_id>":"<session_id>"+c.session_id+
"</session_id>"};this.createContextMessage=function(c){a.ctatdebug("createContextMessage()");var b=new Date,d=flashVars.getRawFlashVars(),e='<context_message context_message_id="'+this.getContextName()+'" name="START_PROBLEM">';c||(e+=this.makeMetaElement(b));void 0!=d.class_name?""!=d.class_name?(c="<class>"+("<name>"+d.class_name+"</name>"),void 0!=d.school_name&&(c+="<school>"+d.school_name+"</school>"),void 0!=d.period_name&&(c+="<period>"+d.period_name+"</period>"),void 0!=d.class_description&&
(c+="<description>"+d.class_description+"</description>"),void 0!=d.instructor_name&&(c+="<instructor>"+d.instructor_name+"</instructor>"),c+="</class>"):c="<class />":c="<class />";e+=c;c=flashVars.getDatasetTypes();var g=flashVars.getDatasetNames();a.ctatdebug("Check: "+c.length+", "+g.length);if(null!=c&&null!=g){a.ctatdebug("We have valid data set names and types, adding to message ...");for(var b="<dataset>"+("<name>"+d.dataset_name+"</name>"),f=0;f<c.length;f++)a.ctatdebug("Adding ..."),b+=
'<level type="'+c[f]+'">',b+="<name>"+g[f]+"</name>";b+="<problem ";a.ctatdebug('Checking vars ["problem_tutorflag"]: '+d.problem_tutorflag);a.ctatdebug('Checking vars ["problem_otherproblemflag"]: '+d.problem_otherproblemflag);if(void 0!=d.problem_tutorflag||void 0!=d.problem_otherproblemflag)void 0!=d.problem_tutorflag?b+=' tutorFlag="'+d.problem_tutorflag+'"':void 0!=d.problem_otherproblemflag&&(b+='tutorFlag="'+d.problem_otherproblemflag+'"');b=b+">"+("<name>"+d.problem_name+"</name>");b=void 0!=
d.problem_context?b+("<context>"+d.problem_context+"</context>"):b+"<context />";b+="</problem>";for(d=0;d<c.length;d++)b+="</level>";e+=b+"</dataset>"}d="";c=flashVars.getConditionNames();b=flashVars.getConditionTypes();g=flashVars.getConditionDescriptions();if(0<c.length)for(f=0;f<c.length;f++)d+="<condition><name>"+c[f]+"</name>",d+=""==b[f]?"":"<type>"+b[f]+"</type>",d+=""==g[f]?"":"<desc>"+g[f]+"</desc>",d+="</condition>";var e=e+d,d=flashVars.getCustomFields(),p;for(p in d)d.hasOwnProperty(p)&&
(c=String(d[p]),c=0>c.indexOf("<![CDATA[")?"<![CDATA["+c+"]]\x3e":c,e+="<custom_field>",e+="<name>"+p+"</name>",e+="<value>"+c+"</value>",e+="</custom_field>");e+="</context_message>";a.ctatdebug("messageString = "+e);return e};this.createSemanticEventToolMessage=function(c,b,d,e,n,l){a.ctatdebug("createSemanticEventToolMessage("+l+")");var h=new Date;flashVars.getRawFlashVars();var m='<tool_message context_message_id="'+this.getContextName()+'">';n||(m+=this.makeMetaElement(h));b='<semantic_event transaction_id="'+
b+'" name="'+d+'"';""!=e&&(b+=' subtype="'+e+'"');void 0!=l&&""!=l&&(b+=' trigger="'+l+'"');m+=b+"/>";e="<event_descriptor>";c=c.toXMLString(!0);m+=e+c+"</event_descriptor>";m+=this.createCustomFields(f,g);m+="</tool_message>";a.ctatdebug("messageString = "+m);return m};this.createUIEventToolMessage=function(c,b,d,e){a.ctatdebug("createUIEventToolMessage()");var h=new Date;flashVars.getRawFlashVars();var l='<tool_message context_message_id="'+this.getContextName()+'">';e||(l+=this.makeMetaElement(h));
l+='<ui_event name="'+b+'">'+d+"</ui_event>";c="<event_descriptor>"+c.toSerializedString();l=l+(c+"</event_descriptor>")+this.createCustomFields(f,g);l+="</tool_message>";a.ctatdebug("messageString = "+l);return l};this.createTutorMessage=function(c,b,d,e,n,l,p,m){a.ctatdebug("createTutorMessage()");var h=new Date;flashVars.getRawFlashVars();var u='<tutor_message context_message_id="'+this.getContextName()+'">';m||(u+=this.makeMetaElement(h));b='<semantic_event transaction_id="'+b+'" name="'+d+'"';
""!==l&&(b+=' subtype="'+l+'"');u+=b+"/>";c="<event_descriptor>"+c.toXMLString(!0);u+=c+"</event_descriptor>";c="<action_evaluation ";e.hasClassification()&&null!=e.getAttributeString()&&(c+=e.getAttributeString());c+=">"+e.getEvaluation()+"</action_evaluation>";u+=c;""!=n&&(u+="<tutor_advice>"+n+"</tutor_advice>");null!=p&&(a.ctatdebug("Adding skills to log message ..."),u+=p.toLogString());u+=this.createCustomFields(f,g);u+="</tutor_message>";a.ctatdebug("messageString = "+u);return u};this.createGenericMessage=
function(c,b){a.ctatdebug("createGenericMessage()");flashVars.getRawFlashVars();b='<message context_message_id="'+this.getContextName()+'">';b=b+c+"</message>";a.ctatdebug("messageString = "+b);return b};this.makeMetaElement=function(c){a.ctatdebug("makeMetaElement ()");var b=flashVars.getRawFlashVars(),d;d="<meta>"+("<user_id>"+b.user_guid+"</user_id>");d+="<session_id>"+b.session_id+"</session_id>";d+="<time>"+this.formatTimeStamp(c)+"</time>";return d+="<time_zone>"+flashVars.getTimeZone()+"</time_zone></meta>"};
this.createLogSessionStart=function(){a.ctatdebug("createLogSessionStart ()");var c=new Date;a.ctatdebug("Date: "+c);var b='<log_session_start timezone="'+flashVars.getTimeZone()+'" ',d=flashVars.getRawFlashVars(),b=b+('date_time="'+CTATLogMessageBuilder.formatTimeStampOLI(c)+'" '),b=b+('auth_token="'+d.auth_token+'" '),b=b+('session_id="'+d.session_id+'" '),b=b+('user_guid="'+d.user_guid+'" ');return b+'class_id="" treatment_id="" assignment_id="" info_type="tutor_message.dtd"/>'};this.formatTimeStamp=
function(c){a.ctatdebug("formatTimeStamp ("+c+")");var b="",d=c.getUTCFullYear(),b=b+(d+"-"),d=c.getUTCMonth();d++;b+=(10>d?"0"+d:d)+"-";d=c.getUTCDate();b+=(10>d?"0"+d:d)+" ";d=c.getUTCHours();b+=(10>d?"0"+d:d)+":";d=c.getUTCMinutes();b+=(10>d?"0"+d:d)+":";d=c.getUTCSeconds();b+=(10>d?"0"+d:d)+".";c=c.getUTCMilliseconds();return b+((10>c?"00":100>c?"0":"")+c)};this.resetCustomFields=function(){a.ctatdebug("resetCustomFields ()");f=[];g=[]};this.createCustomFields=function(c,b){a.ctatdebug("createCustomFields ()");
if(null==c||null==b)return a.ctatdebug("No custom fields provided"),"";a.ctatdebug("Processing "+c.length+" custom fields ...");for(var d="",g=0;g<c.length;g++){a.ctatdebug("Adding custom field: ["+c[g]+"],["+b[g]+"]");var f=String(b[g]);/step[-_.]?id/i.test(c[g])&&(e=f);f=0>f.indexOf("<![CDATA[")?"<![CDATA["+f+"]]\x3e":f;d+="<custom_field>";d+="<name>"+c[g]+"</name>";d+="<value>"+f+"</value>";d+="</custom_field>"}return d};this.addCustomFields=function(c,b){a.ctatdebug("addCustomFields () "+(c?c.length:
"null"));if(void 0!=c)for(var d=0;d<c.length;d++)f.push(c[d]),g.push(b[d])};this.addCustomField=function(c,b){a.ctatdebug("addCustomfield ("+c+","+b+")");f.push(c);g.push(b)};this.getCustomFieldNames=function(){return f};this.getCustomFieldValues=function(){return g}};CTATLogMessageBuilder.prototype=Object.create(CTATBase.prototype);CTATLogMessageBuilder.prototype.constructor=CTATLogMessageBuilder;CTATLogMessageBuilder.contextGUID="";
CTATLogMessageBuilder.formatTimeStampOLI=function(a){ctatdebug("formatTimeStampOLI ("+a+")");var f="",g=a.getUTCFullYear(),f=f+(g+"/"),g=a.getUTCMonth();g++;f+=(10>g?"0"+g:g)+"/";g=a.getUTCDate();f+=(10>g?"0"+g:g)+" ";g=a.getUTCHours();f+=(10>g?"0"+g:g)+":";g=a.getUTCMinutes();f+=(10>g?"0"+g:g)+":";g=a.getUTCSeconds();f+=(10>g?"0"+g:g)+".";a=a.getUTCMilliseconds();return f+((10>a?"00":100>a?"0":"")+a)};
CTATLogMessageBuilder.wrapForOLI=function(a){ctatdebug("wrapForOLI ()");var f=new Date,g=flashVars.getRawFlashVars();a=encodeURIComponent(a);var e;e='<?xml version="1.0" encoding="UTF-8"?><log_action '+('auth_token="'+encodeURIComponent(g.auth_token)+'" ');e=void 0!=g.log_session_id&&null!=g.session_id?e+('session_id="'+g.log_session_id+'" '):e+('session_id="'+g.session_id+'" ');e=e+'action_id="EVALUATE_QUESTION" '+('user_guid="'+g.user_guid+'" ');e+='date_time="'+CTATLogMessageBuilder.formatTimeStampOLI(f)+
'" ';e+='timezone="'+flashVars.getTimeZone()+'" ';e+='source_id="'+g.source_id+'" ';e=g.activity_context_guid?e+('external_object_id="'+g.activity_context_guid+'" info_type="tutor_message.dtd">'):e+'external_object_id="" info_type="tutor_message.dtd">';return e+a+"</log_action>"};var CTATCustomLogElementObject=function(){this.reset=function(){};this.addCustomLogElement=function(a,f){customElementsNames.push(a);customElementsTypes.push(a)};this.getCustomElementNames=function(){return customElementsNames};this.getCustomElementTypes=function(){return customElementsTypes}};var loggingDisabled=!1,CTATLoggingLibrary=function(a,f){CTATBase.call(this,"CTATLoggingLibrary","logginglibrary");var g=this,e=!0,c="undefined"==typeof a?!0:a,b=!1,d=[],h="undefined",n="undefined",l="undefined",p="undefined",m="undefined",q="undefined",u="undefined",v="undefined",w="UnassignedDataset",B="UnassignedLevelName",C="UnassignedLevelType",F=null,G=null,H=null,v=CTATGuid.guid(),E=new CTATCommLibrary;E.setName("commLoggingLibrary");E.setUseCommSettings(!1);E.setConnectionRefusedMessage("ERROR_CONN_LS");
E.assignHandler(this);E.setFixedURL(CTATConfiguration.get("log_service_url"));this.extCommLogMessageBuilder=f;this.getLastSAI=function(){return G};this.assignLogListener=function(b){F=b};this.generateSession=function(){d.session_id="ctat_session_"+CTATGuid.guid();return d.session_id};this.setLogClassName=function(b){h=b};this.setDatasetName=function(b){w=b};this.setDatasetLevelName=function(b){B=b};this.setDatasetLevelType=function(b){C=b};this.setSchool=function(b){n=b};this.setPeriod=function(b){l=
b};this.setDescription=function(b){p=b};this.setInstructor=function(b){m=b};this.setProblemName=function(b){q=b};this.setProblemContext=function(b){u=b};this.setUserID=function(b){v=b};this.getLoggingCommLibrary=function(){return E};this.setUseSessionLog=function(b){e=b};this.setLoggingURL=function(b){g.getLoggingCommLibrary().setFixedURL(b)};this.getSessionIdentifierBundle=function(){var b=[];b.class_name=h;b.school_name=n;b.period_name=l;b.class_description=p;b.instructor_name=m;b.dataset_name=
w;b.problem_name=q;b.problem_context=u;b.auth_token="";b.user_guid=v;b.session_id=d.session_id;b.source_id="tutor";b.dataset_level_name1=B;b.dataset_level_type1=C;return b};this.setupExternalLibraryUsage=function(){g.ctatdebug("setupExternalLibraryUsage ()");d.class_name=h;d.school_name=n;d.period_name=l;d.class_description=p;d.instructor_name=m;d.dataset_name=w;d.problem_name=q;d.problem_context=u;d.auth_token="";d.user_guid=v;d.session_id="ctat_session_"+CTATGuid.guid();d.source_id="tutor";d.dataset_level_name1=
B;d.dataset_level_type1=C;flashVars=CTATConfiguration.generateDefaultConfigurationObject();flashVars.assignRawFlashVars(d)};this.initCheck=function(){g.ctatdebug("initCheck ()");0==c&&0==b&&(g.setupExternalLibraryUsage(),b=!0)};this.sendMessage=function(b,c){g.ctatdebug("sendMessage ()");g.ctatdebug("Raw log message to send (info "+c+"): "+b);this.sendMessageInternal(b,c);null!=F&&F(b)};this.sendMessageInternal=function(b,d){g.ctatdebug("sendMessageInternal ()");if(!0===loggingDisabled)g.ctatdebug("Warning: loggingDisabled==true");
else if(1==c){var a=CTATConfiguration.get("Logging");if("ClientToService"!=a&&"ClientToLogServer"!=a)g.ctatdebug("Logging is turned off, as per: "+a);else{var e=CTATConfiguration.get("tutoring_service_communication");"ClientToService"!=a||"http"!=e&&"https"!=e||(a=CTATConfiguration.get("remoteSocketURL")+":"+CTATConfiguration.get("remoteSocketPort"),g.setLoggingURL(a),g.ctatdebug("Reconfigured the logging url to be: "+a));g.ctatdebug("Pre encoded log message: "+b);a=b;0>b.indexOf("<log_session_start")&&
(a=CTATLogMessageBuilder.wrapForOLI('<?xml version="1.0" encoding="UTF-8"?><tutor_related_message_sequence version_number="4">'+b+"</tutor_related_message_sequence>"));g.ctatdebug("Encoded log message: "+a);H=CTATLMS.logEvent(a,b,d);(b=CTATConfiguration.get("log_service_url"))&&navigator.sendBeacon(b,a)}}else g.ctatdebug("Use internal: "+c)};this.startProblem=function(){g.ctatdebug("startProblem ()");g.initCheck();g.logSessionStart();var b=g.extCommLogMessageBuilder||new CTATLogMessageBuilder;g.sendMessage(b.createContextMessage(!0),
{datashopType:"context"})};this.logSessionStart=function(){g.ctatdebug("logSessionStart ()");g.initCheck();var b=CTATConfiguration.getRawFlashVars();void 0!=b.SessionLog&&("false"==b.SessionLog||"boolean"==typeof b.SessionLog&&!1===b.SessionLog?(g.ctatdebug("Turning SessionLog off ..."),e=!1):(g.ctatdebug("Turning SessionLog on ..."),e=!0));!0===e&&(b=g.extCommLogMessageBuilder||new CTATLogMessageBuilder,this.sendMessage(b.createLogSessionStart(),{datashopType:"sessionStart"}))};this.logSemanticEvent=
function(b,c,d,a,e,f,h){g.ctatdebug("logSemanticEvent ("+h+")");g.initCheck();G=c;var l=new Date,n=g.extCommLogMessageBuilder||new CTATLogMessageBuilder;n.resetCustomFields();n.addCustomFields(e,f);n.addCustomField("tool_event_time",n.formatTimeStamp(l)+" UTC");b=n.createSemanticEventToolMessage(c,b,d,a,!0,h);this.sendMessage(b,{datashopType:"tool",semanticName:d,sai:c})};this.logTutorResponse=function(b,c,d,a,e,f,h,l,n){g.ctatdebug("logTutorResponse ()");g.initCheck();G=c;var m=new Date,B=g.extCommLogMessageBuilder||
new CTATLogMessageBuilder;B.resetCustomFields();B.addCustomFields(l,n);B.addCustomField("tutor_event_time",B.formatTimeStamp(m)+" UTC");g.ctatdebug("Formatting feedback ...");void 0!=f&&null!=f?f="<![CDATA["+CTATGlobals.languageManager.filterString(f)+"]]\x3e":(g.ctatdebug("No feedback provided, using empty string"),f="");g.ctatdebug("Creating tutor message ...");b=B.createTutorMessage(c,b,d,e,f,a,h,!0);this.sendMessage(b,{datashopType:"tutor",semanticName:d,stepID:B.getStepID(),sai:c,evaluation:e&&
e.getEvaluation?e.getEvaluation():"",tutorAdvice:f});return b};this.processMessage=function(b){g.ctatdebug("processMessage ()");g.ctatdebug("Response from log server: "+b)};this.start=function(){g.ctatdebug("start ()");var b=g.generateSession();g.startProblem();return b};this.logInterfaceAttempt=function(b,c,d,a){g.ctatdebug("logInterfaceAttempt ()");a=CTATGuid.guid();b=new CTATSAI(b,c,d);b.setInput(d);G=b;this.logSemanticEvent(a,b,"ATTEMPT","");return a};this.logInterfaceAttemptSAI=function(b,c){g.ctatdebug("logInterfaceAttemptSAI ()");
G=b;c=CTATGuid.guid();this.logSemanticEvent(c,b,"ATTEMPT","");return c};this.logResponse=function(b,c,d,a,e,f,h,l){g.ctatdebug("logResponse ()");c=new CTATSAI(c,d,a);c.setInput(a);a=new CTATActionEvaluationData("");a.setEvaluation(f);void 0==l?this.logTutorResponse(b,c,e,"",a,h):this.logTutorResponse(b,c,e,"",a,h,null,l.getCustomElementNames(),l.getCustomElementTypes())};this.logResponseSAI=function(b,c,d,a,e,f){g.ctatdebug("logResponse ()");var h=new CTATActionEvaluationData("");h.setEvaluation(a);
void 0==f?this.logTutorResponse(b,c,d,"",h,e):this.logTutorResponse(b,c,d,"",h,e,null,f.getCustomElementNames(),f.getCustomElementTypes())};this.endSession=function(){this.generateSession()};this.then=function(b,c,d){var a=[];E&&"function"==typeof E.then&&a.push(E);H&&"function"==typeof H.then&&a.push(H);if(0<(d=Number(d))){var e=Date.now();a.push(new Promise(function(b,c){setTimeout(c,d,e)}))}return Promise.race(a).then(b,c)}};CTATLoggingLibrary.prototype=Object.create(CTATBase.prototype);
CTATLoggingLibrary.prototype.constructor=CTATLoggingLibrary;var CTATComponentDescription=function(){CTATBase.call(this,"CTATComponentDescription","");this.groupName=this.name=this.type="Unknown";this.height=this.width=this.y=this.x=0;this.tabIndex=this.zIndex=-1;this.styles={};this.params={};this.componentPointer=null;this.setComponentPointer=function(a){this.componentPointer=a};this.getComponentPointer=function(){return this.componentPointer};this.setGenericDefaults=function(){this.name="Generic name";this.styles={BackgroundColor:null,BorderColor:null,FontName:null,
FontSize:null,FontColor:null,FontBold:null,FontItalic:!1,FontUnderlined:!1,TextAlign:null,ShowHintHighlight:!1,blockOnCorrect:!1,disabledBackgroundColor:"#999999",disabledTextColor:"#999999",tutorComponent:null};return this}};CTATComponentDescription.prototype=Object.create(CTATBase.prototype);CTATComponentDescription.prototype.constructor=CTATComponentDescription;var CTATShellTools={ctat_base:new CTATBase("CTATShellTools","shelltools"),component_descriptions:{},registerComponentDescription:function(a){CTATShellTools.ctat_base.ctatdebug("registerComponentDescription ("+a.name+","+a.type+")");CTATShellTools.component_descriptions[a.name]=a},listComponents:function(){CTATShellTools.ctat_base.ctatdebug("listComponents ()");var a=CTATShellTools.component_descriptions,f;for(f in a){var g=a[f];CTATShellTools.ctat_base.ctatdebug("Obtaining component for "+g.name+
" with type: "+g.type);g=g.getComponentPointer();null!==g?CTATShellTools.ctat_base.ctatdebug("Component: "+g.getName()+" of instance: "+g.getClassName()):CTATShellTools.ctat_base.ctatdebug("Error: component pointer is null")}},feedback_components:[],registerFeedbackComponent:function(a,f,g,e,c){CTATShellTools.feedback_components.push({component:a,next:f,prev:g,showHints:e,showFeedback:c})},showNextHint:function(){CTATShellTools.feedback_components.forEach(function(a){a.next&&a.next.bind(a.component)()})},
showPrevHint:function(){CTATShellTools.feedback_components.forEach(function(a){a.prev&&a.prev.bind(a.component)()})},showFeedback:function(a){0==CTATShellTools.feedback_components.length?CTATScrim.scrim.OKScrimUp(a,null):CTATShellTools.feedback_components.forEach(function(f){f.showFeedback&&f.showFeedback.call(f.component,a)})},showHints:function(a){CTATShellTools.feedback_components.forEach(function(f){f.showHints&&f.showHints.call(f.component,a)})},getCurrentMs:function(){return(new Date).valueOf()},
getAllComponents:function(){var a=[];$(".CTATComponent").each(function(){a.push($(this).data("CTATComponent"))});return a},getNameFromGroup:function(a){CTATShellTools.ctat_base.ctatdebug("getNameFromGroup ("+a+")");var f=a.split(" ");return 1==f.length?a:f[0].substring(0,f[0].length-1)},findComponent:function(a){var f=CTATShellTools.component_descriptions,g=[],e=null;CTATShellTools.ctat_base.ctatdebug("findComponent("+a+")");if(!a)return[];for(var c=['div[data-ctat-component]:has(input[name="'+a+
'"])',"done"==a.toLowerCase()?".CTATDoneButton":"","hint"==a.toLowerCase()||"help"==a.toLowerCase()?".CTATHintButton":""],e=$('[id="'+a+'"]'),b=0;0===e.length&&b<c.length;b++)e=$(c[b]);if(0<e.length&&(e.each(function(){$(this).data("CTATComponent")&&g.push($(this).data("CTATComponent"))}),0<g.length))return g;CTATShellTools.ctat_base.ctatdebug("JQuery couldn't find the component, let's try our internal list ...");for(var d in f){e=f[d];if(!e||!e.name||!e.getComponentPointer())return CTATShellTools.ctat_base.ctatdebug("Internal error parsing component at index "+
d+(e?e.name?"(no component pointer)":"(no name attribute)":"")),null;CTATShellTools.ctat_base.ctatdebug("Comparing "+e.name+" to: "+a);if(e.name==a)return CTATShellTools.ctat_base.ctatdebug("Found a component description for ["+e.name+"], returning pointer ("+e.getComponentPointer()+") ..."),g.push(e.getComponentPointer()),g;e.groupName==a&&(CTATShellTools.ctat_base.ctatdebug("Found the component group ("+e.groupName+"), adding component instance for "+e.name+" ..."),g.push(e.getComponentPointer()))}return 0===
g.length&&(CTATShellTools.ctat_base.ctatdebug("Info (groupArray.length==0), no appropriate component found, perhaps this is a group component"),-1!=a.indexOf("."))?(a=a.split("."),this.findComponent(a[0])):g},findComponentInstance:function(a,f){a=CTATShellTools.findComponent(a,f);return 1==a.length?a[0]:a},findComponentByClass:function(a){var f=CTATShellTools.component_descriptions,g;for(g in f){var e=f[g];if(null===e)return null;if(null!==e.getComponentPointer()&&e.getComponentPointer().getClassName()==
a)return e.getComponentPointer()}a=$("."+a);return 0<a.length?a.first().data("CTATComponent"):null}};CTATShellTools.reservedSelections={nextButton:{name:"nextButton",executeSAI:CTATShellTools.showNextHint},previousButton:{name:"previousButton",executeSAI:CTATShellTools.showPrevHint}};CTATShellTools.execReservedSelection=function(a){var f=a.getSelection(),g=a.getAction(),e=a.getInput();return(a=CTATShellTools.reservedSelections[f])?(a.executeSAI(f,g,e),!0):!1};
CTATShellTools.getReservedSelection=function(a){return CTATShellTools.reservedSelections[a&&a.getSelection()]};var CTATTutoringServiceMessageBuilder=function(){CTATBase.call(this,"CTATTutoringServiceMessageBuilder","__undefined__");this.createStartProblemMessage=function(a){this.ctatdebug("createStartProblemMessage ()");return"<message><verb>NotePropertySet</verb><properties><MessageType>StartProblem</MessageType><ProblemName>"+a+"</ProblemName></properties></message>"};this.createInterfaceIdentificationMessage=function(a){this.ctatdebug("createInterfaceIdentificationMessage ("+a+")");return"<message><verb>NotePropertySet</verb><properties><MessageType>InterfaceIdentification</MessageType><Guid>"+
a+"</Guid></properties></message>"};this.createInterfaceDescriptionMessage=function(a){this.ctatdebug("createInterfaceDescriptionMessage ()");message="<message><verb>NotePropertySet</verb><properties><MessageType>InterfaceDescription</MessageType>";message+="<WidgetType>"+a.getClassName()+"</WidgetType>";message+="<CommName>"+a.getName()+"</CommName>";message+="<UpdateEachCycle>false</UpdateEachCycle>";message+="<serialized>";message+="<"+a.getClassName()+' name="'+a.getName()+'" x="0" y="0" width="50" height="30" scaleX="1" scaleY="1" originalWidth="50" originalHeight="30" zIndex="-1" tabIndex="-1">';
message+="<Parameters><selection>";if("CTATRadioButton"==a.getClassName()||"CTATCheckBox"==a.getClassName())message+="<CTATComponentParameter>",message+="<name>group</name>",message+='<value fmt="text" name="Group Name" type="String" includein="sparse">'+a.getComponentGroup()+"</value>",message+="</CTATComponentParameter>";message+="</selection></Parameters>";message+="</"+a.getClassName()+">";message+="</serialized>";return message+="</properties></message>"};this.createSetPreferencesMessage=function(a,
f){this.ctatdebug("createSetPreferencesMessage ()");f=CTATConfiguration.getRawFlashVars();var g;g="<message><verb>NotePropertySet</verb><properties><MessageType>SetPreferences</MessageType>"+("<log_service_url>"+f.log_service_url+"</log_service_url>");var e=!1,c=!1,b=f.Logging;this.ctatdebug("Parsing and processing logMethod: "+b);switch(b){case "ServiceToLogServer":e=!0;break;case "ServiceToDisk":c=!0;break;case "ServiceToDiskAndLogServer":c=e=!0;break;case "ClientToLogServer":c=e=!1;break;case "ClientToService":c=
e=!0}g=g+("<log_to_remote_server>"+e+"</log_to_remote_server><log_to_disk>"+c+"</log_to_disk>")+("<log_to_disk_directory>"+f.log_to_disk_directory+"</log_to_disk_directory>");g+="<logging>"+f.Logging+"</logging>";g+="<user_guid>"+f.user_guid+"</user_guid>";g+="<problem_name>"+f.problem_name+"</problem_name>";g+="<question_file><![CDATA["+f.question_file+"]]\x3e</question_file>";g+="<class_name>"+f.class_name+"</class_name>";g+="<school_name>"+f.school_name+"</school_name>";g+="<instructor_name>"+
f.instructor_name+"</instructor_name>";g+="<session_id>"+f.session_id+"</session_id>";g+="<source_id>"+f.source_id+"</source_id>";g+="<sui><![CDATA["+f.sui+"]]\x3e</sui>";g+="<problem_state_status>"+f.problem_state_status+"</problem_state_status>";g+="<curriculum_service_url>"+f.curriculum_service_url+"</curriculum_service_url>";g+="<restore_problem_url>"+f.restore_problem_url+"</restore_problem_url>";g+="<tutoring_service_communication>"+f.tutoring_service_communication+"</tutoring_service_communication>";
g+="<mode>"+f.mode+"</mode>";g+="<collaborators>"+f.collaborators+"</collaborators>";null!==CTATSkillSet.skills&&(g+=CTATSkillSet.skills.toSetPreferencesXMLString());g=g+("<CommShellVersion>"+a+"</CommShellVersion>")+"</properties></message>";return""+g};this.createTracerActionMessage=function(a,f){this.ctatdebug("createTracerActionMessage ()");a="<message><verb>NotePropertySet</verb><properties><MessageType>TracerAction</MessageType>"+("<transaction_id>"+a+"</transaction_id>")+f.toXMLString(!1);
return""+(a+"</properties></message>")};this.createInterfaceActionMessage=function(a,f,g,e,c){this.ctatdebug("createInterfaceActionMessage ()");a="<message><verb>NotePropertySet</verb><properties><MessageType>InterfaceAction</MessageType>"+("<transaction_id>"+a+"</transaction_id>")+f.toXMLString(!1);g&&(a+="<trigger>"+g+"</trigger>","user"!=g.toLowerCase()&&(a+="<actor>tutor</actor>"));!1===e&&(a+="<shouldLog>false</shouldLog>");null!=c&&(a+="<saveForRestore>"+(new Boolean(c)).toString()+"</saveForRestore>");
return""+(a+"</properties></message>")};this.createUntutoredActionMessage=function(a,f,g,e,c){this.ctatdebug("createUntutoredActionMessage ("+a+")");a="<message><verb>NotePropertySet</verb><properties><MessageType>UntutoredAction</MessageType>"+("<transaction_id>"+a+"</transaction_id>")+f.toXMLString(!1);g&&(a+="<trigger>"+g+"</trigger>","user"!=g.toLowerCase()&&(a+="<actor>tutor</actor>"));!1===e&&(a+="<shouldLog>false</shouldLog>");null!=c&&(a+="<saveForRestore>"+(new Boolean(c)).toString()+"</saveForRestore>");
return""+(a+"</properties></message>")};this.createProblemSummaryRequestMessage=function(){return"<message><verb>NotePropertySet</verb><properties><MessageType>ProblemSummaryRequest</MessageType></properties></message>"};this.createProblemRestoreEndMessage=function(){return"<message><verb>NotePropertySet</verb><properties><MessageType>ProblemRestoreEnd</MessageType></properties></message>"};this.createInterfaceConfigurationEnd=function(){return"<message><verb>NotePropertySet</verb><properties><MessageType>InterfaceConfigurationEnd</MessageType></properties></message>"};
this.createInCorrectActionMessage=function(a,f){this.ctatdebug("createInCorrectActionMessage ()");a="<message><verb>SendNoteProperty</verb><properties><MessageType>InCorrectAction</MessageType>"+("<transaction_id>"+a+"</transaction_id>")+f.toXMLString(!1);return""+(a+"</properties></message>")};this.createURLResponse=function(a,f){CTATGlobal.debug(classType,"createURLResponse ()");return"<message><verb>NotePropertySet</verb><properties><MessageType>GetURLResponse</MessageType><URL><![CDATA[ "+a+" ]]\x3e</URL><content><![CDATA[ "+
btoa(f)+" ]]\x3e</content></properties></message>"};this.createCorrectActionMessage=function(a,f){this.ctatdebug("createCorrectActionMessage ()");a="<message><verb>SendNoteProperty</verb><properties><MessageType>CorrectAction</MessageType>"+("<transaction_id>"+a+"</transaction_id>")+f.toXMLString(!1);return""+(a+"</properties></message>")}};CTATTutoringServiceMessageBuilder.prototype=Object.create(CTATBase.prototype);CTATTutoringServiceMessageBuilder.prototype.constructor=CTATTutoringServiceMessageBuilder;var CTATMessageHandler=function(a){function f(b){var c=b&&b.getProperty("WidgetLockFlag");switch(String(c).toLowerCase()){case "no":case "off":case "false":b=!1;break;default:b=!0}e.ctatdebug("processSendWidgetLock() wlFlag "+c+", result"+b);return b}CTATBase.call(this,"CTATMessageHandler","messagehandler");var g=null,e=this,c=!0,b=null,d=0;this.inStartState=!1;b=CTATConfig.parserType_is_XML()?new CTATXML:new CTATJSON;this.assignHandler=function(b){e.ctatdebug("assignHandler ()");g=b};this.reset=
function(){e.ctatdebug("reset ()")};this.getInStartState=function(){return e.inStartState};var h=!1;this.receiveFromTutor=function(b){this.processMessage(b)};this.processMessage=function(c){e.ctatdebug("Incoming message: "+c);if(!0!==h)if(CTATConfig.parserType_is_JSON()&&-1!=c.indexOf("<?xml"))alert("Error: CTAT is configured to parse JSON but it received an XML message, disabling comm capabilities ..."),h=!0;else if(CTATConfig.parserType_is_XML()&&0===c.indexOf("{"))alert("Error: CTAT is configured to parse XML but it received a JSON message, disabling comm capabilities ..."),
h=!0;else{var d;e.ctatdebug("Attempting parse ...");d=b.parse(c);null===d?e.ctatdebug("Error parsing message: "+c):this.parseElement(d,c)}};this.parseElement=function(c,d){var a=b.getElementName(c);e.ctatdebug("parseElement ("+a+")");"CTATResponseMessages"!=a&&"StartStateMessages"!=a&&"MessageBundle"!=a||this.processMessageBundle(c);"message"==a&&this.processSingleMessage(c,d)};this.processMessageBundle=function(c,d){d=b.getElementName(c);e.ctatdebug("processMessageBundle ("+d+")");c=b.getElementChildren(c);
if(null===c)e.ctatdebug("Error parsing bundle");else for(ctatdebug("Processing "+c.length+" objects in bundle"),d=0;d<c.length;d++)this.parseElement(c[d])};this.processSingleMessage=function(h,l){e.ctatdebug("processSingleMessage ("+b.getElementName(h)+")");a.sendToTools(l);l=new CTATMessage(h);var n=l.getProperty("Actor")||l.getProperty("subtype"),n=!n||/tutor/i.test(n)?"tutor":n;g.updateLastActionTimestamp&&g.updateLastActionTimestamp();h=b.getElementChildren(h);e.ctatdebug("Generated CTATMessage, now doing regular processing ...");
for(var m=0;m<h.length;m++){var q=h[m];if("properties"==b.getElementName(q)){e.ctatdebug("Parsing properties ...");for(var u=b.getElementChildren(q),v=0;v<u.length;v++){var w=u[v];if("MessageType"==b.getElementName(w)){w=b.getNodeTextValue(w);e.ctatdebug("MessageType: "+w);switch(w){case "StateGraph":ctatdebug("Setting inStartState to true");e.inStartState=!0;a.setGotProblemRestoreEnd(!1);this.processStateGraph(q);a.propagateShellEvent("StateGraph",l);break;case "StartProblem":e.ctatdebug("Setting inStartState to true");
e.inStartState=!0;a.setGotProblemRestoreEnd(!1);this.processStartProblem(u);a.propagateShellEvent("StartProblem",l);break;case "InterfaceDescription":this.processInterfaceDescription(u);a.propagateShellEvent("InterfaceDescription",l);break;case "GetAllInterfaceDescriptions":a.sendInterfaceDescriptionMessages();a.propagateShellEvent("GetAllInterfaceDescriptions",l);break;case "SendWidgetLock":e.ctatdebug("Found: SendWidgetLock");!0===e.getInStartState()&&(c=f(l));a.propagateShellEvent("SendWidgetLock",
l);break;case "CorrectAction":e.ctatdebug("Found: CorrectAction");g.processCorrectAction(l);a.propagateShellEvent("CorrectAction",l);break;case "InCorrectAction":e.ctatdebug("Found: InCorrectAction");g.processInCorrectAction(l);a.propagateShellEvent("InCorrectAction",l);break;case "HighlightMsg":e.ctatdebug("Found: HighlightMsg");g.processHighlightMsg(l);a.propagateShellEvent("HighlightMsg",l);break;case "UnHighlightMsg":e.ctatdebug("Found: UnHighlightMsg");g.processUnHighlightMsg(l);a.propagateShellEvent("UnHighlightMsg",
l);break;case "AssociatedRules":e.ctatdebug("Found: AssociatedRules ("+u.length+")");for(var B="",C=w="",F=0;F<u.length;F++){var G=u[F];switch(b.getElementName(G)){case "TutorAdvice":B=b.getValueNodesAsText(G);G=b.getNodeTextValue(G);B=B&&B.length?B[0]:G?G:"";break;case "Actor":n=b.getNodeTextValue(G);break;case "Indicator":w=b.getNodeTextValue(G);break;case "StepID":b.getNodeTextValue(G);break;case "LogAsResult":b.getNodeTextValue(G);break;case "tool_selection":case "StudentSelection":C=b.getNodeTextValue(G);
break;case "Skills":e.ctatdebug("Processing skills ..."),null===CTATSkillSet.skills&&(e.ctatdebug("Interesting, there isn't a skillSet object yet. Creating ..."),CTATSkillSet.skills=new CTATSkillSet),CTATSkillSet.skills.parseByValue(G)}}g.processAssociatedRules(l,w,B,C);a.propagateShellEvent("AssociatedRules",l,n);break;case "BuggyMessage":e.ctatdebug("Found: BuggyMessage");g.processBuggyMessage(l);a.propagateShellEvent("BuggyMessage",l);break;case "SuccessMessage":e.ctatdebug("Found: SuccessMessage");
g.processSuccessMessage(l);a.propagateShellEvent("SuccessMessage",l);break;case "InterfaceAction":e.ctatdebug("Found: InterfaceAction");w=l.getSAI();-1!=w.getAction().indexOf(":")?(e.ctatdebug("Processing and storing timed interface action : "+w.getAction()),C=parseInt(w.getAction().substring(w.getAction().indexOf(":")+1)),e.ctatdebug("Target time: "+C),w.setAction(w.getAction().substring(0,w.getAction().indexOf(":"))),e.ctatdebug("Timing ..."),setTimeout(g.processInterfaceAction,C,l),setTimeout(a.propagateShellEvent,
C,"InterfaceAction",l,n)):(e.ctatdebug("Processing regular (non-timed) interface action"),g.processInterfaceAction(l,c),a.propagateShellEvent("InterfaceAction",l,n));break;case "UntutoredAction":e.ctatdebug("Found: UntutoredAction");w=l.getSAI();-1!=w.getAction().indexOf(":")?(e.ctatdebug("Processing and storing timed interface action : "+w.getAction()),C=parseInt(w.getAction().substring(w.getAction().indexOf(":")+1)),e.ctatdebug("Target time: "+C),w.setAction(w.getAction().substring(0,w.getAction().indexOf(":"))),
e.ctatdebug("Timing ..."),setTimeout(g.processUntutoredAction,C,l),setTimeout(a.propagateShellEvent,C,"UntutoredAction",l,n)):(e.ctatdebug("Processing regular (non-timed) interface action"),g.processUntutoredAction(l,c),a.propagateShellEvent("UntutoredAction",l,n));break;case "InterfaceIdentification":e.ctatdebug("Found: InterfaceIdentification");a.propagateShellEvent("InterfaceIdentification",l);break;case "AuthorModeChange":e.ctatdebug("Found: AuthorModeChange");g.globalReset();a.propagateShellEvent("AuthorModeChange",
l);break;case "ResetAction":e.ctatdebug("Found: ResetAction");g.globalReset();a.propagateShellEvent("ResetAction",l);break;case "ShowHintsMessage":e.ctatdebug("Found: ShowHintsMessage");w=[];for(C=0;C<u.length;C++)F=u[C],"HintsMessage"==b.getElementName(F)&&(w=w.concat(b.getValueNodesAsText(F)));w.length?g.processHintResponse(l,w):e.ctatdebug("Error: incomplete hint message received");a.propagateShellEvent("ShowHintsMessage",l);break;case "ConfirmDone":e.ctatdebug("Found: ConfirmDone");g.processConfirmDone(l);
a.propagateShellEvent("ConfirmDone",l);break;case "VersionInfo":e.ctatdebug("Found: VersionInfo");g.processVersionInfo(u);a.propagateShellEvent("VersionInfo",l);break;case "TutoringServiceAlert":e.ctatdebug("Found: TutoringServiceAlert");g.processTutoringServiceAlert(u);a.propagateShellEvent("TutoringServiceAlert",l);break;case "TutoringServiceError":w=l.getProperty("Action");e.ctatdebug("Found: TutoringServiceError - actor "+n+", action "+w);var H;w&&(H=CTATSAI.delayedActionRegExp.exec(w))&&2<H.length&&
1<H[2]?(C=parseInt(H[2]),l.setProperty("Action",H[1]),e.ctatdebug("Delaying TutoringServiceError by "+C+" ..."),setTimeout(g.processTutoringServiceError,C,l),setTimeout(a.propagateShellEvent,C,"TutoringServiceError",l,n)):(g.processTutoringServiceError(l),a.propagateShellEvent("TutoringServiceError",l,n));break;case "ProblemSummaryResponse":e.ctatdebug("Found: ProblemSummaryResponse");g.processProblemSummaryResponse(l);a.propagateShellEvent("ProblemSummaryResponse",l);break;case "StartStateEnd":e.ctatdebug("Found: StartStateEnd");
CTATShellTools.listComponents();null!==g?(e.inStartState=!0,g.processStartState()):this.ctatdebug("Error: no message handler object available to process start state");try{e.processStartStateActions()}catch(E){e.ctatdebug("Caught in the act: "+E.message)}e.inStartState=!1;a.propagateShellEvent("StartStateEnd",l);break;case "ProblemRestoreEnd":e.ctatdebug("Found: ProblemRestoreEnd");g.processProblemRestoreEnd(l);a.propagateShellEvent("ProblemRestoreEnd",l);break;case "GetURL":e.ctatdebug("Found: GetURL");
g.processGetURL(l);a.propagateShellEvent("GetURL",l);break;case "SetPreferences":g.forwardToTutor(l);return;case "InterfaceReboot":d++;ctatdebug("Found: InterfaceReboot #"+d+" -- href "+(location?location.href:"(no location)"));1<d&&!CTAT.ToolTutor.reboot("InterfaceReboot from CTATMessageHandler")&&(w="ws://"+CTATConfiguration.get("remoteSocketURL")+":"+CTATConfiguration.get("remoteSocketPort"),ctatdebug("closing connection w/ url: "+w),a.closeWSConnection(w,function(){var b=window.frameElement.getAttribute("id");
"function"==typeof CustomEvent&&(b=new CustomEvent("refreshIframe",{detail:b}),window.parent.document.dispatchEvent(b))},"interfaceReboot"));break;case "NoOp":n=l&&l.getTransactionID();l=l&&l.getSAI();ctatdebug("NoOp transactionID "+n+", SAI "+l);return}(w=/student[0-9]+/i.exec(n))&&w[0]==n&&g.forwardToTutor(l)}}}}};this.processStateGraph=function(c){e.ctatdebug("processStateGraph ()");if(void 0===c||null===c)e.ctatdebug("Error: state graph property list is undefined");else if(e.ctatdebug("Processing node: "+
c.nodeName),null===b.getElementChildren(c))e.ctatdebug("Error: state graph property list is undefined");else{c=b.getElementChildren(c);for(var d=0;d<c.length;d++){var a=c[d],f=b.getElementName(a),h=b.getNodeTextValue(a);e.ctatdebug("State graph attribute: "+f+" = "+h);"suppressStudentFeedback"==f&&(CTATGlobals.suppressStudentFeedback="false"==h?!1:!0);"confirmDone"==f&&(e.ctatdebug("Confirm done: "+h),CTATGlobals.confirmDone="true"==h?!0:!1);"Skills"==f&&(null===CTATSkillSet.skills&&(CTATSkillSet.skills=
new CTATSkillSet),CTATSkillSet.skills.parseByValue(a),g.updateSkillWindow())}}};this.processStartProblem=function(b){e.ctatdebug("processStartProblem ()");g.processStartProblem()};this.processInterfaceDescription=function(c){e.ctatdebug("processInterfaceDescription ("+c.length+")");for(var d="Unknown",a="Unknown",g=null,f=0;f<c.length;f++){var h=c[f];e.ctatdebug("Inspecting element: "+b.getElementName(h));"WidgetType"==b.getElementName(h)&&(e.ctatdebug("Widget type: "+b.getNodeTextValue(h)),d=b.getNodeTextValue(h));
"CommName"==b.getElementName(h)&&(e.ctatdebug("Instance name: "+b.getNodeTextValue(h)),a=b.getNodeTextValue(h));if("serialized"==b.getElementName(h)){e.ctatdebug("Prepareing to de-serialize component ...");for(var n=b.getElementChildren(h),w=0;w<n.length;w++){var B=n[w];-1!=b.getElementName(B).indexOf("CTAT")&&(g=B)}}"interface"==b.getElementName(h)&&(e.ctatdebug("Storing interface for post start-state reconstruction ..."),CTATGlobals.interfaceElement=h);"script"==b.getElementName(h)&&(e.ctatdebug("Storing and loading main javascript code as defined by the BRD ..."),
scriptElement=b.getNodeTextValue(h))}null!==g?this.deserializeComponent(d,a,g):e.ctatdebug("Error: unable to find CTAT serialization point of attachement");e.ctatdebug("processInterfaceDescription () done")};this.deserializeComponent=function(c,d,a){e.ctatdebug("deserializeComponent ("+c+","+d+")");if(!0===CTATGlobals.ignoreInterfaceDescriptions)e.ctatdebug("ignoreInterfaceDescriptions==true");else if(null===b.getElementAttr(a,"x"))e.ctatdebug("Warning: this component does not have x,y information. Probably an older component");
else{var g=b.getElementAttr(a,"x"),f=b.getElementAttr(a,"y"),h=b.getElementAttr(a,"width"),l=b.getElementAttr(a,"height"),n=b.getElementAttr(a,"tabIndex"),B=b.getElementAttr(a,"zIndex");null===n&&(n=-1);null===B&&(B=0);var p=new CTATComponentDescription;p.type=c;p.name=d;p.x=Math.floor(g);p.y=Math.floor(f);p.tabIndex=n;p.zIndex=B;p.width=Math.floor(h);p.height=Math.floor(l);CTATShellTools.registerComponentDescription(p);a=b.getElementChildren(a);for(g=0;g<a.length;g++){f=a[g];b.getElementName(f);
if("Parameters"==b.getElementName(f))for(this.ctatdebug("Processing component parameters ..."),h=b.getElementChildren(f)[0],h=b.getElementChildren(h),l=0;l<h.length;l++){var F=h[l];if("CTATComponentParameter"==b.getElementName(F)){this.ctatdebug("Processing parameter property (CTATComponentParameter) ...");for(var B=n=void 0,F=b.getElementChildren(F),G=0;G<F.length;G++){var H=F[G];"name"==b.getElementName(H)&&(this.ctatdebug("Found parameter name: "+b.getNodeTextValue(H)),n=b.getNodeTextValue(H));
"value"==b.getElementName(H)&&(this.ctatdebug("Found parameter value: "+b.getNodeTextValue(H)),B=b.getNodeTextValue(H).trim())}this.ctatdebug("Parameter name: "+n+", value: "+B);void 0!==n&&(p.params[n]=B,"group"==n&&(p.groupName=B))}}if("Styles"==b.getElementName(f))for(this.ctatdebug("Processing component styles ..."),f=b.getElementChildren(f)[0],f=b.getElementChildren(f),h=0;h<f.length;h++)if(B=f[h],"CTATStyleProperty"==b.getElementName(B)){this.ctatdebug("Processing style property (CTATStyleProperty) ...");
n=l="";B=b.getElementChildren(B);for(F=0;F<B.length;F++)G=B[F],"name"==b.getElementName(G)&&(l=b.getNodeTextValue(G)),"value"==b.getElementName(G)&&(n=b.getNodeTextValue(G).trim());this.ctatdebug("Style (name: "+l+", value: "+n+")");""!==l&&(p.styles[l]=n)}}e.ctatdebug("deserializeComponent ("+c+","+d+") done")}};this.processStartStateActions=function(){e.ctatdebug("processStartStateActions(), scriptElement "+CTATMessageHandler.scriptElement);if(0<CTATMessageHandler.startStateHandlers.length)for(var b=
0;b<CTATMessageHandler.startStateHandlers.length;b++)CTATMessageHandler.startStateHandlers[b].processStartStateActions(null);else if(""!==CTATMessageHandler.scriptElement)try{eval(CTATMessageHandler.scriptElement)}catch(l){alert("Error executing script from BRD: "+l.message)}};this.sleep=function(b){e.ctatdebug("sleep ("+b+")")}};CTATMessageHandler.prototype=Object.create(CTATBase.prototype);CTATMessageHandler.prototype.constructor=CTATMessageHandler;CTATMessageHandler.startStateHandlers=[];
CTATMessageHandler.scriptElement="";CTAT.SAI={};
function createSteps(){CTAT.SAI={help:function(){console.log("Enter steps.list() to see the list of steps;\n      steps.next() to do the next step;\n      steps.rest() to do the remaining steps;\n      steps.all() to do all\n      steps.send(n) to send the nth step\n")},nStored:0,msgs:[],storeForReplay:function(a){if(a&&"string"==typeof a&&!/visibilityChange|UpdateVariable/i.test(a)){try{sessionStorage&&"function"==typeof sessionStorage.setItem&&(sessionStorage.setItem("CTAT.SAI."+CTAT.SAI.nStored,a),
sessionStorage.setItem("CTAT.SAI.length",String(++CTAT.SAI.nStored)))}catch(c){console.log("CTAT.SAI.storeForReplay() error ",c,"\n  msg",a)}return CTAT.SAI.nStored}},format:function(a){var c=useDebuggingBasic;useDebuggingBasic=!1;var b=useDebugging;useDebugging=!1;a=(new CTATXML).parseXML(a);a=new CTATMessage(a);useDebuggingBasic=c;useDebugging=b;return sprintf("s: %-16s, a: %-16s, i: %s",a.getSelection(),a.getAction(),a.getInput())},list:function(){for(var a="",c=0;c<CTAT.SAI.msgs.length;++c)var b=
CTAT.SAI.format(CTAT.SAI.msgs[c]),a=sprintf("%s\n[%2d] %s",a,c,b);console.log("Number of steps: "+CTAT.SAI.msgs.length+a+"\n")},send:function(a){if(a>=CTAT.SAI.msgs.length)return"Already past last step "+a;a=CTAT.SAI.msgs[a];CTATCommShell.commShell.propagateShellEvent(CTATMsgType.getMessageType(a),a);CTATCommShell.commShell.getCommLibrary().sendXML(a);CTAT.SAI.storeForReplay(a)},last:-1,next:function(){return CTAT.SAI.send(++CTAT.SAI.last)},rest:function(){for(;CTAT.SAI.last<CTAT.SAI.msgs.length-
2;)CTAT.SAI.next();return CTAT.SAI.next()},all:function(){CTAT.SAI.last=-1;return CTAT.SAI.rest()}};try{for(var a=sessionStorage.getItem("CTAT.SAI.length"),a=a?Number(a):0,f=0;f<a;++f){var g="CTAT.SAI."+f;CTAT.SAI.msgs.push(sessionStorage.getItem(g));sessionStorage.removeItem(g)}sessionStorage.setItem("CTAT.SAI.length",String(a-f))}catch(e){console.log("CTAT.SAI load error ",e)}return CTAT.SAI}window.steps=createSteps();console.log("***To replay steps:");steps.help();var CTATSessionExpiry=function(a,f,g,e){function c(){var b=q&&q.getHTTPObject?q.getHTTPObject():null;h.ctatdebug("CTATSessionExpiry.processInactivityReply() refreshConnection "+q+", getHTTPObject "+b);q&&b&&h.ctatdebug("CTATSessionExpiry.processInactivityReply() readyState "+b.readyState+", status "+b.status+", responseText "+(4==b.readyState?b.responseText:null))}function b(){try{if(50>l)throw"No-op: time interval "+l+" too short: less than 50 ms";u=setInterval(function(){q.send.apply(q,[])},l);
return"ok"}catch(w){return w.toString()}}function d(){try{if(50>p)throw"No-op: time interval "+p+" too short: less than 50 ms";v=setInterval(function(){h.checkInactivity.apply(h,[])},p);return"ok"}catch(w){return w.toString()}}CTATBase.call(this,"CTATSessionExpiry",f);var h=this,n=1E3*f,l=1E3*(f-60),p=6E4,m=Date.now(),q=null,u=0,v=0;this.checkInactivity=function(){var b=Date.now(),a=m;h.ctatdebug("CTATSessionExpiry.checkInactivity() elapsed "+(b-a)+", limit "+n+",\n                 now "+Date(b)+
",\n lastActionTimestamp "+h.getLastActionTimestamp());if(!(b<a+n))try{h.cancelTimers();var d=new CTATConnection(CTATConfiguration.getRawFlashVars());d.setMethod("GET");d.setURL(g);d.assignReceiveFunction(c);d.send();return"ok"}catch(F){return F.toString()}};this.updateLastActionTimestamp=function(){m=Date.now()};this.getLastActionTimestamp=function(){return new Date(m)};this.toString=function(){return"CTATSessionExpiry sessionTimeoutMS "+n+", refreshIntervalMS "+l+", refreshTimer "+u+", inactivityTimer "+
v+",\n  expireLogoutURL "+g+",\n  refreshSessionURL "+e};this.getRefreshConnection=function(){return q};this.getSessionTimeoutMS=function(){return n};this.getRefreshIntervalMS=function(){return l};this.getInactivityIntervalMS=function(){return p};this.setSessionTimeoutMS=function(b){n=b};this.setRefreshIntervalMS=function(c){l=c;h.cancelRefreshTimer();b()};this.setInactivityIntervalMS=function(b){p=b;h.cancelInactivityTimer();d()};this.cancelRefreshTimer=function(){0!==u&&clearInterval(u);u=0};this.cancelInactivityTimer=
function(){0!==v&&clearInterval(v);v=0};this.cancelTimers=function(){h.cancelRefreshTimer();h.cancelInactivityTimer()};this.getRefreshTimer=function(){return u};this.getInactivityTimer=function(){return v};q=new CTATConnection(a);q.setMethod("GET");q.setURL(e);q.assignReceiveFunction(function(){var b=q&&q.getHTTPObject?q.getHTTPObject():null;h.ctatdebug("CTATSessionExpiry.processRefreshReply() refreshConnection "+q+", getHTTPObject "+b);q&&b&&h.ctatdebug("CTATSessionExpiry.processRefreshReply() readyState "+
b.readyState+", status "+b.status+", responseText "+(4==b.readyState?b.responseText:null))});b();d()};CTATSessionExpiry.prototype=Object.create(CTATBase.prototype);CTATSessionExpiry.prototype.constructor=CTATSessionExpiry;
CTATSessionExpiry.factory=function(a){var f=Number(a.session_timeout)||0,g=a.expire_logout_url,e=a.refresh_session_url;ctatdebug("CTATSessionExpiry.init() session_timeout "+f+", expire_logout_url "+g+", refresh_session_url "+e);return 60>=f||!g||!e?null:new CTATSessionExpiry(a,f,g,e)};"undefined"!==typeof module&&(module.exports=CTATSessionExpiry);var sprintf={};
!function(){function a(c){var b;b=c;if(e[b])b=e[b];else{for(var d=b,f,n=[],l=0;d;){if(null!==(f=g.text.exec(d)))n.push(f[0]);else if(null!==(f=g.modulo.exec(d)))n.push("%");else if(null!==(f=g.placeholder.exec(d))){if(f[2]){var l=l|1,p=[],m=f[2],q;if(null!==(q=g.key.exec(m)))for(p.push(q[1]);""!==(m=m.substring(q[0].length));)if(null!==(q=g.key_access.exec(m)))p.push(q[1]);else if(null!==(q=g.index_access.exec(m)))p.push(q[1]);else throw new SyntaxError("[sprintf] failed to parse named argument key");else throw new SyntaxError("[sprintf] failed to parse named argument key");
f[2]=p}else l|=2;if(3===l)throw Error("[sprintf] mixing positional and named placeholders is not (yet) supported");n.push({placeholder:f[0],param_no:f[1],keys:f[2],sign:f[3],pad_char:f[4],align:f[5],width:f[6],precision:f[7],type:f[8]})}else throw new SyntaxError("[sprintf] unexpected placeholder");d=d.substring(f[0].length)}b=e[b]=n}d=arguments;f=1;for(var n=b.length,p="",u,v,w,B,m=0;m<n;m++)if("string"===typeof b[m])p+=b[m];else if("object"===typeof b[m]){q=b[m];if(q.keys)for(l=d[f],u=0;u<q.keys.length;u++){if(void 0==
l)throw Error(a('[sprintf] Cannot access property "%s" of undefined value "%s"',q.keys[u],q.keys[u-1]));l=l[q.keys[u]]}else l=q.param_no?d[q.param_no]:d[f++];g.not_type.test(q.type)&&g.not_primitive.test(q.type)&&l instanceof Function&&(l=l());if(g.numeric_arg.test(q.type)&&"number"!==typeof l&&isNaN(l))throw new TypeError(a("[sprintf] expecting number but found %T",l));g.number.test(q.type)&&(w=0<=l);switch(q.type){case "b":l=parseInt(l,10).toString(2);break;case "c":l=String.fromCharCode(parseInt(l,
10));break;case "d":case "i":l=parseInt(l,10);break;case "j":l=JSON.stringify(l,null,q.width?parseInt(q.width):0);break;case "e":l=q.precision?parseFloat(l).toExponential(q.precision):parseFloat(l).toExponential();break;case "f":l=q.precision?parseFloat(l).toFixed(q.precision):parseFloat(l);break;case "g":l=q.precision?String(Number(l.toPrecision(q.precision))):parseFloat(l);break;case "o":l=(parseInt(l,10)>>>0).toString(8);break;case "s":l=String(l);l=q.precision?l.substring(0,q.precision):l;break;
case "t":l=String(!!l);l=q.precision?l.substring(0,q.precision):l;break;case "T":l=Object.prototype.toString.call(l).slice(8,-1).toLowerCase();l=q.precision?l.substring(0,q.precision):l;break;case "u":l=parseInt(l,10)>>>0;break;case "v":l=l.valueOf();l=q.precision?l.substring(0,q.precision):l;break;case "x":l=(parseInt(l,10)>>>0).toString(16);break;case "X":l=(parseInt(l,10)>>>0).toString(16).toUpperCase()}g.json.test(q.type)?p+=l:(!g.number.test(q.type)||w&&!q.sign?B="":(B=w?"+":"-",l=l.toString().replace(g.sign,
"")),u=q.pad_char?"0"===q.pad_char?"0":q.pad_char.charAt(1):" ",v=q.width-(B+l).length,v=q.width?0<v?u.repeat(v):"":"",p+=q.align?B+l+v:"0"===u?B+v+l:v+B+l)}return p}function f(c,b){return a.apply(null,[c].concat(b||[]))}var g={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,
key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/},e=Object.create(null);"undefined"!==typeof exports&&(exports.sprintf=a,exports.vsprintf=f);"undefined"!==typeof window&&(window.sprintf=a,window.vsprintf=f,"function"===typeof define&&define.amd&&define(function(){return{sprintf:a,vsprintf:f}}))}();var CTATTransactionListener=function(a){function f(b){return b&&"function"==typeof b.getTransactionID?b.getTransactionID():null}function g(b){n.ctatdebug("formatTimeStamp ("+b+")");return sprintf("%04d-%02d-%02d %02d:%02d:%02d.%03d UTC",b.getUTCFullYear(),b.getUTCMonth()+1,b.getUTCDate(),b.getUTCHours(),b.getUTCMinutes(),b.getUTCSeconds(),b.getUTCMilliseconds())}function e(b,c){for(var a,d,e=1;;++e){var g=c+"_type"+e,f=c+"_name"+e;a=CTATConfiguration.get(g);d=CTATConfiguration.get(f);if(!a||!d)break;
b[g]=a;b[f]=d}1==e&&(a=CTATConfiguration.get(c+"_type"),d=CTATConfiguration.get(c+"_name"),b[g]=a?a:"",b[f]=d?d:"");return b}function c(){n.ctatdebug("CTATTransactionListener.createContextMessage()");var b={},c=new Date;n.ctatdebug("TX.makeMetaElement ()");var a={};a.date_time=g(c);a.session_id=CTATConfiguration.get("session_id");a.user_guid=CTATConfiguration.get("user_guid");b.meta=a;b.context={};c=b.context;a=CTATLogMessageBuilder.contextGUID;if(!a)throw Error("Context message ID not yet defined");
c.context_message_id=a;c=b.context;a=CTATConfiguration.get("class_name");c.class_name=a?a:"";a=CTATConfiguration.get("school_name");c.class_school=a?a:"";a=CTATConfiguration.get("period_name");c.class_period_name=a?a:"";a=CTATConfiguration.get("class_description");c.class_description=a?a:"";a=CTATConfiguration.get("instructor_name");c.class_instructor_name=a?a:"";c=b.context;a=CTATConfiguration.get("dataset_name");c.dataset_name=a?a:"";e(c,"dataset_level");prop=CTATConfiguration.get("problem_name");
c.problem_name=prop?prop:"";prop=CTATConfiguration.get("problem_context");c.problem_context=prop?prop:"";prop=CTATConfiguration.get("problem_tutorflag");c.problem_tutorFlag=prop?prop:"";e(c,"study_condition");var c=b.context,a=0,d=CTATConfiguration.getCustomFields();if(d){c.custom_fields={};for(var f in d)d.hasOwnProperty(f)&&(c.custom_fields[f]=d[f],++a)}n.ctatdebug("CTATTransactionListener.createCustomFields() nAdded "+a+", cfs "+d);return b}function b(b,c){if(b&&"function"==typeof b.toLowerCase&&
0<=b.toLowerCase().indexOf("hint"))return!0;if(!c)return!1;if(0<=c.getMessageType().toLowerCase().indexOf("hint"))return!0;b=c.getSelection().toLowerCase();return 0<=c.getAction().toLowerCase().indexOf("buttonpress")&&(0<=b.indexOf("hint")||0<=b.indexOf("help"))}function d(b,c){var a=(b=b.getProperty(c))?b.split(CTATTransactionListener.valueDelimiter):[];n.ctatdebug("CTATTransactionListener.getPropertyAsArray("+c+") withValues "+b+", result "+a);return a}function h(b,c){b=d(b,c);for(var a="",e=0;e<
b.length;++e)a+=b[e];n.ctatdebug("CTATTransactionListener.getProperty("+c+") valueElts "+b+", result "+a);return a}CTATBase.call(this,"CTATTransactionListener","");var n=this,l=null,p=!0,m=null,q={},u=0,v=CTATConfig.parserType_is_XML()?new CTATXML:new CTATJSON;this.getMailer=function(){return l};this.onmessage=function(b){n.ctatdebug("CTATTransactionListener.onmessage("+b.toString()+")");(b=b.data&&3<=b.data.length?new CTATSAI(b.data[0],b.data[1],b.data[2]):null)&&CTATCommShell.shell.processComponentAction(b,
!1,!0,null,"ATTEMPT","Detector")};if(!l)a:{if("undefined"!=typeof TransactionMailerUsers&&"function"==typeof TransactionMailerUsers.create)try{l=l=TransactionMailerUsers.create("Assets",a,CTATConfiguration.get("process_detectors_url"),CTATConfiguration.get("authenticity_token"),CTATConfiguration.get("detectors"),CTATConfiguration.get("provider_key"),CTAT.ToolTutor.tutor&&JSON.stringify(CTAT.ToolTutor.tutor.getProblemSummary().getSkills().toJSON("pSummarySkills"))||null,JSON.stringify({visibilitychangeSAI:CTATTransactionListener.visibilitychangeSAI}));
break a}catch(w){console.trace("Error creating transaction mailer: "+w);l=l=null;break a}l=void 0}this.isReady=function(){return null!=n.mailerProxy};this.toString=function(){return"transactions sent to ["+n.process_transactions_url+":]"};this.processCommShellEvent=function(a,e,C){n.ctatdebug("CTATTransactionListener.processCommShellEvent("+a+", "+e+", "+C+")");try{var B=null;switch(a){case "InterfaceAction":case "AssociatedRules":case "UntutoredAction":case "NextPressed":case "PreviousPressed":var w=
e;e&&e.constructor!=CTATMessage&&(w=e.constructor!=Element?v.parse(w):w,w=new CTATMessage(w));n.ctatdebug("CTATTransactionListener.makeOrCompleteTransaction("+a+") actor "+C+", txID "+f(w)+", problemInfo "+m);var H=e=null,E=!1;if(H=f(w)){!m&&(m=c());var D,K;b:switch(a){case "UntutoredAction":K=!1;break b;case "InterfaceAction":K="tutor-performed"!=h(w,"subtype").toLowerCase();break b;default:K=!0}if(D=!(E=!K)){var J;K=H;var r=q[K];r?(delete q[K],--u,n.ctatdebug("CTATTransactionListener.removeIncompleteTransaction("+
K+") count now "+u),J=r):J=null;D=(e=J)&&(E=!0)}D||(e={meta:m.meta,context:m.context});switch(a){case "AssociatedRules":case "NextPressed":case "PreviousPressed":C=e;C.tutor_data&&console.log("Warning: CTATTransactionListener.addTutorInfo("+a+") tx has tutor_data with time "+C.tutor_data.tutor_event_time);C.tutor_data={};C.tutor_data.tutor_event_time=g(new Date);C.tutor_data.selection=h(w,"Selection");C.tutor_data.action=h(w,"Action");C.tutor_data.input=h(w,"Input");C.tutor_data.action_evaluation=
w.getIndicator();0<=C.tutor_data.action_evaluation.toLowerCase().indexOf("hint")&&(C.tutor_data.current_hint_number=h(w,"CurrentHintNumber"),C.tutor_data.total_hints_available=h(w,"TotalHintsAvailable"));C.tutor_data.tutor_advice=h(w,"TutorAdvice");var I=C.tutor_data;D=[];var A=CTAT.ToolTutor.tutor&&CTAT.ToolTutor.tutor.getProblemSummary()?CTAT.ToolTutor.tutor.getProblemSummary().getSkills():null,P=w.getSkillsObject().getSkillSet();for(J=0;J<P.length;++J){var L=P[J],N=CTATSkillSet.skills?CTATSkillSet.skills.getSkill(L.getSkillName()):
null;if(N){r={};r.name=N.getSkillName();r.category=N.getCategory();var R=null==r.category||""==r.category.trim()?r.name:r.name+" "+r.category,Q=A?A.getSkill(R):null,z;Q?(r.pKnown=isNaN(z=Q.getPKnown())?"":z,r.pGuess=isNaN(z=Q.getPGuess())?"":z,r.pSlip=isNaN(z=Q.getPSlip())?"":z,r.pLearn=isNaN(z=Q.getPLearn())?"":z,r.history=isNaN(z=Q.getHistory())?"":z,r.opportunityCount=isNaN(z=Q.getOpportunityCount())?"":z):(r.pKnown=isNaN(z=N.getPKnown())?"":z,r.pGuess=isNaN(z=N.getPGuess())?"":z,r.pSlip=isNaN(z=
N.getPSlip())?"":z,r.pLearn=isNaN(z=N.getPLearn())?"":z);n.ctatdebug("CTATTransactionListener.createSkills() ssSk "+N+", tracerSk "+Q+", skElt "+r);D.push(r)}}I.skills=D;C.tutor_data.step_id=h(w,"StepID");C.tutor_data.rule_names=d(w,"Rules");var T=C.tutor_data,X=w.getCustomFields();n.ctatdebug("CTATTransactionListener.createCustomFields() result "+X);T.custom_fields=X;break;default:e.meta.date_time=g(new Date);I=e;if(!(I.transaction_id=f(w)))throw Error("Message has no transaction_id: eventType "+
a+", msg\n  "+w);I.semantic_event="UntutoredAction"==a?"UNTUTORED-ACTION":b(a,w)?"HINT-REQUEST-HINTS":"ATTEMPT-RESULT";I.actor=/tutor/i.test(C)?"tutor":C||"student";I.tool_data&&console.log("Warning: CTATTransactionListener.addToolInfo("+a+") tx has tool_data with time "+I.tool_data.tool_event_time);I.tool_data={};I.tool_data.tool_event_time=g(new Date);I.tool_data.selection=h(w,"Selection");I.tool_data.action=h(w,"Action");I.tool_data.input=h(w,"Input")}var S;if(E)S=e;else{var I=H,V=q[I];V&&(console.log("Warning: CTATTransactionListener.storeIncompleteTransaction() found tx with ID "+
I,V),--u);q[I]=e;++u;n.ctatdebug("CTATTransactionListener.storeIncompleteTransaction("+I+") count now "+u);S=null}B=S}else B=null;break;case "StateGraph":case "StartProblem":m=c();break;case "ProblemRestoreEnd":p=!1}B&&(p?parent.postMessage({command:"restoredTx",data:B},location.origin):l&&l.sendTransaction(B))}catch(U){console.log("Error in CTATTransactionListener.processCommShellEvent("+a+"): "+U,U.stack)}};ctatdebug("**<end of CTATTransactionListener constructor, process_transactions_url "+a+", mailerProxy "+
l)};Object.defineProperty(CTATTransactionListener,"scriptParam",{enumerable:!1,configurable:!1,writable:!1,value:"process_transactions_url"});Object.defineProperty(CTATTransactionListener,"valueDelimiter",{enumerable:!1,configurable:!1,writable:!1,value:/<\/?value>/});Object.defineProperty(CTATTransactionListener,"visibilitychangeSAI",{enumerable:!1,configurable:!1,writable:!1,value:{selection:"root",action:"visibilityChange",input:".*"}});CTATTransactionListener.prototype=Object.create(CTATBase.prototype);
CTATTransactionListener.prototype.constructor=CTATTransactionListener;"undefined"!==typeof module&&(module.exports=CTATTransactionListener);CTATTransactionListener.create=function(a){var f=null;try{f=new CTATTransactionListener(a)}catch(g){console.trace("Error creating or connecting to transaction listener",g),f=null}return f};var CTATNameTranslator=function(){CTATBase.call(this,"CTATNameTranslator","translator");var a=!1,f=this;this.setPassthrough=function(g){a=CTATGlobalFunctions.toBoolean(g)};this.getPassthrough=function(){return a};this.manufactorJSON=function(a,e){f.ctatdebug("manufactorJSON ("+a+","+e+")");a=a.split(":");if(1==a.length)return f.ctatdebug("No range in aRange, returning basic JSON ..."),"";var c=this.getA1Row(a[0]),b=this.getA1Col(a[0]),d=this.getA1Row(a[1]),g=this.getA1Col(a[1]);f.ctatdebug("Manufacturing json from: ["+
c+","+b+"] to: ["+d+","+g+"]");a="[";c=parseInt(d)-parseInt(c);b=parseInt(g)-parseInt(b);c++;b++;f.ctatdebug("X range: "+c+", Y range: "+b);for(d=0;d<c;d++){0<d&&(a+=",");a+="[";for(g=0;g<b;g++)0<g&&(a+=","),a+='"',a+=e,a+='"';a+="]"}return a+"]"};this.translateFromCTAT=function(g,e){if(!0===a)return g;g=g.toLowerCase();f.ctatdebug("translateFromCTAT ("+g+")");var c;if(-1!=g.indexOf(".r")){var b=g.split(".");c=b[1].split("r");0>=c.length&&(c=b[1].split("c"));0>=c.length?f.ctatdebug("Info: incoming name does not need translation"):
(g=c[1],c=c[0].substr(1),f.ctatdebug("Original row (1st format): "+c+" original col: "+g),g=!0===e?colName(g,!1)+c:b[0]+"."+colName(g,!1)+c,f.ctatdebug("Translated: "+g))}else{if(0===g.indexOf("r")){e=g.indexOf("c");var b=parseInt(g.substr(1,e-1)),d=parseInt(g.substr(e+1));c=b+1;g=d;f.ctatdebug("Original row (2nd format) (columnindex: "+e+"): "+b+" -> "+c+", original col: "+d+" -> "+g);g=colName(g,!1)+c;f.ctatdebug("Translated: "+g);return g}f.ctatdebug("Info: incoming name does not need translation")}return g};
this.translateToCTAT=function(g){if(!0===a)return g;var e=this.letterToColumn(g.substr(0,1))-1;return"R"+(parseInt(g.substr(1))-1)+"C"+e};this.columnToLetter=function(a){for(var e,c="";0<a;)e=(a-1)%26,c=String.fromCharCode(e+65)+c,a=(a-e-1)/26;return c};this.letterToColumn=function(a){for(var e=0,c=a.length,b=0;b<c;b++)e+=(a.charCodeAt(b)-64)*Math.pow(26,c-b-1);return e};this.getA1Row=function(a){return parseInt(a.substr(1))-1};this.getA1Col=function(a){return this.letterToColumn(a.substr(0,1))-1}};
CTATNameTranslator.prototype=Object.create(CTATBase.prototype);CTATNameTranslator.prototype.constructor=CTATNameTranslator;var CTATCommShell=function(){CTATBase.call(this,"CTATCommShell","theShell");var a=null,f=null,g=null,e=null,c=null,b=this,d=null,h=null,n={},l=null,p=null,m=null,q=null,u=[],v=!1,w=!1,h="xml"==CTATConfig.parserType?new CTATXML:new CTATJSON;this.init=function(d){this.ctatdebug("init () tutoring_service_communication "+CTATConfiguration.get("tutoring_service_communication")+" is.Authoring "+CTATLMS.is.Authoring());CTATLMS.is.Authoring()&&(CTATConfiguration.set("tutoring_service_communication","websocket"),
CTATConfiguration.set("question_file",""));var h=CTATConfiguration.getRawFlashVars(),l="http://";"https"==h.tutoring_service_communication&&(l="https://");var n=h.remoteSocketURL;n&&(n=String(n).toLowerCase(),0==n.indexOf("http")||0==n.indexOf("ws"))&&(l="");c=d;CTATLogMessageBuilder.contextGUID=CTATGuid.guid();b.ctatdebug("processSkills ()");CTATSkillSet.skills=new CTATSkillSet;d=flashVars.getRawFlashVars();null!=d.skills&&CTATSkillSet.skills.fromDataParams(d.skills,!0);b.updateSkillWindow(null);
null==commMessageHandler&&(commMessageHandler=new CTATMessageHandler(this),CTAT.ToolTutor.registerInterface(commMessageHandler));commMessageHandler.assignHandler(this);e=new CTATTutoringServiceMessageBuilder;h.deliverymode&&"review"==h.deliverymode&&(h.Logging="None");f=CTATSessionExpiry.factory(h);a=new CTATCommLibrary(b);a.setConnectionRefusedMessage("ERROR_CONN_TS");a.setSocketType(h.tutoring_service_communication+(CTATConfiguration.getCustomFields()["Team ID"]||h.collaborators||CTATLMS.is.ToolsListener()?
" websocket":""));g=new CTATCurriculumService(a);null==commLoggingLibrary&&(commLoggingLibrary=new CTATLoggingLibrary(!0));commLoggingLibrary.getLoggingCommLibrary().setFixedURL(flashVars.getRawFlashVars().log_service_url);flashVars.setTimeZone(null);new CTATHTMLManager;this.ctatdebug("CTATCommShell.init() FlashVar info: "+h.info);if(null!=h.info)try{parent.javaScriptInfo&&parent.javaScriptInfo(decodeURIComponent(h.info))}catch(H){}else this.ctatdebug("There is no info flash var");console.log("Connecting to: "+
l+h.remoteSocketURL+":"+h.remoteSocketPort);d=e.createSetPreferencesMessage(version,this.getAllInterfaceDescriptions());b.hasTutorShopCable()?CTAT.ToolTutor.sendToTutor(d):a.sendXMLURL(d,l+h.remoteSocketURL+":"+h.remoteSocketPort,CTATConfiguration.get("collaborators"));l=CTATConfiguration.get("collaborators")||"";1<String(l).split(",").length&&(CTATScrim.scrim.scrimDown(),CTATScrim.scrim.scrimUp(CTATGlobals.languageManager.getString("AWAITING_OTHER_COLLABORATORS")));b.addGlobalEventListener(CTATTransactionListener.create(h[CTATTransactionListener.scriptParam]));
b.setVisibilityChangeListener(CTATLMS.visibilityChange)};this.statechanges=Array(10).fill(null);this.setVisibilityChangeListener=function(a){console.log("CTATCommShell.setVisibilityChangeListener: document",document,"lifecycle","undefined"==typeof lifecycle?"undefined":lifecycle);"undefined"!=typeof lifecycle&&lifecycle.addEventListener("statechange",function(a){b.statechanges.push({time:(new Date).toLocaleTimeString("en-US",{hour:"numeric",minute:"numeric",second:"numeric",fractionalSecondDigits:3,
hour12:!1}),old:a.oldState,new:a.newState,event:a.originalEvent.type});return b.statechanges.shift()});CTATConfiguration.get("process_detectors_url")&&document.addEventListener("visibilitychange",function(c){if(!w){var d=CTATTransactionListener.visibilitychangeSAI;b.processComponentAction(new CTATSAI(d.selection,d.action,document.visibilityState),!1);"function"==typeof a&&a(c)}})};this.getCommLibrary=function(){return a};this.forwardToTutor=function(b){a&&a.hasJavaScriptConnection()&&CTAT.ToolTutor.sendToTutor(b.getXMLString())};
this.getLoggingLibrary=function(){return commLoggingLibrary};this.propagateShellEvent=function(b,a,c,d){ctatdebug("propagateShellEvent ("+b+", "+typeof a+", actor "+c+", logmsg len "+("string"==typeof d?d.length:d)+")");for(var e=0;e<u.length;e++)u[e].processCommShellEvent(b,a,c,d)};this.reset=function(){b.ctatdebug("reset ()");CTATGlobals.interfaceElement=null;commMessageHandler.reset()};this.getSessionExpiry=function(){return f};this.getMessageHandler=function(){return this.commMessageHandler};
this.addStartStateHandler=function(a){b.ctatdebug("addStartStateHandler ()");null==CTATMessageHandler.startStateHandlers&&(CTATMessageHandler.startStateHandlers=[]);CTATMessageHandler.startStateHandlers.push(a)};this.gradeComponent=function(a){this.ctatdebug("gradeComponent ("+a.getName()+","+a.getClassName()+")");var c=CTATShellTools.findComponentByClass("CTATDoneButton");null!=c&&c!=a?c.moveHintHighlight(!1,null):b.ctatdebug("Info: no done button available to reset");b.clearFeedbackComponents();
null!=nameTranslator?nameTranslator.translateFromCTAT(a.getName()):this.ctatdebug("Info: no name translator provided, using as-is");null==a?this.ctatdebug("Internal error, provided component is null"):(this.ctatdebug("Info: we have a valid component, grading ..."),"Do not tutor"==a.getTutorComponent()?b.processComponentAction(a.getSAI(),!1):(this.ctatdebug("Checking for back grading: "+a.getName()),"CTATTextArea"==a.getClassName()||"CTATTextInput"==a.getClassName()||"CTATTextField"==a.getClassName()?
(this.ctatdebug("Backgrading ..."),this.ctatdebug("Grading "+a.getClassName()+" with value: "+a.getValue()),!0===CTATGlobalFunctions.isBlank(a.getValue())?this.ctatdebug("Empty component, nothing to grade"):(a.updateSAI(),a=a.getSAI(),b.processComponentAction(a))):(a="CTATTableGoogle"==a.getClassName()?new CTATSAI(a.getCurrentSelection(),"UpdateTextArea",a.getCurrentValue()):a.getSAI(),b.processComponentAction(a))))};this.processMessage=function(b){this.ctatdebug("processMessage ()");commMessageHandler.processMessage(b);
this.ctatdebug("processMessage () done")};this.processStartProblem=function(){this.ctatdebug("processStartProblem ()");"google"==CTATConfig.external&&this.showFeedback("The tutor is starting, please wait ...");CTATLMS.initLMSConnection&&CTATLMS.initLMSConnection()};this.processStartState=function(){this.ctatdebug("processStartState ()");try{c?(this.ctatdebug("Calling tutor.createInterface () ..."),c.createInterface()):window.hasOwnProperty("createInterface")&&(this.ctatdebug("Error: no tutor object available, calling window.createInterface ..."),
window.createInterface())}catch(C){console.log("Error from "+(c?"tutorPointer":"window")+".createInterface",C)}this.ctatdebug("Logging start of problem ...");if(null!=commLoggingLibrary){var a=CTATConfiguration.get("problem_context");a&&CTATConfiguration.addCustomField("problem_context",a);commLoggingLibrary.startProblem()}else this.ctatdebug("Info: no logging library available!");b.propagateShellEvent("StartProblem",null);this.ctatdebug("End of start state, inspecting suppressStudentFeedback ...");
!0===CTATGlobals.suppressStudentFeedback&&(this.ctatdebug("Hiding hint button ..."),a=CTATShellTools.findComponentByClass("CTATHintButton"),null!=a&&a.SetVisible(!1));"google"==CTATConfig.external?(b.ctatdebug("Calling google app script hint request driver ..."),addCall(new RPCObject("resetOnEditQueue","dummy","dummy"))):this.ctatdebug("processStartState () done")};this.sendStartProblemMessage=function(){b.ctatdebug("sendStartProblemMessage()")};this.sendProblemSummaryRequest=function(c){b.ctatdebug("sendProblemSummaryRequest()");
m=c;c=(new CTATTutoringServiceMessageBuilder).createProblemSummaryRequestMessage();a.sendXML(c,!1)};this.getAllInterfaceDescriptions=function(){b.ctatdebug("getAllInterfaceDescriptions ()");for(var a="<messages>",c=new CTATTutoringServiceMessageBuilder,d=CTATShellTools.getAllComponents(),e=0;e<d.length;e++){var g=d[e];b.ctatdebug("Getting component interface description message for: "+g.getName());a+=c.createInterfaceDescriptionMessage(g);g.getConfigurationActions&&g.getConfigurationActions().forEach(function(b){a+=
c.createInterfaceActionMessage(CTATGuid.guid(),b)})}return a+="</messages>"};this.sendInterfaceDescriptionMessages=function(){b.ctatdebug("sendInterfaceDescriptionMessages ()");var c;c='<?xml version="1.0" encoding="UTF-8"?><message><verb>NotePropertySet</verb><properties><MessageType>MessageBundle</MessageType>'+b.getAllInterfaceDescriptions();c+="</properties></message>";b.ctatdebug("Final bundle: "+c);a.sendXMLNoBundle(c)};this.processSerialization=function(){b.ctatdebug("processSerialization()");
b.setText(this.label)};this.processComponentAction=function(c,d,e,g,f,h,l,n){b.ctatdebug("processComponentAction("+c.getName()+" -> "+c.getSelection()+","+c.getAction()+","+c.getInput()+"), trigger "+h);this.showFeedback("");e=l||CTATGuid.guid();l=h&&"data"==h.toLowerCase()?"tutor-performed":"";null!=commLoggingLibrary?v&&(b.ctatdebug("We're not in the start state, logging the action ..."),"scrim"==c.getSelection()?ctatdebug("Not logging any scrim actions (for now)"):void 0!=f?!1!==f&&commLoggingLibrary.logSemanticEvent(e,
c,f,l,"","",h):"hint"==c.getSelection()||"null.nextButton"==c.getSelection()||"null.previousButton"==c.getSelection()?commLoggingLibrary.logSemanticEvent(e,c,"HINT_REQUEST",l,"","",h):commLoggingLibrary.logSemanticEvent(e,c,"ATTEMPT",l,"","",h)):this.ctatdebug("Info: no logging library available!");g=new CTATTutoringServiceMessageBuilder;l="tutor-performed"==l?"tutor":"student";!1!==d&&d!==CTAT.Component.Base.Tutorable.Options.TutorComponent.DO_NOT_TUTOR?(c=g.createInterfaceActionMessage(e,c,h,f,
n),b.propagateShellEvent("InterfaceAction",c,l)):(c=g.createUntutoredActionMessage(e,c,h,f,n),b.propagateShellEvent("UntutoredAction",c,l));a.sendXML(c);CTAT.SAI&&"function"==typeof CTAT.SAI.storeForReplay&&CTAT.SAI.storeForReplay(c)};this.onEditSuccess=function(a){b.ctatdebug("onEditSuccess ("+a+")");null==nameTranslator?b.ctatdebug("Error: CTAT name translator not available"):-1!=a.indexOf(":")?(b.ctatdebug("Bump"),b.showFeedback("You're asking for a hint for multiple cells, please select only a single cell.")):
(a=nameTranslator.translateToCTAT(a),b.ctatdebug("Info A1 notiation mapped to (if needed): "+a),a=new CTATSAI("hint","ButtonPressed",a),b.processComponentAction(a),b.propagateShellEvent("REQUESTHINT",null),b.ctatdebug("onEditSuccess () done"))};this.onFailure=function(a){b.ctatdebug("onFailure ("+a.message+")")};this.onNOPEditSuccess=function(a){b.ctatdebug("onNOPEditSuccess ("+a+")")};this.onNOPFailure=function(a){b.ctatdebug("onNOPFailure ("+a.message+")")};this.requestHint=function(){b.ctatdebug("requestHint(external -> "+
CTATConfig.external+")");var a;if("none"==CTATConfig.external)b.ctatdebug("Calling built-in hint request driver ..."),CTATGlobals.Tab.previousFocus?(a=new CTATSAI("hint","ButtonPressed","hint request"),CTATGlobals.Tab.previousFocus.getSAI?(a.addSelection(CTATGlobals.Tab.previousFocus.getSAI().getSelection()),a.addAction("PreviousFocus")):b.ctatdebug("Current focus is not a CTAT component, can't ask for a hint yet")):(b.ctatdebug("CTATGlobals.Tab.previousFocus===null"),a=new CTATSAI("hint","ButtonPressed",
"hint request")),this.processComponentAction(a),this.propagateShellEvent("RequestHint",null);else if(b.clearFeedbackComponents(),"google"==CTATConfig.external){b.ctatdebug("Calling google app script hint request driver ...");try{google.script.run.withSuccessHandler(b.onEditSuccess).withFailureHandler(b.onFailure).getSheetSelectedRange()}catch(C){b.ctatdebug("google.script.run: "+C.message)}}else b.ctatdebug("'external' has configuration that doesn't match anything: "+CTATConfig.external)};this.processDone=
function(a){b.ctatdebug("processDone()");!0===CTATGlobals.confirmDone?CTATScrim.scrim.confirmScrimUp(CTATGlobals.languageManager.getString("SURE_YOU_ARE_DONE"),this.processDoneContinue,this.processDoneCancel):(a=new CTATSAI("done","ButtonPressed",a&&"string"==typeof a?a:"-1"),b.processComponentAction(a))};this.processDoneContinue=function(a){b.ctatdebug("processDoneContinue()");CTATScrim.scrim.scrimDown();a=new CTATSAI("done","ButtonPressed",a&&"string"==typeof a?a:"-1");b.processComponentAction(a);
b.propagateShellEvent("DonePressed",null)};this.processDoneCancel=function(a){b.ctatdebug("processDoneCancel()");CTATScrim.scrim.scrimDown();a=CTATGuid.guid();var c=new CTATSAI("ConfirmDone","ButtonPressed","no");commLoggingLibrary.logSemanticEvent(a,c,"ATTEMPT","")};this.processGetURL=function(c){b.ctatdebug("processGetURL()");-1!=c.getURL().indexOf("http://")?a.retrieveFile(c.getURL().substring(7),b.processClientBRDLoad):a.retrieveFile(c.getURL(),b.processClientBRDLoad)};this.processClientBRDLoad=
function(c){b.ctatdebug("processClientBRDLoad()");var d=a.getURL();a.sendXML("<message><verb>NotePropertySet</verb><properties><MessageType>GetURLResponse</MessageType><URL><![CDATA[ "+d+" ]]\x3e</URL><content><![CDATA[ "+window.btoa(c)+" ]]\x3e</content></properties></message>")};this.processCorrectAction=function(a){b.ctatdebug("processCorrectAction()");a.setGradeResult("correct");b.clearFeedbackComponents();null!=q&&(ctatdebug("Calling custom grading processor ..."),q("CORRECT",a));var c=a.getSelection();
if(n[c]&&null!=l)l("CORRECT",a),this.propagateShellEvent("CORRECT",a);else{var d=CTATShellTools.findComponent(c);if(null!=d)for(ctatdebug("Processing "+d.length+" components ..."),c=0;c<d.length;c++)ctatdebug("Check "+d[c].getName()),d[c]?d[c].setCorrect&&d[c].setCorrect(a):b.ctatdebug("Internal error, component pointer is null");else b.ctatdebug("Error: component is null for selection "+c)}};this.processInCorrectAction=function(a){b.ctatdebug("processInCorrectAction()");a.setGradeResult("incorrect");
null!=q&&(ctatdebug("Calling custom grading processor ..."),q("INCORRECT",a));var c=a.getSelection();if(n[c]&&null!=l)l("INCORRECT",a);else{var d=CTATShellTools.findComponent(c);if(null!==d)for(c=0;c<d.length;c++)ctatdebug("Calling setIncorrect on component ("+d[c].getClassName()+")..."),d[c].setIncorrect&&d[c].setIncorrect(a);else b.ctatdebug("Error: component is null for selection "+c)}};this.processHighlightMsg=function(a){b.ctatdebug("processHighlightMsg()");var c=a.getSelection(),d=CTATShellTools.findComponent(c);
if(null!=d)for(c=0;c<d.length;c++)"function"==typeof d[c].setHintHighlight&&d[c].setHintHighlight(!0,a);else b.ctatdebug("Error: component is null for selection "+c);this.showFeedback(a.getHighlightMsg())};this.processUnHighlightMsg=function(a){b.ctatdebug("processUnHighlightMsg()");var c=a.getSelection(),d=CTATShellTools.findComponent(c);if(null!=d)for(c=0;c<d.length;c++)"function"==typeof d[c].setHintHighlight&&d[c].setHintHighlight(!1,null,a);else b.ctatdebug("Error: component is null for selection "+
c)};this.processAssociatedRules=function(c,d,g,f){var h="";b.ctatdebug("processAssociatedRules()");if(0==commMessageHandler.getInStartState()){logHintSAI=c.getSAI();logHintStepID=c.getProperty("StepID");var l,n=new CTATActionEvaluationData("");b.ctatdebug("Found tutor advice: "+g);"Hint"==d||"HintWindow"==d?(ctatdebug("Preparing log message to indicate a hint response","commShell"),n.setCurrentHintNumber(hintIndex+1),n.setTotalHintsAvailable(hints.length),n.setEvaluation("HINT"),l="HINT_MSG",hints[hintIndex]&&
(g=hints[hintIndex])):("Correct"==c.getIndicator()?n.setEvaluation("CORRECT"):n.setEvaluation("INCORRECT"),l="RESULT");ctatdebug("Adding custom field names ...");var m=[],p=[];m.push("step_id");p.push(logHintStepID);var w=c.getInput();ctatdebug("CTATCommShell.processAssociatedRules() tutorInput: "+w);w&&(m.push("tutor_input"),p.push(w.toString()));if(w=c.getRules())m.push("rule_names"),p.push(w.toString());var w=c.getCustomFields(),q;for(q in w)m.push(q),p.push(w[q]);q=c.getSkillsObject();b.updateSkillWindow(q);
ctatdebug("Sending log message ...");null!=commLoggingLibrary?v?h=commLoggingLibrary.logTutorResponse(c.getTransactionID(),logHintSAI,l,"",n,g,q,m,p):c.suppressLogging():this.ctatdebug("Info: no logging library available!");"done"==logHintSAI.getSelection()&&"ButtonPressed"==logHintSAI.getAction()&&"Correct"==c.getIndicator()&&(l=e.createProblemSummaryRequestMessage(),a.sendXML(l,!1))}else b.updateSkillWindow(null);if((f=f&&CTATShellTools.findComponent(f))&&f.length)for(l=0;l<f.length;l++)ctatdebug("Calling processAssociatedRules on component ("+
f[l].getClassName()+")..."),f[l].processAssociatedRules&&f[l].processAssociatedRules(c,d,g,h);b.ctatdebug("processAssociatedRules() done");return h};this.processBuggyMessage=function(a){b.ctatdebug("processBuggyMessage()");this.showFeedback(a.getBuggyMsg())};this.processSuccessMessage=function(a){b.ctatdebug("processSuccessMessage()");this.showFeedback(a.getSuccessMessage())};this.processUntutoredAction=function(a,c){b.processInterfaceAction(a,c)};this.processInterfaceAction=function(a,c){b.ctatdebug('CTATCommShell.processInterfaceAction ("'+
a.getMessageType()+'")');var d=a.getProperty("trigger"),d=a.getProperty("subtype")||(d&&"data"==d.toLowerCase()?"tutor-performed":"");null!=commLoggingLibrary?v&&"false"!==a.getProperty("shouldLog")&&commLoggingLibrary.logSemanticEvent(a.getTransactionID(),a.getSAI(),"ATTEMPT",d):this.ctatdebug("Info: no logging library available!");if("root"==a.getSelection()||"_root"==a.getSelection()){b.ctatdebug("Info: selection is 'root', we'll call the function straight up ...");c=[window,CTATCommShell.commShell];
d=a.getAction();a=a.getInput();for(var e=0;e<c.length&&"function"!=typeof c[e][d];++e);if(e>=c.length)b.ctatdebug("Internal error: unable to find function: "+d);else{b.ctatdebug("Calling as: "+d+"("+a+")");try{c[e][d](a)}catch(K){b.ctatdebug("Internal error: unable to execute function: "+K.message)}}}else if(!CTATShellTools.execReservedSelection(a))if(d=CTATShellTools.findComponent(a.getSelection()),null===d)b.ctatdebug("Internal error: unable to find pointer to component object");else if(0==d.length)b.ctatdebug("Error: no component found to call interface action on");
else{e=d.length;b.ctatdebug("Call the action on the component(s) -> ("+e+")...");for(var g=0;g<e;g++){b.ctatdebug("About to call "+a.getAction()+" ("+a.getInput()+") on: "+a.getSelection());var f=d[g];"function"==typeof f.executeSAI&&f.executeSAI(a);b.ctatdebug("Method executed, continuing with post-processing ...");if(1==commMessageHandler.getInStartState()){var h=a.getAction()||"";/^(updatetext|updatecombobox|updatecheckbox)/i.test(h)&&!f.getDivWrap().className.includes("CTATTextField")&&f.setEnabled(!c)}}b.ctatdebug("processInterfaceAction() Done")}};
this.removeComponent=function(b){CTATTutor.removeComponent(b)};this.processAuthorModeChange=function(a){b.ctatdebug("processAuthorModeChange()")};this.processShowHintsMessage=function(a){b.ctatdebug("processShowHintsMessage()")};this.processConfirmDone=function(a){b.ctatdebug("processConfirmDone()")};this.processVersionInfo=function(a){b.ctatdebug("processVersionInfo()")};this.updateLastActionTimestamp=function(){f&&f.updateLastActionTimestamp()};this.processTutoringServiceAlert=function(a){b.ctatdebug("processTutoringServiceAlert()");
for(var c="",d=0;d<a.length;d++){var e=a[d];"ErrorType"==h.getElementName(e)&&h.getNodeTextValue(e);"Details"==h.getElementName(e)&&(c=h.getNodeTextValue(e))}CTATScrim.scrim.scrimUp(c)};this.processTutoringServiceError=function(a){b.ctatdebug("processTutoringServiceError()");var c=a.getProperty("ErrorType");a=a.getProperty("Details");CTATScrim.scrim.scrimDown();CTATScrim.scrim.errorScrimUp(c+" - "+a)};this.processProblemSummaryResponse=function(b){var a=null;CTATLMS.processProblemSummary&&(a=CTATLMS.processProblemSummary(b));
CTATLMS.closeLMSConnection&&CTATLMS.closeLMSConnection();if(null!=m){var a=b.getXMLObject(),c=a.getElementsByTagName("ProblemSummary"),e=a.getElementsByTagName("cmi.core.lesson_status"),f=a.getElementsByTagName("cmi.core.score.raw");b=a.getElementsByTagName("cmi.core.exit");a=a.getElementsByTagName("cmi.core.session_time");c=$("<div>").html(c[0].innerHTML).text();e="<cmi.core.lesson_status>"+$("<div>").html(e[0].innerHTML).text()+"</cmi.core.lesson_status>";f="<cmi.core.score.raw>"+$("<div>").html(f[0].innerHTML).text()+
"</cmi.core.score.raw>";b="<cmi.core.exit>"+$("<div>").html(b[0].innerHTML).text()+"</cmi.core.exit>";a="<cmi.core.session_time>"+$("<div>").html(a[0].innerHTML).text()+"</cmi.core.session_time>";m(c,"<scorm>"+e+f+b+a+"</scorm>");m=null}else w=!0,null!=d?(c=new CTATXML,d(c.xmlToString(b.getXMLObject()),g.sendSummary.bind(g,b,a))):g.sendSummary(b,a)};this.setGotProblemRestoreEnd=function(b){v=b};this.getGotProblemRestoreEnd=function(){return v};this.processProblemRestoreEnd=function(a){b.ctatdebug("processProblemRestoreEnd() scrimIsUp "+
scrimIsUp);v=!0;b.getCommLibrary()&&b.getCommLibrary().sendTutorReady();b.hasTutorShopCable()||CTATScrim.scrim.scrimDownForced()};this.hasTutorShopCable=function(){var b=CTATConfiguration.getCustomFields();return CTATLMS.is.TutorShop()&&b&&b["Team ID"]};this.clearFeedbackComponents=function(){b.ctatdebug("clearFeedbackComponents ()");CTATShellTools.showHints(null)};this.processHintResponse=function(a,c){b.ctatdebug("processHintResponse()");unhighlightall();CTATShellTools.showHints(c);c=a.getSAI();
if(null!=c)if(c=c.getSelection(),null!=c)if(b.ctatdebug("Highlighting selection for hint: "+c),c=CTATShellTools.findComponent(c),null!=c)for(var d=0;d<c.length;d++)1==CTATCommShell.detailedFeedback&&"function"==typeof c[d].setHintHighlight&&c[d].setHintHighlight(!0,a);else b.ctatdebug("Unable to find component name in list: "+c);else b.ctatdebug("Error: no highlight selection present in SAI");else b.ctatdebug("Warning: no SAI found in highlight message");CTATCommShell.detailedFeedback=!0;b.ctatdebug("processHintResponse() done")};
this.showHighlightSelection=function(a,c){b.ctatdebug("showHighlightSelection ("+a+")");a=CTATShellTools.findComponent(a);if(null!=a)for(var d=0;d<a.length;d++)1==CTATCommShell.detailedFeedback&&(0===d?a[d].moveHintHightlight&&a[d].moveHintHighlight(!0,c):a[d].setHintHighlight&&a[d].setHintHighlight(!0,c));else b.ctatdebug("Unable to find component name in list: "+a)};this.globalReset=function(){b.ctatdebug("globalReset ()");CTATMessageHandler.scriptElement=""};this.nextProblem=function(c){b.ctatdebug("nextProblem ()");
if(CTATGlobalFunctions.isBlank(c))b.ctatdebug("Message is blank, requesting next problem ..."),c=flashVars.getRawFlashVars().run_problem_url,a.send(c);else{b.ctatdebug("Message contains html data, writing ...");try{document.close()}catch(C){alert("Error closing document: "+C.message)}try{document.write(c)}catch(C){alert("Error writing document: "+C.message)}}};this.updateSkillWindow=function(a){b.ctatdebug("updateSkillWindow()");CTATSkillSet.skills.untouchSkills();var c=CTATShellTools.findComponentByClass("CTATSkillWindow");
null!==c?null!=a?c.updateSkillSet(a):c.drawComponent():b.ctatdebug("Info: no skill window available")};this.processComponentFocus=function(a){b.ctatdebug("processComponentFocus("+a.getName()+","+a.getClassName()+")");"CTATTextInput"==a.getClassName()||"CTATTextField"==a.getClassName()||"CTATTextArea"==a.getClassName()?(CTATGlobals.selectedTextInput=a,null!==mobileAPI&&!0===mobileAPI.getEnabled()&&mobileAPI.processTextFocus(a.getX(),a.getY(),a.getWidth(),a.getHeight())):CTATGlobals.selectedTextInput=
null;b.ctatdebug("processComponentFocus() done")};this.showFeedback=function(a){a&&(!(a instanceof Array)||a.length&&String(a[0]).trim())&&String(a).trim()?(b.ctatdebug("showFeedback("+a+") -> l: "+a.length),CTATShellTools.showFeedback(a),null!=p&&p(a)):b.ctatdebug("showFeedback(): False alarm: empty message. This can happen when the commshell is trying to clear the hint window and there is no hint window.")};this.assignFeedbackHandler=function(a){b.ctatdebug("assignFeedbackHandler()");p=a};this.gradeSAI=
function(a,c,d){b.ctatdebug("gradeSAI()");n[a]=d;a=new CTATSAI(a,c,d);b.processComponentAction(a,!0,!0)};this.assignGradingHandler=function(a){b.ctatdebug("assignGradingHandler()");l=a};this.assignAnonymousGradingProcessor=function(b){q=b};this.assignDoneProcessor=function(b){d=b};this.addEventListener=function(b,a){};this.addGlobalEventListener=function(a){b.ctatdebug("addGlobalEventListener( "+a+")");a&&u.push(a)};this.sendToTools=function(b){a&&a.sendToToolsOrCollaborators(a.getURL(),b,!1)};this.closeWSConnection=
function(b,c,d){(b=a.findWSConnection(b))?b.close(d,c):console.warn("connection not found")}};CTATCommShell.prototype=Object.create(CTATBase.prototype);CTATCommShell.prototype.constructor=CTATCommShell;CTATCommShell.commShell=null;CTATCommShell.detailedFeedback=!0;function enableDetailedFeedback(a){CTATCommShell.detailedFeedback=a};var CTATComponentReference=function(a,f){var g=a,e=f;this.setElement=function(a){g=a};this.getElement=function(){return g};this.setDiv=function(a){e=a};this.getDiv=function(){return e}};CTATComponentReference.components={};CTATComponentReference.list=function(){for(var a in CTATComponentReference.components){var f=CTATComponentReference.components[a];ctatdebug("Component: "+f.getElement().getName()+", with div: "+f.getDiv().id)}};
CTATComponentReference.getComponentFromID=function(a){var f=CTATComponentReference.components;return f.hasOwnProperty(a)?(a=f[a],a.getElement()?a.getElement():null):null};CTATComponentReference.add=function(a,f){a=new CTATComponentReference(a,f);return CTATComponentReference.components[a.getDiv().getAttribute("id")]=a};var CTATCompBase=function(a,f,g,e,c,b){CTATBase.call(this,a,f);var d=g||0,h=e||0,n=c||-2,l=b||-2,p=50,m=25,q=!1,u=!1,v="",w=!1,B=!0,C=null,F="",G=null;this.isTabIndexable=!0;var H=0,E=null,D=this,K=null,J="hidden",r=CTATGlobalFunctions.gensym.z_index(),I=CTATGlobalFunctions.gensym.div_id(),A=CTATGlobalFunctions.gensym.z_index(),P=CTATGlobalFunctions.gensym.div_id();this.setIsAbstractComponent=function(b){q=b};this.isAbstractComponent=function(){return q};this.setIsFeedbackComponent=function(b){u=
b};this.isFeedbackComponent=function(){return u};this.setTabIndex=function(b){!0===this.isTabIndexable?(G=b,0>G?(G=CTATGlobals.Tab.Tracker,CTATGlobals.Tab.Tracker++):CTATGlobals.Tab.Tracker=G):G=-1};this.getTabIndex=function(){return G||this.getComponent().getAttribute("tabindex")};this.setZIndex=function(b){D.ctatdebug("Setting z index to: "+b);H=b;null!==C&&(C.style.zIndex=b)};this.getZIndex=function(){return H};this.setDefaultWidth=function(b){p=b};this.getDefaultWidth=function(){return p};this.setDefaultHeight=
function(b){m=b};this.getDefaultHeight=function(){return m};this.processCommShellEvent=function(b,a){D.ctatdebug("processCommShellEvent ("+b+")")};this.makeDivWrapper=function(b){C=document.createElement("div");C.id=this.getName();C.setAttribute("onkeypress","return noenter(event)");C.setAttribute("data-ctat-component",this.getClassName());C.style.position="absolute";C.style.left=d+"px";C.style.top=h+"px";C.style.zIndex=r;C.style.width=D.getWidth()+"px";C.style.height=D.getHeight()+"px";$(C).data("CTATComponent",
this);b.appendChild(C)};this.setDivWrapper=function(b){(C=b)&&C.setAttribute("data-ctat-component",this.getClassName())};var L=this.setClassName;this.setClassName=function(b){L(b);C&&C.setAttribute("data-ctat-component",this.getClassName())};this.wrapComponent=function(b){D.ctatdebug("wrapComponent ()");D.makeDivWrapper(b);D.ctatdebug("wrapComponent () done")};this.createCanvas=function(){D.ctatdebug("createCanvas ()");K=document.createElement("canvas");K.setAttribute("id",P);K.setAttribute("onkeypress",
"return noenter(event)");K.setAttribute("width",n+canvasCalibrate+"px");K.setAttribute("height",l+canvasCalibrate+"px");K.setAttribute("style","border: 1px "+this.borderColor+" solid; "+("hidden"==J?"visibility: hidden; ":"")+"z-index:"+A+";");C.firstChild?C.insertBefore(K,C.firstChild):C.appendChild(K);return K};this.redraw=function(){var b=C.style.display;C.style.display="none";C.style.display=b};this.setCanvasVisibility=function(b){J=b};this.getSubCanvasCtx=function(){if(K)return K.getContext("2d")};
this.getSubCanvas=function(){return K};this.getX=function(){return d};this.getY=function(){return h};this.getWidth=function(){if(0>=n){var b;E?b=window.getComputedStyle(E):C&&(b=window.getComputedStyle(C));if(b)return parseFloat(b.width)}return n};this.getHeight=function(){if(0>=l&&C){var b=window.getComputedStyle(C);return parseFloat(b.getPropertyValue("height"))}return l};this.getText=function(){return v};this.getEnabled=function(){return B};this.assignEnabled=function(b){B=b;C.setAttribute("data-ctat-enabled",
B)};this.setEnabled=function(b){D.ctatdebug("setEnabled ("+b+")");D.assignEnabled(b);E?E.disabled=!B:D.ctatdebug("Error: component pointer is null")};this.lock=function(){this.setEnabled(!1)};this.unlock=function(){this.setEnabled(!0)};this.getDivWrap=function(){return C};this.getComponent=function(){return E};this.component=null;Object.defineProperty(this,"component",{get:function(){return E}});this.getCanvasZIndex=function(){return A};this.getComponentGroup=function(){return F};this.setComponent=
function(b){E=b;this.setEnabled(this.getEnabled())};this.getTopDivZIndex=function(){return r};this.getTopDivID=function(){return I};this.setComponentGroup=function(b){F=b;E&&(E.name=b)};this.assignText=function(b){v=b};this.init=function(){D.ctatdebug("THIS IS THE BASE INIT METHOD")};this.initialize=function(){D.ctatdebug("initialize ()");D.configFromDescription();D.init();D.processSerialization();D.render();D.processTabOrder();D.ctatdebug("initialize () done")};this.getInitialized=function(){return w};
this.setInitialized=function(b){D.ctatdebug("setInitialized ("+b+")");w=b;!0!==w||C?D.ctatdebug("Not wrapping, initialized="+w+", divWrapper = "+C):(D.ctatdebug("Wrapping a component and appending it to the top container div if one was never set ..."),(b=findPointOfAttachment(this.getName()))?(D.ctatdebug("Attaching component to existing MovieClip ..."),D.wrapComponent(b.getDivWrapper())):(D.ctatdebug("Attaching component to main div ..."),0<$("#"+ctatcontainer).length&&D.wrapComponent(getSafeElementById(ctatcontainer))));
D.getDivWrap().classList.add("CTATComponent");D.ctatdebug("setInitialized () done")};this.addSafeEventListener=function(b,a,c){D.ctatdebug("addSafeEventListener ("+b+")");D.ctatdebug("Adding event listener to: "+c);c?c.addEventListener(b,a):(E?(D.ctatdebug("Adding eventlistener to component instead of target"),E.addEventListener(b,a)):D.ctatdebug("Error: pointer to component is null, can't add event listener"),D.ctatdebug("addSafeEventListener () done"))};this.drawComponent=function(){};this.addComponentReference=
function(b,a){D.ctatdebug("addComponentReference ("+b.getName()+" -> "+a.getAttribute("id")+")");CTATComponentReference.add(b,a);D.ctatdebug("addComponentReference ()")};this.getComponentFromID=function(b){return CTATComponentReference.getComponentFromID(b)};this.processSerialization=function(){D.ctatdebug("processSerialization()");D.ctatdebug("implement in child class")};this.move=function(b,a){d=Number(b);h=Number(a);if(void 0===a||null===a||isNaN(h))0<=b.indexOf(",")?(b=b.split(","),d=Number(b[0]),
h=Number(b[1])):h=0;d=isNaN(d)?0:d;h=isNaN(h)?0:h;C&&(C.style.left=d+"px",C.style.top=h+"px")};this.setSize=function(b,a){var c=Number(b),d=Number(a);(void 0===a||null===a||isNaN(d))&&0<=b.indexOf(",")&&(b=b.split(","),c=Number(b[0]),d=Number(b[1]));D.ctatdebug("setSize ("+c+","+d+")");isNaN(c)||D.setWidth(c);isNaN(d)||D.setHeight(d)};this.SetVisible=this.setVisible=function(b){b=CTATGlobalFunctions.toBoolean(b);J=!0===b?"block":"hidden";K&&K.setAttribute("style","border: 0px; position: absolute; "+
(b?"":"visibility:hidden; ")+"; left:"+d+"px; top:"+h+"px; z-index:"+A+";");C.style.visibility=!0===b?"unset":"hidden"};this.FadeIn=function(b){D.SetVisible(!0)};this.FadeOut=function(b){D.SetVisible(!1)};this.reset=function(){};this.setX=function(b){this.x=b;C.style.left=this.x+"px";!0===w&&this.render()};this.setY=function(b){this.y=b;C.style.top=this.y+"px";!0===w&&this.render()};this.setWidth=function(b){D.ctatdebug("setWidth ("+b+")");n=b;C?C.style.width=n+"px":D.ctatdebug("Internal error: no div wrapper available to set width")};
this.setHeight=function(b){D.ctatdebug("setHeight ("+b+")");l=b;C?C.style.height=l+"px":D.ctatdebug("Internal error: no div wrapper available to set height")};this.setText=function(b){v=b;return this};this.getValue=function(){return E?E.value:""};this.backgrade=!1;this.unHighlightAll=function(){$(".CTAT--hint").each(function(){for(var b=$(this),a=null;0<b.length&&null===a;)b.data("CTATComponent")?a=b.data("CTATComponent"):b=b.parent();a&&a.setHintHighlight&&a.setHintHighlight(!1,null)})};this.processOnFocus=
function(){D.ctatdebug("processOnFocus ("+D.getName()+")");CTATGlobals.Tab.previousFocus=CTATGlobals.Tab.Focus;CTATGlobals.Tab.Focus!=D?(D.ctatdebug("CTATGlobals.Tab.Focus!=pointer, updating CTATGlobals.Tab.Focus ..."),CTATGlobals.Tab.Focus=D):D.ctatdebug("CTATGlobals.Tab.Focus==pointer");D.ctatdebug("processOnFocus () done")};this.processFocus=function(b){D.ctatdebug("processFocus ()");D.ctatdebug("***processFocus("+b+"): comp.getName "+(D&&"function"==typeof D.getName?D.getName():D)+"\n  CTATGlobals.Tab.Focus "+
(CTATGlobals.Tab.Focus&&"function"==typeof CTATGlobals.Tab.Focus.getName?CTATGlobals.Tab.Focus.getName():CTATGlobals.Tab.Focus)+"\n  CTATGlobals.Tab.Focus.isCorrect "+(CTATGlobals.Tab.Focus&&"function"==typeof CTATGlobals.Tab.Focus.isCorrect?CTATGlobals.Tab.Focus.isCorrect():"no isCorrect")+"\n  CTATGlobals.Tab.Focus == comp "+(CTATGlobals.Tab.Focus==D)+"\n  CTATGlobals.Tab.Focus.backgrade "+(CTATGlobals.Tab.Focus&&"undefined"!=typeof CTATGlobals.Tab.Focus.backgrade?CTATGlobals.Tab.Focus.backgrade:
"no backgrade")+"\n  comp.getClassName "+(D&&"function"==typeof D.getClassName?D.getClassName():D)+"\n  CTATGlobals.Tab.previousFocus "+CTATGlobals.Tab.previousFocus);if(D){mobileAPI&&!0===mobileAPI.getEnabled()&&D.hideKeyboard();CTATCommShell.commShell&&CTATCommShell.commShell.processComponentFocus(D);if(CTATGlobals.Tab.Focus){D.ctatdebug("old focus: "+CTATGlobals.Tab.Focus.getName()+", new focus:"+D.getName()+", correct: "+("function"==typeof CTATGlobals.Tab.Focus.isCorrect?CTATGlobals.Tab.Focus.isCorrect():
"[no isCorrect()]"));if("function"==typeof CTATGlobals.Tab.Focus.isCorrect&&1==CTATGlobals.Tab.Focus.isCorrect()){D.ctatdebug("Previous focus is a correct component, don't backgrade!");return}if(CTATGlobals.Tab.Focus==D){D.ctatdebug("We're already there!");return}CTATGlobals.Tab.Focus.backgrade&&CTATGlobals.Tab.Focus.processAction()}else D.ctatdebug("No previously focused component yet, can't grade");"hint"==D.getClassName()||"CTATHintButton"==D.getClassName()?D.ctatdebug("Info: focus moved to hint, bump"):
(CTATGlobals.Tab.previousFocus=CTATGlobals.Tab.Focus,CTATGlobals.Tab.Focus=D,D.ctatdebug("processFocus () done"))}else D.ctatdebug("Error: component reference is null")};this.processTabOrder=function(){D.ctatdebug("processTabOrder ("+G+")");!0===q?D.ctatdebug("Component is an abstract component, bump"):E?(D.ctatdebug("We have a component, actually assigning to html component ..."),null!==G&&(E.tabIndex=G),E.onfocus=D.processOnFocus):D.ctatdebug("Error: we don't have an html component yet, can't assign tab index")};
this.hideKeyboard=function(){document.activeElement.blur();$("input").blur()}};CTATCompBase.prototype=Object.create(CTATBase.prototype);CTATCompBase.prototype.constructor=CTATCompBase;var CTATCSS=function(){var a=0,f=[],g=0,e=[],c=0,b=[];this.resetSelectors=function(){g=0;e=[];e[g]=[]};this.resetCSSStringArray=function(){b=[];c=0};this.clearCSS=function(){this.resetSelectors();this.resetCSSStringArray();f=[];a=0};this.addStringCSS=function(a){b[c]=a;c++};this.addCSSAttribute=function(b,c){f[a]=b;f[a+1]=c;a+=2};this.removeStringCSS=function(a){a=b.indexOf(a);0<=a&&b.splice(a,1)};this.removeCSSAttribute=function(b){b=f.indexOf(b);0<=b&&f.splice(b,2)};this.modifyCSSAttribute=function(b,
a){var c=f.indexOf(b);-1==c?this.addCSSAttribute(b,a):f[c+1]=a};this.addSelector=function(b){e[g]=[];e[g][0]=b;g++};this.addSelectorAttribute=function(b,a,c){var d=1;a:if(0===g)b=0;else{for(var f=0;f<e.length&&null!==e[f][0];f++)if(e[f][0]==b){b=f;break a}b=-1}for(;void 0!==e[b][d];)d++;e[b][d]=a;e[b][d+1]=c};this.toCSSString=function(){for(var a="",c=0;c<e.length;c++){for(var a=a+(e[c][0]+" { "),g=1;g<e[c].length;g++)a+=e[c][g],a=0===g%2?a+"; ":a+": ";a+=" }; "}for(c=0;c<f.length;c++)a+=f[c],a=0===
c%2?a+": ":a+"; ";for(c=0;c<b.length;c++)a+=b[c]+" ";return a}};CTAT.Component={};CTAT.Component.Base={};
CTAT.Component.Base.Style=function(a,f,g,e,c,b){CTATCompBase.call(this,a,f,g,e,c,b);var d=new CTATCSS;this.addCSSAttribute=function(b,a){d.addCSSAttribute(b,a);this.render()};this.removeCSSAttribute=function(b){d.removeCSSAttribute(b);this.render()};this.addStringCSS=function(b){d.addStringCSS(b);this.render()};this.removeStringCSS=function(b){d.removeStringCSS(b);this.render()};this.modifyCSSAttribute=function(b,a){d.modifyCSSAttribute(b,a);this.render()};this.getCSS=function(){return d.toCSSString()};
this.render=function(){!0===this.isAbstractComponent()?this.ctatdebug("Component is an abstract component, bump"):this.getInitialized()&&(this.getComponent()?this.ctatdebug(d.toCSSString()):this.ctatdebug("Internal error, html component not available for rendering"))};this.setStyleAll=function(b,a){this.getSubCanvas()&&this.getSubCanvas().setAttribute(b,a);this.modifyCSSAttribute(b,a)}};CTAT.Component.Base.Style.prototype=Object.create(CTATCompBase.prototype);
CTAT.Component.Base.Style.prototype.constructor=CTAT.Component.Base.Style;CTAT.Component.Base.Graphical=function(a,f,g,e,c,b,d){CTAT.Component.Base.Style.call(this,a,f,e,c,b,d);var h=g||(new CTATComponentDescription).setGenericDefaults();this.getGrDescription=function(){return h};this.setGrDescription=function(b){h=b;this.processDescription(h)};var n={},l={};this.getDisplay=function(){return $(this.getDivWrap()).css("display")};this.getdisplay=this.getDisplay.bind(this);this.GetDisplay=this.getDisplay.bind(this);this.setDisplay=function(b){b=String(b);switch(b.toLowerCase()){case "false":b=
"none";break;case "true":case "null":case "undefined":b=""}$(this.getDivWrap()).css("display",b);return this};this.setdisplay=this.setDisplay.bind(this);this.SetDisplay=this.setDisplay.bind(this);this.getAlign=function(){return this.component?$(this.component).css("text-align"):$(this.getDivWrap()).css("text-align")};this.setAlign=function(b){this.component&&(this.component.style.textAlign=b);return this};this.getBackgroundColor=function(){return $(this.getComponent()).css("background-color")};this.setBackgroundColor=
function(b){b=b?CTATGlobalFunctions.formatColor(b):null;this.component&&(this.component.style.backgroundColor=b);return this};this.setDisabledBGColor=function(b){return this};this.setDisabledTextColor=function(b){return this};this.getBorderColor=function(){return $(this.getComponent()).css("border-color")};this.setBorderColor=function(b){b&&(b=CTATGlobalFunctions.formatColor(b),this.getComponent()?$(this.getComponent()).css("border-color",b):this.getDivWrap().style.borderColor=b);return this};this.getBorderRoundness=
function(){return $(this.getComponent()).css("border-radius")};this.setBorderRoundness=function(b){b=parseInt(b,10);isNaN(b)?b=n.roundness=0:n.roundness=b;b+="px";this.component&&this.getBorderRoundness()!==b&&($(this.component).css("border-radius",b),this.component.style.borderRadius=n.roundness);return this};this.getBorderStyle=function(){return $(this.getComponent()).css("borderStyle")};this.setBorderStyle=function(b){this.component&&(this.component.style.borderStyle=b);return this};this.getBorderWidth=
function(){return this.getComponent()?$(this.getComponent()).css("borderWidth"):n.width};this.setBorderWidth=function(b){n.width=b;/(\d*(px)? ?){1,3}(\d*(px)? ?)?/.test(b)||(b="0px",console.log("invalid width string"));this.component&&this.getBorderWidth()!==b&&$(this.component).css("borderWidth",b);return this};this.setPadding=function(b){b=parseInt(b);isNaN(b)&&(b=0);this.component&&(this.component.style.padding=b+"px");return this};this.getFontColor=function(){if(this.component)return $(this.component).css("color")};
this.setFontColor=function(b){console.log("setFontColor( )");l.color=CTATGlobalFunctions.formatColor(b);this.component&&(console.log("got comp"),this.getFontColor()!==l.color&&$(this.component).css("color",l.color));return l.color};this.setFontFamily=function(b){this.component&&(this.component.style.fontFamily=b);return this};this.getFontFamily=function(){if(this.component)return this.component.style.fontFamily;console.warn("component not found");return null};this.setFontSize=function(b){b=parseInt(b);
isNaN(b)?this.component.style.fontSize=null:(l.size=b,this.component&&(this.component.style.fontSize=b+"pt"));return this};this.setShowBorder=function(b){b=CTATGlobalFunctions.toBoolean(b);this.component&&(b?this.setBorderStyle("solid"):this.setBorderStyle("none"));return this};this.setUnderlined=function(b){p_underlined=CTATGlobalFunctions.toBoolean(b);this.component&&(this.component.style.textDecoration=p_underlined?"underline":null);return this};this.setBolded=function(b){b=CTATGlobalFunctions.stringToBoolean(b);
this.component&&(this.component.style.fontWeight=b?"bold":null);return this};this.setItalicized=function(b){CTATGlobalFunctions.toBoolean(b);this.component&&(this.component.style.fontStyle=l.italicized?"italic":null);return this};var p=this;a=function(b){var a=b||{};return{setHandler:function(b,c){a[b]=c},set:function(b){if(a.hasOwnProperty(b)){if(a[b]){var c=Array.prototype.slice.call(arguments,1);return a[b].apply(p,c)}p.ctatdebug("Error: NULL handler for "+b)}else p.ctatdebug("Error: No handler set for "+
b)}}};this.style_handlers=a({BackgroundColor:this.setBackgroundColor,BorderColor:this.setBorderColor,borderRoundness:this.setBorderRoundness,DrawBorder:this.setShowBorder,FontFace:this.setFontFamily,FontSize:this.setFontSize,FontBold:this.setBolded,FontItalic:this.setItalicized,FontUnderlined:this.setUnderlined,labelText:this.setText,padding:this.setPadding,showBorder:this.setShowBorder,TextAlign:this.setAlign,TextColor:this.setFontColor});this.setStyle=function(b,a){this.style_handlers.set(b,a)};
this.setStyleHandler=function(b,a){this.style_handlers.setHandler(b,a)};this.parameter_handlers=a({group:this.setComponentGroup});this.setParameter=function(b,a){this.parameter_handlers.set(b,a)};this.setParameterHandler=function(b,a){this.parameter_handlers.setHandler(b,a)};this.data_ctat_handlers={};this.processAttributes=function(){if(this.getDivWrap()){var b=$(this.getDivWrap()),a=parseInt(b.attr("tabindex"),10)||parseInt(b.attr("data-ctat-tabindex"),10);isNaN(a)||(this.setTabIndex(a),b.attr("tabindex",
null));a=b.attr("name");void 0!==a&&this.setComponentGroup(a);for(var c in this.data_ctat_handlers)a=b.data("ctat-"+c),void 0!==a&&this.data_ctat_handlers[c].apply(this,[a])}};this.data_ctat_handlers.enabled=function(b){this.setEnabled(CTATGlobalFunctions.toBoolean(b))};this.processParameters=function(b){if(b)if(b instanceof CTATComponentDescription){p.setName(b.name);b=b.params;for(var a in b)this.setParameter(a,b[a])}else this.ctatdebug("Error: Invalid description sent to CTAT.Components.Hierarchy.Graphical.processDescription: "+
b)};this.processStyles=function(b){if(b)if(b instanceof CTATComponentDescription){b=b.styles;for(var a in b)this.setStyle(a,b[a])}else this.ctatdebug("Error: Invalid description sent to CTAT.Components.Hierarchy.Graphical.processDescription: "+b)};this.processDescription=function(b){this.processParameters(b);this.processStyles(b)};this.configFromDescription=function(){this.processParameters(h)};this.processSerialization=function(){this.processStyles(h)};this.addClass=function(b){this.getDivWrap()&&
null!=this.getDivWrap()&&this.getDivWrap().classList.add(b)};this.removeClass=function(b){this.getDivWrap()&&null!=this.getDivWrap().classList&&this.getDivWrap().classList.remove(b)}};CTAT.Component.Base.Graphical.prototype=Object.create(CTAT.Component.Base.Style.prototype);CTAT.Component.Base.Graphical.prototype.constructor=CTAT.Component.Base.Graphical;CTAT.Component.Base.SAIHandler=function(a,f,g,e,c,b,d){CTAT.Component.Base.Graphical.call(this,a,f,g,e,c,b,d);var h=new CTATSAI(this.getName(),CTAT.Component.Base.SAIHandler.DefaultAction,CTAT.Component.Base.SAIHandler.DefaultInput,CTAT.Component.Base.SAIHandler.DefaultPrompt),n=this.setName;this.setName=function(b){n(b);h.setSelection(this.getName())};this.getSAI=function(){return h};this.setSAI=function(b,a,c){b instanceof CTATSAI?h=b:(b=null===b||void 0===b?this.getName():b,h=new CTATSAI(b,a,c,
CTAT.Component.Base.SAIHandler.DefaultPrompt));return this};this.setInput=function(b){h instanceof CTATSAI?h.setInput(b):h=new CTATSAI(this.getName(),CTAT.Component.Base.SAIHandler.DefaultAction,b,CTAT.Component.Base.SAIHandler.DefaultPrompt);return this};this.setAction=function(b){h instanceof CTATSAI?h.setAction(b):h=new CTATSAI(this.getName(),b,CTAT.Component.Base.SAIHandler.DefaultInput,CTAT.Component.Base.SAIHandler.DefaultPrompt);return this};this.setActionInput=function(b,a){this.setAction(b);
this.setInput(a);return this};this.setSelection=function(b){h instanceof CTATSAI?h.setSelection(b):h=new CTATSAI(b,CTAT.Component.Base.SAIHandler.DefaultAction,CTAT.Component.Base.SAIHandler.DefaultInput,CTAT.Component.Base.SAIHandler.DefaultPrompt)};this.updateSAI=function(){};this.executeSAI=function(b){this.ctatdebug("executeSAI ()");var a;a=b instanceof CTATMessage?b.getSAI():b;if(a instanceof CTATSAI){var c=a.getAction();this.ctatdebug("Processing "+c+"("+a.getInput()+") on: "+a.getSelection());
if("function"==typeof this[c]){a=a.getArgumentsTyped();this.ctatdebug("JSON args: "+JSON.stringify(a));try{this.ctatdebug("Executing "+c+"("+a+","+typeof b+")..."),a.push(b),this[c].apply(this,a)}catch(q){return this.ctatdebug("ERROR: failed to execute action: "+q.message),!1}this.component&&(b=new CustomEvent("CTAT_EXECUTE_SAI",{detail:{sai:b,component:this},bubbles:!0,cancelable:!0}),this.component.dispatchEvent(b));return!0}this.ctatdebug("ERROR: Unsupported action: "+c+" from "+a.toLSxmlString());
return!1}this.ctatdebug("ERROR: Non-SAI sent to executeSAI("+typeof b+")");return!1}};CTAT.Component.Base.SAIHandler.DefaultAction="ButtonPressed";CTAT.Component.Base.SAIHandler.DefaultInput="-1";CTAT.Component.Base.SAIHandler.DefaultPrompt="";CTAT.Component.Base.SAIHandler.prototype=Object.create(CTAT.Component.Base.Graphical.prototype);CTAT.Component.Base.SAIHandler.prototype.constructor=CTAT.Component.Base.SAIHandler;CTAT.Component.Base.Tutorable=function(a,f,g,e,c,b,d){CTAT.Component.Base.SAIHandler.call(this,a,f,g,e,c,b,d);var h=!0,n=!0,l=!0,p=CTAT.Component.Base.Tutorable.Options.TutorComponent.TUTOR,m=this,q=!1;this.setTutorComponent=function(b){p=b;b=CTAT.Component.Base.Tutorable.Options.TutorComponent;switch(p){case b.TUTOR:l=h=n=!0;break;case b.TUTOR_NO_FEEDBACK:h=n=!0;l=!1;break;case b.DO_NOT_TUTOR:h=!1,n=!0}};this.setParameterHandler("tutorComponent",this.setTutorComponent);this.data_ctat_handlers.tutor=
function(b){h=CTATGlobalFunctions.toBoolean(b)};this.data_ctat_handlers["show-feedback"]=function(b){l=CTATGlobalFunctions.toBoolean(b)};this.getTutorComponent=function(){var b=CTAT.Component.Base.Tutorable.Options.TutorComponent;return h&&n&&l?b.TUTOR:h&&n&&!l?b.TUTOR_NO_FEEDBACK:!h&&n?b.DO_NOT_TUTOR:p};this.getDisableOnCorrect=function(){var b=$(this.getDivWrap()).attr("data-ctat-disable-on-correct");return b?CTATGlobalFunctions.toBoolean(b):!0};this.setDisableOnCorrect=function(b){$(this.getDivWrap()).attr("data-ctat-disable-on-correct",
b)};this.setParameterHandler("DisableOnCorrect",this.setDisableOnCorrect);var u=!0;this.getShowHintHighlight=function(){return u};this.setShowHintHighlight=function(b){u=CTATGlobalFunctions.toBoolean(b)};this.setParameterHandler("ShowHintHighlight",this.setShowHintHighlight);this.data_ctat_handlers["show-hint-highlight"]=function(b){u=CTATGlobalFunctions.toBoolean(b)};var v=CTAT.Component.Base.Tutorable.Options.Status.NOTGRADED;this.getComponentStatus=function(){return v};this.setComponentStatus=
function(b){v=b};this.isCorrect=function(){return v===CTAT.Component.Base.Tutorable.Options.Status.CORRECT};this.isIncorrect=function(){return v===CTAT.Component.Base.Tutorable.Options.Status.INCORRECT};this.isNotGraded=function(){return v===CTAT.Component.Base.Tutorable.Options.Status.NOTGRADED};this.setCorrect=function(b){this.setNotGraded();"CTATTableGoogle"!=this.getClassName()&&this.executeSAI(b);v=CTAT.Component.Base.Tutorable.Options.Status.CORRECT;!0===this.getDisableOnCorrect()&&this.setEnabled(!1);
!1===CTATGlobals.suppressStudentFeedback&&l&&this.showCorrect(b);this.ctatdebug("setCorrect() post showCorrect");this.component&&(b=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.correct,{detail:{sai:b,component:this},bubbles:!0,cancelable:!0}),this.getDivWrap().dispatchEvent(b))};this.setIncorrect=function(b){this.ctatdebug("setIncorrect()");this.setNotGraded();"CTATTableGoogle"!=this.getClassName()&&this.executeSAI(b);v=CTAT.Component.Base.Tutorable.Options.Status.INCORRECT;!1===CTATGlobals.suppressStudentFeedback&&
l&&this.showInCorrect(b);this.component&&(b=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.incorrect,{detail:{sai:b,component:this},bubbles:!0,cancelable:!0}),this.getDivWrap().dispatchEvent(b))};this.setNotGraded=function(){this.ctatdebug("setNotGraded ()");this.setHintHighlight(!1);if(!this.isNotGraded()&&(v=CTAT.Component.Base.Tutorable.Options.Status.NOTGRADED,this.removeCorrect(),this.removeInCorrect(),this.component)){var b=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.ungrade,
{detail:{component:this},bubbles:!0,cancelable:!0});this.getDivWrap().dispatchEvent(b)}};this.showHintHighlight=function(b,a){this.component.classList.remove("CTAT--correct");this.component.classList.remove("CTAT--incorrect");b?this.component.classList.add("CTAT--hint"):this.component.classList.remove("CTAT--hint")};this.setHintHighlight=function(b,a){this.ctatdebug("setHintHighlight ("+b+")");if(u){b=CTATGlobalFunctions.toBoolean(b);if(this.component){var c=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.highlight,
{detail:{isHighlighted:b,component:this},bubbles:!0,cancelable:!0});this.getDivWrap().dispatchEvent(c)}b!==q&&(q=b,this.showHintHighlight(b,a))}};this.moveHintHighlight=function(b,a){this.ctatdebug("moveHintHighlight ("+b+")");CTATGlobals.Tab.previousFocus=CTATGlobals.Tab.Focus;CTATGlobals.Tab.Focus=m;m.component.focus?CTATGlobals.Tab.Focus.getComponent().focus():CTATGlobals.Tab.Focus.getDivWrap().focus();if(u){b=CTATGlobalFunctions.toBoolean(b);if(this.component){var c=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.highlight,
{detail:{isHighlighted:b,component:this},bubbles:!0,cancelable:!0});this.getDivWrap().dispatchEvent(c)}b!==q&&(q=b,this.showHintHighlight(b,a))}};this.highlight=function(b){ctatdebug("highlight ()");this.component.classList.add("CTAT--highlight")};this.unhighlight=function(b){ctatdebug("unhighlight ()");this.component.classList.remove("CTAT--highlight")};this.showCorrect=function(b){this.ctatdebug("showCorrect("+b+")");this.getComponent().classList.remove("CTAT--incorrect");this.getComponent().classList.remove("CTAT--hint");
this.getComponent().classList.add("CTAT--correct")};this.removeCorrect=function(){this.getComponent()&&this.getComponent().classList.remove("CTAT--correct")};this.showInCorrect=function(b){this.ctatdebug("showInCorrect("+b+")");this.getComponent().classList.remove("CTAT--correct");this.getComponent().classList.remove("CTAT--hint");this.getComponent().classList.add("CTAT--incorrect")};this.removeInCorrect=function(){this.getComponent()&&this.getComponent().classList.remove("CTAT--incorrect")};this.resetTutoring=
function(){this.showHintHighlight(!1);this.removeCorrect();this.removeInCorrect();v=CTAT.Component.Base.Tutorable.Options.Status.NOTGRADED};this.grade=function(){this.updateSAI();this.processAction(!0)};this.getIsBeingGraded=function(){return!1};this.processAction=function(b,a){var c=!1;this.ctatdebug("processAction("+b+","+a+")");if(this.getIsBeingGraded())return this.ctatdebug("skipping processAction; I am being graded"),c;m.unHighlightAll();var d=CTATShellTools.findComponentByClass("CTATDoneButton");
d&&d instanceof CTAT.Component.Base.Tutorable&&d!=this&&d.setNotGraded();this.ctatdebug("processAction() finished checking doneButton");ctatdebug("Clearing hint window ...");CTATCommShell.commShell&&CTATCommShell.commShell.clearFeedbackComponents();b=void 0===b||null===b?!1:b;a=void 0===a||null===a?!1:a;""!==this.getComponentGroup()?CTATShellTools.findComponent(this.getComponentGroup()).forEach(function(b){b.setNotGraded&&b.setNotGraded()}):this.setNotGraded();this.ctatdebug("processAction() finished setNotGraded");
CTATCommShell.commShell&&(b?CTATCommShell.commShell.processComponentAction(this.getSAI(),!0,!0):a?CTATCommShell.commShell.processComponentAction(this.getSAI(),!1,!0):CTATCommShell.commShell.processComponentAction(this.getSAI(),h,n),c=!0);this.ctatdebug("processAction() finished call to commShell.processComponentAction");this.component&&(b=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.action,{detail:{sai:this.getSAI(),component:this,graded:b||h},bubbles:!0,cancelable:!0}),this.component.dispatchEvent(b));
return c};this.addEventScreen=function(b){var a=document.createElement("div");a.style.position="absolute";a.style.top="0";a.style.left="0";a.style.bottom="0";a.style.right="0";b&&a.addEventListener("dblclick",function(){setTimeout(function(){var b=m.getDivWrap().getAttribute("data-ctat-enabled");m.setEnabled(!0);var a=m.getComponent();a.hasEditListeners||(a.addEventListener("blur",function(){m.setEnabled(!1);m.getDivWrap().setAttribute("data-ctat-enabled",b);m.getDivWrap().setAttribute("value",a.value)}),
"CTATTextArea"===m.getClassName()&&a.addEventListener("keydown",function(b){13==(b.keyCode||b.charCode)&&(b.preventDefault(),this.value+="\n")}),a.hasEditListeners=!0);a.focus()},410)});this.getDivWrap().appendChild(a)}};CTAT.Component.Base.Tutorable.Options={TutorComponent:{TUTOR:"Tutor",TUTOR_NO_FEEDBACK:"Tutor but no visual feedback",DO_NOT_TUTOR:"Do not tutor"},Status:{CORRECT:"CORRECT",INCORRECT:"INCORRECT",NOTGRADED:"NOTGRADED"}};
CTAT.Component.Base.Tutorable.EventType={correct:"CTAT_CORRECT",incorrect:"CTAT_INCORRECT",highlight:"CTAT_HIGHLIGHT",ungrade:"CTAT_NOTGRADED",action:"CTAT_ACTION"};CTAT.Component.Base.Tutorable.prototype=Object.create(CTAT.Component.Base.SAIHandler.prototype);CTAT.Component.Base.Tutorable.prototype.constructor=CTAT.Component.Base.Tutorable;CTAT.Component.Base.Clickable=function(a,f,g,e,c,b,d){CTAT.Component.Base.Tutorable.call(this,a,f,g,e,c,b,d);var h=this;this.processClick=function(b){h.ctatdebug("processClick ("+b.currentTarget.getAttribute("id")+" -> "+b.eventPhase+")");!0===h.getEnabled()?h.processAction():h.ctatdebug("Component is disabled, not grading")};this.setClickable=function(b){h.setEnabled(b)}};CTAT.Component.Base.Clickable.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);
CTAT.Component.Base.Clickable.prototype.constructor=CTAT.Component.Base.Clickable;var CTATButtonBasedComponent=function(a,f,g,e,c,b,d){CTAT.Component.Base.Clickable.call(this,a,f,g,e,c,b,d);var h=this,n="",l="black",p=!1;this.setActionInput("ButtonPressed","-1");this.getIsBeingGraded=function(){return p};this.setImage=function(b){h.ctatdebug("assignImage ("+b+")");h.getDivWrap().setAttribute("data-ctat-img",b);b&&(b="url('"+b+"')");$(h.getComponent()).css("background-image",b);$(h.getComponent()).css("background-size","cover")};this.assignImage=function(b){h.ctatdebug("assignImage ()");
h.assignImages(b,b,b,b)};this.assignImageURL=function(b){h.ctatdebug("assignImageURL ()");h.assignImages(b,b,b,b)};this.assignImages=function(b,a,c,d){h.ctatdebug("assignImages ()");h.getDivWrap().setAttribute("data-ctat-image-hover",b);h.getDivWrap().setAttribute("data-ctat-image-clicked",a);h.getDivWrap().setAttribute("data-ctat-image-default",c);h.getDivWrap().setAttribute("data-ctat-image-disabled",d);this.setImage(c)};this.processBaseMousedown=function(){h.ctatdebug("processMousedown ()");h.component.classList.add("CTAT-button--clicked");
var b=h.getDivWrap().getAttribute("data-ctat-image-clicked");h.getEnabled()&&b&&void 0!==b&&""!==b&&null!==b&&(h.getComponent().style.backgroundImage="url('"+b+"')")};this.processBaseMouseup=function(){h.ctatdebug("processMouseup ()");h.component.classList.remove("CTAT-button--clicked");var b=h.getDivWrap().getAttribute("data-ctat-image-default");h.getEnabled()&&b&&void 0!==b&&""!==b&&null!==b&&(h.getComponent().style.backgroundImage="url('"+b+"')")};this.processBaseMouseover=function(){h.ctatdebug("processBaseMouseover ()");
h.component.classList.add("CTAT-button--hover");var b=h.getDivWrap().getAttribute("data-ctat-image-hover");h.getEnabled()&&b&&void 0!==b&&""!==b&&(h.getComponent().style.backgroundImage="url('"+b+"')")};this.processBaseMouseout=function(){h.ctatdebug("processBaseMouseout ()");h.component.classList.remove("CTAT-button--hover");h.component.classList.remove("CTAT-button--clicked");var b=h.getDivWrap().getAttribute("data-ctat-image-default");h.getEnabled()&&b&&void 0!==b&&""!==b&&(h.getComponent().style.backgroundImage=
"url('"+b+"')")};this.setText=function(b){h.ctatdebug("setText ("+b+")");n=b;null!==h.getComponent()&&(h.getComponent().innerHTML=n)};this.setFontColor=function(b){l=b;$(h.getComponent()).css("color",b)};this.getFontColor=function(){return l};this.setStyleHandler("labelText",this.setText);this.getText=function(){return n};this.processClick=function(b){h.ctatdebug("processClick ("+b.currentTarget.getAttribute("id")+" -> "+b.eventPhase+")");h.getEnabled()?(null!==CTATGlobals.Tab.Focus&&("CTATTextArea"==
CTATGlobals.Tab.Focus.getClassName()||"CTATTextInput"==CTATGlobals.Tab.Focus.getClassName()||"CTATMathInput"==CTATGlobals.Tab.Focus.getClassName()||"CTATTextField"==CTATGlobals.Tab.Focus.getClassName()?CTATGlobals.Tab.Focus.processAction():h.ctatdebug("Info: CTATGlobals.Tab.Focus==null")),b=$(h.getDivWrap()).attr("value"),h.setInput(b?b:"-1"),h.processAction(),h.getTutorComponent()===CTAT.Component.Base.Tutorable.Options.TutorComponent.TUTOR&&(p=!0)):h.ctatdebug("Component is disabled, not grading")};
this.ButtonPressed=function(){};this.processAssociatedRules=function(){p=!1}};CTATButtonBasedComponent.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTATButtonBasedComponent.prototype.constructor=CTATButtonBasedComponent;CTAT.ComponentRegistry={};CTAT.ComponentRegistry.addComponentType=function(){};Object.defineProperty(CTAT.ComponentRegistry,"addComponentType",{enumerable:!1,value:function(a,f){"string"==typeof a&&(this.hasOwnProperty(a)?alert(a+" is already a registered component"):this[a]=f)}});var CTATAudioButton=function(a,f,g,e,c){CTATButtonBasedComponent.call(this,"CTATAudioButton","audiobutton",a,f,g,e,c);var b=this;b.setActionInput("play","-1");var d=null,h="",n=CTATConfiguration.get("previewMode");this.setSource=function(b){this.getDivWrap().setAttribute("data-ctat-src",b);return this};this.getSource=function(){return this.getDivWrap().getAttribute("data-ctat-src")};this.setParameterHandler("SoundFile",this.setSource);this.init=function(){var a=document.createElement("button");a.value=
"-1";a.name=b.getName();a.setAttribute("id",CTATGlobalFunctions.gensym.div_id());a.setAttribute("onkeypress","return noenter(event)");a.classList.add("CTAT-button");if(this.getDivWrap().getAttribute("data-ctat-label"))a.textContent=this.getDivWrap().getAttribute("data-ctat-label");else if(b.getText())a.textContent=b.getText();else if(b.getDivWrap()&&b.getDivWrap().innerHTML&&!n){var c=b.getDivWrap().innerHTML;b.getDivWrap().innerHTML="";a.innerHTML=c}b.setInitialized(!0);b.setComponent(a);b.addComponentReference(b,
a);b.getDivWrap().appendChild(a);b.ctatdebug("Final location: "+b.getX()+","+b.getY()+" with text: "+b.getText());n||(a.addEventListener("click",b.processClick),a.addEventListener("focus",b.processFocus));d=document.createElement("audio");d.addEventListener("canplay",function(){b.ctatdebug("Audio loaded and ready for play");""!==h&&(b.logAudioEvent(h),h="")},!0);d.onended=function(){b.ctatdebug("Audio ended");b.logAudioEvent("end")};this.getDivWrap().appendChild(d)};this.getConfigurationActions=function(){var b=
[],a;0<this.component.innerHTML.trim().length&&(a=new CTATSAI,a.setSelection(this.getName()),a.setInput(this.component.innerHTML.toString()),a.setAction("setText"),b.push(a));0<this.getSource().trim().length&&(a=new CTATSAI,a.setSelection(this.getName()),a.setInput(this.getSource()),a.setAction("setSource"),b.push(a));return b};this.reset=function(){b.configFromDescription();b.processSerialization();b.setEnabled(!0);h="reset"};this.logAudioEvent=function(a){b.ctatdebug("logAudioEvent ("+a+")");if(void 0!==
d.duration)if(null!==CTATCommShell.commShell){a=new CTATSAI(b.getName(),a,b.toHHMMSS(d.currentTime)+".000","");a.addSelection(encodeURIComponent(d.currentSrc),"media_file");a.addSelection(b.toHHMMSS(d.duration)+".000","clip_length");var c=a.getInputObject();null!==c&&c.setType("time");CTATCommShell.commShell.processComponentAction(a,!1,!0,b,"AUDIO_ACTION","USER")}else b.ctatdebug("Error: commShell is null, can't send untutored tool message");else b.ctatdebug("Error: audio file not loaded yet, can't obtain duration")};
this.processClick=function(a){b.ctatdebug("processClick ("+a.currentTarget.getAttribute("id")+" -> "+a.eventPhase+")");!0===b.getEnabled()?(a=this.getSource(),b.ctatdebug("Playing audio file: "+a),d.setAttribute("src",a),d.play(),h="play",b.processAction()):b.ctatdebug("Component is disabled, not grading")}.bind(this);this.play=function(){b.ctatdebug("play");var a=this.getSource();d.setAttribute("src",a);d.load();d.play();h="play"};this.playClip=function(a){b.ctatdebug("playClip");d.setAttribute("src",
a);d.load();d.play();h="play"};this.pause=function(){b.ctatdebug("pause");d.pause();h="pause"}};CTATAudioButton.prototype=Object.create(CTATButtonBasedComponent.prototype);CTATAudioButton.prototype.constructor=CTATAudioButton;CTAT.ComponentRegistry.addComponentType("CTATAudioButton",CTATAudioButton);var CTATButton=function(a,f,g,e,c){CTATButtonBasedComponent.call(this,"CTATButton","aButton",a,f,g,e,c);var b=this,d=null,h=CTATConfiguration.get("previewMode");this.init=function(){b.ctatdebug("init ("+b.getName()+")");b.setActionInput("ButtonPressed","-1");d=document.createElement("button");d.type="button";d.name=b.getName();d.value=$(this.getDivWrap()).attr("value")||"-1";this.setInput(d.value);d.id=CTATGlobalFunctions.gensym.div_id();d.setAttribute("onkeypress","return noenter(event)");d.classList.add("CTAT-button");
b.setInitialized(!0);if(b.getDivWrap().getAttribute("data-ctat-label"))d.innerHTML=b.getDivWrap().getAttribute("data-ctat-label");else if(b.getText())d.innerHTML=b.getText();else if(b.getDivWrap()&&b.getDivWrap().innerHTML&&!h){var a=b.getDivWrap().innerHTML;b.getDivWrap().innerHTML="";d.innerHTML=a}b.setComponent(d);b.addComponentReference(b,d);b.getDivWrap().appendChild(d);d.addEventListener("click",b.processClick);d.addEventListener("focus",b.processFocus);d.addEventListener("mousedown",this.processBaseMousedown);
d.addEventListener("mouseup",this.processBaseMouseup);d.addEventListener("mouseover",b.processBaseMouseover);d.addEventListener("mouseout",b.processBaseMouseout)}.bind(this);this.render=function(){};this.getConfigurationActions=function(){var b=[],a;0<d.innerHTML.trim().length&&(a=new CTATSAI,a.setSelection(this.getName()),a.setInput(d.innerHTML.toString()),a.setAction("setText"),b.push(a));return b};this.reset=function(){b.configFromDescription();b.processSerialization();b.setEnabled(!0)}};
CTATButton.prototype=Object.create(CTATButtonBasedComponent.prototype);CTATButton.prototype.constructor=CTATButton;CTAT.ComponentRegistry.addComponentType("CTATButton",CTATButton);var CTATTextBasedComponent=function(a,f,g,e,c,b,d){CTAT.Component.Base.Tutorable.call(this,a,f,g,e,c,b,d);var h=this,n="",l="#000000",p=16,m=!0,q=255,u=!0;this.setAction("UpdateTextField");this.backgrade=!0;this.setFontColor=function(b){l=b;$(h.getComponent()).css("color",b)};this.getFontColor=function(){return l};this.setFontSize=function(b){b.includes("px")||(b+="px");p=b;$(h.getComponent()).css("font-size",b)};this.getFontSize=function(){return p};this.assignText=function(b){n=b;this.setInput(b)};
this.UpdateTextArea=this.UpdateTextField=function(b){this.setText(b)};this.setTabOnEnter=function(b){m=CTATGlobalFunctions.toBoolean(b)};this.setStyleHandler("TabOnEnter",this.setTabOnEnter);this.data_ctat_handlers["tab-on-enter"]=this.setTabOnEnter;this.assignEditable=function(b){u=b};this.setMaxCharacters=function(b){q=b};this.setStyleHandler("MaxCharacters",this.setMaxCharacters);this.getText=function(){return n};this.getEditable=function(){return u};this.getTabOnEnter=function(){return m};this.getMaxCharacters=
function(){return q};this.disableTextAlterations=function(b){for(var a="autocomplete off autocapitalize off autocorrect off spellcheck false".split(" "),c=0;c<a.length;c+=2){var d=a[c],e=b.getAttribute(d);e||"false"===String(e).toLowerCase()||b.setAttribute(d,e=a[c+1]);a[c+1]=e}this.ctatdebug("'#"+b.getAttribute("id")+"'.processAttributes("+a+")");return a};this.setEditable=function(b){h.assignEditable(CTATGlobalFunctions.toBoolean(b));null!==h.getComponent()&&(!0===h.getEditable()?h.getComponent().contentEditable=
"true":h.getComponent().contentEditable="false")};this.setStyleHandler("Enabled",this.setEditable);this.setEnabled=function(b){h.assignEnabled(b);null!==h.getComponent()&&(h.getComponent().disabled=!b,this.setEditable(b))};var v=this.processAction.bind(this);this.processAction=function(b,a){h.ctatdebug("processAction ()");this.updateSAI();CTATGlobalFunctions.isBlank(this.getValue())||v(b,a)};this.processKeypress=function(b){h.ctatdebug("processKeypress ()");var a=b.target.getAttribute("id");h.ctatdebug(a);
var c=h.getComponentFromID(a);if(null===c)h.ctatdebug("Error: component reference is null");else switch(h.ctatdebug(c.getName()+" keydown ("+("google"==CTATConfig.platform?0:window.event?window.event.keyCode:b.which)+" -> "+b.eventPhase+") ID: "+a),b.which){case 37:h.ctatdebug("left arrow key pressed!");break;case 39:h.ctatdebug("right arrow key pressed!");break;case 13:return m?(h.component.blur(),CTATGlobals.Tab.Focus=null,h.processAction(),!1):!0;case 0:h.component.blur();CTATGlobals.Tab.Focus=
null;h.processAction();break;default:h.ctatdebug('Key pressed! "'+b.which+'"')}};this.updateSAI=function(){h.ctatdebug("updateSAI ()");this.setInput(this.getValue());var b=this.getSAI();h.ctatdebug("SAI: "+b.toTSxmlString())}};CTATTextBasedComponent.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATTextBasedComponent.prototype.constructor=CTATTextBasedComponent;var CTATTextArea=function(a,f,g,e,c){CTATTextBasedComponent.call(this,"CTATTextArea","__undefined__",a,f,g,e,c);this.setDefaultWidth(100);this.setDefaultHeight(44);var b=this,d=null,h=null,n=CTATConfiguration.get("previewMode");this.setAction("UpdateTextArea");this.init=function(c){d=document.createElement("textarea");a&&(d.name=a.name);d.setAttribute("id",CTATGlobalFunctions.gensym.div_id());(c=this.getDivWrap())&&$(c).attr("maxlength")&&(d.maxlength=$(c).attr("maxlength"));c&&$(c).attr("rows")&&
(d.rows=$(c).attr("rows"));c&&$(c).attr("cols")&&(d.cols=$(c).attr("cols"));b.setComponent(d);b.disableTextAlterations(d);c&&$(c).attr("value")?this.setText($(c).attr("value")):d.value=this.getText();b.setInitialized(!0);b.addComponentReference(b,d);c.appendChild(d);$(d).keypress(b.processKeypress);d.addEventListener("focus",b.processFocus);$(d).on("input",function(a){b.setNotGraded()});n&&this.addEventScreen(!1)};this.processBlur=function(a){b.processAction()};this.setCellContainer=function(b){h=
b};this.getCellContainer=function(){return h};this.setText=function(a){b.ctatdebug("setText ("+a+")");b.assignText(a);d.value=a};this.getValue=function(){return d.value};this.reset=function(){b.configFromDescription();b.processSerialization();d.value=""}};CTATTextArea.prototype=Object.create(CTATTextBasedComponent.prototype);CTATTextArea.prototype.constructor=CTATTextArea;CTAT.ComponentRegistry.addComponentType("CTATTextArea",CTATTextArea);var CTATChatPanel=function(a,f,g,e,c){function b(){var b=new Date,a=b.getHours();12<a&&(a-=12);var c=b.getMinutes();10>c&&(c="0"+b.getMinutes());return""+a+":"+c+(12<=b.getHours()?" PM":" AM")}CTAT.Component.Base.Tutorable.call(this,"CTATChatPanel","__undefined__",a,f,g,e,c);var d=this,h=null,n=null,l="",p="",m=null,q=null,u=null,v=CTATConfiguration.get("previewMode"),w=null,B=0,C="Typing...";this.setWarningText=function(b){l=b};this.data_ctat_handlers["warning-text"]=d.setWarningText;this.setWarningImg=
function(b){p=b};this.data_ctat_handlers["warning-img"]=d.setWarningImg;this.setTypeText=function(b){C=b};this.data_ctat_handlers["type-text"]=d.setTypeText;this.init=function(){d.ctatdebug("init ("+d.getName()+")");d.setTutorComponent(CTAT.Component.Base.Tutorable.Options.TutorComponent.DO_NOT_TUTOR);d.setInitialized(!0);var b=d.getDivWrap();d.addComponentReference(d,b);d.ctatdebug("chat name = "+this.getName());h=document.createElement("div");h.id=b.id+"chatArea";h.classList.add("CTATChatPanel--chat-area");
n=document.createElement("div");n.id=b.id+"inputDiv";n.classList.add("CTATChatPanel--input-div");lineBreak=document.createElement("br");q=document.createElement("textarea");q.id=b.id+"_input";q.classList.add("CTATChatPanel--message-box");q.placeholder="Type a message, then choose a button below to send it";q.addEventListener("keydown",this.typingIndicator);if(l||p){m=document.createElement("div");m.classList.add("CTATChatPanel--warning-div");if(p){var a=document.createElement("img");a.src=p;m.appendChild(a)}l&&
(a=document.createTextNode(l),m.appendChild(a));n.appendChild(m)}n.appendChild(q);u=document.createElement("button");u.innerText="Send";u.classList.add("CTATChatPanel--send-button");u.addEventListener("click",this.sendText);d.setComponent(q);d.addComponentReference(d,h);d.addComponentReference(d,n);m&&d.addComponentReference(d,m);d.addComponentReference(d,q);b.appendChild(h);b.appendChild(n);d.render();v&&this.addEventScreen(!1)};this.updateSAISend=function(b){d.ctatdebug("updateSAISend ()");console.log("updateSAISend ()",
b);var a=d.getDivWrap();this.setSelection(a.id);this.setAction("sendMessage");a=CTATConfiguration.get("user_guid");this.setInput(a+": "+b);b=this.getSAI();d.ctatdebug("SAI: "+b.toTSxmlString())};var F=this.processAction.bind(this);this.processSend=function(b,a,c){d.ctatdebug("processSend ()");d.updateSAISend(b);var e=/_computer$/i.test(String(b));CTATGlobalFunctions.isBlank(b)&&!e||F(a,c)};this.removeLastMessage=function(b){var a=h.children;console.log("removeLastMessage:"+b+", length:"+a.length);
for(var c=1;c<=Math.min(a.length,2);c++){var d=a[a.length-c],e=d.children;if(e&&!(4>e.length)){var e=e[e.length-4].innerText,g=d.getAttribute("data-ctat-author");console.log("  mbAuthor "+g+", mbText "+e);if(g==CTATConfiguration.get("user_guid")&&e==C||b==g&&e==b+" "+C)return h.removeChild(d),h.scrollTop=h.scrollHeight,c}}return 0};this.processRemoveLastMessage=function(b,a,c){a=d.getDivWrap();this.setSelection(a.id);this.setAction("removeLastMessage");this.setInput(b);b=d.getSAI();d.ctatdebug("processRemoveLastMessage SAI: "+
b.toTSxmlString());CTATCommShell.commShell.processComponentAction(b,d.getTutorComponent(),c,null,!1,"data")};this.addOwnMessage=function(a,c){var e=document.createElement("div");e.innerText=a;e.classList.add("CTATChatPanel--single-message");a=document.createElement("div");a.innerText=b();a.classList.add("CTATChatPanel--timestamp");var g=document.createElement("br"),f=document.createElement("br"),l=document.createElement("div");l.setAttribute("data-ctat-author",CTATConfiguration.get("user_guid"));
l.style.display=c||"block";l.style.padding="5px";l.appendChild(e);l.appendChild(g);l.appendChild(a);l.appendChild(f);d.removeLastMessage(CTATConfiguration.get("user_guid"))&&d.processRemoveLastMessage(CTATConfiguration.get("user_guid"));h.appendChild(l);h.scrollTop=h.scrollHeight};this.addOtherMessage=function(a){var c=a.indexOf(":"),d=a.substr(0,c),c=a.substr(c+2);a=document.createElement("div");a.innerHTML=d.bold()+" "+c;a.classList.add("CTATChatPanel--other-message");c=document.createElement("div");
c.innerText=b();c.classList.add("CTATChatPanel--timestamp");var e=document.createElement("br");c.style.cssFloat="left";var g=document.createElement("br"),f=document.createElement("div");f.setAttribute("data-ctat-author",d);f.style.display="block";f.style.padding="5px";f.appendChild(a);f.appendChild(e);f.appendChild(c);f.appendChild(g);h.appendChild(f);h.scrollTop=h.scrollHeight};this.sendCompMessage=function(a){var c=document.createElement("div");c.innerHTML="computer: ".bold()+a;c.classList.add("CTATChatPanel--comp-message");
a=document.createElement("div");a.innerText=b();a.classList.add("CTATChatPanel--timestamp");a.style.cssFloat="left";var d=document.createElement("br"),e=document.createElement("br");h.appendChild(c);h.appendChild(d);var g=document.createElement("div");g.setAttribute("data-ctat-author","computer");g.style.display="block";g.style.padding="5px";g.appendChild(c);g.appendChild(d);g.appendChild(a);g.appendChild(e);h.appendChild(g);h.scrollTop=h.scrollHeight};this.sendCompMessageBroadcast=function(b){if(""!==
b){d.processSend(b+"_computer");var a=CTAT.Component.Base.Tutorable.Options.TutorComponent;d.getTutorComponent()===a.DO_NOT_TUTOR&&d.sendCompMessage(b)}};this.checkTime=function(b){B++;4<=B&&(d.resetTimer(!1),d.removeLastMessage(CTATConfiguration.get("user_guid"))&&d.processRemoveLastMessage(CTATConfiguration.get("user_guid")))};this.resetTimer=function(b){null!=w&&(clearInterval(w),w=null,B=0);b&&null==w&&(w=setInterval(this.checkTime,1E3))};this.typingIndicator=function(b){d.resetTimer(!0);b=C;
var a=null,c=h.children;0<c.length&&(a=c[c.length-1].children,a=a[a.length-4]);a&&a.innerText==b||(d.addOwnMessage(b,"none"),d.updateSAISend(b),CTATCommShell.commShell.processComponentAction(d.getSAI(),d.getTutorComponent(),null,null,!1,"data"))};this.sendText=function(b){var a=q.value;""!==a&&(a=b+": "+a,d.processSend(a),b=CTAT.Component.Base.Tutorable.Options.TutorComponent,d.getTutorComponent()===b.DO_NOT_TUTOR&&d.addOwnMessage(a));q.value="";u.classList.remove("CTAT--incorrect")};this.sendMessage=
function(b){if("computer"===b.split("_").pop()){var a=b.indexOf(":"),c=b.lastIndexOf("_");b=b.slice(a+2,c);d.sendCompMessage(b)}else d.addOtherMessage(b);u.classList.remove("CTAT--incorrect")}};CTATChatPanel.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATChatPanel.prototype.constructor=CTATChatPanel;CTAT.ComponentRegistry.addComponentType("CTATChatPanel",CTATChatPanel);var CTATCheckBox=function(a,f,g,e,c){CTAT.Component.Base.Clickable.call(this,"CTATCheckBox","__undefined__",a,f,g,e,c);var b=null,d=null,h=CTATConfiguration.get("previewMode");this.setStyleHandler("inspBackgroundColor",null);this.setStyleHandler("BackgroundColor",null);this.setStyleHandler("DrawBorder",null);this.setStyleHandler("showBorder",null);this.setStyleHandler("BorderColor",null);this.setStyleHandler("TextAlign",null);var n=this;this.setSelection(this.getComponentGroup());this.setAction("UpdateCheckBox");
this.getCheckBox=function(){return b};this.setStyleHandler("labelPlacement",null);var l=function(b){this.updateSAI();this.processClick(b)};this.init=function(){n.setInitialized(!0);b=document.createElement("input");b.type="checkbox";b.setAttribute("id",this.getName()+"_check");b.classList.add("CTATCheckBox--button");this.getText()?b.value=n.getText():this.getDivWrap()&&this.getDivWrap().textContent?b.value=this.getDivWrap().textContent:b.value=b.id;this.getComponentGroup()?b.name=n.getComponentGroup():
this.getDivWrap()&&$(this.getDivWrap()).attr("name")?b.name=$(this.getDivWrap()).attr("name"):b.name="checkBoxGroup";!0===n.getEnabled()?b.disabled=!1:b.disabled=!0;n.ctatdebug("Final location: "+n.getX()+","+n.getY()+" with text: "+n.getText());n.addComponentReference(n,b);if(!h){var a=this.getDivWrap().innerHTML;this.getDivWrap().innerHTML=""}$(n.getDivWrap()).append(b);d=document.createElement("label");d.htmlFor=b.id;d.classList.add("CTATCheckBox--label");this.getText()?d.textContent=this.getText():
a&&!h?d.innerHTML=a:this.getDivWrap().getAttribute("data-ctat-label")&&this.setText(this.getDivWrap().getAttribute("data-ctat-label"));$(this.getDivWrap()).append(d);n.setComponent(b);b.addEventListener("click",l.bind(this));b.addEventListener("focus",n.processFocus);b.onfocus=this.processOnFocus;this.setSelection(this.getComponentGroup())};this.resize=function(){var b=$(this.getDivWrap()).height();$(d).css("font-size",b-5+"px");$(this.getComponent()).css("height",b-10+"px");$(this.getComponent()).css("width",
b-10+"px")};this.getConfigurationActions=function(){var b=[],a;0<d.innerHTML.trim().length&&(a=new CTATSAI,a.setSelection(this.getName()),a.setInput(d.innerHTML.toString()),a.setAction("setText"),b.push(a));return b};var p=this.setText;this.setText=function(a){n.ctatdebug("setText ("+a+")");p(a);b&&(b.value=a,d.innerHTML=a)};this.setStyleHandler("labelText",this.setText);var m=this.setEnabled;this.setEnabled=function(a){m(a);b&&(b.disabled=!this.getEnabled())};this.getCheckBoxInput=function(){return d.innerHTML+
": "+b.checked};this.reset=function(){b.checked=!1;n.setEnabled(!0)};this.UpdateCheckBox=function(a){var c=new RegExp("(^|;)"+CTATCheckBox.escape(b.value)+"\\s*:\\s*true");b.checked=0<=a.search(c)};this.SetSelected=function(a){a=CTATGlobalFunctions.toBoolean(a);b.checked=a};this.updateSAI=function(){var a=$("."+this.getClassName()+'[data-ctat-component]:has(input[type="checkbox"][name="'+b.name+'"])').sort(function(b,a){b=b.id;a=a.id;return b>a?1:b<a?-1:0}),a=$.map(a,function(b){b=$(b).data("CTATComponent").getCheckBox();
return b.value+": "+b.checked});this.setSelection(b.name);this.setAction("UpdateCheckBox");this.setInput(a.join(";"))};var q=function(a){d.classList.add(a);b.classList.add(a)},u=function(a){d.classList.remove(a);b.classList.remove(a)};this.showCorrect=function(b){u("CTAT--incorrect");u("CTAT--hint");q("CTAT--correct")};this.removeCorrect=u.bind(this,"CTAT--correct");this.showInCorrect=function(b){u("CTAT--correct");u("CTAT--hint");q("CTAT--incorrect")};this.removeInCorrect=u.bind(this,"CTAT--incorrect");
this.showHintHighlight=function(b){u("CTAT--incorrect");u("CTAT--correct");b?q("CTAT--hint"):u("CTAT--hint")}};CTATCheckBox.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTATCheckBox.prototype.constructor=CTATCheckBox;CTATCheckBox.escape=function(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s\/]/g,"\\$&")};CTAT.ComponentRegistry.addComponentType("CTATCheckBox",CTATCheckBox);var CTATComboBox=function(a,f,g,e,c){CTAT.Component.Base.Clickable.call(this,"CTATComboBox","__undefined__",a,f,g,e,c);var b=this,d=null;this.component=null;var h="",n=CTATConfiguration.get("previewMode");this.setAction("UpdateComboBox");var l=",";a=function(b){l=b;d&&(d.innerHTML="",this.addLabels(p,l))}.bind(this);this.setStyleHandler("SplitCharacter",a);this.data_ctat_handlers["split-on"]=a;var p=null;this.setLabels=function(b){p=b;d&&(d.innerHTML="",this.addLabels(p,l))}.bind(this);this.setStyleHandler("Labels",
this.setLabels);this.data_ctat_handlers.labels=this.setLabels;var m=null;a=function(b){b=parseInt(b);m=isNaN(b)?null:b;d&&d.setAttribute("size",m)};this.setStyleHandler("DropDownSize",a);this.data_ctat_handlers.size=a;this.setStyleHandler("DropDownWidth",null);this.setNumOptions=a;this.setGradeOnNextClick=function(a){b.ctatdebug("CTATComboBox["+b.getName()+"].setGradeOnNextClick("+a+")");h=a};this.getGradeOnNextClick=function(){b.ctatdebug("CTATComboBox["+b.getName()+"].getGradeOnNextClick() to return "+
h);return h};this.processAssociatedRules=function(a,c,d){a=a.getProperty("OutOfOrder");b.ctatdebug("CB["+b.getName()+"] processAssociatedRules indicator "+c+", outOfOrder "+a+", tutorAdvice '"+d+"'");c&&"incorrect"==c.toString().toLowerCase()&&(a||d&&d.toString().toLowerCase().includes(" the step you "))&&b.setGradeOnNextClick("at "+(new Date).toString()+": sai "+b.getSAI().toString())};this.init=function(){b.setInitialized(!0);d=document.createElement("select");d.name=b.getName();d.setAttribute("id",
CTATGlobalFunctions.gensym.div_id());d.setAttribute("onkeypress","return noenter(event)");d.onchange=this.processComboSelection;d.addEventListener("click",function(a){b.ctatdebug("CB["+b.getName()+"].onclick() "+a+", gradeOnNextClickInfo "+b.getGradeOnNextClick());b.getGradeOnNextClick()&&b.processComboSelection()});d.classList.add("CTAT-combobox");m&&!n&&d.setAttribute("size",m);if(!n){var a=this.getDivWrap().innerHTML;this.getDivWrap().innerHTML="";a.trim()&&(d.innerHTML=a)}p&&this.addLabels(p,
l);!0===b.getEnabled()?d.disabled=!1:d.disabled=!0;b.addComponentReference(b,d);b.setComponent(d);b.getDivWrap().appendChild(d);this.component=d;d.addEventListener("focus",b.processFocus)};this.getConfigurationActions=function(){var b=[];if(p){var a=new CTATSAI;a.setSelection(this.getName());a.setInput(p);a.setAction("setLabels");b.push(a)}return b};this.getHTMLComponent=function(){return d};this.addLabels=function(b,a){b=b.split(a?a:l);for(a=0;a<b.length;a++)this.addItem(b[a])};this.addBlank=function(b){for(var a=
0;a<b;a++)this.addItem("")};this.addItem=function(a){b.ctatdebug("addItem ("+a+")");var c=document.createElement("option");c.setAttribute("value",a);c.textContent=a;d.appendChild(c)};this.setFontSize=function(b){isNaN(b)||($(this.getComponent()).css("font-size",b+"px"),this.getDivWrap().setAttribute("data-ctat-font-size",b))};this.valid_selection=function(){return 0<=d.selectedIndex&&!CTATGlobalFunctions.isBlank(d.value)};this.processComboSelection=function(){b.ctatdebug("processComboSelection ()");
b.setGradeOnNextClick("");b.setInput(d.options[d.selectedIndex].value);b.valid_selection()?b.processAction():this.ctatdebug("Empty component, nothing to grade")};this.UpdateComboBox=function(b){d.value=b};this.updateSAI=function(){b.setInput(d.value)}};CTATComboBox.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTATComboBox.prototype.constructor=CTATComboBox;CTAT.ComponentRegistry.addComponentType("CTATComboBox",CTATComboBox);var CTATDoneButton=function(a,f,g,e,c){CTAT.Component.Base.Clickable.call(this,"done","CTATDoneButton",a,f,g,e,c);this.setName("done");this.setClassName("CTATDoneButton");this.setText(CTATGlobals.languageManager.getString("DONE"));this.setStyleHandler("BackgroundColor",null);this.setStyleHandler("TextAlign",null);var b=this;this.init=function(){this.setInitialized(!0);var b=document.createElement("button");b.classList.add("CTAT-done-button");this.setComponent(b);var a=document.createElement("div");
a.classList.add("CTAT-done-button--content");b.appendChild(a);var c=document.createElement("div");c.textContent="\u2714";c.classList.add("CTAT-done-button--icon");a.appendChild(c);this.getText()&&(c=document.createElement("div"),c.classList.add("CTAT-done-button--text"),c.textContent=this.getText(),a.appendChild(c));this.getDivWrap().appendChild(b);b.addEventListener("mouseenter",function(b){b.target.classList.add("CTAT-done-button--hover")});b.addEventListener("mouseleave",function(b){b.target.classList.remove("CTAT-done-button--hover");
b.target.classList.remove("CTAT-done-button--clicked")});b.addEventListener("mousedown",function(b){b.target.classList.add("CTAT-done-button--clicked")});b.addEventListener("mouseup",function(b){b.target.classList.remove("CTAT-done-button--clicked")});b.addEventListener("click",function(b){b.target.classList.remove("CTAT-done-button--clicked")});b.addEventListener("click",this.processClick);b.addEventListener("focus",this.processFocus)};this.processClick=function(a){b.getEnabled()&&CTATCommShell.commShell&&
(a=new FocusEvent(b.getName(),{currentTarget:b,relatedTarget:CTATGlobals.Tab.Focus&&"function"==typeof CTATGlobals.Tab.Focus.getComponent?CTATGlobals.Tab.Focus.getComponent():null}),b.processFocus(a),CTATCommShell.commShell.processDone(b.getCompletionStatus()))};this.getCompletionStatus=function(){return this.getDivWrap()?this.getDivWrap().getAttribute("data-ctat-completion-status"):""};this.setCompletionStatus=function(b){this.getDivWrap()&&this.getDivWrap().setAttribute("data-ctat-completion-status",
String(b));return this}};CTATDoneButton.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTATDoneButton.prototype.constructor=CTATDoneButton;CTAT.ComponentRegistry.addComponentType("CTATDoneButton",CTATDoneButton);var CTATDragNDrop=function(){CTAT.Component.Base.Tutorable.call(this,"CTATDragNDrop","aDnD");this.setParameterHandler("groupname",function(b){this.getDivWrap()&&$(this.getDivWrap()).attr("name",b)});this.set_child_limit=function(b){b=parseInt(b);isNaN(b)||$(this.component).attr("data-ctat-max-cardinality",b)};this.setParameterHandler("MaxObjects",this.set_child_limit);this.get_child_limit=function(){var b=parseInt($(this.component).attr("data-ctat-max-cardinality"));return isNaN(b)?-1:b};var a=function(b){return b.split("").reduce(function(b,
a){b=(b<<5)-b+a.charCodeAt(0);return b&b},0)},f=function(b){var c=$(this).parent().attr("name"),d=$(this).parent().attr("id");b.dataTransfer.setData("ctat/group",c);b.dataTransfer.setData("ctat/source",d);b.dataTransfer.setData("text",this.id);var e=a(this.id);CTATDragNDrop.dragging[e]={id:this.id,group:c,source:d};b.dataTransfer.setData("ctat/id/"+e,e)},g=function(b){for(var a,c=0;c<b.dataTransfer.types.length;c++)if(a=/^ctat\/id\/(.+)$/.exec(b.dataTransfer.types[c]))a=a[1],CTATDragNDrop.dragging.hasOwnProperty(a)&&
delete CTATDragNDrop.dragging[a]},e=null;this.init=function(){e=this.getDivWrap();if(!$(e).attr("name")){var b=CTATDragNDrop.default_groupname;this.getComponentGroup()&&(b=this.getComponentGroup());$(e).attr("name",b)}this.setComponent(e);CTATComponentReference.add(this,e);CTATConfiguration.get("previewMode")||$(e).children().addClass("CTATDragNDrop--item").attr({unselectable:"on",draggable:!0}).each(function(){this.id||(this.id=CTATGlobalFunctions.gensym.div_id());this.addEventListener("dragstart",
f,!1);this.addEventListener("dragend",g,!1)});this.component.addEventListener("dragover",function(b){var a=!1;if($(this).data("CTATComponent").getEnabled()){var c=parseInt($(this).attr("data-ctat-max-cardinality"));if((isNaN(c)||0>c||$(this).children().length<c)&&(new Set(b.dataTransfer.types)).has("ctat/group"))if(b.dataTransfer.getData("text"))b.dataTransfer.getData("ctat/group")===$(this).attr("name")&&b.dataTransfer.getData("ctat/source")!==this.id&&(a=!0);else for(var d,c=0;c<b.dataTransfer.types.length;c++)if(d=
/^ctat\/id\/(.+)$/.exec(b.dataTransfer.types[c]))d=d[1],CTATDragNDrop.dragging.hasOwnProperty(d)&&CTATDragNDrop.dragging[d].group===$(this).attr("name")&&CTATDragNDrop.dragging[d].source!==this.id&&(a=!0)}a&&(b.preventDefault(),b.dataTransfer.effectAllowed="move",b.dataTransfer.dropEffect="move",this.classList.add("CTATDragNDrop--valid-drop"))},!1);this.component.addEventListener("drop",function(b){b.preventDefault();this.classList.remove("CTATDragNDrop--valid-drop");var a=$(this).data("CTATComponent");
if(a.getEnabled()){var c=b.dataTransfer.getData("text");b.dataTransfer.getData("ctat/source");b=document.getElementById(c);this.appendChild(b);$("#"+c).removeClass("CTAT--correct CTAT--incorrect CTAT--hint");a.setActionInput("Add",c);a.processAction()}},!1);this.component.addEventListener("dragleave",function(b){this.classList.remove("CTATDragNDrop--valid-drop")},!1);this.setInitialized(!0)};this.getConfigurationActions=function(){var b=[],a=[];$(this.component).children().each(function(){a.push($(this).attr("id"))});
if(0<a.length){var c=new CTATSAI;c.setSelection(this.getName());c.setAction("SetChildren");c.setInput(a.sort().join(";"));b.push(c)}return b};var c=this.setEnabled;this.setEnabled=function(b){c(b);e&&($(e).children().attr("draggable",b),this.getDisableOnCorrect()&&$(e).find(".CTAT--correct").attr("draggable",!1))};this.Add=function(b){b=$("#"+b);0<b.length&&b.appendTo(this.getDivWrap());$(b).hasClass("CTATDragNDrop--item")||($(b).addClass("CTATDragNDrop--item").attr({unselectable:"on",draggable:!0}),
b.addEventListener("dragstart",f,!1),b.addEventListener("dragend",g,!1))};this.SetChildren=function(b){b.split(";").forEach(function(b){this.Add(b)},this)};this.updateSAI=function(){var b=[];$(this.component).children().each(function(){b.push($(this).attr("id"))});this.setActionInput("SetChildren",b.sort().join(";"))};var b=this.showCorrect.bind(this);this.showCorrect=function(a){switch(a.getAction()){case "Add":this.setEnabled(!0);a=a.getInput();$("#"+a).addClass("CTAT--correct");this.getDisableOnCorrect()&&
$("#"+a).attr("draggable",!1);break;default:b(a)}};var d=this.showInCorrect.bind(this);this.showInCorrect=function(b){switch(b.getAction()){case "Add":b=b.getInput();$("#"+b).addClass("CTAT--incorrect");break;default:d(b)}}};CTATDragNDrop.dragging={};CTATDragNDrop.default_groupname="DragNDropGroup";CTATDragNDrop.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATDragNDrop.prototype.constructor=CTATDragNDrop;CTAT.ComponentRegistry.addComponentType("CTATDragNDrop",CTATDragNDrop);var CTATDragSource=function(){CTAT.Component.Base.Tutorable.call(this,"CTATDragSource","aDnD");this.setParameterHandler("groupname",function(b){this.getDivWrap()&&$(this.getDivWrap()).attr("name",b)});this.set_child_limit=function(b){b=parseInt(b);isNaN(b)||$(this.component).attr("data-ctat-max-cardinality",b)};this.setParameterHandler("MaxObjects",this.set_child_limit);this.get_child_limit=function(){var b=parseInt($(this.component).attr("data-ctat-max-cardinality"));return isNaN(b)?-1:b};this.set_child_overflow=
function(b){b=parseInt(b);isNaN(b)||$(this.component).attr("data-ctat-max-overflow",b)};this.setParameterHandler("MaxOverflow",this.set_child_overflow);this.get_child_overflow=function(){var b=parseInt($(this.component).attr("data-ctat-max-overflow"));return isNaN(b)?-1:b};this.set_purpose=function(b){b?$(this.component).attr("data-ctat-purpose",b):$(this.component).attr("data-ctat-purpose","destination")};this.setParameterHandler("Purpose",this.set_purpose);this.get_purpose=function(){return $(this.component).attr("data-ctat-purpose")?
$(this.component).attr("data-ctat-purpose"):"destination"};var a=function(b){return b.split("").reduce(function(b,a){b=(b<<5)-b+a.charCodeAt(0);return b&b},0)},f=function(b){var c=$(this).parent().attr("name"),d=$(this).parent().attr("id");b.dataTransfer.setData("ctat/group",c);b.dataTransfer.setData("ctat/source",d);b.dataTransfer.setData("original",this.id);if("source"===$("#"+d).attr("data-ctat-purpose")){var e=this.id+"--"+CTATGlobalFunctions.gensym.div_id().slice(7);b.dataTransfer.setData("text",
e);var g=a(e);b.dataTransfer.setData("ctat/id/"+g,g);CTATDragSource.dragging[g]={id:e,group:c,source:d}}else b.dataTransfer.setData("text",this.id),g=a(this.id),b.dataTransfer.setData("ctat/id/"+g,g),CTATDragSource.dragging[g]={id:this.id,group:c,source:d}},g=function(b){for(var a,c=0;c<b.dataTransfer.types.length;c++)if(a=/^ctat\/id\/(.+)$/.exec(b.dataTransfer.types[c]))a=a[1],CTATDragSource.dragging.hasOwnProperty(a)&&delete CTATDragSource.dragging[a]},e=this;e.setDisabled=function(b){try{if("button"!==
b.type&&(b.disabled=!0),0<b.children.length)for(var a=0;a<b.children.length;a++)e.setDisabled(b.children[a])}catch(p){}};e.removeDisabled=function(b){b.disabled=!1;if(0<b.children.length)for(var a=0;a<b.children.length;a++)e.removeDisabled(b.children[a])};e.animatedRemove=function(b){$("#"+b).animate({opacity:.1,zoom:1.3},500,"swing",function(){var a=document.getElementById(b);a.parentNode.removeChild(a)})};var c=null;this.init=function(){c=this.getDivWrap();if(!$(c).attr("name")){var b=CTATDragSource.default_groupname;
this.getComponentGroup()&&(b=this.getComponentGroup());$(c).attr("name",b)}this.setComponent(c);CTATComponentReference.add(this,c);CTATConfiguration.get("previewMode")||$(c).children().addClass("CTATDragSource--item").attr({unselectable:"on",draggable:!0}).each(function(){this.id||(this.id=CTATGlobalFunctions.gensym.div_id());this.addEventListener("dragstart",f,!1);this.addEventListener("dragend",g,!1)});"source"===c.getAttribute("data-ctat-purpose")&&(window.onload=function(){e.setDisabled(c)});
this.component.addEventListener("dragover",function(b){var a=!1;if($(this).data("CTATComponent").getEnabled()){var c=parseInt($(this).attr("data-ctat-max-cardinality"));if((isNaN(c)||0>c||$(this).children().length<c)&&(new Set(b.dataTransfer.types)).has("ctat/group"))if(b.dataTransfer.getData("text"))b.dataTransfer.getData("ctat/group")===$(this).attr("name")&&b.dataTransfer.getData("ctat/source")!==this.id&&(a=!0);else for(var d,c=0;c<b.dataTransfer.types.length;c++)if(d=/^ctat\/id\/(.+)$/.exec(b.dataTransfer.types[c]))d=
d[1],CTATDragSource.dragging.hasOwnProperty(d)&&CTATDragSource.dragging[d].group===$(this).attr("name")&&CTATDragSource.dragging[d].source!==this.id&&(a=!0)}"source"===$(b.target).attr("data-ctat-purpose")&&(a=!1);a&&(b.preventDefault(),b.dataTransfer.effectAllowed="move",b.dataTransfer.dropEffect="move",this.classList.add("CTATDragSource--valid-drop"))},!1);this.component.addEventListener("drop",function(b){b.preventDefault();this.classList.remove("CTATDragSource--valid-drop");var a=$(this).data("CTATComponent");
if(a.getEnabled()){var c=b.dataTransfer.getData("text"),d;document.getElementById(c)&&(d=document.getElementById(c),this.appendChild(d));if(!document.getElementById(c)){b=document.getElementById(b.dataTransfer.getData("original"));d=b.cloneNode(!1);this.append(d);d.id=c;d.addEventListener("dragstart",f,!1);d.addEventListener("dragend",g,!1);var h,l=/(CTAT[A-z]*)(\s|$)/g.exec(d.className);if(l)for(var n=0;n<l.length;n++)CTAT.ComponentRegistry[l[n]]&&(h=l[n]);h&&CTATTutor.initializeHTMLComponent(d,
h);d.setAttribute("draggable",!0);d.setAttribute("unselectable","on");h=b.childNodes.length;l=d.childNodes.length;b.classList.remove("CTAT--correct");b.classList.remove("CTAT--incorrect");b.classList.remove("CTAT--hint");if(l===h)for(n=0;n<l;n++)d.childNodes[n].setAttribute("class",b.childNodes[n].className),d.childNodes[n].setAttribute("value",b.childNodes[n].value),d.childNodes[n].innerHTML=b.childNodes[n].innerHTML;if(h!==l){for(;d.hasChildNodes();)d.removeChild(d.lastChild);for(n=0;n<h;n++)d.appendChild(b.childNodes[n].cloneNode(!0))}}"trashcan"===
$(this).attr("data-ctat-purpose")&&this.removeChild(d);"source"===$(this).attr("data-ctat-purpose")&&this.removeChild(d);"destination"!==$(this).attr("data-ctat-purpose")&&$(this).attr("data-ctat-purpose")||($("#"+d.id).removeClass("CTAT--correct CTAT--incorrect CTAT--hint"),e.removeDisabled(d),a.setActionInput("Add",c),a.processAction(),null!==$(this).attr("data-ctat-max-overflow")&&this.childNodes.length>$(this).attr("data-ctat-max-overflow")&&e.animatedRemove(this.firstChild.id))}},!1);this.component.addEventListener("dragleave",
function(b){this.classList.remove("CTATDragSource--valid-drop")},!1);this.setInitialized(!0)};this.getConfigurationActions=function(){var b=[],a=[];$(this.component).children().each(function(){a.push($(this).attr("id"))});if(0<a.length){var c=new CTATSAI;c.setSelection(this.getName());c.setAction("SetChildren");c.setInput(a.sort().join(";"));b.push(c)}return b};var b=this.setEnabled;this.setEnabled=function(a){b(a);c&&($(c).children().attr("draggable",a),this.getDisableOnCorrect()&&$(c).find(".CTAT--correct").attr("draggable",
!1))};this.Add=function(b){b=$("#"+b);0<b.length&&b.appendTo(this.getDivWrap());$(b).hasClass("CTATDragSource--item")||($(b).addClass("CTATDragSource--item").attr({unselectable:"on",draggable:!0}),b.addEventListener("dragstart",f,!1),b.addEventListener("dragend",g,!1))};this.SetChildren=function(b){b.split(";").forEach(function(b){this.Add(b)},this)};this.updateSAI=function(){var b=[];$(this.component).children().each(function(){b.push($(this).attr("id"))});this.setActionInput("SetChildren",b.sort().join(";"))};
var d=this.showCorrect.bind(this);this.showCorrect=function(b){switch(b.getAction()){case "Add":this.setEnabled(!0);b=b.getInput();$("#"+b).addClass("CTAT--correct");this.getDisableOnCorrect()&&$("#"+b).attr("draggable",!1);break;default:d(b)}};var h=this.showInCorrect.bind(this);this.showInCorrect=function(b){switch(b.getAction()){case "Add":b=b.getInput();$("#"+b).addClass("CTAT--incorrect");break;default:h(b)}}};CTATDragSource.dragging={};CTATDragSource.default_groupname="DragNDropGroup";
CTATDragSource.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATDragSource.prototype.constructor=CTATDragSource;CTAT.ComponentRegistry.addComponentType("CTATDragSource",CTATDragSource);var CTATElement=function(a,f,g,e,c){CTAT.Component.Base.SAIHandler.call(this,"CTATElement","__undefined__",a,f,g,e,c);CTATConfiguration.get("previewMode");this.setStyleHandler("inspBackgroundColor",null);this.setStyleHandler("BackgroundColor",null);this.setStyleHandler("DrawBorder",null);this.setStyleHandler("showBorder",null);this.setStyleHandler("BorderColor",null);this.setStyleHandler("TextAlign",null);var b=this;this.setStyleHandler("labelPlacement",null);this.init=function(){b.setInitialized(!0);
console.log("CTATElement.init() typeof getDivWrap()",typeof b.getDivWrap(),b.getDivWrap());b.ctatdebug("Final location: "+b.getX()+","+b.getY()+" with text: "+b.getText());b.addComponentReference(b,b.getDivWrap())};this.resize=function(){var b=$(this.getDivWrap()).height();$(label).css("font-size",b-5+"px");$(this.getComponent()).css("height",b-10+"px");$(this.getComponent()).css("width",b-10+"px")};this.getConfigurationActions=function(){return[]}};CTATElement.prototype=Object.create(CTAT.Component.Base.SAIHandler.prototype);
CTATElement.prototype.constructor=CTATElement;CTAT.ComponentRegistry.addComponentType("CTATElement",CTATElement);CTAT.Math={LeastCommonMultiple:function(a,f){return a*f/CTAT.Math.GreatestCommonDivisor(a,f)},GreatestCommonDivisor:function(a,f){if(0>a||0>f)return CTAT.Math.GreatestCommonDivisor(Math.abs(a),Math.abs(f));if(1===a||1===f)return 1;if(0===a)return f;if(0===f)return a;var g=function(a,c){return c?g(c,a%c):a};return g(a,f)},round10:function(a,f){if("undefined"===typeof f||0===Number(f))return Math.round(a);a=Number(a);f=Number(f);if(isNaN(a)||"number"!==typeof f||0!==f%1)return NaN;a=a.toString().split("e");
a=Math.round(Number(a[0])+"e"+(a[1]?Number(a[1])-f:-f));a=a.toString().split("e");return Number(a[0]+"e"+(a[1]?Number(a[1])+f:f))},precision:4,round:function(a){return CTAT.Math.round10(a,-CTAT.Math.precision)},rad2deg:function(a){return CTAT.Math.round(180*a/Math.PI)},deg2rad:function(a){return a*Math.PI/180}};CTAT.Math.Fraction=function(a,f){this._numerator=0;this._denominator=1;this.set(a,f)};
CTAT.Math.Fraction.prototype=Object.create(CTAT.Math.Fraction.prototype,{numerator:{get:function(){return this._numerator},set:function(a){this._numerator=a}},denominator:{get:function(){return this._denominator},set:function(a){this._denominator=a}},toString:{value:function(){return 1===this.denominator?String(this._numerator):String(this._numerator)+"/"+String(this._denominator)}},valueOf:{value:function(){return this.numerator/this.denominator}},fromString:{value:function(a){var f=a.match(/(\d*\.?\d*)\s*\/\s*(\d*\.?\d*)/);
f?(this._numerator=Number(f[1]),this._denominator=Number(f[2])):this.fromValue(a)}},fromValue:{value:function(a){this._numerator=Number(a.valueOf());this._denominator=1}},toMathML:{value:function(){var a=document.createElementNS("http://www.w3.org/1998/Math/MathML","math"),f=document.createElementNS("http://www.w3.org/1998/Math/MathML","mn");f.textContent=this.numerator;if(1==this.denominator)a.appendChild(f);else{var g=document.createElementNS("http://www.w3.org/1998/Math/MathML","mfrac"),e=document.createElementNS("http://www.w3.org/1998/Math/MathML",
"mrow");e.appendChild(f);g.appendChild(e);f=document.createElementNS("http://www.w3.org/1998/Math/MathML","mrow");e=document.createElementNS("http://www.w3.org/1998/Math/MathML","mn");e.textContent=this.denominator;f.appendChild(e);g.appendChild(f);a.appendChild(g)}return a}},is_proper:{get:function(){return Math.abs(this._numerator)<Math.abs(this._denominator)}},whole_part:{get:function(){return Math.floor(this.valueOf())}},remainder_part:{get:function(){return new CTAT.Math.Fraction(this._numerator%
this._denominator,this._denominator)}},set_denominator:{value:function(a){this._numerator=this.numerator*a/this.denominator;1E-9>Math.abs(this.numerator-Math.round(this.numerator))&&(this.numerator=Math.round(this.numerator));this._denominator=a;return this}},scale:{value:function(a){this._numerator*=a;this._denominator=0===a?1:Math.abs(this._denominator*a)}},set:{value:function(a,f){this._numerator=0;this._denominator=1;"undefined"!==typeof a&&f?(this.numerator="number"===typeof a?a:"string"===typeof a?
Number(a):a?a.valueOf():0,this.denominator="number"===typeof f?f:"string"===typeof f?Number(f):f.valueOf()):a&&(a instanceof CTAT.Math.Fraction?(this.numerator=a.numerator,this.denominator=a.denominator):"number"===typeof a?(this.numerator=a,this.denominator=1):"string"===typeof a?this.fromString(a):(this.numerator=a?a.valueOf():0,this.denominator=1));isNaN(this._numerator)&&(this._numerator=0);isNaN(this._denominator)&&(this._denominator=1);return this}},reduce:{value:function(){var a=CTAT.Math.GreatestCommonDivisor(this.numerator,
this.denominator);this._numerator/=a;this._denominator/=a;return this}},reduced:{value:function(){var a=new CTAT.Math.Fraction(this);a.reduce();return a}},reciprocal:{value:function(){return new CTAT.Math.Fraction(this.denominator,this.numerator)}},negative:{value:function(){return new CTAT.Math.Fraction(-this.numerator,this.denominator)}},add:{value:function(a){var f=new CTAT.Math.Fraction;a instanceof CTAT.Math.Fraction?0===this.numerator||isNaN(this.numerator)?f.set(a.numerator,a.denominator):
0===a.numerator||isNaN(a.numerator)?f.set(this.numerator,this.denominator):this.denominator==a.denominator?f.set(this.numerator+a.numerator,this.denominator):(f.set(this.numerator*a.denominator+a.numerator*this.denominator,this.denominator*a.denominator),f.reduce()):"string"===typeof a?(a=new CTAT.Math.Fraction(a),f=this.add(a)):f.set(a.valueOf()*this.denominator+this.numerator,this.denominator);return f}},subtract:{value:function(a){return a instanceof CTAT.Math.Fraction?this.add(a.negative()):"string"===
typeof a?(a=new CTAT.Math.Fraction(a),this.add(a.negative())):this.add(-a.valueOf())}},multiply:{value:function(a){a instanceof CTAT.Math.Fraction?(a=new CTAT.Math.Fraction(this.numerator*a.numerator,this.denominator*a.denominator),a.reduce()):"string"===typeof a?(a=new CTAT.Math.Fraction(a),a=this.multiply(a)):(a=new CTAT.Math.Fraction(a.valueOf()*this.numerator,this.denominator),a.reduce());return a}},divide:{value:function(a){return a instanceof CTAT.Math.Fraction?this.multiply(a.reciprocal()):
"string"===typeof a?(a=new CTAT.Math.Fraction(a),this.multiply(a.reciprocal())):this.multiply(new CTAT.Math.Fraction(1,a.valueOf()))}},equals:{value:function(a){return CTAT.Math.round(this.valueOf())===CTAT.Math.round(a.valueOf())}},deepEquals:{value:function(a){return a instanceof CTAT.Math.Fraction&&this.numerator===a.numerator&&this.denominator===a.denominator}},clone:{value:function(){return new CTAT.Math.Fraction(this.numerator,this.denominator)}}});
CTAT.Math.Fraction.FromString=function(a){var f=new CTAT.Math.Fraction;f.setFromString(String(a));return f};CTAT.Math.Fraction.FromNumber=function(a){a=new CTAT.Math.Fraction(a);a.reduce();return a};CTAT.Math.Fraction.Sum=function(){for(var a=new CTAT.Math.Fraction,f=0;f<arguments.length;f++)a=a.add(arguments[f]);return a};CTAT.Math.Fraction.Product=function(){for(var a=new CTAT.Math.Fraction(1,1),f=0;f<arguments.length;f++)a=a.multiply(arguments[f]);return a};CTAT.Component.Base.SVG=function(a,f,g,e,c,b,d){CTAT.Component.Base.Clickable.call(this,a,f,g,e,c,b,d);var h=null;this.initSVG=function(){this.setInitialized(!0);var b=CTATGlobals.NameSpace.svg,a=CTATGlobals.NameSpace.xml,c=CTATGlobals.NameSpace.xlink,d=CTATGlobals.NameSpace.ev,e=document.createDocumentFragment();h=document.createElementNS(b,"svg");e.appendChild(h);h.classList.add("CTAT-gen-component");h.classList.add("CTAT-svg");h.classList.add("unselectable");h.setAttributeNS(a,"xmlns",b);h.setAttributeNS(a,
"xmlns:xlink",c);h.setAttributeNS(a,"xmlns:ev",d);b=document.createElementNS(b,"defs");h.appendChild(b);this.getDivWrap().appendChild(e);this.setComponent(h)};this.genName=function(b){return this.getName()+"_"+b};this.getBoundingBox=function(){var b=new DOMRect(0,0,this.getWidth(),this.getHeight()),a=this.getComponent(),c=window.getComputedStyle(a),a=parseInt(c.getPropertyValue("padding-left")),d=parseInt(c.getPropertyValue("padding-right")),e=parseInt(c.getPropertyValue("padding-bottom")),g=parseInt(c.getPropertyValue("padding-right")),
f=parseInt(c.getPropertyValue("border-left-width")),h=parseInt(c.getPropertyValue("border-right-width")),B=parseInt(c.getPropertyValue("border-bottom-width")),c=parseInt(c.getPropertyValue("border-right-width"));b.width-=a+g+f+c;b.height-=d+e+h+B;return b}};CTAT.Component.Base.SVG.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTAT.Component.Base.SVG.prototype.constructor=CTAT.Component.Base.SVG;CTAT.Component.Base.UnitDisplay=function(a,f,g,e,c,b,d){CTAT.Component.Base.SVG.call(this,a,f,g,e,c,b,d);var h="1/2+1/4+(0*1/8)";this.setActionInput("SetPieces",h);var n="#800080";this.color=n;var l=1;this.colorAlpha=l;var p="#800080";this.deselectedColor=p;var m=.3;this.deselectedColorAlpha=m;var q="black";this.piece_border_color=q;this.piece_border_thickness=1;this.getPieceBorderColor=function(){return q};this.setPieceBorderColor=function(b){q=CTATGlobalFunctions.formatColor(b);return this};var u=
[],v=this;this.generateClassname=function(){return this.getName()+" UnitPart"};this.getPieces=function(){return u};var w=function(b){if(b.hasAttributeNS(null,"data-selected"))return CTATGlobalFunctions.toBoolean(b.getAttributeNS(null,"data-selected"));b.setAttributeNS(null,"data-selected",!0);return!0};this.getPiecesBySelected=function(b){for(var a=this.getPieces(),c=[],d,e=0;e<a.length;e++)d=a[e],w(d)===b&&c.push(d);return c};this.getSelectedPieces=this.getPiecesBySelected.bind(this,!0);this.getDeselectedPieces=
this.getPiecesBySelected.bind(this,!1);this.getColor=function(){return n};this.getColorAlpha=function(){return l};this.getDeselectedColor=function(){return p};this.getDeselectedColorAlpha=function(){return m};this.setColor=function(b){this.color=n=CTATGlobalFunctions.formatColor(b);b=this.getSelectedPieces();for(var a=0;a<b.length;a++)$(b[a]).css("fill",n)};this.setColorAlpha=function(b){l=Number(b);this.colorAlpha=l=isNaN(l)?1:l;b=this.getSelectedPieces();for(var a=0;a<b.length;a++)$(b[a]).css("fill-opacity",
l)};this.setDeselectedColor=function(b){this.deselectedColor=p=CTATGlobalFunctions.formatColor(b);b=this.getDeselectedPieces();for(var a=0;a<b.length;a++)$(b[a]).css("fill",n)};this.setDeselectedColorAlpha=function(b){m=Number(b);isNaN(m)&&(m=.3);this.deselectedColorAlpha=m;b=this.getDeselectedPieces();for(var a=0;a<b.length;a++)$(b[a]).css("fill-opacity",m)};this.valueOf=function(){return this.evaluate()};this.getValue=function(){return h};this.setValue=function(b){h=String(b);this.setInput(h);this.clear();
this.drawPieces();return h};this.setParameterHandler("Value",this.setValue);this.data_ctat_handlers.value=function(b){this.setValue(b)};this.drawPieces=function(){};this.evaluate=function(){return this.parseValue().reduce(function(b,a){return a.selected?b.add(a):b},new CTAT.Math.Fraction)};this.numActive=function(){return this.getSelectedPieces().length};this.parseValue=function(){var b=[];h.split("+").forEach(function(a){var c=!0;-1!=a.search(/(\(\s*0\s*\*)|(\*\s*0\s*\))/)&&(c=!1,a=a.replace(/(\(\s*0\s*\*)|(\*\s*0\s*\))/,
""),a=a.replace(/[() ]/g,""));a=new CTAT.Math.Fraction(a);a.selected=c;0<a&&b.push(a);return a});return b};this.updateValue=function(){return h=this.getPieces().map(function(b){return F(b.getAttributeNS(null,"data-value"),CTATGlobalFunctions.toBoolean(b.getAttributeNS(null,"data-selected")))}).join("+")};var B=function(b,a){a=CTATGlobalFunctions.toBoolean(a);CTATGlobalFunctions.toBoolean(b.getAttributeNS(null,"data-selected"));!0===a?(b.setAttributeNS(null,"data-selected",!0),$(b).css("fill",v.color),
$(b).css("fill-opacity",v.colorAlpha)):($(b).css("fill",v.deselectedColor),$(b).css("fill-opacity",v.deselectedColorAlpha),b.setAttributeNS(null,"data-selected",!1))};this.clickHandler=function(b){!0===v.getEnabled()&&(b=CTATGlobalFunctions.toBoolean(this.getAttributeNS(null,"data-selected")),B(this,!b),v.setActionInput("SetPieces",v.updateValue()),v.processAction())};this.updateSAI=function(){v.setActionInput("SetPieces",v.updateValue())};this.addPieceElem=function(b,a,c){b.setAttributeNS(null,"data-selected",
c);b.setAttributeNS(null,"data-value",a.toString());b.dataValue=a;this.getEnabled()&&(b.style.cursor="pointer");b.addEventListener("click",this.clickHandler);u.push(b)};var C=this.setEnabled;this.setEnabled=function(b){C(b);u.forEach(function(a){a.style.cursor=b?"pointer":"default"})};this.clear=function(){u=[]};var F=function(b,a){b=b.toString();!1===a&&(b="(0*"+b+")");return b};this.AddPiece=function(b,a){if(b&&(b=new CTAT.Math.Fraction(b),0<CTAT.Math.round(b.valueOf()))){var c=h.split("+");c.push(F(b,
a));v.setValue(c.join("+"))}};this.AddToValue=function(b,a){if(b&&(b=new CTAT.Math.Fraction(b),0<CTAT.Math.round(b.valueOf()))){var c=h.split("+");c.push(F(b,a));h=c.join("+")}return h};var G=-1,H=function(b){isNaN(b)&&this.get_denominator();b=Math.max(b,1);1<G&&(b=Math.min(b,G));return b}.bind(this);this.set_max_denominator=function(b){b=parseInt(b);isNaN(b)||(G=b)};this.set_denominator=function(b){v.setHintHighlight(!1);var a="string"===typeof b?parseInt(b):b;if(!isNaN(a)&&(a=H(a),this.get_denominator()!=
b)){var c=v.evaluate();v.clear();b=[];c.set_denominator(a);for(var d=new CTAT.Math.Fraction(1,a),e=Math.floor(c.numerator),g=a-e,f=0;f<e;f++)b.push(F(d,!0));a=new CTAT.Math.Fraction(c.numerator-e,a);a.equals(0)||(b.push(F(a,!0)),b.push(F(d.subtract(a),!1)),g--);for(a=0;a<g;a++)b.push(F(d,!1));this.setValue(b.join("+"));v.setActionInput("SetPieces",h);v.processAction();return h}};this.get_denominator=function(){return u.reduce(function(b,a,c,d){return Math.min(b,a.dataValue.denominator)},Infinity)};
this.change_denominator=function(b){return this.set_denominator(this.get_denominator()+Number(b))};this.set_number_pieces=function(b){v.setHintHighlight(!1);b="string"===typeof b?parseInt(b):b;if(!isNaN(b)){b=H(b);var a=v.numActive();v.clear();for(var c=[],d=new CTAT.Math.Fraction(1,b),e=0;e<b;e++)c.push(F(d,0<a)),a--;this.setValue(c.join("+"));v.setActionInput("SetPieces",h);v.processAction();return h}};this.change_number_pieces=function(b){this.set_number_pieces(u.length+b)};this.set_numerator=
function(b){return this.change_numerator(b-this.getSelectedPieces().length)};this.change_numerator=function(b){0!==b&&(0<b?u.every(function(a){!1===w(a)&&(B(a,!0),b--);return 0<b}):(u.reverse(),u.every(function(a){!0===w(a)&&(B(a,!1),b++);return 0>b}),u.reverse()))};this.SetPieces=function(b){v.setValue(b)};g=function(b){return(b=$(this.getDivWrap()).attr(b))?b.split(/\s*;\s*/).map(function(b){return b.trim()}):[]};a=g.bind(this,"data-ctat-ctrl-denominator");f=g.bind(this,"data-ctat-ctrl-partition");
g=g.bind(this,"data-ctat-ctrl-numerator");e=function(b,a){return 0<=b().indexOf(a)};var E=e.bind(null,a),D=e.bind(null,f),K=e.bind(null,g),J=function(b){var a=null;if(b instanceof CTAT.Component.Base.Tutorable)b!=this&&(a=b.getName());else if(b instanceof CTATSAI)b.getSelection()!=v.getName()&&(a=b.getSelection());else if(b instanceof String)b!=v.getName()&&(a=b);else if(b instanceof Element)b!=v.getComponent()&&(a=b.id);else return null;if(a){if(E(a))return r.bind(this,this.change_denominator,this.set_denominator);
if(K(a))return r.bind(this,this.change_numerator,this.set_numerator);if(D(a))return r.bind(this,this.change_number_pieces,this.set_number_pieces)}return null}.bind(this);a=CTAT.Component.Base.Tutorable.EventType;CTATConfiguration.get("previewMode")||document.addEventListener(a.action,function(b){var a=b.detail.sai;b=J(b.detail.component);a&&null!==b&&b(a)},!1);var r=function(b,a,c){var d=parseInt(c.getInput());if(!isNaN(d)){switch(c.getAction()){case "ButtonPressed":b.call(this,d);break;case "Update":case "UpdateTextField":case "UpdateTextArea":a.call(this,
d)}this.updateSAI();this.processAction()}};this.setNumeratorControllers=function(b){this.getDivWrap().setAttribute("data-ctat-ctrl-numerator",b);return this};this.setParameterHandler("NumeratorControllers",this.setNumeratorControllers);this.setDenominatorControllers=function(b){this.getDivWrap().setAttribute("data-ctat-ctrl-denominator",b);return this};this.setParameterHandler("DenominatorControllers",this.setDenominatorControllers);this.setPartitionControllers=function(b){this.getDivWrap().setAttribute("data-ctat-ctrl-partition",
b);return this};this.setParameterHandler("PartitionControllers",this.setPartitionControllers);this.getConfigurationActions=function(){var b=this.getDivWrap().getAttribute("data-ctat-value");if(b){var a=new CTATSAI;a.setSelection(this.getName());a.setAction("SetPieces");a.setInput(b);return[a]}this.updateSAI();return[this.getSAI()]}};CTAT.Component.Base.UnitDisplay.prototype=Object.create(CTAT.Component.Base.SVG.prototype);CTAT.Component.Base.UnitDisplay.prototype.constructor=CTAT.Component.Base.UnitDisplay;var CTATFractionBar=function(a,f,g,e,c){CTAT.Component.Base.UnitDisplay.call(this,"CTATFractionBar","aFractionBar",a,f,g,e,c);var b=CTATGlobals.NameSpace.svg;this.init=function(){this.initSVG();this.baseGroup=document.createElementNS(b,"g");this.getComponent().appendChild(this.baseGroup);this.getComponent().classList.add("CTATFractionBar--container");this.drawPieces();this.addComponentReference(this,this.getDivWrap());this.component.addEventListener("focus",this.processFocus)};this.render=function(){this.drawPieces()};
this.drawPieces=function(){if(this.baseGroup){this.clear();for(var a=this.parseValue(),c=0,e=document.createDocumentFragment(),g=0;g<a.length;g++){var f=a[g],m=100*f,q=document.createElementNS(b,"rect");q.classList.add("CTATFractionBar--piece");q.setAttributeNS(null,"height","100%");q.setAttributeNS(null,"width",m+"%");q.setAttributeNS(null,"y",0);q.setAttributeNS(null,"x",c+"%");this.addPieceElem(q,f,f.selected);e.appendChild(q);var u=document.createElementNS(b,"text");u.classList.add("CTATFractionBar--label");
u.setAttributeNS(null,"text-anchor","middle");u.setAttributeNS(null,"dominant-baseline","middle");e.appendChild(u);var q=""+String(f.numerator),f=""+String(f.denominator),v=document.createElementNS(b,"tspan"),w=document.createElementNS(b,"tspan");v.appendChild(document.createTextNode(q));w.appendChild(document.createTextNode(f));u.appendChild(v);u.appendChild(w);u=c+m/2;v.setAttributeNS(null,"x",u+"%");v.setAttributeNS(null,"y","60%");v.setAttributeNS(null,"dy","-1em");w.setAttributeNS(null,"x",u+
"%");w.setAttributeNS(null,"y","60%");q.length>f.length?v.style.textDecoration="underline":w.style.textDecoration="overline";c+=m}this.baseGroup.innerHTML="";this.baseGroup.appendChild(e);var B=this.baseGroup.getBBox().width-1;Array.prototype.slice.call(this.baseGroup.childNodes).forEach(function(b){if("rect"==b.nodeName){var a=window.getComputedStyle(b),c=parseFloat(a.getPropertyValue("padding-left")),d=parseFloat(a.getPropertyValue("stroke-width")),a=b.getBBox();b.setAttributeNS(null,"y",a.y+d/
2);b.setAttributeNS(null,"height",a.height-d);var e=a.x+d/2,d=a.width-d;1>a.x?d-=c/2:(e+=c/2,d=a.x+a.width>=B?d-c/2:d-c);b.setAttributeNS(null,"x",e);b.setAttributeNS(null,"width",d)}})}};this.setShowFractionLabel=function(b){};this.setStyleHandler("showFractionLabel",this.setShowFractionLabel)};CTATFractionBar.prototype=Object.create(CTAT.Component.Base.UnitDisplay.prototype);CTATFractionBar.prototype.constructor=CTATFractionBar;CTAT.ComponentRegistry.addComponentType("CTATFractionBar",CTATFractionBar);var CTATFS={writeFile:function(a,f){return new Promise(function(g,e){return $.post(location.origin+"/writeFile?path="+a,f).done(function(a){return g(a)}).fail(function(a){return e(a)})})}};var CTATGroupingComponent=function(a,f,g,e,c){CTAT.Component.Base.SAIHandler.call(this,"CTATGroupingComponent","__undefined__",a,f,g,e,c);var b=this,d=b.executeSAI;this.isTabIndexable=!1;this.getComponentList=function(){var a=[],c=b.getDivWrap().getAttribute("data-ctat-componentlist");c&&(a=c.split(/\s*[,;]\s*/).map(function(b){return $("#"+b.trim()).data("CTATComponent")}));$(b.getDivWrap()).children(".CTATComponent").each(function(){a.push($(this).data("CTATComponent"))});return[].concat($jscomp.arrayFromIterable(new Set(a)))};
this.init=function(){b.setInitialized(!0)};this.executeSAI=function(a){b.getComponentList().forEach(function(c){c&&"function"==typeof c.executeSAI?c.executeSAI(a):b.ctatdebug("CTATGroupingComponent "+b.getName()+".executeSAI: comp doesn't implement executeSAI: "+c)});d.call(b,a)}};CTATGroupingComponent.prototype=Object.create(CTAT.Component.Base.SAIHandler.prototype);CTATGroupingComponent.prototype.constructor=CTATGroupingComponent;CTAT.ComponentRegistry.addComponentType("CTATGroupingComponent",CTATGroupingComponent);var CTATHintButton=function(a,f,g,e,c){CTAT.Component.Base.Clickable.call(this,"hint","CTATHintButton",a,f,g,e,c);this.setName("hint");this.setClassName("CTATHintButton");this.isTabIndexable=!1;this.setText(CTATGlobals.languageManager.getString("HINT"));this.setStyleHandler("BackgroundColor",null);this.setStyleHandler("TextAlign",null);this.setStyleHandler("BorderColor",null);this.setStyleHandler("FontFace",null);this.setStyleHandler("TextColor",null);this.init=function(){this.setInitialized(!0);
var b=document.createElement("button");this.setComponent(b);b.classList.add("unselectable");b.classList.add("CTAT-hint-button");var a=document.createElement("div");a.classList.add("CTAT-hint-button--icon");a.textContent="?";b.appendChild(a);this.getText()&&(a=document.createElement("div"),a.textContent=this.getText(),b.appendChild(a));this.getDivWrap().appendChild(b);b.addEventListener("mouseenter",function(b){b.target.classList.add("CTAT-hint-button--hover")});b.addEventListener("mouseleave",function(b){b.target.classList.remove("CTAT-hint-button--hover");
b.target.classList.remove("CTAT-hint-button--clicked")});b.addEventListener("mousedown",function(b){b.target.classList.add("CTAT-hint-button--clicked")});b.addEventListener("mouseup",function(b){b.target.classList.remove("CTAT-hint-button--clicked")});b.addEventListener("click",function(b){b.target.classList.remove("CTAT-hint-button--clicked")});b.addEventListener("click",this.processClick)};var b=this;this.processClick=function(a){b.getEnabled()&&CTATCommShell.commShell&&CTATCommShell.commShell.requestHint()}};
CTATHintButton.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTATHintButton.prototype.constructor=CTATHintButton;CTAT.ComponentRegistry.addComponentType("CTATHintButton",CTATHintButton);var CTATHintWindow=function(a,f,g,e,c){CTAT.Component.Base.Graphical.call(this,"CTATHintWindow","__undefined__",a,f,g,e,c);var b=this;b.isTabIndexable=!1;var d=CTATConfig.parserType_is_XML()?new CTATXML:new CTATJSON,h=new CTATTutorMessageBuilder,n=null,l=null,p=null,m=null,q=null,u=CTATGlobals.languageManager.getString("NEXT"),v=CTATGlobals.languageManager.getString("PREVIOUS"),w=null;this.data_ctat_handlers["next-content"]=function(b){w=b;m&&(m.innerHTML=b)};var B=null;this.data_ctat_handlers["previous-content"]=
function(b){B=b;p&&(p.innerHTML=b)};var C=!1;this.getCurrentHint=function(){return n.innerHTML};this.init=function(){b.ctatdebug("init ("+b.getName()+")");b.setInitialized(!0);b.setIsAbstractComponent(!0);q=this.getDivWrap();q.id||q.setAttribute("id",CTATGlobalFunctions.gensym.div_id());q.setAttribute("onkeypress","return noenter(event)");b.setComponent(q);b.addComponentReference(b,q);n=document.createElement("div");q.appendChild(n);n.classList.add("CTATHintWindow--hint-content");var a=document.createElement("div");
a.classList.add("CTATHintWindow--hint-button-area");q.appendChild(a);if(B)p=document.createElement("button"),p.classList.add("CTATHintWindow--previous"),p.innerHTML=B;else{p=document.createElement("button");p.classList.add("CTATHintWindow--previous");var c=document.createElement("span");c.classList.add("CTATHintWindow--button-icon");c.textContent="\u25c0";p.appendChild(c);v&&(c.style.cssFloat="left",p.appendChild(document.createTextNode(v)))}p.addEventListener("click",function(b){CTATShellTools.showPrevHint()},
!1);a.appendChild(p);l=document.createElement("div");l.classList.add("CTATHintWindow--hint-indicator");a.appendChild(l);w?(m=document.createElement("button"),m.classList.add("CTATHintWindow--next"),m.innerHTML=w):(m=document.createElement("button"),m.classList.add("CTATHintWindow--next"),c=document.createElement("span"),c.classList.add("CTATHintWindow--button-icon"),c.textContent="\u25b6",u&&(c.style.cssFloat="right",m.appendChild(document.createTextNode(u))),m.appendChild(c));m.addEventListener("click",
function(b){CTATShellTools.showNextHint()},!1);a.appendChild(m);var d=function(b){this.disabled=!b;b||(this.classList.remove("CTAT-hint-button--hover"),this.classList.remove("CTAT-hint-button--clicked"))};[p,m].forEach(function(b){b.setEnabled=d.bind(b);b.classList.add("CTATHintWindow--button");b.classList.add("CTAT-hint-button");b.addEventListener("mouseenter",function(b){b.target.classList.add("CTAT-hint-button--hover")});b.addEventListener("mouseleave",function(b){b.target.classList.remove("CTAT-hint-button--hover");
b.target.classList.remove("CTAT-hint-button--clicked")});b.addEventListener("mousedown",function(b){b.target.classList.add("CTAT-hint-button--clicked")});b.addEventListener("mouseup",function(b){b.target.classList.remove("CTAT-hint-button--clicked")});b.addEventListener("click",function(b){b.target.classList.remove("CTAT-hint-button--clicked")})});C="true"===q.getAttribute("data-ctat-speak-hints");CTATShellTools.registerFeedbackComponent(this,this.goNext,this.goPrevious,this.showHint,this.showFeedback);
b.ctatdebug("Disabling previous and next ...");p.setEnabled(!1);m.setEnabled(!1)};this.setStyleHandler("OuterBorderColor",this.setBorderColor);this.SetText=this.showFeedback=function(a){b.ctatdebug("showFeedback ("+a+")");a=a instanceof Array?a:[a];return this.showHint(a)};this.setEnabled=function(a){b.assignEnabled(a);null===b.getComponent()?b.ctatdebug("Error pointer.getComponent()==null"):b.getComponent().disabled=!a};this.setContent=function(b){b=CTATGlobals.languageManager.filterString(b);n&&
(n.innerHTML=b);C&&(b=new SpeechSynthesisUtterance(b),window.speechSynthesis.speak(b))};this.showHint=function(a){b.ctatdebug("showHint ()");l.innerHTML="";hints=a||[];hintIndex=0;p.setEnabled(!1);m.setEnabled(!1);hints=hints.filter(function(b){return""!==b});if(!hints||0>=hints.length)hints=[],n.innerHTML="";else for(this.setEnabled(!0),this.setContent(hints[hintIndex]),1<hints.length?(b.ctatdebug("We have more than one hint, enabling next button"),m.setEnabled(!0)):b.ctatdebug("We only have one hint, leaving next button disabled"),
a=0;a<hints.length;a++){var c=document.createElement("span");c.classList.add("CTATHintWindow--hint-indicator-bullet");c.innerHTML=0===a?"&#9679;":"&#9675;";l.appendChild(c)}};this.changeHint=function(a){this.setContent(hints[hintIndex]);var c=new CTATTutoringServiceMessageBuilder,e=CTATGuid.guid(),g="previous"===a?CTATShellTools.reservedSelections.previousButton.name:CTATShellTools.reservedSelections.nextButton.name,f=new CTATSAI(g,"ButtonPressed","-1"),c=c.createInterfaceActionMessage(e,f),f=new CTATSAI(g,
"ButtonPressed","hint request");commLoggingLibrary.logSemanticEvent(e,f,"HINT_REQUEST","");CTATCommShell.commShell.propagateShellEvent("InterfaceAction",c);g=b.getCurrentHint();e=h.createAssociatedRulesMessageForHint([g],logHintSAI,"student",null,logHintStepID,e,hints.length,hintIndex+1);e=new CTATMessage(d.parse(e));CTATCommShell.commShell.processAssociatedRules(e,"HintWindow",g);CTAT.ToolTutor.tutor&&CTAT.ToolTutor.tutor.getProblemStateSaver().appendToProblemState(c,CTATExampleTracerLink.HINT_ACTION,
CTAT.ToolTutor.tutor.getOutputStatus());CTATCommShell.commShell.propagateShellEvent("previous"===a?"PreviousPressed":"NextPressed",e)};this.goPrevious=function(){b.ctatdebug("goPrevious ()");hintIndex--;m.setEnabled(!0);0>=hintIndex?(hintIndex=0,p.setEnabled(!1)):p.setEnabled(!0);var a=l.querySelectorAll(".CTATHintWindow--hint-indicator-bullet");a[hintIndex+1].innerHTML="&#9675;";a[hintIndex].innerHTML="&#9679;";this.changeHint("previous")};this.goNext=function(){b.ctatdebug("goNext ()");hintIndex++;
p.setEnabled(!0);hintIndex>hints.length-1&&(hintIndex=hints.length-1);hintIndex>hints.length-2?m.setEnabled(!1):m.setEnabled(!0);var a=l.querySelectorAll(".CTATHintWindow--hint-indicator-bullet");a[hintIndex-1].innerHTML="&#9675;";a[hintIndex].innerHTML="&#9679;";this.changeHint("next")}};CTATHintWindow.prototype=Object.create(CTAT.Component.Base.Graphical.prototype);CTATHintWindow.prototype.constructor=CTATHintWindow;CTAT.ComponentRegistry.addComponentType("CTATHintWindow",CTATHintWindow);var CTATIFrameManager=function(){var a={},f=this;this.initFrame=function(g,e,c){var b=g?g.getAttribute("id"):null;b?a[b]={domNode:g,initialDom:e,initialMode:c}:console.error("iFrames managed by CTATIFrameManager must exist and have unique ids");g.setAttribute("data-ctat-target",c);this.writeData(g,e)};this.refresh=function(g){var e=a[g];e.domNode?(e.domNode.setAttribute("src","about:blank"),this.writeData(e.domNode,e.initialDom)):console.warn("CTATIFrameManager: iFrame id "+g+" not found")};this.writeData=
function(a,e){a&&(a=a.contentDocument||a.contentWindow.document,a.open(),a.write(e),a.close())};document.addEventListener("refreshIframe",function(a){a=a.detail;console.log("refresh event for iframe "+a);f.refresh(a)})};var CTATImageButton=function(a,f,g,e,c){CTATButtonBasedComponent.call(this,"CTATImageButton","__undefined__",a,f,g,e,c);var b=this;this.init=function(){b.setInitialized(!0);b.setComponent(b.getDivWrap());b.addComponentReference(b,b.getDivWrap());b.setImage(b.getDivWrap().getAttribute("data-ctat-image-default"));var a=b.component;a.setAttribute("role","button");a.classList.add("CTAT-button");a.addEventListener("click",b.processClick);a.addEventListener("focus",b.processFocus);a.addEventListener("mousedown",
b.processBaseMousedown);a.addEventListener("mouseup",b.processBaseMouseup);a.addEventListener("mouseover",b.processBaseMouseover);a.addEventListener("mouseout",b.processBaseMouseout)};var d=this.setEnabled;this.setEnabled=function(a){d(a);b.getEnabled()?b.setImage(b.getDivWrap().getAttribute("data-ctat-image-default")):b.setImage(b.getDivWrap().getAttribute("data-ctat-image-disabled"))};this.getConfigurationActions=function(){var b=this.getDivWrap(),a=b.getAttribute("data-ctat-image-hover"),c=b.getAttribute("data-ctat-image-clicked"),
d=b.getAttribute("data-ctat-image-default"),b=b.getAttribute("data-ctat-image-disabled");if(d){var e=new CTATSAI;e.setSelection(this.getName());a||c||b?(e.setAction("assignImages"),e.setInputArray([a,c,d,b])):(e.setAction("assignImage"),e.setInput(d));return[e]}return[]}};CTATImageButton.prototype=Object.create(CTATButtonBasedComponent.prototype);CTATImageButton.prototype.constructor=CTATImageButton;CTAT.ComponentRegistry.addComponentType("CTATImageButton",CTATImageButton);var CTATJumble=function(a,f,g,e,c){CTAT.Component.Base.Tutorable.call(this,"CTATJumble","aJumble",a,f,g,e,c);var b=this;this.setActionInput("SetOrder","");var d=null;this.init=function(){this.setInitialized(!0);d=this.getDivWrap();this.setComponent(d);this.addComponentReference(this,d);CTATConfiguration.get("previewMode")||$(d).children().addClass("CTATJumble--item").attr({unselectable:"on",draggable:!0}).each(function(){this.addEventListener("dragstart",n,!1);this.addEventListener("dragenter",p,
!1);this.addEventListener("dragover",l,!1);this.addEventListener("dragleave",m,!1);this.addEventListener("drop",q,!1);this.addEventListener("dragend",u,!1)});this.component.addEventListener("focus",this.processFocus)};this.getConfigurationActions=function(){this.updateSAI();return[this.getSAI()]};var h=null,n=function(b){/CTATJumble/.test(b.target.className)&&(b.target.classList.add("CTATJumble--item--home"),h=b.target,b.dataTransfer.effectAllowed="move",b.dataTransfer.setData("text/html",b.target.innerHTML))},
l=function(b){b.preventDefault&&b.preventDefault();b.dataTransfer.dropEffect="move";return!1},p=function(b){this.classList.add("CTATJumble--item--over")},m=function(b){this.classList.remove("CTATJumble--item--over")},q=function(a){a.stopPropagation&&a.stopPropagation();if(h&&($(d).children().removeClass("CTATJumble--item--over"),h!=this)){h.innerHTML=this.innerHTML;var c=h.id;h.id=this.id;this.innerHTML=a.dataTransfer.getData("text/html");this.id=c;b.setInput(b.getOrder());b.processAction()}return!1},
u=function(b){this.classList.remove("CTATJumble--item--home");$(d).children().removeClass("CTATJumble--item--over");h=null},v=this.setEnabled;this.setEnabled=function(b){v(b);d&&$(d).children().attr("draggable",b)};this.init_items=function(b){if(d){var a=document.createDocumentFragment();b=b.split(";");for(var c=b.length,e=0;e<c;e++){var g=document.createElement("div");g.textContent=b[e];g.id=this.getName()+e;g.setAttribute("unselectable","on");g.setAttribute("draggable",!0);g.classList.add("CTATJumble--item");
g.addEventListener("dragstart",n,!1);g.addEventListener("dragenter",p,!1);g.addEventListener("dragover",l,!1);g.addEventListener("dragleave",m,!1);g.addEventListener("drop",q,!1);g.addEventListener("dragend",u,!1);a.appendChild(g)}d.innerHTML="";d.appendChild(a)}};this.setParameterHandler("textItems",this.init_items);this.SetOrder=function(b){b.split(";").forEach(function(b){$(d).append($("#"+b))})};this.getOrder=function(){var a=[];$(d).children().each(function(){this.draggable&&(this.id?a.push(this.id):
console.log("ERROR: The CTATJumble "+b.getName()+" has a child with no id attribute: "+this+"!!!"))});return a.join(";")};this.updateSAI=function(){b.setInput(b.getOrder())}};CTATJumble.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATJumble.prototype.constructor=CTATJumble;CTAT.ComponentRegistry.addComponentType("CTATJumble",CTATJumble);var CTATMathInput=function(){function a(b){d.parentNode&&d.parentNode.removeChild(d);h.parentNode&&h.parentNode.removeChild(h);l.parentNode&&l.parentNode.removeChild(l);n.parentNode&&n.parentNode.removeChild(n);b.includes('<f group="operations" type="=" ast_type="operator"><b p="latex">=</b><b p="asciimath"> = </b></f>')?(c.appendChild(h),c.appendChild(l),c.appendChild(n),b=b.split('<f group="operations" type="=" ast_type="operator"><b p="latex">=</b><b p="asciimath"> = </b></f>').map(function(b,
a){return 0===a?b+"</m>":"<m>"+b}),Guppy.Doc.render(b[0],h.id),Guppy.Doc.render('<m><f group="operations" type="=" ast_type="operator"><b p="latex">=</b><b p="asciimath"> = </b></f></m>',l.id),Guppy.Doc.render(b[1],n.id)):(c.appendChild(d),Guppy.Doc.render(b,d.id))}CTAT.Component.Base.Tutorable.call(this,"CTATMathInput","myComponent");CTATMathInput.guppyInitialized||(Guppy.init({path:"https://cdn.ctat.cs.cmu.edu/releases/latest/guppy/",symbols:"https://cdn.ctat.cs.cmu.edu/releases/latest/guppy/symbols.json",
osk:{config:{attach:"focus",groups:["qwerty"],controls:"&uarr; &darr; &larr; &rarr; del enter".split(" ")}}}),document.documentElement.className+="ontouchstart"in document.documentElement?" touch":" no-touch",CTATMathInput.guppyInitialized=!0);var f=this,g=null,e=CTATConfiguration.get("previewMode"),c,b,d,h,n,l,p="",m=0,q=!1;this.backgrade=!0;this.getIsBeingGraded=function(){return q};this.processAssociatedRules=function(){q=!1};this.init=function(){this.ctatdebug("init ("+f.getName()+")");f.getInitialized()||
(c=f.getDivWrap(),b=document.createElement("div"),b.id=c.id+"_math",c.appendChild(b),g=new Guppy(b.id,{events:{done:function(){"false"!==c.getAttribute("data-ctat-submit-on-enter")&&f.processAction()},focus:function(b){b.focused&&f.processFocus()}},settings:{empty_content:""}}),d=document.createElement("div"),d.id=c.id+"_new",c.appendChild(d),h=document.createElement("div"),h.id=c.id+"_left",h.classList.add("CTATMathInput-left"),l=document.createElement("div"),l.id=c.id+"_equals",l.classList.add("CTATMathInput-equals"),
n=document.createElement("div"),n.id=c.id+"_right",n.classList.add("CTATMathInput-right"),this.ctatdebug("Final location: "+f.getX()+","+f.getY()+" with text: "+f.getValue()),c.addEventListener("keydown",function(b){++m;f.ctatdebug("dirty "+m)}),f.setInitialized(!0),f.setComponent(c),f.addComponentReference(f,c),e&&this.addEventScreen(!1),this.backgrade="false"!==c.getAttribute("data-ctat-submit-on-blur"))};this.GuppyStyleInput=function(b){var a;if(b.includes("/")){for(var c=b.indexOf("/"),d=c;0<
d;d--)if("+"===b[d]||"-"===b[d]){a=b.slice(0,d+1)+"("+b.slice(d+1,c)+")/"+f.GuppyStyleInput(b.slice(c+1,b.length));break}!a&&(a="("+b.slice(0,c)+")/"+f.GuppyStyleInput(b.slice(c+1,b.length)))}else a=b;return a};this.getValue=function(){try{var b=g.asciimath();g.text();return b}catch(H){return""}};this.updateSAI=function(){this.setActionInput("UpdateTextField",f.getValue())};this.setMath=function(b){(b=b.trim())?g.import_text(b):(g.engine.sel_all(),g.engine.sel_delete(),g.engine.sel_clear());g.render(!0);
f.getEnabled()||(b=g.xml(),a(b))};this.getConfigurationActions=function(){var b=[],a=$(this.getDivWrap());if(a.attr("value")){var c=new CTATSAI;c.setSelection(this.getName());c.setAction("UpdateTextField");c.setInput(a.attr("value"));b.push(c)}return b};this.UpdateTextField=function(b){this.setMath(b)};this.reset=function(){f.configFromDescription();f.processSerialization();g.import_text("")};var u=this.processAction;this.processAction=function(){var b=!1,a=f.getValue();if(/^\s*$/.test(String(a)))return b;
f.setActionInput("UpdateTextField",a);if(b=u.call(f))m=0,q=!0;return b};var v=this.setEnabled;this.setEnabled=function(e){v.call(this,e);f.getInitialized()&&(e?("none"===b.style.display&&(b.style.display=p||""),d.parentNode===c?c.removeChild(d):h.parentNode===c&&(c.removeChild(h),c.removeChild(l),c.removeChild(n))):(e=g.xml(),"none"!==b.style.display&&(p=b.style.display,b.style.display="none"),a(e),g.deactivate()))};var w=this.setCorrect;this.setCorrect=function(){w.apply(this,arguments)};var B=this.setIncorrect;
this.setIncorrect=function(){B.apply(this,arguments)};var C=this.showIncorrect;this.showIncorrect=function(){C.apply(this,arguments);b.style.color="red"};var F=this.showHintHighlight;this.showHintHighlight=function(){F.apply(this,arguments);b.style.color="initial"}};CTATMathInput.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATMathInput.prototype.constructor=CTATMathInput;CTAT.ComponentRegistry.addComponentType("CTATMathInput",CTATMathInput);var CTATMobileTutorHandler=function(a,f){CTATBase.call(this,"CTATMobileTutorHandler","mobiletutorhandler");this.ctatdebug("CTATMobileTutorHandler ()");var g="",e=f?f:"disabled",c=!1;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(c=!0);this.error=function(b){this.ctatdebug(b);alert(b)};this.processOrientationChange=function(b){this.ctatdebug("processOrientationChange ("+b+")")};this.getEnabled=function(){return"disabled"==e||"auto"==e&&0==c?!1:!0};this.processTextFocus=
function(b,a,f,n,l){this.ctatdebug("processTextFocus ("+b+","+a+","+f+","+n+","+l+")");"disabled"==e||"auto"==e&&0==c||(g="",this.manipulateKeyboard())};this.processEnter=function(){this.ctatdebug("processEnter ()");if("disabled"!=e&&("auto"!=e||0!=c)){var b=getSafeElementById(a);if(null!=b)try{b.processExternalEnter(),this.ctatdebug("Successfully called AS3 method")}catch(d){this.ctatdebug("Error description: "+d.message)}else this.ctatdebug("Error: unable to obtain reference to swf object")}};this.setText=
function(b){this.ctatdebug("setText ("+b+")");if("disabled"!=e&&("auto"!=e||0!=c))if(null!=CTATGlobals.selectedTextInput){this.ctatdebug("Attempting to call HTML5 method on text object ...");var d=CTATGlobals.selectedTextInput.getText();CTATGlobals.selectedTextInput.setText(d+b)}else if(this.ctatdebug("Attempting to call AS3 method ..."),d=getSafeElementById(a),null!=d)try{g+=b,this.ctatdebug(g),d.processExternalKeyboard(g),this.ctatdebug("Successfully called AS3 method")}catch(h){this.ctatdebug("Error description: "+
h.message)}else this.ctatdebug("Error: unable to obtain reference to swf object")};this.manipulateKeyboard=function(){this.ctatdebug("manipulateKeyboard()");if("disabled"!=e&&("auto"!=e||0!=c)){this.hideKeyboard();var b=getSafeElementById("keyboardUI");b&&(b.style.visibility="visible")}};this.hideKeyboard=function(){document.activeElement.blur();var b=getSafeElementById("input");b&&b.blur()};this.hideCustomKeyboard=function(){getSafeElementById("keyboardUI").style.visibility="visible"}};
CTATMobileTutorHandler.prototype=Object.create(CTATBase.prototype);CTATMobileTutorHandler.prototype.constructor=CTATMobileTutorHandler;function processTextFocus(a,f,g,e,c){mobileAPI.processTextFocus(a,f,g,e,c)}function processFocusOut(){closeK()};var CTATMovieClip=function(a,f,g,e,c){CTATBase.call(this,"CTATMovieClip",a);var b=CTATGlobalFunctions.gensym.z_index(),d=CTATGlobalFunctions.gensym.div_id(),h=CTATGlobalFunctions.gensym.z_index();CTATGlobalFunctions.gensym.div_id();var n=[],l=this,p=null;this.wrapComponent=function(a){p=document.createElement("div");p.setAttribute("id",d);p.setAttribute("name",this.getName());p.setAttribute("style","z-index: "+b);p.setAttribute("width",e+"px");p.setAttribute("height",c+"px");p.setAttribute("style",
"border: 0px; position: absolute; left:"+f+"px; top:"+g+"px; z-index:"+h+";");a.appendChild(p);return p};this.getDivWrapper=function(){return p};this.addComponent=function(b){l.ctatdebug("addComponent ("+b+")");n.push(b)};this.isRegistered=function(b){for(var a=0;a<n.length;a++)if(n[a]==b)return!0;return!1}};CTATMovieClip.prototype=Object.create(CTATBase.prototype);CTATMovieClip.prototype.constructor=CTATMovieClip;var CTATNLPInput=function(a,f,g,e,c){CTATTextBasedComponent.call(this,"CTATNLPInput","__undefined__",a,f,g,e,c);var b=this,d=null,h=null,n=CTATConfiguration.get("previewMode");this.init=function(){this.ctatdebug("init ("+b.getName()+")");d=document.createElement("input");d.type="text";a&&(d.name=a.name);d.setAttribute("maxlength",b.getMaxCharacters());d.setAttribute("id",CTATGlobalFunctions.gensym.div_id());b.setComponent(d);this.ctatdebug("Final location: "+b.getX()+","+b.getY()+" with text: "+b.getText());
var c=$(this.getDivWrap());c.attr("value")&&this.setText(c.attr("value"));var e=$(d);"autofocus defaultValue maxLength pattern placeholder readOnly size title".split(" ").forEach(function(b){var a=c.attr(b);a&&e.attr(b,a)});b.setInitialized(!0);b.addComponentReference(b,d);b.getDivWrap().appendChild(d);b.addSafeEventListener("keypress",b.processKeypress,d);b.addSafeEventListener("focus",b.processFocus,d);$(d).on("input",function(a){b.setNotGraded()});n&&this.addEventScreen(!1)};this.getConfigurationActions=
function(){var b=[],a=$(this.getDivWrap());if(a.attr("value")){var c=new CTATSAI;c.setSelection(this.getName());c.setAction("UpdateTextField");c.setInput(a.attr("value"));b.push(c)}return b};this.processAction.bind(this);this.processAction=function(b,a){if("GET"===p){var c=this.nlp_url,c=c.includes("${input}")?c.replace("${input}",this.getValue()):c.concat(this.getValue()),d=this.getName();(function(b){$.get(c,function(a){console.log("NLP DATA: ",a);b(a)})})(function(b){"string"!=typeof b&&(b=JSON.stringify(b));
var a=new CTATSAI;a.setSelection(d);a.setAction("NLPclassification");a.setInput(b);CTATCommShell.commShell.processComponentAction(a)})}"POST"===p&&(c=this.nlp_url,b=l,b=b.includes("${input}")?b.replace("${input}",this.getValue()):b.concat(this.getValue()),c=c.concat(b),d=this.getName(),function(b){$.post(c,function(a){b(a)})}(function(b){var a=new CTATSAI;a.setSelection(d);a.setAction("NLPclassification");a.setInput(b);CTATCommShell.commShell.processComponentAction(a)}))};this.setCellContainer=function(b){h=
b};this.getCellContainer=function(){return h};this.setText=function(a){b.ctatdebug("setText ("+a+")");b.assignText(a);d.value=a};this.getValue=function(){return d.value};this.reset=function(){b.configFromDescription();b.processSerialization();d.value=""};this.setStyleHandler("DrawBorder",null);this.nlp_url="";this.setURL=function(b){this.nlp_url=b};this.data_ctat_handlers["nlp-url"]=function(b){this.setURL(b)};var l="";this.setPostBody=function(b){this.post_body=b};this.data_ctat_handlers["post-body"]=
function(b){this.setPostBody(b)};var p="GET";this.setMethod=function(b){b&&(this.method=b)};this.data_ctat_handlers["nlp-method"]=function(b){this.setMethod(b)};this.setPreprocessor=function(b){window&&"function"===typeof window[b]&&(this.preprocessor=window[b])};this.data_ctat_handlers.preprocess=function(b){this.setPreprocessor(b)}};CTATNLPInput.prototype=Object.create(CTATTextBasedComponent.prototype);CTATNLPInput.prototype.constructor=CTATNLPInput;
CTAT.ComponentRegistry.addComponentType("CTATNLPInput",CTATNLPInput);CTAT.Geom={};CTAT.Geom.Point={};try{new DOMPoint}catch(a){if(console.log("WARNING: new DOMPoint():",a,typeof a),a instanceof ReferenceError||a instanceof TypeError){console.log("   Using shim!");var DOMPoint=function(f,g,e,c){this.z=this.y=this.x=0;this.w=1;if(f instanceof DOMPoint)for(var b in f)this[b]=f[b];else this.x=f||0,this.y=g||0,this.z=e||0,this.w=c||1}}}CTAT.Geom.Point.useDOMMatrix=!0;try{new DOMMatrix}catch(a){a instanceof ReferenceError&&(CTAT.Geom.Point.useDOMMatrix=!1)}
CTAT.Geom.Point.add=function(){if(CTAT.Geom.Point.useDOMMatrix){for(var a=new DOMMatrix,f,g=0;g<arguments.length;g++)f=arguments[g],a.translateSelf(f.x/f.w,f.y/f.w,f.z/f.w);return a.transformPoint(new DOMPoint)}return Array.prototype.reduce.call(arguments,function(a,c){for(var b in a)"w"!=b&&0!==c[b]&&(a[b]+=c[b]/c.w);return a},new DOMPoint)};
DOMPoint.prototype.add||Object.defineProperty(DOMPoint.prototype,"add",{enumerable:!1,value:function(a){return CTAT.Geom.Point.useDOMMatrix?(new DOMMatrix).translate(a.x/a.w,a.y/a.w,a.z/a.w).transformPoint(this):CTAT.Geom.Point.add(this,a)}});CTAT.Geom.Point.angle=function(a,f){return Math.acos(DOMPoint.dot(a,f)/(a.magnitude*f.magnitude))};CTAT.Geom.Point.angle_degrees=function(a,f){return CTAT.Math.rad2deg(CTAT.Geom.Point.angle(a,f))};
CTAT.Geom.Point.angle_between_2d=function(a,f){return CTAT.Math.rad2deg(Math.atan2(f.y,f.x)-Math.atan2(a.y,a.x))};DOMPoint.prototype.clone||Object.defineProperty(DOMPoint.prototype,"clone",{value:function(){return new DOMPoint(this.x,this.y,this.z,this.w)}});CTAT.Geom.Point.distance=function(a,f){a=CTAT.Geom.Point.add(a,CTAT.Geom.Point.scale(f,-1));return Math.sqrt(CTAT.Geom.Point.dot(a,a))};
DOMPoint.prototype.distance||Object.defineProperty(DOMPoint.prototype,"distance",{value:function(a){return CTAT.Geom.Point.distance(this,a)}});CTAT.Geom.Point.dot=function(a,f){return(a.x*f.x+a.y*f.y+a.z*f.z)/(a.w*f.w)};CTAT.Geom.Point.equals=function(a,f){var g=!0,e;for(e in a)if(e in f?"w"!=e&&(g&=a[e]/a.w==f[e]/f.w):g=!1,!g)break;return g};CTAT.Geom.Point.interpolate=function(a,f,g){return CTAT.Geom.Point.add(a.scale(g),f.scale(1-g))};
"magnitude"in DOMPoint.prototype||Object.defineProperty(DOMPoint.prototype,"magnitude",{enumerable:!1,get:function(){return CTAT.Math.round(Math.sqrt(CTAT.Geom.Point.dot(this,this)))}});DOMPoint.prototype.normalize||Object.defineProperty(DOMPoint.prototype,"normalize",{value:function(a){return this.scale((a?a:1)/this.magnitude)}});
CTAT.Geom.Point.scale=function(a,f){if(CTAT.Geom.Point.useDOMMatrix)return(new DOMMatrix).scale(f).transformPoint(a);var g=new DOMPoint(a),e;for(e in g)"w"!=e&&(g[e]=CTAT.Math.round(a[e]*f));return g};DOMPoint.prototype.scale||Object.defineProperty(DOMPoint.prototype,"scale",{value:function(a){return CTAT.Geom.Point.scale(this,a)}});CTAT.Geom.Point.polar=function(a,f){return new DOMPoint(CTAT.Math.round(a*Math.cos(f)),CTAT.Math.round(a*Math.sin(f)))};
CTAT.Geom.Point.is_on_line=function(a,f,g){return 1E-4>Math.abs(a.distance(g)+f.distance(g)-a.distance(f))};CTAT.Geom.Point.circle_intersection=function(a,f,g,e){f=f.add(a.scale(-1)).normalize();var c=CTAT.Geom.Point.dot(f,g.add(a.scale(-1))),b=a.add(f.scale(c));g=CTAT.Geom.Point.distance(g,b);return g<e?(e=Math.sqrt(e*e-g*g),[a.add(f.scale(c-e)),a.add(f.scale(c+e))]):g==e?[b]:[]};CTAT.Geom.Point.to2DString=function(a,f){a=[a.x/a.w,a.y/a.w].join();f&&(a="("+a+")");return a};CTAT.Geom.Rectangle={};try{new DOMRect}catch(a){if(console.log("WARNING: new DOMRect():",a,typeof a),a instanceof ReferenceError||a instanceof TypeError){console.log("    Using shim!");var DOMRect=function(f,g,e,c){this.x=f||0;this.y=g||0;this.width=e||0;this.height=c||0;return this}}}"left"in DOMRect.prototype||Object.defineProperty(DOMRect.prototype,"left",{get:function(){return Math.min(this.x,this.x+this.width)}});
"right"in DOMRect.prototype||Object.defineProperty(DOMRect.prototype,"right",{get:function(){return Math.max(this.x,this.x+this.width)}});"top"in DOMRect.prototype||Object.defineProperty(DOMRect.prototype,"top",{get:function(){return Math.min(this.y,this.y+this.height)}});"bottom"in DOMRect.prototype||Object.defineProperty(DOMRect.prototype,"bottom",{get:function(){return Math.max(this.y,this.y+this.height)}});
CTAT.Geom.Rectangle.contains=function(a,f,g){var e=CTAT.Geom.Rectangle.contains;if(f instanceof DOMRect)return e(a,f.left,f.top)&e(a,f.right,f.bottom);if(f instanceof DOMPoint){var c=!0;if(g instanceof DOMPoint)c=e(a,g.x/g.w,g.y/g.w);else if("number"==typeof g)return e(a,f.x-g,f.y-g)&e(a,f.x+g,f.y+g);return c&e(a,f.x,f.y)}return a.left<=f&a.right>=f&a.top<=g&a.bottom>=g};
DOMRect.prototype.contains||Object.defineProperty(DOMRect.prototype,"contains",{value:function(a,f){return CTAT.Geom.Rectangle.contains(this,a,f)}});DOMRect.prototype.clone||Object.defineProperty(DOMRect.prototype,"clone",{value:function(){return new DOMRect(this.x,this.y,this.width,this.height)}});DOMRect.prototype.copyFrom||Object.defineProperty(DOMRect.prototype,"copyFrom",{value:function(a){this.x=a.x;this.y=a.y;this.width=a.width;this.height=a.height;return this}});
CTAT.Geom.Rectangle.equals=function(a,f){return a.left==f.left&&a.top==f.top&&a.right==f.right&&a.bottom==f.bottom};CTAT.Geom.Rectangle.inflate=function(a,f,g){f=f?f:0;g=g?g:0;f instanceof DOMPoint&&(g=f.y,f=f.x);a=a.clone();a.x-=f;a.y-=g;a.width+=2*f;a.height+=2*g;return a};CTAT.Geom.Rectangle.isEmpty=function(a){return 0===a.width||0===a.height};CTAT.Geom.Rectangle.setEmpty=function(a){a.x=0;a.y=0;a.width=0;a.height=0;return a};
CTAT.Geom.Rectangle.setTo=function(a,f,g,e,c){a.x=f;a.y=g;a.width=e;a.height=c;return a};CTAT.Geom.Rectangle.offset=function(a,f,g){f=f?f:0;g=g?g:0;f instanceof DOMPoint&&(g=f.y,f=f.x);a=a.clone();a.x+=f;a.y+=g;return a};CTAT.Geom.Rectangle.union=function(a,f){var g=new DOMRect;g.x=Math.min(a.x,f.x);g.y=Math.min(a.y,f.y);g.width=Math.max(a.right,f.right)-g.x;g.height=Math.max(a.bottom,f.bottom)-g.y;return g};var CTATNumberLine=function(a,f,g,e,c){CTAT.Component.Base.SVG.call(this,"CTATNumberLine","aNumberLine",a,f,g,e,c);var b=CTAT.Math.Fraction,d=CTATGlobals.NameSpace.svg;a=function(a,c,e,g,f){this.numberline=a;this.step=new b(c);this.size=e;this.origin=new b(0);g=g?g:null;f=f?f:null;this.g=null;this.setStep=function(a){this.step=new b(a)};this.setSize=function(b){b=Number(b);isNaN(b)&&(b=e);this.size=b};this.setOrigin=function(a){this.origin=new b(a)};this.generate=function(){if(this.numberline){var a=
new b,c=document.createDocumentFragment(),e=document.createElementNS(d,"g");e.setAttributeNS(null,"data-step-size",this.step.toString());e.setAttributeNS(null,"pointer-events","none");g&&e.classList.add(g);c.appendChild(e);if(0<this.step){for(a.set(this.origin).reduce();a<=this.numberline.Maximum;)a>=this.numberline.Minimum&&e.appendChild(this.numberline.genTickmark(a,null,this.size)),a=a.add(this.step);a.set(this.origin).reduce();for(a=a.subtract(this.step);a>=this.numberline.Minimum;)a<=this.numberline.Maximum&&
e.appendChild(this.numberline.genTickmark(a,null,this.size)),a=a.subtract(this.step)}f&&$(e).find("text.CTATNumberLine--tickmark-label").each(function(){this.classList.add(f)});return c}}};var h=new a(this,new b(1),30,"CTATNumberLine--large-tickmark","CTATNumberLine--large-tickmark-label");this.setLargeTickSize=function(b){h.setSize(s);this.render();return this};this.setParameterHandler("LargeTickmarkSize",this.setLargeTickSize);this.setParameterHandler("LargeTickmarkStep",function(b){h.setStep(b);
this.render();return this});this.data_ctat_handlers["large-tick-step"]=function(b){h.setStep(b);this.render()};var n=new a(this,new b(1,2),20,"CTATNumberLine--small-tickmark","CTATNumberLine--small-tickmark-label");this.setSmallTickSize=function(b){n.setSize(s);this.render();return this};this.setParameterHandler("SmallTickmarkSize",this.setSmallTickSize);this.setParameterHandler("SmallTickmarkStep",function(b){n.setStep(b);this.render();return this});this.data_ctat_handlers["small-tick-step"]=function(b){n.setStep(b);
this.render()};var l=new a(this,new b(0),25,"CTATNumberLine--denominator-tickmark","CTATNumberLine--denominator-tickmark-label");this.setParameterHandler("DenominatorTickmarkSize",function(b){l.setSize(b);this.render();return this});this.setParameterHandler("DenominatorTickmarkStep",function(a){l.setStep((new b(a)).reciprocal())});this.data_ctat_handlers.denominator=function(a){a=new b(a);l.setStep(a.reciprocal())};this.setColor=function(b){console.log("numberline.setColor");this.color=b=CTATGlobalFunctions.formatColor(b);
for(var a=$(this.getDivWrap()).find("g"),c=0;c<a.length;c++)$(a[c]).css("stroke",b)};this.getColor=function(){console.log("numberline.getColor");return this.color};this.X_Axis=new function(b,a,c,d){var e={};this.svg_group=null;var g=b;Object.defineProperty(this,"start",{get:function(){return g},set:function(b){e={};g=b}});Object.defineProperty(this,"min_loc",{get:function(){if(!e.hasOwnProperty("min_loc")){var b=this.start.clone(),a=CTAT.Geom.Point.polar(20,this.angle()),b=b.add(a);b.x=CTAT.Math.round(b.x);
b.y=CTAT.Math.round(b.y);e.min_loc=b}return e.min_loc}});var f=a;Object.defineProperty(this,"end",{get:function(){return f},set:function(b){e={};f=b}});Object.defineProperty(this,"max_loc",{get:function(){if(!e.hasOwnProperty("max_loc")){var b=this.end.clone(),a=CTAT.Geom.Point.polar(20,this.angle()),b=b.add(a.scale(-1));b.x=CTAT.Math.round(b.x);b.y=CTAT.Math.round(b.y);e.max_loc=b}return e.max_loc}});var h=c;Object.defineProperty(this,"min",{get:function(){return h},set:function(b){e={};h=b}});var l=
d;Object.defineProperty(this,"max",{get:function(){return l},set:function(b){e={};l=b}});Object.defineProperty(this,"length",{get:function(){e.hasOwnProperty("length")||(e.length=CTAT.Math.round(this.min_loc.distance(this.max_loc)));return e.length}});this.isHorizontal=function(){return this.start.y===this.end.y};this.isVertical=function(){return this.start.x===this.end.x};Object.defineProperty(this,"range",{get:function(){return this.max.subtract(this.min)}});Object.defineProperty(this,"step_size",
{get:function(){return CTAT.Geom.Point.equals(this.min_loc,this.max_loc)?this.length:CTAT.Math.round(this.length/this.range)}});this.s_vec=function(){return this.max_loc.add(this.min_loc.scale(-1))};this.slope=function(){var b=this.s_vec();return b.y/b.x};this.step=function(){e.hasOwnProperty("step")||(e.step=this.s_vec().normalize(this.step_size));return e.step};this.scalar=function(){e.hasOwnProperty("scalar")||(e.scalar=this.range/this.length);return e.scalar};this.zero=function(){e.hasOwnProperty("zero")||
(e.zero=this.min_loc.add(this.step().scale(-this.min)),e.zero.x=CTAT.Math.round(e.zero.x),e.zero.y=CTAT.Math.round(e.zero.y));return e.zero};this.angle=function(){if(!e.hasOwnProperty("angle")){var b=this.end.add(this.start.scale(-1));e.angle=Math.atan2(b.y,b.x)}return e.angle};this.angle_deg=function(){return CTAT.Math.rad2deg(this.angle())};this.getPosition=function(b){b=this.zero().add(this.step().scale(1*b));b.x=CTAT.Math.round(b.x);b.y=CTAT.Math.round(b.y);return b};this.projected_point=function(b){var a=
this.s_vec(),c=b.add(this.min_loc.scale(-1)),c=0+(a.y*c.x-a.x*c.y)/(a.y*a.y+a.x*a.x);return b.add(new DOMPoint(-c*a.y,c*a.x))};this.getProjectedPoint=function(b){b=this.projected_point(b);return b.distance(this.max_loc)>this.length?this.min_loc:b.distance(this.min_loc)>this.length?this.max_loc:b};this.getAxisValue=function(b){return CTAT.Math.round(h+this.scalar()*this.min_loc.distance(this.getProjectedPoint(b)))}}(new DOMPoint(0,0),new DOMPoint(0,0),new b(0),new b(3));Object.defineProperty(this,
"Maximum",{get:function(){return this.X_Axis.max},set:function(a){this.X_Axis.max=new b(a)}});this.setMaximum=function(b){this.Maximum=b};this.setParameterHandler("Maximum",this.setMaximum);this.data_ctat_handlers.maximum=this.setMaximum;Object.defineProperty(this,"Minimum",{get:function(){return this.X_Axis.min},set:function(a){this.X_Axis.min=new b(a)}});this.setMinimum=function(b){this.Minimum=b};this.setParameterHandler("Minimum",this.setMinimum);this.data_ctat_handlers.minimum=this.setMinimum;
var p=1;Object.defineProperty(this,"Max_Points",{get:function(){return p},set:function(b){b=parseInt(b);isNaN(b)||(p=b)}});this.setMaxPoints=function(b){this.Max_Points=b};this.setParameterHandler("Max_Points",this.setMaxPoints);this.data_ctat_handlers["max-points"]=this.setMaxPoints;var m=7;this.setPointSize=function(b){m=Number(b);w&&(w.setAttributeNS(null,"r",m),$(this._point_group).find("circle").each(function(){$(this).attr("r",m)}))};this.setStyleHandler("PointSize",this.setPointSize);this.data_ctat_handlers["point-size"]=
this.setPointSize;var q=!1;this.setSnapToTickMark=function(b){q=CTATGlobalFunctions.toBoolean(b)};this.setParameterHandler("SnapToTickmark",this.setSnapToTickMark);this.data_ctat_handlers.snap=this.setSnapToTickMark;this.theta=0;Object.defineProperty(this,"Orientation",{get:function(){return 180*this.theta/Math.PI},set:function(b){b=Number(b);isNaN(b)&&(b=0);this.theta=Math.PI*b/180}});this.setOrientation=function(b){this.Orientation=b;this.render()};this.setParameterHandler("Orientation",this.setOrientation);
this.data_ctat_handlers.rotation=this.setOrientation;this._tickmarks=[];this.genTickmark=function(b,a,c){var e=document.createDocumentFragment();if(!this._tickmarks.some(function(a){return a.data.equals(b)})){var g=document.createElementNS(d,"line"),f=this.X_Axis.getPosition(b),h=CTAT.Geom.Point.polar(c/2,this.theta+Math.PI/2).add(f);c=CTAT.Geom.Point.polar(-c/2,this.theta+Math.PI/2).add(f);g.setAttributeNS(null,"x1",h.x);g.setAttributeNS(null,"y1",h.y);g.setAttributeNS(null,"x2",c.x);g.setAttributeNS(null,
"y2",c.y);g.setAttributeNS(null,"data-value",b.toString());g.data=b;g.location=f;g.label=null;this._tickmarks.push(g);e.appendChild(g);if(""!==a){f=document.createElementNS(d,"text");f.classList.add("CTATNumberLine--tickmark-label");f.setAttributeNS(null,"text-anchor","middle");e.appendChild(f);if(null===a||void 0===a)if(1==b.denominator)f.appendChild(document.createTextNode(String(b.numerator.toPrecision(z)))),f.setAttributeNS(null,"x",c.x),f.setAttributeNS(null,"y",c.y);else{a=""+String(b.numerator);
h=""+String(b.denominator);f.style.fontSize="0.6em";f.setAttributeNS(null,"text-align","center");var l=document.createElementNS(d,"tspan"),n=document.createElementNS(d,"tspan");l.appendChild(document.createTextNode(a));n.appendChild(document.createTextNode(h));f.appendChild(l);f.appendChild(n);l.setAttributeNS(null,"text-anchor","middle");l.setAttributeNS(null,"x",c.x);l.setAttributeNS(null,"y",c.y);l.setAttributeNS(null,"dy","-1em");n.setAttributeNS(null,"text-anchor","middle");n.setAttributeNS(null,
"x",c.x);n.setAttributeNS(null,"y",c.y);a.length>h.length?l.style.textDecoration="underline":n.style.textDecoration="overline"}else f.appendChild(document.createTextNode(a.toString())),e.appendChild(tlabel),f.setAttributeNS(null,"x",c.x),f.setAttributeNS(null,"y",c.y);g.label=f}}return e};var u=function(){if(null!==this.X_Axis&&null!==this.X_Axis.svg_group){var b=this.getBoundingBox(),a=window.getComputedStyle(this._axis_line_group),a=parseInt(a.getPropertyValue("stroke-width")),b=CTAT.Geom.Rectangle.inflate(b,
-a,-a),c=new DOMPoint(b.width/2,b.height/2),e=c.add(CTAT.Geom.Point.polar(Math.min(40,b.height,b.width)/4,this.theta)),g=Math.sin(this.theta),f=-Math.cos(this.theta),m=g*c.x+f*c.y,p=-b.height*f,q=-g*b.width,a=new DOMPoint(b.left,c.y),c=new DOMPoint(b.right,c.y);if(0<Math.abs(CTAT.Math.round(p))){var p=new DOMPoint(b.left,(m-g*b.left)/f),w=new DOMPoint(b.right,(m-g*b.right)/f);if(b.contains(p)||b.contains(w))e.distance(p)<e.distance(w)?(a=w,c=p):(a=p,c=w)}0<Math.abs(CTAT.Math.round(q))&&(q=new DOMPoint((m-
f*b.top)/g,b.top),g=new DOMPoint((m-f*b.bottom)/g,b.bottom),b.contains(q)||b.contains(g))&&(e.distance(q)<e.distance(g)?(a=g,c=q):(a=q,c=g));if(this.X_Axis.start.x!=a.x||this.X_Axis.start.y!=a.y||this.X_Axis.end.x!=c.x||this.X_Axis.end.y!=c.y)this.X_Axis.start=a,this.X_Axis.end=c,this.X_Axis.svg_group.innerHTML="",b=document.createDocumentFragment(),e=document.createElementNS(d,"line"),e.setAttributeNS(null,"x1",a.x),e.setAttributeNS(null,"y1",a.y),e.setAttributeNS(null,"x2",c.x),e.setAttributeNS(null,
"y2",c.y),b.appendChild(e),e=document.createElementNS(d,"path"),e.setAttributeNS(null,"d","M 10,6 L 0,0 L 10,-6"),e.setAttributeNS(null,"transform","translate("+CTAT.Geom.Point.to2DString(a)+") rotate("+this.Orientation+")"),b.appendChild(e),a=document.createElementNS(d,"path"),a.setAttributeNS(null,"d","M -10,6 L 0,0 L -10,-6"),a.setAttributeNS(null,"transform","translate("+CTAT.Geom.Point.to2DString(c)+") rotate("+this.Orientation+")"),b.appendChild(a),this.X_Axis.svg_group.appendChild(b);this._tickmarks=
[];a=document.createDocumentFragment();a.appendChild(h.generate());a.appendChild(n.generate());a.appendChild(l.generate());this._tick_mark_group.innerHTML="";this._tick_mark_group.appendChild(a);a=this._point_group.children;for(c=0;c<a.length;c++)b=a[c],e=this.X_Axis.getPosition(b.value),g=new DOMPoint(b.cx.baseVal.value,b.cy.baseVal.value),1<e.distance(g)&&(b.cx.baseVal.value=e.x,b.cy.baseVal.value=e.y)}}.bind(this),v=0,w=null,B=new DOMPoint(-30,-30),C=!1,F=function(b){B.x=b.clientX;B.y=b.clientY},
G=function(b){cancelAnimationFrame(v);w.style.visibility="hidden";C=!1},H=function(b){if(!0===this.getEnabled()&&0<p){this.setHintHighlight(!1);var a;q?(b=J(b.clientX,b.clientY),a=b.location,b=b.data):(b=D(b.clientX,b.clientY),a=this.X_Axis.getProjectedPoint(b),b=this.X_Axis.getAxisValue(b));var c=document.createElementNS(d,"circle");c.classList.add("CTATNumberLine--point");c.setAttributeNS(null,"cx",a.x);c.setAttributeNS(null,"cy",a.y);c.setAttributeNS(null,"r",m);c.value=b;if(this._point_group.children.length>=
this.Max_Points){a=[].slice.call(this._point_group.children);var e=a.filter(function(b,a,c){return b.classList.contains("CTAT--incorrect")});0<e.length?this._point_group.removeChild(e[0]):(a=a.filter(function(b,a,c){return!b.classList.contains("CTAT--correct")}),0<a.length&&this._point_group.removeChild(a[0]))}this._point_group.appendChild(c);this.setActionInput("AddPoint",b.toString());this.processAction()}}.bind(this);this.init=function(){this.initSVG();this.component.classList.add("CTATNumberLine--container");
this._axis_line_group=document.createElementNS(d,"g");this._axis_line_group.classList.add("CTATNumberLine--axis");this._tick_mark_group=document.createElementNS(d,"g");this._tick_mark_group.classList.add("CTATNumberLine--tickmark");this._point_group=document.createElementNS(d,"g");w=document.createElementNS(d,"circle");w.setAttributeNS(null,"r",m);w.classList.add("CTATNumberLine--cursor");w.setAttributeNS(null,"transform","translate(-30,-30)");this.component.appendChild(this._axis_line_group);this.component.appendChild(this._tick_mark_group);
this.component.appendChild(this._point_group);this.component.appendChild(w);this.X_Axis.svg_group=this._axis_line_group;u();this.addComponentReference(this,this.getDivWrap());this.component.addEventListener("mousemove",F);this.component.addEventListener("mouseleave",G);var b=this.getEnabled;this.component.addEventListener("mouseenter",function(){!0===b()&&0<p&&(C=!0,w.style.visibility=null,v=requestAnimationFrame(r))});this.component.addEventListener("click",H);this.component.addEventListener("focus",
this.processFocus)};this.getConfigurationActions=function(){var b=[],a,c=$(this.getDivWrap());c.attr("data-ctat-minimum")&&(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("set_minimum"),a.setInput(c.attr("data-ctat-minimum")),b.push(a));c.attr("data-ctat-maximum")&&(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("set_maximum"),a.setInput(c.attr("data-ctat-maximum")),b.push(a));c.attr("data-ctat-max-points")&&(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("set_max_user_entries"),
a.setInput(c.attr("data-ctat-max-points")),b.push(a));c.attr("data-ctat-large-tick-step")&&(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("set_large_step"),a.setInput(c.attr("data-ctat-large-tick-step")),b.push(a));c.attr("data-ctat-small-tick-step")&&(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("set_small_step"),a.setInput(c.attr("data-ctat-small-tick-step")),b.push(a));c.attr("data-ctat-denominator")&&(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("set_denominator"),
a.setInput(c.attr("data-ctat-denominator")),b.push(a));return b};var E=-1<navigator.userAgent.toLowerCase().indexOf("firefox"),D=function(b,a){this.svgPoint=this.svgPoint?this.svgPoint:this.component.createSVGPoint();this.svgPoint.x=b;this.svgPoint.y=a;b=this._axis_line_group.getScreenCTM().inverse();this.svgPoint=this.svgPoint.matrixTransform(b);b=new DOMPoint(this.svgPoint.x,this.svgPoint.y);if(E){var c=$(this.component);a=parseInt(c.css("borderLeftWidth"))+parseInt(c.css("paddingLeft"))+parseInt(c.css("marginLeft"));
c=parseInt(c.css("borderTopWidth"))+parseInt(c.css("paddingTop"))+parseInt(c.css("marginTop"));b.x-=a;b.y-=c}return b}.bind(this),K=function(b,a){return this.getProjectedPoint(D(b,a))}.bind(this.X_Axis),J=function(b,a){b=K(b,a);a=null;for(var c=Number.POSITIVE_INFINITY,d,e,g=0;g<this._tickmarks.length;g++)d=this._tickmarks[g],e=b.distance(d.location),e<c&&(a=d,c=e);return a}.bind(this),r=function(){if(C&&!0===this.getEnabled()){if(q){var b=J(B.x,B.y);w.setAttributeNS(null,"transform","translate"+
CTAT.Geom.Point.to2DString(b.location,!0))}else w.setAttributeNS(null,"transform","translate"+CTAT.Geom.Point.to2DString(K(B.x,B.y),!0));v=requestAnimationFrame(r)}}.bind(this);this.render=function(){u()};this.calcXCoordinate=function(a){a=new b(a);var c=this.getWidth()-30,c=Math.abs(c-30),d=max.subtract(min);return 30+a.subtract(min).divide(d)/c};this.calcNum=function(b){var a=this.getWidth()-30,a=Math.abs(a-30);b=max.subtract(min).multiply((b-30)/a);return min.add(b)};var I=function(b,a){switch(a.getClassName()){case "CTATMessage":a=
a.getSAI()}a=a.clone();a.setAction(b.getSAI().getAction());a.setSelection(b.getName());return a};this.showCorrect=function(b){b.getInput();var a=b.getAction(),c=function(a){a.setCorrect(I(a,b))};switch(a){case "AddPoint":0<this._point_group.children.length&&(a=[].slice.call(this._point_group.children),c=a[a.length-1],c.classList.remove("CTAT--incorrect"),c.classList.remove("CTAT--hint"),c.classList.add("CTAT--correct"),this.getDisableOnCorrect()&&(a.length>=this.Max_Points&&a.every(function(b){return b.classList.contains("CTAT--correct")})?
this.setEnabled(!1):this.setEnabled(!0)));break;case "Points":a=this._point_group.children;for(c=0;c<a.length;c++){var d=a[c];d.classList.remove("CTAT--incorrect");d.classList.remove("CTAT--hint");d.classList.add("CTAT--correct")}break;case "set_minimum":Y(S()).forEach(c);break;case "set_maximum":Y(X()).forEach(c);break;case "set_large_step":Y(V()).forEach(c);break;case "set_small_step":Y(U()).forEach(c);break;case "set_denominator":Y(ea()).forEach(c);break;default:console.log("Unhandled Action in",
this.getName(),a)}};this.showInCorrect=function(b){b.getInput();var a=b.getAction(),c=function(a){a.setIncorrect(I(a,b))};switch(a){case "AddPoint":0<this._point_group.children.length&&(a=[].slice.call(this._point_group.children),a=a[a.length-1],a.classList.remove("CTAT--correct"),a.classList.remove("CTAT--hint"),a.classList.add("CTAT--incorrect"));break;case "Points":a=this._point_group.children;for(c=0;c<a.length;c++){var d=a[c];d.classList.remove("CTAT--correct");d.classList.remove("CTAT--hint");
d.classList.add("CTAT--incorrect")}break;case "set_minimum":Y(S()).forEach(c);break;case "set_maximum":Y(X()).forEach(c);break;case "set_large_step":Y(V()).forEach(c);break;case "set_small_step":Y(U()).forEach(c);break;case "set_denominator":Y(ea()).forEach(c);break;default:console.log("Unhandled Action in",this.getName(),a)}};var A=this.setEnabled;this.setEnabled=function(b){A(b);w&&C&&(w.style.visibility=this.getEnabled()?null:"hidden")};this.set_minimum=function(b){this.Minimum=b;this.render()};
this.change_minimum=function(a){a=new b(a);0!==a.valueOf()&&(this.Minimum=this.Minimum.add(a),this.render())};var P=function(){this.setActionInput("set_minimum",this.Minimum)}.bind(this);this.set_maximum=function(b){this.Maximum=b;this.render()};this.change_maximum=function(a){a=new b(a);0!==a.valueOf()&&(this.Maximum=this.Maximum.add(a),this.render())};var L=function(){this.setActionInput("set_maximum",this.Maximum)}.bind(this);this.set_max_user_entries=function(b){this.setMaxPoints(parseInt(b))};
a=function(b,a){b.setStep(a);this.render()};this.set_large_step=a.bind(this,h);var N=function(){this.setActionInput("set_large_step",h.step.toString())}.bind(this);this.set_small_step=a.bind(this,n);var R=function(){this.setActionInput("set_small_step",n.step.toString())}.bind(this);this.set_denominator=function(a){0===parseInt(a)?l.setStep(0):l.setStep((new b(a)).reciprocal());this.render()};var Q=function(){var b=0===l.step.valueOf()?0:l.step.reciprocal();this.setActionInput("set_denominator",b.toString())}.bind(this);
a=function(a,c){0!==(new b(c)).valueOf()&&(c=a.step.add(c),0>c.valueOf()&&c.set(0,1),a.setStep(c),this.render())};this.change_large_step=a.bind(this,h);this.change_small_step=a.bind(this,n);this.change_denominator=function(a){a=new b(a);0!==a.valueOf()&&(a=a.add(l.step.denominator),l.setStep(a.reciprocal()),this.render())};var z=void 0;this.set_precision=function(b){z=parseInt(b);this.render()};this.AddPoint=function(a,c){var e=new b(a);a=this.X_Axis.getPosition(e);c=document.createElementNS(d,"circle");
c.classList.add("CTATNumberLine--point");c.setAttributeNS(null,"cx",a.x);c.setAttributeNS(null,"cy",a.y);c.setAttributeNS(null,"r",m);c.value=e;[].slice.call(this._point_group.children).some(function(b){return e.equals(b.value)})||this._point_group.appendChild(c)};this.Points=function(b,a){this._point_group.innerHTML="";b=b.split(";");for(var c in b)this.AddPoint(b[c],a)};var T=function(b,a,c,d){switch(d.getAction()){case "ButtonPressed":b.call(this,d.getInput());break;case "Update":case "UpdateTextField":case "UpdateTextArea":a.call(this,
d.getInput())}c.call();this.processAction(!1,!0)};a=function(b){return(b=$(this.getDivWrap()).attr(b))?b.split(/\s*;\s*/).map(function(b){return b.trim()}):[]};var X=a.bind(this,"data-ctat-ctrl-max"),S=a.bind(this,"data-ctat-ctrl-min"),V=a.bind(this,"data-ctat-ctrl-large-tick"),U=a.bind(this,"data-ctat-ctrl-small-tick"),ea=a.bind(this,"data-ctat-ctrl-denominator"),Y=function(b){return b.map(function(b){return $("#"+b).data("CTATComponent")})},ra=function(b){var a=null;if(b instanceof CTAT.Component.Base.Tutorable)b!=
this&&(a=b.getName());else if(b instanceof CTATSAI)b.getSelection()!=pointer.getName()&&(a=b.getSelection());else if(b instanceof String)b!=pointer.getName()&&(a=b);else if(b instanceof Element)b!=pointer.getComponent()&&(a=b.id);else return null;if(a){if(W(a))return T.bind(this,this.change_denominator,this.set_denominator,Q);if(ba(a))return T.bind(this,this.change_small_step,this.set_small_step,R);if(da(a))return T.bind(this,this.change_large_step,this.set_large_step,N);if(ga(a))return T.bind(this,
this.change_minimum,this.set_minimum,P);if(la(a))return T.bind(this,this.change_maximum,this.set_maximum,L)}return null}.bind(this);CTATConfiguration.get("previewMode")||document.addEventListener(CTAT.Component.Base.Tutorable.EventType.action,function(b){var a=b.detail.sai;b=ra(b.detail.component);a&&null!==b&&b(a)},!1);this.setMaxControllers=function(b){$(this.getDivWrap()).attr("data-ctat-ctrl-max",b)};this.setParameterHandler("MaxValueControllers",this.setMaxControllers);this.setMinControllers=
function(b){$(this.getDivWrap()).attr("data-ctat-ctrl-min",b)};this.setParameterHandler("MinValueControllers",this.setMinControllers);this.setLargeTickControllers=function(b){$(this.getDivWrap()).attr("data-ctat-ctrl-large-tick",b)};this.setParameterHandler("LargeTickmarkControllers",this.setLargeTickControllers);this.setSmallTickControllers=function(b){$(this.getDivWrap()).attr("data-ctat-ctrl-small-tick",b)};this.setParameterHandler("SmallTickmarkControllers",this.setSmallTickControllers);this.setDenominatorControllers=
function(b){$(this.getDivWrap()).attr("data-ctat-ctrl-denominator",b)};this.setParameterHandler("DenominatorTickmarkControllers",this.setDenominatorControllers);a=function(b,a){return 0<=b().indexOf(a)};var la=a.bind(null,X),ga=a.bind(null,S),da=a.bind(null,V),ba=a.bind(null,U),W=a.bind(null,ea);this.grade=function(b){b=b.getDivWrap().id;la(b)?(this.setAction("set_maximum"),this.setInput(this.Maximum.toString())):ga(b)?(this.setAction("set_minimum"),this.setInput(this.Minimum.toString())):da(b)?(this.setAction("set_large_step"),
this.setInput(h.step.toString())):ba(b)?(this.setAction("set_small_step"),this.setInput(n.step.toString())):W(b)?(this.setAction("set_denominator"),this.setInput(l.step.reciprocal().toString())):this.updateSAI();this.processAction(!0)};this.updateSAI=function(){for(var b=this._point_group.children,a=[],c=0;c<b.length;c++)a.push(b[c].value);a.sort(function(b,a){return b-a});this.setActionInput("Points",a.join(";"))}};CTATNumberLine.prototype=Object.create(CTAT.Component.Base.SVG.prototype);
CTATNumberLine.prototype.constructor=CTATNumberLine;CTAT.ComponentRegistry.addComponentType("CTATNumberLine",CTATNumberLine);var CTATNumericStepper=function(a,f,g,e,c){CTAT.Component.Base.Tutorable.call(this,"CTATNumericStepper","__undefined__",a,f,g,e,c);this.setAction("Update");var b=document.createElement("input");b.type="number";this.set_maximum=function(a){a=Number(a);isNaN(a)||(b.max=a)};this.setParameterHandler("maximum",this.set_maximum);this.set_minimum=function(a){a=Number(a);isNaN(a)||(b.min=a)};this.setParameterHandler("minimum",this.set_minimum);this.set_step=function(a){a=Number(a);isNaN(a)||(b.step=a)};this.setParameterHandler("stepSize",
this.set_step);this.update_value=function(a){a=Number(a);isNaN(a)||(b.value=a,this.setInput(a))};this.setParameterHandler("value",this.update_value);this.updateSAI=function(){this.setInput(b.value)};this.Update=this.update_value;this.init=function(){b.id=this.getName()+"_spinner";this.setComponent(b);this.setInitialized(!0);var a=$(this.getDivWrap()),c=$(b);"autofocus defaultValue placeholder value max min readOnly step".split(" ").forEach(function(b){var d=a.attr(b);d&&c.attr(b,d)});CTATConfiguration.get("previewMode")||
(this.getDivWrap().innerHTML="");this.getDivWrap().appendChild(b);this.component.addEventListener("focus",this.processFocus);var e=this;b.addEventListener("change",function(b){var a=Number(this.min);isNaN(a)&&(a=0);b=Number(this.value);if(isNaN(b))this.value=a;else if(""!==this.min&&b<a)this.value=a;else if(""!==this.max&&!isNaN(Number(this.max))&&b>Number(this.max))this.value=this.max;else{var c=Number(this.step);if(isNaN(c)||0>=c)c=1;a=(b-a)%c;0!==a&&(this.value=b-a)}e.updateSAI();e.processAction();
return!1});CTATConfiguration.get("previewMode")&&this.addEventScreen(!1)};this.getConfigurationActions=function(){var b=[],a,c=$(this.getDivWrap());c.attr("min")&&(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("set_minimum"),a.setInput(c.attr("min")),b.push(a));c.attr("max")&&(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("set_maximum"),a.setInput(c.attr("max")),b.push(a));c.attr("step")&&(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("set_step"),a.setInput(c.attr("step")),
b.push(a));c.attr("value")&&(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("Update"),a.setInput(c.attr("value")),b.push(a));return b}};CTATNumericStepper.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATNumericStepper.prototype.constructor=CTATNumericStepper;CTAT.ComponentRegistry.addComponentType("CTATNumericStepper",CTATNumericStepper);var CTATPieChart=function(a,f,g,e,c){CTAT.Component.Base.UnitDisplay.call(this,"CTATPieChart","aPieChart",a,f,g,e,c);var b=3,d=3,h=this,n,l,p,m=null,q=CTATGlobals.NameSpace.svg;this.init=function(){this.initSVG();this.baseGroup=document.createElementNS(q,"g");this.getComponent().appendChild(this.baseGroup);this.getComponent().classList.add("CTATPieChart--container");n=document.createElementNS(q,"filter");n.id=this.genName("Shadow");l="#"+n.id;p="url("+l+")";n.setAttributeNS(null,"width","200%");n.setAttributeNS(null,
"height","200%");m=document.createElementNS(q,"feOffset");m.setAttributeNS(null,"in","SourceAlpha");m.setAttributeNS(null,"result","offOut");m.setAttributeNS(null,"dx",d);m.setAttributeNS(null,"dy",d);n.appendChild(m);var b=document.createElementNS(q,"feGaussianBlur");b.setAttributeNS(null,"in","offOut");b.setAttributeNS(null,"result","blurOut");b.setAttributeNS(null,"stdDeviation",4);n.appendChild(b);b=document.createElementNS(q,"feBlend");b.setAttributeNS(null,"in","SourceGraphic");b.setAttributeNS(null,
"in2","blurOut");b.setAttributeNS(null,"mode","normal");n.appendChild(b);this.getComponent().getElementsByTagName("defs")[0].appendChild(n);0<d&&this.baseGroup.setAttributeNS(null,"filter",p);this.drawPieces();this.addComponentReference(this,this.getDivWrap());this.component.addEventListener("focus",this.processFocus)};this.render=function(){this.drawPieces()};this.drawPieces=function(){if(this.baseGroup){this.clear();var a=window.getComputedStyle(this.getComponent()),a=parseFloat(a.getPropertyValue("stroke-width")),
c=this.getBoundingBox(),e=Math.min(c.width/2,c.height/2)-(a+d+4),g=new DOMPoint(c.width/2,c.height/2),a=this.parseValue(),f=document.createDocumentFragment();a.reduce(function(a,c,d,l){if(1<=c.valueOf())d=document.createElementNS(q,"circle"),d.classList.add("CTATPieChart--piece"),d.cx.baseVal.value=g.x,d.cy.baseVal.value=g.y,d.r.baseVal.value=e,this.addPieceElem(d,c,c.selected),f.appendChild(d);else{d=document.createElementNS(q,"path");d.classList.add("CTATPieChart--piece");f.appendChild(d);window.getComputedStyle(d);
var n=2*Math.PI*a.valueOf();l=g.add(CTAT.Geom.Point.polar(e,n));c.reduce();var m=g.add(CTAT.Geom.Point.polar(e,2*Math.PI*c.valueOf()+n)),p=g.clone();if(0<b&&b<e){n=CTAT.Geom.Point.polar(b,n+Math.PI*c.valueOf());p=p.add(n);l=l.add(n);var w=function(b,a,c){return b.distance(a)<b.distance(c)?a:c};l=CTAT.Geom.Point.circle_intersection(p,l,g,e).reduce(w.bind(this,l));m=m.add(n);m=CTAT.Geom.Point.circle_intersection(p,m,g,e).reduce(w.bind(this,m))}n=CTAT.Geom.Point.to2DString;p="M "+n(p);w=new DOMPoint(e,
e);p+=" L "+n(l);p+=" A "+n(w)+" 0 "+(.5<c.valueOf()?1:0)+",1 "+n(m);d.setAttributeNS(null,"d",p+" Z");h.addPieceElem(d,c,c.selected)}return a.add(c)},new CTAT.Math.Fraction);this.baseGroup.innerHTML="";this.baseGroup.appendChild(f)}};this.getExplode=function(){return b};this.getDropShadowDistance=function(){return d};this.setExplode=function(a){a=Number(a);if(!isNaN(a)){var c=a!==b;b=a;c&&this.drawPieces()}return this};this.setStyleHandler("explode",this.setExplode);this.data_ctat_handlers.explode=
function(b){this.setExplode(b)};this.setDropShadowDistance=function(b){d=parseInt(b);d=isNaN(d)?0:d;m&&(m.setAttributeNS(null,"dx",d),m.setAttributeNS(null,"dy",d),0>=d&&this.baseGroup?this.baseGroup.removeAttributeNS(null,"filter"):this.baseGroup.hasAttributeNS(null,"filter")||this.baseGroup.setAttributeNS(null,"filter",p))};this.data_ctat_handlers["shadow-distance"]=function(b){this.setDropShadowDistance(b)}};CTATPieChart.prototype=Object.create(CTAT.Component.Base.UnitDisplay.prototype);
CTATPieChart.prototype.constructor=CTATPieChart;CTAT.ComponentRegistry.addComponentType("CTATPieChart",CTATPieChart);var CTATRadioButton=function(a,f,g,e,c){CTAT.Component.Base.Clickable.call(this,"CTATRadioButton","__undefined__",a,f,g,e,c);var b=CTATConfiguration.get("previewMode"),d=this,h=null,n=null,l="#000000";this.setSelection(this.getComponentGroup());this.setAction("UpdateRadioButton");this.setStyleHandler("BackgroundColor",null);this.init=function(){d.setInitialized(!0);h=document.createElement("input");h.type="radio";h.id=this.getName()+"_radio";h.value=d.getName();this.getComponentGroup()?h.name=d.getComponentGroup():
this.getDivWrap()&&$(this.getDivWrap()).attr("name")?h.name=$(this.getDivWrap()).attr("name"):h.name="radioButtonGroup";!0===d.getEnabled()?h.disabled=!1:h.disabled=!0;d.addComponentReference(d,h);var a;b||(a=this.getDivWrap().innerHTML,this.getDivWrap().innerHTML="");d.getDivWrap().appendChild(h);n=document.createElement("label");n.htmlFor=h.id;this.getText()?n.textContent=d.getText():a&&!b?n.innerHTML=a:this.getDivWrap().getAttribute("data-ctat-label")&&(n.textContent=this.getDivWrap().getAttribute("data-ctat-label"));
d.setComponent(h);this.getDivWrap().appendChild(n);h.addEventListener("click",function(b){d.updateSAI();d.processAction()});h.addEventListener("focus",this.processFocus);h.onfocus=this.processOnFocus;this.setSelection(this.getComponentGroup());this.component.addEventListener("focus",this.processFocus)};this.getConfigurationActions=function(){var b=[];if(0<n.innerHTML.trim().length){var a=new CTATSAI;a.setSelection(this.getName());a.setInput(n.innerHTML.toString());a.setAction("setText");b.push(a)}return b};
this.setFontColor=function(b){l=b;$(n).css("color",b)};this.getFontColor=function(){return l};this.resize=function(){var b=$(this.getDivWrap()).height();$(n).css("font-size",b-5+"px");$(this.getComponent()).css("height",b-10+"px");$(this.getComponent()).css("width",b-10+"px")};var p=this.setText;this.setText=function(b){p(b);null!==n&&(n.innerHTML=this.getText())};this.setStyleHandler("buttonLabel",this.setText);var m=this.setEnabled;this.setEnabled=function(b){m(b);null!==h&&(h.disabled=!this.getEnabled())};
this.setChecked=function(b){null!==h&&(h.checked=b)};this.getChecked=function(){return h.checked};this.getRadioInput=function(){return h.checked?h.value+": "+n.textContent:""};this.setStyleHandler("labelPlacement",null);this.reset=function(){d.ctatdebug(" reset ( "+d.getName()+")");h.checked=!1;d.setEnabled(!0)};this.UpdateRadioButton=function(b){0<=b.indexOf(h.value)&&d.setChecked(!0);d.ctatdebug("UpdateRadioButton ()")};this.updateSAI=function(){var b=$("."+this.getClassName()+'[data-ctat-component]:has(input[type="radio"][name="'+
h.name+'"]:checked)'),a="";1===b.length&&(a=$(b[0]).data("CTATComponent").getRadioInput());d.setSelection(h.name);d.setInput(a)};var q=function(b){n&&n.classList.add(b);h&&h.classList.add(b)},u=function(b){n&&n.classList.remove(b);h&&h.classList.remove(b)};this.showCorrect=function(b){u("CTAT--hint");u("CTAT--incorrect");(b?0===b.getInput().indexOf(h.value):1)?q("CTAT--correct"):u("CTAT-correct")};this.removeCorrect=function(){u("CTAT--correct")};this.showInCorrect=function(b){u("CTAT--hint");u("CTAT--correct");
(b?0===b.getInput().indexOf(h.value):1)?q("CTAT--incorrect"):u("CTAT-incorrect")};this.removeInCorrect=u.bind(this,"CTAT--incorrect");this.showHintHighlight=function(b){this.removeCorrect();this.removeInCorrect();b?q("CTAT--hint"):u("CTAT--hint")}};CTATRadioButton.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTATRadioButton.prototype.constructor=CTATRadioButton;CTAT.ComponentRegistry.addComponentType("CTATRadioButton",CTATRadioButton);var CTATScrollPaneComponent=function(a,f,g,e,c){CTAT.Component.Base.Tutorable.call(this,"CTATScrollPaneComponent","__undefined__",a,f,g,e,c);var b=0,d=this;d.isTabIndexable=!1;this.getAlpha=function(){return b};this.setAlpha=function(a){b=a};this.init=function(){d.ctatdebug("init ("+d.getName()+")");d.ctatdebug("Final location: "+d.getX()+","+d.getY()+" with text: "+d.getText());d.setInitialized(!0)};this.processCommShellEvent=function(b,a){d.ctatdebug("processCommShellEvent ("+b+")")};this.processSerialization=
function(){d.ctatdebug("processSerialization()")};this.postProcess=function(){d.ctatdebug("postProcess ()");for(var b in this.parameters){var a=this.parameters[b];d.ctatdebug("Checking style name: "+b);if("TargetMovieClip"==b)if(d.ctatdebug("Loading sub element: ["+a.trim()+"] ..."),a=findMovieClip(a.trim()),null!==a){if(d.ctatdebug("Found target movieclip, temporarily removing ..."),null!==a.getDivWrapper().parentNode){try{a.getDivWrapper().parentNode.removeChild(a.getDivWrapper())}catch(m){CTATScrim.scrim.errorScrimUp(m.message);
return}d.getDivWrap().setAttribute("id","scrollsubdiv");d.ctatdebug("Adding ...");d.getDivWrap().appendChild(a.getDivWrapper());var c=a.getDivWrapper().style.left,e=a.getDivWrapper().style.top;a.getDivWrapper().style.left="0px";a.getDivWrapper().style.top="0px";d.ctatdebug("Moving canvas from: "+c+","+e+" to: 0,0");a=a.getDivWrapper().childNodes;for(c=0;c<a.length;c++);}}else d.ctatdebug("Unable to find the target movieclip to reparent the content from")}d.ctatdebug("Final location: "+d.getX()+","+
d.getY()+" with text: "+d.getText());null===CTATCommShell.commShell||void 0===CTATCommShell.commShell?d.ctatdebug("Error: can't add event listener to commshell, pointer is invalid"):CTATCommShell.commShell.addGlobalEventListener(this)};this.configFromDescription()};CTATScrollPaneComponent.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATScrollPaneComponent.prototype.constructor=CTATScrollPaneComponent;CTAT.ComponentRegistry.addComponentType("CTATScrollPaneComponent",CTATScrollPaneComponent);var CTATSkillWindow=function(a,f,g,e,c){CTAT.Component.Base.Graphical.call(this,"CTATSkillWindow","__undefined__",a,f,g,e,c);var b=this;b.isTabIndexable=!1;this.getThreshold=function(){var b=parseFloat($(this.getDivWrap()).attr("data-ctat-threshold"));return isNaN(b)?.95:b};this.setThreshold=function(b){$(this.getDivWrap()).attr("data-ctat-threshold",b)};var d=null;this.init=function(){b.ctatdebug("init ("+b.getName()+")");b.setIsAbstractComponent(!0);b.setInitialized(!0);d=this.getDivWrap();this.setComponent(d);
this.drawComponent();this.component.addEventListener("focus",this.processFocus)};this.assignSkillSet=function(b){CTATSkillSet.skills=b;this.drawComponent()};this.updateSkillSet=function(a){if(CTATSkillSet.skills){b.ctatdebug("updateSkillSet ("+a.getSkillSet().length+")");a=a.getSkillSet();for(var c=0,d=0;d<a.length;d++){var e=a[d];b.ctatdebug("Updating skill "+e.getSkillName()+" to level: "+e.getLevel()+" ...");CTATSkillSet.skills.setSkillLevel(e.getSkillName(),e.getLevel(),1);c++}0<c&&this.drawComponent()}else b.ctatdebug("Error: updateSkillSet () no initial skill set given, can't update")};
this.drawComponent=function(){b.ctatdebug("drawComponent ()");if(null===CTATSkillSet.skills)ctatdebug("Info: no skillSet object available, bumping out");else{var a=CTATSkillSet.skills.getSkillSet();if(null===a)b.ctatdebug("Error: list of skills is null in skills object");else if(0>=a.length)b.ctatdebug("Error: list of skills is 0 length");else{for(var c=document.createDocumentFragment(),e=this.getThreshold(),g=0;g<a.length;g++){var f=a[g];b.ctatdebug("Drawing skill "+g+" "+f.getDisplayName()+" level: "+
f.getLevel()+" ...");var q=document.createElement("div");q.classList.add("CTATSkillWindow--skill");var u=document.createElement("div");u.classList.add("CTATSkillWindow--bar");var v=document.createElement("div"),w=f.getLevel();w<e?v.classList.add("CTATSkillWindow--bar--nonmastered"):v.classList.add("CTATSkillWindow--bar--mastery");v.style.width=w>e?"100%":100*w+"%";u.appendChild(v);q.appendChild(u);c.appendChild(q);u=document.createElement("div");u.textContent=f.getDisplayName()||"no-name";u.classList.add("CTATSkillWindow--label");
q.appendChild(u)}d.innerHTML="";d.appendChild(c)}}}};CTATSkillWindow.prototype=Object.create(CTAT.Component.Base.Graphical.prototype);CTATSkillWindow.prototype.constructor=CTATSkillWindow;CTAT.ComponentRegistry.addComponentType("CTATSkillWindow",CTATSkillWindow);var CTATSubmitButton=function(a,f,g,e,c){CTATButton.call(this,a,f,g,e,c);this.setClassName("CTATSubmitButton");CTATConfiguration.get("previewMode");var b=this;this.setParameterHandler("target_components",function(b){this.getDivWrap().setAttribute("data-ctat-target",b);return this});var d=this.init;this.init=function(){d();this.setParameter("tutorComponent",CTAT.Component.Base.Tutorable.Options.DO_NOT_TUTOR);this.component.addEventListener("focus",this.processFocus)};var h=function(a){var c=b.getTargets();
return 0===Object.keys(c).length?!1:a===b?!1:a instanceof CTAT.Component.Base.Tutorable?c.hasOwnProperty(a.getName())||c.hasOwnProperty(a.getComponentGroup()):a instanceof CTATSAI?a.getSelection()!=b.getName()&&c.hasOwnProperty(a.getSelection()):a instanceof String?a!=b.getName()&&c.hasOwnProperty(a):a instanceof Element?a!=b.getComponent()&&(c.hasOwnProperty(a.id)||c.hasOwnProperty(a.getAttribute("name"))):!1};a=CTAT.Component.Base.Tutorable.EventType;document.addEventListener(a.correct,function(a){a.detail.sai&&
h(a.detail.component)&&b.isNotGraded()&&b.setCorrect()},!1);document.addEventListener(a.incorrect,function(a){a.detail.sai&&h(a.detail.component)&&(b.setIncorrect(),b.setEnabled(!0))},!1);document.addEventListener(a.ungrade,function(a){(a=a.detail.component)&&h(a)&&b.setNotGraded()},!1);document.addEventListener(a.action,function(a){var c=a.detail.component;c&&h(c)&&!a.detail.graded&&(b.setNotGraded(),b.setEnabled(!0))},!1);document.addEventListener(a.highlight,function(a){var c=a.detail.component;
c&&h(c)&&b.setHintHighlight(a.detail.isHighlighted)},!1);this.getTargets=function(){var b={},a=this.getDivWrap().getAttribute("data-ctat-target");a&&String(a).split(/\s*[;,]\s*/).forEach(function(a){return b[a.trim()]=1});return b};this.processClick=function(a){if(!0===b.getEnabled()){a=b.getTargets();for(var c in a)a=CTATShellTools.findComponent(c),null!==a&&0<a.length&&(a=a[0],a instanceof CTAT.Component.Base.Tutorable?a.getEnabled()&&a.grade(b):b.ctatdebug("Invalid target component: "+a))}}};
CTATSubmitButton.prototype=Object.create(CTATButtonBasedComponent.prototype);CTATSubmitButton.prototype.constructor=CTATSubmitButton;CTAT.ComponentRegistry.addComponentType("CTATSubmitButton",CTATSubmitButton);var CTATTable=function(a,f,g,e,c){CTAT.Component.Base.Tutorable.call(this,"CTATTable","__undefined__",a,f,g,e,c);var b=this,d=[],h=[],n=0;this.get_first_row_is_header=function(){return CTATGlobalFunctions.toBoolean($(this.getDivWrap()).attr("data-ctat-has-header"))};this.set_first_row_is_header=function(b){$(this.getDivWrap()).attr("data-ctat-has-header",b);this.get_first_row_is_header()?(m(),n=1):(q(),n=0)};this.setParameterHandler("FirstRowIsHeader",this.set_first_row_is_header);a=function(b){b=
parseInt($(this.getDivWrap()).attr(b));return isNaN(b)?2:b};var l=a.bind(this,"data-ctat-num-rows");this.get_row_count=l;this.set_row_count=function(b){$(this.getDivWrap()).attr("data-ctat-num-rows",b)};this.setNumRows=function(b){b=Number(b);if(!isNaN(b)){for(;this.get_row_count()<b;)this.addRow();for(;this.get_row_count()>b;)this.deleteRow()}};var p=a.bind(this,"data-ctat-num-cols");this.get_col_count=p;this.set_col_count=function(b){$(this.getDivWrap()).attr("data-ctat-num-cols",b)};this.setNumCols=
function(b){b=Number(b);if(!isNaN(b)){for(;this.get_col_count()<b;)this.addColumn();for(;this.get_col_count()>b;)this.deleteColumn()}};this.super_setName=this.setName;this.setName=function(b){this.super_setName(b);if(d&&d[0])for(var a=0;a<d.length;a++)for(var c=0;c<d[0].length;c++)d[a][c].setAttribute("id",b+".R"+a+"C"+c)};this.init=function(){b.ctatdebug("init ("+b.getName()+")");b.setInitialized(!0);var a=b.getDivWrap();b.setComponent(a);b.addComponentReference(b,a);b.render();b.ctatdebug("table name = "+
this.getName());this.adjustTableContents();this.get_first_row_is_header()?(m(),n=1):n=0};this.getConfigurationActions=function(){var b=[],a,c=$(this.getDivWrap());c.attr("data-ctat-num-rows")&&(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("setNumRows"),a.setInput(c.attr("data-ctat-num-rows")),b.push(a));c.attr("data-ctat-num-cols")&&(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("setNumCols"),a.setInput(c.attr("data-ctat-num-cols")),b.push(a));c.attr("data-ctat-has-header")&&
(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("set_first_row_is_header"),a.setInput(c.attr("data-ctat-has-header")),b.push(a));return b};var m=function(){b.ctatdebug("fix_header()");h[0].classList.add("CTATTable--headers");for(var a=0;a<d[0].length;a++)d[0][a].classList.add("CTATTable--header")}.bind(this),q=function(){b.ctatdebug("remove_header()");h[0].classList.remove("CTATTable--headers");for(var a=0;a<d[0].length;a++)d[0][a].classList.remove("CTATTable--header")}.bind(this);this.fixHeader=
m;this.removeHeader=q;var u=function(b,a){var c=document.createElement("div");a=this.getName()+".R"+b+"C"+a;c.id=a;c.classList.add("CTATTable--cell");c.classList.add("CTATTextArea");b=new CTATTextArea;b.setName(a);b.setDivWrapper(c);(a=this.getTabIndex())&&b.setTabIndex(a);b.processAttributes();b.init(!0);b.processTabOrder();b.setEnabled(this.getEnabled());$(c).data("CTATComponent",b);return c}.bind(this);this.addRow=function(){var b=document.createElement("div");b.classList.add("CTATTable--row");
var a=l();parseInt(a,10);d[a]=[];for(var c=0;c<p();c++){var e=u(a,c);d[a].push(e);b.appendChild(e)}$(this.getDivWrap()).append(b);h.push(b);this.set_row_count(a+1)};this.deleteRow=function(){var b=this.getDivWrap();b.removeChild(b.lastChild);h.pop();d.pop();this.set_row_count(this.get_row_count()-1)};this.addColumn=function(){var b=p(),a=0;h.forEach(function(c){var e=u(a,b);d[a].push(e);a<n&&e.classList.add("CTATTable--header");c.appendChild(e);a++});this.set_col_count(b+1)};this.deleteColumn=function(){this.getDivWrap();
for(var b=h.length,a=0;a<b;a++)h[a].removeChild(h[a].lastChild),d[a].pop();this.set_col_count(this.get_col_count()-1)};this.adjustTableContents=function(){b.ctatdebug("adjustTableContents()");for(var a=l(),c=0;c<a;c++){var e=document.createElement("div");e.classList.add("CTATTable--row");$(this.getDivWrap()).append(e);h.push(e);for(var g=0;g<p();g++){var f=b.getName()+".R"+c+"C"+g,n=CTATShellTools.findComponent(f);n&&0!==n.length&&n[0].getName()===f?(f=n[0].getDivWrap(),f.classList.add("CTATTable--cell")):
f=u(c,g);e.appendChild(f);d[c]||(d[c]=[]);d[c].push(f)}}}};CTATTable.prototype=Object.create(CTAT.Component.Base.Graphical.prototype);CTATTable.prototype.constructor=CTATTable;CTAT.ComponentRegistry.addComponentType("CTATTable",CTATTable);var CTATTextField=function(a,f,g,e,c){CTATTextBasedComponent.call(this,"CTATTextBasedComponent","__undefined__",a,f,g,e,c);var b=this,d=null,h,n,l=null;this.setAction("UpdateTextArea");this.init=function(){d=this.getDivWrap();b.setComponent(d);this.getText()&&(d.innerHTML=b.getText());var a=d.getAttribute("data-ctat-selectable");a&&"true"==a.toLowerCase()&&m();b.setInitialized(!0);b.addComponentReference(b,d);b.setEditable(!1);a=(a=d.getAttribute("data-ctat-enabled"))&&"true"==a.toLowerCase();b.setEnabled(a);
b.render();b.addSafeEventListener("focus",b.processFocus,d)};var p=this.setEnabled.bind(this);this.setEnabled=function(a){p(a);b.setEditable(!1)};var m=function(){[h,n].forEach(function(b,a){b=document.createElement("span");var c=document.createElement("div");a=0==a;b.className="ctattextfield-marker";b.id=a?"start-marker":"end-marker";c.className="handle";b.appendChild(c);a?(c.className+=" start-handle",h=b):(c.className+=" end-handle",n=b);b.addEventListener("click",function(b){b.stopPropagation()});
b.addEventListener("mouseup",function(b){b.stopPropagation()})});b.addSafeEventListener("mouseup",q,d)},q=function(a){if(b.getEnabled()){a=null;b.clearSelectionMarkers();if(window.getSelection){var c=window.getSelection();c.getRangeAt&&(a=c.getRangeAt(0))}else document.selection&&document.selection.createRange&&(a=document.selection.createRange());a&&!a.collapsed&&d.contains(a.startContainer)&&a.startContainer==a.endContainer?(l=a.startOffset+","+a.endOffset,b.processAction(),b.setSelectionMarkers(a)):
(l="0,0",b.processAction())}};this.setSelectionMarkers=function(b){b.insertNode(h);b.collapse(!1);b.insertNode(n)};this.clearSelectionMarkers=function(){h.parentNode&&h.parentNode.removeChild(h);n.parentNode&&n.parentNode.removeChild(n);d.normalize();l=null};this.getConfigurationActions=function(){return 0<d.innerHTML.trim().length?(console.log(d.innerHTML),this.setInput(d.innerHTML.toString()),[this.getSAI()]):[]};this.setText=function(a){b.ctatdebug("setText ("+a+")");b.assignText(a);null!==d&&
(d.innerHTML=a)};this.getValue=function(){var b=content=""+this.getDivWrap().innerHTML;l&&(content=content.replace(/<span.*?class="ctattextfield-marker".*?>.*?<\/span>/g,""),b=l+";"+content);return b};var u=this.updateSAI.bind(this);this.updateSAI=function(){l?b.setAction("TextSelected"):b.setAction("UpdateTextArea");u()};this.setStyleHandler("ShowScrollbars",function(a){!0===CTATGlobalFunctions.toBoolean(a)?b.modifyCSSAttribute("overflow","scroll"):b.modifyCSSAttribute("overflow","hidden")})};
CTATTextField.prototype=Object.create(CTATTextBasedComponent.prototype);CTATTextField.prototype.constructor=CTATTextField;CTAT.ComponentRegistry.addComponentType("CTATTextField",CTATTextField);var CTATTextInput=function(a,f,g,e,c){CTATTextBasedComponent.call(this,"CTATTextInput","__undefined__",a,f,g,e,c);var b=this,d=null,h=null,n=CTATConfiguration.get("previewMode");this.init=function(){this.ctatdebug("init ("+b.getName()+")");var c=$(this.getDivWrap()),e=c.attr("data-ctat-type");d=document.createElement("input");d.type="number"==e?"number":"text";a&&(d.name=a.name);d.setAttribute("maxlength",b.getMaxCharacters());d.setAttribute("id",CTATGlobalFunctions.gensym.div_id());b.setComponent(d);
b.disableTextAlterations(d);this.ctatdebug("Final location: "+b.getX()+","+b.getY()+" with text: "+b.getText());c.attr("value")&&this.setText(c.attr("value"));var g=$(d);"autofocus defaultValue maxLength pattern placeholder readOnly size title".split(" ").forEach(function(b){var a=c.attr(b);a&&g.attr(b,a)});b.setInitialized(!0);b.addComponentReference(b,d);b.getDivWrap().appendChild(d);b.addSafeEventListener("keypress",b.processKeypress,d);b.addSafeEventListener("focus",b.processFocus,d);$(d).on("input",
function(a){b.setNotGraded()});n&&this.addEventScreen(!1)};this.getConfigurationActions=function(){var b=[],a=$(this.getDivWrap());if(a.attr("value")){var c=new CTATSAI;c.setSelection(this.getName());c.setAction("UpdateTextField");c.setInput(a.attr("value"));b.push(c)}return b};this.setCellContainer=function(b){h=b};this.getCellContainer=function(){return h};this.setText=function(a){b.ctatdebug("setText ("+a+")");b.assignText(a);d.value=a};this.getValue=function(){return d.value};this.reset=function(){b.configFromDescription();
b.processSerialization();d.value=""};this.setStyleHandler("DrawBorder",null)};CTATTextInput.prototype=Object.create(CTATTextBasedComponent.prototype);CTATTextInput.prototype.constructor=CTATTextInput;CTAT.ComponentRegistry.addComponentType("CTATTextInput",CTATTextInput);var CTATVideo=function(a,f,g,e,c){CTAT.Component.Base.Tutorable.call(this,"CTATVideo","__undefined__",a,f,g,e,c);var b=0,d=this,h=null;this.getAlpha=function(){return b};this.setAlpha=function(a){b=a};this.ctatdebug(this.getClassName()+" ("+this.getX()+","+this.getY()+","+this.getWidth()+","+this.getHeight()+")");this.setTutorComponent(CTAT.Component.Base.Tutorable.Options.TutorComponent.DO_NOT_TUTOR);this.configFromDescription();this.init=function(){d.ctatdebug("init ("+d.getName()+")");d.addCSSAttribute("z-index",
CTATGlobalFunctions.gensym.z_index());h=document.createElement("video");this.getDivWrap()&&$(this.getDivWrap()).attr("src")&&!CTATConfiguration.get("previewMode")&&(h.src=$(this.getDivWrap()).attr("src"));this.getDivWrap()&&$(d.getDivWrap()).attr("data-ctat-controls")?h.controls=CTATGlobalFunctions.toBoolean($(this.getDivWrap()).attr("data-ctat-controls")):h.controls=!0;h.autocontrols=!1;d.ctatdebug("Auto play: "+$(d.getDivWrap()).attr("data-ctat-autoplay"));this.getDivWrap()&&$(d.getDivWrap()).attr("data-ctat-autoplay")?
h.autoplay=CTATGlobalFunctions.toBoolean($(this.getDivWrap()).attr("data-ctat-autoplay")):h.autoplay=!0;d.setComponent(h);h.name=d.getName();h.setAttribute("id",CTATGlobalFunctions.gensym.div_id());h.setAttribute("onkeypress","return noenter(event)");d.addComponentReference(d,h);d.ctatdebug("Final location: "+d.getX()+","+d.getY()+" with text: "+d.getText());d.setInitialized(!0);d.getDivWrap().appendChild(h);d.ctatdebug("Resizing component to: "+$(d.getDivWrap()).width()+","+$(d.getDivWrap()).height());
h.addEventListener("focus",this.processFocus);h.addEventListener("canplay",function(){d.ctatdebug("Video loaded and ready for play");d.sizeToDiv()},!0);h.addEventListener("play",function(){d.ctatdebug("Video loaded and ready for play");d.logVideoEvent("play")},!0);h.addEventListener("pause",function(){d.ctatdebug("Video loaded and ready for play");d.logVideoEvent("pause")},!0);d.sizeToDiv()};this.sizeToDiv=function(){h&&(h.setAttribute("width",$(d.getDivWrap()).width()),h.setAttribute("height",$(d.getDivWrap()).height()))};
var n=this.render;this.render=function(){n.call(this);this.sizeToDiv()};this.getConfigurationActions=function(){var b=[],a;$(d.getDivWrap()).attr("data-ctat-controls")&&(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("showControls"),a.setInput($(d.getDivWrap()).attr("data-ctat-controls")),b.push(a));$(d.getDivWrap()).attr("data-ctat-autoplay")&&(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("setAutoplay"),a.setInput($(d.getDivWrap()).attr("data-ctat-autoplay")),b.push(a));$(this.getDivWrap()).attr("src")&&
(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("setURL"),a.setInput($(this.getDivWrap()).attr("src")),b.push(a));return b};this.logVideoEvent=function(b){d.ctatdebug("logVideoEvent ("+b+")");if(void 0!==h.duration)if(null!==CTATCommShell.commShell){b=new CTATSAI(d.getName(),b,d.toHHMMSS(h.currentTime)+".000","");b.addSelection(encodeURIComponent(h.currentSrc),"media_file");b.addSelection(d.toHHMMSS(h.duration)+".000","clip_length");var a=b.getInputObject();null!==a&&a.setType("time");CTATCommShell.commShell.processComponentAction(b,
d.getTutorComponent(),!0,d,"VIDEO_ACTION","USER")}else d.ctatdebug("Error: commShell is null, can't send untutored tool message");else d.ctatdebug("Error: audio file not loaded yet, can't obtain duration")};this.PlayMedia=function(b){h.src=b};this.showControls=function(b){b=CTATGlobalFunctions.toBoolean(b);$(d.getDivWrap()).attr("data-ctat-controls",b);h.controls=b};this.setAutoplay=function(b){b=CTATGlobalFunctions.toBoolean(b);$(d.getDivWrap()).attr("data-ctat-autoplay",b);h.autoplay=b};this.setURL=
function(b){$(this.getDivWrap()).attr("src",b);h.src=b};this.play=function(b){d.ctatdebug("play ()");var a="0";b&&(a="number"===typeof b?String(b):"string"===typeof b?b:"0");h.currentTime=a;h.play()};this.pause=function(b){d.ctatdebug("pause ()");h.pause();var a="0";b&&(a="number"===typeof b?String(b):"string"===typeof b?b:"0");h.currentTime=a};this.stop=function(){d.ctatdebug("stop ()");d.pause()}};CTATVideo.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);
CTATVideo.prototype.constructor=CTATVideo;CTAT.ComponentRegistry.addComponentType("CTATVideo",CTATVideo);var CTATAssistments={},assistmentsTimerVar,assistmentsJSONpreface='{ "version" : "AS.1", "action" : ';function iframeToParent(a){window.parent.postMessage(a,"https://test1.assistments.org")}function iframeLoaded(){iframeToParent(assistmentsJSONpreface+'"loaded" }');assistmentsTimerVar=window.setInterval("iframeHeartbeat()",1E4)}function iframeHeartbeat(){iframeToParent(assistmentsJSONpreface+'"heartbeat"}')}
function iframeCompleted(){var a=document.getElementById("MyScore").value;iframeToParent(assistmentsJSONpreface+'"completed", "answer" : "<b>Student worked hard on this problem.</b>","score" : '+a+" }");window.clearTimeout(assistmentsTimerVar)};var CTATEnabledInPreview={},ctatEnabledInPreview={CTATButton:!0,CTATComboBox:!0,CTATAudioButton:!0,CTATImageButton:!0,CTATSubmitButton:!0,CTATTextArea:!0,CTATTextInput:!0,CTATNumericStepper:!0,CTATTable:!0,CTATHintButton:!0,CTATDoneButton:!0};var CTATTutor={drawing:!1,onMobile:!1,tutorInitialized:!1,flashVars:null};Object.defineProperty(CTATTutor,"parser",{get:function(){this._parser||(CTATConfig.parserType_is_XML()?(ctatdebug("Creating XML parser ..."),this._parser=new CTATXML):CTATConfig.parserType_is_JSON()&&(this._parser=new CTATJSON));return this._parser}});
CTATTutor.removeComponent=function(a){var f=[],g=CTATShellTools.findComponent(a);console.log("CTATTutor.removeComponent("+a+") cList",g);if(!a||!g)return f;for(var e=a=null,e=null,c=0;c<g.length;++c)if(a=g[c]){console.log("CTATTutor.removeComponent()[",c,"] ",a.getName&&a.getName(),a);(a.getComponentList?a.getComponentList():[]).forEach(function(b){CTATTutor.removeComponent(b.getName?b.getName():"")});if(e=a.getName&&a.getName())delete CTATShellTools.component_descriptions[e],f.push(e);if(e=a.getDivWrap&&
a.getDivWrap())a.setDivWrapper(null),$(e).data("CTATComponent",null),$(e).remove();console.log("CTATTutor.removeComponent()[",c,"] divWrap",e)}return f};
CTATTutor.initializeHTMLComponent=function(a,f){var g=CTAT.ComponentRegistry[f];if(f=$(a).data("CTATComponent"))return f;f=new g;$(a).attr("id")?f.setName($(a).attr("id")):(a.setAttribute("id",CTATGlobalFunctions.gensym.div_id()),f.setName(a.getAttribute("id")));f.setDivWrapper(a);f.processAttributes();f.init();f.processTabOrder();f.setEnabled(f.getEnabled());0==f.isFeedbackComponent()&&(g=new CTATComponentDescription,g.type=f.getClassName(),g.name=f.getName(),g.setComponentPointer(f),CTATShellTools.registerComponentDescription(g));
$(a).data("CTATComponent",f);CTATConfiguration.get("previewMode")&&(a=f.getDivWrap().getAttribute("data-ctat-enabled"),(g=ctatEnabledInPreview[f.getClassName()])||(g=!1),f.setEnabled(g),f.getDivWrap().setAttribute("data-ctat-enabled",a));return f};CTATTutor.initializeHTMLComponents=function(){for(var a in CTAT.ComponentRegistry)$("."+a).each(function(){$(this).data("CTATComponent")||CTATTutor.initializeHTMLComponent(this,a)});CTATShellTools.listComponents();ctatdebug("initializeHTMLComponents () done")};
var CTATComponentMutObserver=new MutationObserver(function(a,f){a.forEach(function(a){if(a.addedNodes){a=a.addedNodes;for(var e=a.length,c=0;c<e;c++){var b=a[c];if(b.nodeType===Node.ELEMENT_NODE){b.childNodes&&(a=Array.prototype.concat.call(a,Array.from(b.childNodes)));for(var e=a.length,d=/(CTAT[A-z]*)(\s|$)/g;ctatClass=d.exec(b.className);)if(CTAT.ComponentRegistry[ctatClass[1]]){CTATComponentMutObserver.disconnect();CTATTutor.initializeHTMLComponent(b,ctatClass[1]);CTATComponentMutObserver.observe(document.body,
{childList:!0,subtree:!0});break}}}}})});function addMutObserver(){console.log("adding ctatcomponent mutation observer");CTATComponentMutObserver.observe(document.body,{childList:!0,subtree:!0})}"loading"!==document.readyState?addMutObserver():document.addEventListener("DOMContentLoaded",addMutObserver);CTATTutor.callComponentFunction=function(a,f,g){if((a=CTATShellTools.findComponent(a.id))&&0<a.length){a=a[0];var e=null;f&&(e=f(a,g));return e}};
function assignNameTranslator(a){nameTranslator=a}CTATTutor.drawTutor=function(){if(!0!==this.drawing){this.drawing=!0;for(var a in CTATShellTools.component_descriptions){var f=CTATShellTools.component_descriptions[a].getComponentPointer();null!==f&&f.drawComponent()}this.drawing=!1}};
CTATTutor.initialize=function(){var a=navigator.userAgent.toLowerCase();0<a.search("iphone")?CTATTutor.onMobile=!0:0<a.search("ipod")?CTATTutor.onMobile=!0:0<a.search("android")&&(CTATTutor.onMobile=!0);a=getSafeElementById("pageor");null!==a&&!1===CTATTutor.onMobile&&(a.style.display="none");ctatdebug("initialize ()");this.initializeHTMLComponents();flashVars.getRawFlashVars();a=!0;CTATConfiguration.get("previewMode")&&(ctatdebug("In preview mode..."),a=!1);1==a?(CTATCommShell.commShell=new CTATCommShell,
CTATCommShell.commShell.init(CTATTutor)):CTATScrim.scrim.scrimDown()};
CTATTutor.createInterface=function(){ctatdebug("createInterface ("+Object.keys(CTATShellTools.component_descriptions).length+")");if(1==CTATGlobals.ignoreInterfaceDescriptions)ctatdebug("No need to process interface description messages, the interface should already be ready."),this.postProcess(),this.drawTutor();else{if(CTATGlobals.interfaceElement){ctatdebug("Re-creating interface ...");var a=CTATTutor.parser.getElementChildren(CTATGlobals.interfaceElement);CTATTutor.createStaticInterface(null,
a,null)}for(var f in CTATShellTools.component_descriptions){a=CTATShellTools.component_descriptions[f];if(!a){alert("Internal error parsing component at index "+f);return}if(!a.name){alert("Internal error parsing component at index "+f+" (no name attribute available)");return}if(-1==a.name.indexOf("null."))if(ctatdebug("Component: "+a.name+", type: "+a.type),"CTATCommShell"==a.type){if(CTATCommShell.commShell&&CTATCommShell.commShell.setName(a.name),"CTATCommShell"==a.type){ctatdebug("Tutor dimensions: "+
a.width+"x"+a.height);var g=getSafeElementById(ctatcontainer);null!==g?(ctatdebug("Setting canvas dimensions from: "+g.width+"px, "+g.height+"px, to: "+a.width+"px, "+a.height+"px"),g.width=a.width,g.height=a.height,g.style.width=a.width,g.style.height=a.height,ctatdebug("Canvas dimensions now: "+g.width+"px, "+g.height+"px")):ctatdebug("Error: tutor canvas is null, can't adjust size");g=getSafeElementById(ctatcontainer);null!==g?(g.style.width=a.width+"px",g.style.height=a.height+"px"):ctatdebug("Error: tutor container is null, can't adjust size")}}else CTAT.ComponentRegistry.hasOwnProperty(a.type)?
(ctatdebug("Creating ("+a.type+") :"+a.name),g=new CTAT.ComponentRegistry[a.type](a,a.x,a.y,a.width,a.height),g.setName(a.name),"CTATTextInput"!=a.type&&"CTATTextArea"!=a.type||g.setEnabled(!0),g.setTabIndex(a.tabIndex),a.setComponentPointer(g),g.initialize(),ctatdebug(g.getDivWrap())):ctatdebug("ERROR: Unrecognized component type "+a.type+" for "+a.name)}this.postProcess();this.drawTutor();ctatdebug("Tutor has been intialized from BRD, recalculating canvas position and size ...")}};
CTATTutor.postProcess=function(){ctatdebug("postProcess ()");for(var a in CTATShellTools.component_descriptions){var f=CTATShellTools.component_descriptions[a].getComponentPointer();null!==f?(f.getClassName(),f.postProcess&&f.postProcess()):ctatdebug("Error: component pointer "+a+" is null")}};
CTATTutor.createStaticInterface=function(a,f,g){ctatdebug("createStaticInterface ()");var e=getSafeElementById(ctatcontainer);null!==a&&(e=a);for(a=0;a<f.length;a++){var c=f[a];ctatdebug(this.parser.getElementName(c));if("timeline"==this.parser.getElementName(c)){ctatdebug("Timeline node found, obtaining visual elements ...");f=this.parser.getElementChildren(c);this.createStaticInterface(null,f,null);break}if("ctatcomponent"==this.parser.getElementName(c)){var b=this.parser.getElementAttr("instance");
g&&(ctatdebug("Registering existence of CTAT component on MovieClip container: "+b),g.addComponent(b))}var d,h,n,l;"shape"==this.parser.getElementName(c)&&(d=this.parser.getElementAttr(c,"x"),h=this.parser.getElementAttr(c,"y"),n=this.parser.getElementAttr(c,"width"),l=this.parser.getElementAttr(c,"height"),b=this.parser.getElementAttr(c,"instance"),ctatdebug("Creating shape: "+b+" at: "+d+","+h+","+n+","+l),n="data:image/png;base64, "+this.parser.getNodeTextValue(c),l=new Image,l.setAttribute("style",
"position: absolute; top: "+h+"px; left:"+d+"px; z-index:"+CTATGlobalFunctions.gensym.z_index()+";"),l.setAttribute("id",b),l.setAttribute("src",n),e.appendChild(l));"statictext"==this.parser.getElementName(c)&&(d=this.parser.getElementAttr(c,"x"),h=this.parser.getElementAttr(c,"y"),n=this.parser.getElementAttr(c,"width"),l=this.parser.getElementAttr(c,"height"),b=this.parser.getElementAttr(c,"instance"),ctatdebug("Creating static text: "+b+" at: "+d+","+h+","+n+","+l),n="data:image/png;base64, "+
this.parser.getNodeTextValue(c),l=new Image,l.setAttribute("style","position: absolute; top: "+h+"px; left:"+d+"px; z-index:"+CTATGlobalFunctions.gensym.z_index()+";"),l.setAttribute("id",b),l.setAttribute("src",n),e.appendChild(l));"statictext"==this.parser.getElementName(c)&&(b=this.parser.getElementAttr("instance"),ctatdebug("Creating movieclip: "+b),d=this.parser.getElementAttr(c,"x"),h=this.parser.getElementAttr(c,"y"),n=this.parser.getElementAttr(c,"width"),l=this.parser.getElementAttr(c,"height"),
d=new CTATMovieClip(b,d,h,n,l),h=d.wrapComponent(e),ctatdebug("Created movieclip: "+b+" at: "+d.x+","+d.y+","+d.width+","+d.height),movieclips.push(d),c=this.parser.getElementChildren(c),this.createStaticInterface(h,c,d))}};
CTATTutor.runTutor=function(){ctatdebug("runTutor ()");!0===CTATGlobals.tutorRunning?ctatdebug("The tutor is already running"):(null==CTATSkillSet.skills&&(CTATSkillSet.skills=new CTATSkillSet),window.onerror=function(a,f,g){var e=new CTATHTMLManager;ctatdebug(e.htmlEncode(a)+" in "+f+", line "+g);ctatdebug(e.htmlEncode(a)+" in "+f+", line "+g)},centerTutorContainer(),CTATTutor.initialize(),CTATGlobals.tutorRunning=!0,ctatdebug("runTutor () ... all set"))};var idleTime=0;
CTATTutor.setIdleTimeout=function(){setInterval(CTATTutor.timerIncrement,6E4);$(document).mousemove(function(a){idleTime=0});$(document).keypress(function(a){idleTime=0})};
CTATTutor.timerIncrement=function(){if(!(0>idleTime)){var a=1140,f=CTATConfiguration.get("session_timeout");if(f&&!isNaN(f))a=parseInt(f)+60;else if(!CTATLMS.identifier||0>parseInt(CTATLMS.identifier))a=1E20;idleTime+=60;idleTime>a&&(idleTime=-1,CTATScrim.scrim.OKScrimUp("The tutor timed out due to inactivity, click 'Ok' to reload the page.",function(){window.location.reload()}))}};
CTATTutor.initTutor=function(a,f,g,e){ctatdebug("initTutor() aFlashVars "+typeof a+", usingFlash "+e);if(1==CTATTutor.tutorInitialized)ctatdebug("Tutor already initialized, probably in author mode"),"undefined"!=typeof a&&a.previewMode&&(CTATScrim.scrim.scrimDown(),ctatdebug("In preview mode..."));else{CTATConfiguration.generateDefaultConfigurationObject(a,"undefined"==typeof CTATTarget?void 0:CTATTarget);switch(CTATConfiguration.get("show_debug_traces")){case "true":case "basic":useDebuggingBasic=
!0;break;case "on":case "full":useDebugging=!0;break;case "false":case "off":useDebuggingBasic=useDebugging=!1;break;default:useDebuggingBasic=!0}null==e&&(e=CTATConfiguration.usingFlash());e&&CTATScrim.scrim.scrimDown();CTATCommLibrary.setAuthenticityToken(CTATConfiguration.get("authenticity_token"));f&&(ctatcontainer=f);(a=document.getElementById(ctatcontainer))&&a.classList.add("CTATTutorContainer");a=getSafeElementById("debugtraces");null!==a&&(useDebugging=!0===a.checked?!0:!1);ctatdebug("initTutor() CTATConfiguration.get('mode')="+
CTATConfiguration.get("mode")+", window.sendToTutor="+window.sendToTutor);CTATConfiguration.get("swf_name")&&!window.sendToTutor&&(window.sendToTutor=function(b){ctatdebug("window.sendToTutor("+b+") CTAT.ToolTutor.tutor "+CTAT.ToolTutor.tutor);return CTAT.ToolTutor.tutor?CTAT.ToolTutor.tutor.receiveFromInterface(b):CTAT.ToolTutor.tutorMessages.push(b)},window.registerInterface=function(b){CTAT.ToolTutor.registerInterfaceMessageHandler(b)});"javascript"==String(CTATConfiguration.get("tutoring_service_communication")).toLowerCase()&&
("undefined"!=typeof CTATExampleTracer&&CTATExampleTracer?CTAT.ToolTutor.registerTutor(new CTATExampleTracer):CTATScrim.scrim.warningScrimUp('Tutoring service communication parameter is "JavaScript" but class\nCTATExampleTracer is missing. Use a different ctat-*.js script.'));ctatdebug("initTutor ()");"applet"==CTATConfiguration.get("tutoring_service_communication")&&deployJava.runApplet({id:"TSApplet",width:150,height:10},{jnlp_href:"/ctat_applet/TSApplet.jnlp"},"1.6");e||CTATTutor.runTutor();CTATTutor.setIdleTimeout();
CTATTutor.tutorInitialized=!0;if(document&&typeof("function"==document.dispatchEvent)){var c={student_interface:CTATConfiguration.get("student_interface"),question_file:CTATConfiguration.get("question_file")};parent instanceof Window&&location.origin&&parent.postMessage({command:"tutorInitialized",data:c},location.origin);(function(b){return new Promise(function(a){return setTimeout(a,b)})})(0).then(function(){return document.dispatchEvent(new CustomEvent("tutorInitialized",c))})}}};
window.hasOwnProperty("initTutor")||(window.initTutor=CTATTutor.initTutor);function receiveFromTutor(){ctatdebug("receiveFromTutor ()")}function saveAndQuit(){ctatdebug("saveAndQuit ()")}function prepTutorArea(){initTutor()}window.prepTutorArea=prepTutorArea;function assignAnonymousGradingProcessor(a){CTATCommShell.commShell.assignAnonymousGradingProcessor(a)}
function gradeAnonymousComponent(a,f,g){ctatdebug("gradeAnonymousComponent ()");a=new CTATSAI(a,f,g);CTATCommShell.commShell.processComponentAction(a)}function testTutor(a){ctatdebug("testTutor ()");window.onerror=function(a,g,e){var c=new CTATHTMLManager;ctatdebug(c.htmlEncode(a)+" in "+g+", line "+e)};null==CTATSkillSet.skills&&(CTATSkillSet.skills=new CTATSkillSet);(new CTATCommLibrary).send("http://augustus.pslc.cs.cmu.edu/crossdomain.xml")}
function centerTutorContainer(){ctatdebug("centerTutorContainer ()");var a=getSafeElementById(ctatcontainer);if(null==a)ctatdebug("Tutor container not found, bump");else{var f;if(flashVars){f=flashVars.getRawFlashVars();var g,e;g=a.offsetWidth;e=a.offsetHeight;f&&f.width&&f.height&&(ctatdebug("We have raw width and height variables in our flashvars: "+f.width+","+f.height),g=f.width,e=f.height);f.centerTutor?1==f.centerTutor&&(ctatdebug("Moving tutor over by: "+("-"+Number(g/2)+"px 0 0 -"+Number(e/
2)+"px;")),a.style.position="absolute",a.style.top="0",a.style.left="0",a.style.right="0",a.style.bottom="0",a.style.margin="auto"):ctatdebug("The tutor is not configured to center the container, bump")}else ctatdebug("No flashvars yet, bump")}}
function checkTutorCanvas(){ctatdebug("checkTutorCanvas ()");var a=getSafeElementById(ctatcontainer),f=getSafeElementById("main-canvas"),g=flashVars.getRawFlashVars(),e="550",c="450";a&&(ctatdebug("Recording the actual CSS width and height: "+a.offsetWidth+" , "+a.offsetHeight),e=a.offsetWidth,c=a.offsetHeight);g&&g.width&&g.height&&(ctatdebug("We have tutor size flashvars, using those instead: "+g.width+" , "+g.height),e=g.width,c=g.height);null===f?(ctatdebug("No canvas available, creating ..."),
f=document.createElement("canvas"),f.id="main-canvas",f.innerHTML="Your browser does not support CTAT. Please update or use another browser.",ctatdebug("Setting canvas to: 0,0,"+e+" , "+c),getSafeElementById(ctatcontainer).appendChild(f)):(ctatdebug("Setting canvas to: 0 , 0, "+e+" , "+c),f.style.top="0",f.style.left="0");f.style.width=e+"px";f.style.height=c+"px";return f};var CTATProtractor=function(a,f,g,e,c){function b(b,a,c,e,g){g=void 0===g?!0:g;this.protractor=b;this.name=a;this.point;this.ray;this.label;this.arrow;this.x=c;this.y=e;this.move=g;this.bd;var f=this;this.scalefactor;this.df;this.hidden=!1;this.renderProtRay=function(){this.scalefactor=f.protractor.magnitude/320;this.label.setAttributeNS(null,"x",this.x+.09*f.protractor.magnitude);this.label.setAttributeNS(null,"y",this.y);this.ray.setAttributeNS(null,"x1",f.protractor.origin.x);this.ray.setAttributeNS(null,
"y1",f.protractor.origin.y);this.ray.setAttributeNS(null,"x2",this.x);this.ray.setAttributeNS(null,"y2",this.y);this.point.setAttributeNS(null,"cx",this.x);this.point.setAttributeNS(null,"cy",this.y);this.point.setAttributeNS(null,"r",3+3*this.scalefactor);this.arrow.setAttributeNS(null,"points",this.x+","+this.y+" "+(this.x+5*this.scalefactor)+","+(this.y+3*this.scalefactor)+" "+this.x+","+(this.y-10*this.scalefactor)+" "+(this.x-5*this.scalefactor)+","+(this.y+3*this.scalefactor))};this.rerenderProtray=
function(){start90=this.protractor.getPointFromAnglitude(90,this.protractor.magnitude);this.x=start90.x;this.y=start90.y;this.renderProtRay();this.moveTo(this.protractor.getPointFromAnglitude(this.bd,this.protractor.magnitude))};this.createProtRay=function(){this.scalefactor=f.protractor.magnitude/320;this.df=document.createDocumentFragment();label=document.createElementNS(d,"text");label.classList.add("CTATProtractor--labelray");label.setAttributeNS(null,"id","label_"+this.name);label.appendChild(document.createTextNode(this.name));
ray=document.createElementNS(d,"line");ray.setAttributeNS(null,"id","ray_"+this.name);point=document.createElementNS(d,"circle");point.setAttributeNS(null,"id","point_"+this.name);arrow=document.createElementNS(d,"polygon");arrow.setAttributeNS(null,"id","arrow_"+this.name);f.point=point;f.ray=ray;f.label=label;f.arrow=arrow;this.renderProtRay();this.df.appendChild(label);this.df.appendChild(ray);this.df.appendChild(arrow);this.df.appendChild(point)};this.createProtRay();this.drawProtRay=function(){this.move?
(this.point.classList.add("CTATProtractor--select"),f.protractor._protrays.append(this.df)):f.protractor._fgrays.append(this.df);this.bd=this.getAngle()};this.point.getProtRay=function(){return f};this.moveTo=function(a){move_angle=f.protractor.calcAngle(a);move_mag=f.protractor.calcMagMult(a);point_coord=f.protractor.getPointFromAnglitude(move_angle,f.protractor.magnitude);ray_coord=f.protractor.getPointFromAnglitude(move_angle,f.protractor.magnitude*(move_mag+.075));this.point.setAttributeNS(null,
"cx",a.x);this.point.setAttributeNS(null,"cy",a.y);this.ray.setAttributeNS(null,"x2",ray_coord.x);this.ray.setAttributeNS(null,"y2",ray_coord.y);arrow_angle=move_angle-90;this.arrow.setAttributeNS(null,"transform","rotate("+arrow_angle+" "+b.origin.x+" "+b.origin.y+") translate(0 "+(1-move_mag-.075)*f.protractor.magnitude+")");this.move?(60>move_angle||120<move_angle?this.label.setAttributeNS(null,"y",1.1*a.y):this.label.setAttributeNS(null,"y",.9*a.y),a.x>=this.protractor.origin.x?this.label.setAttributeNS(null,
"x",a.x+.07*f.protractor.magnitude):this.label.setAttributeNS(null,"x",a.x-.07*f.protractor.magnitude)):(this.label.setAttributeNS(null,"x",a.x),this.label.setAttributeNS(null,"y",a.y+.08*f.protractor.magnitude));this.bd=this.getAngle()};this.setPoint=function(b){function a(b){setTimeout(function(){f.moveTo(f.protractor.getPointFromAnglitude(b,f.protractor.magnitude));e?b++:b--;b!=d?setTimeout(function(){a(b)},11):setTimeout(function(){f.moveTo(f.protractor.getPointFromAnglitude(d,f.protractor.magnitude))},
11);11})}var c=Math.floor(this.getAngle()),d=Math.floor(b),e=!0;if(0<c-d)e=!1;else if(c==d){f.moveTo(f.protractor.getPointFromAnglitude(d,f.protractor.magnitude));return}a(c)};this.differentialProtrayMove=function(b,a){if(!this.move)return console.error('Ray "'+this.name+'" is a non-moving base ray, so should not move.'),!1;var c=this.bd-b.bd;a-=Math.abs(c);if(1>Math.abs(a))return!1;if(0>c){if(c=this.bd-a,0>c||180<c)if(c=b.bd+a,0>c||180<c)return console.log("New angle not possible with Ray "+this.name),
!1}else if(c=this.bd+a,0>c||180<c)if(c=b.bd-a,0>c||180<c)return console.log("New angle not possible with Ray "+this.name),!1;this.setPoint(c);return!0};this.getAngle=function(){var b=this.point.getAttributeNS(null,"cx"),a=this.point.getAttributeNS(null,"cy");coord={x:b,y:a};return this.protractor.calcAngle(coord)};this.genInput=function(){function b(b){b.name!=f.name&&(rep_value=Math.abs(Math.round(f.bd-b.bd)),f.protractor.measureunit.includes("deg")||(rep_value=f.protractor.convertUnits(rep_value)),
a[f.name+f.protractor.baseOrigin+b.name]=rep_value)}var a={};Object.values(this.protractor.basePoints).forEach(b);Object.values(this.protractor.interactivePoints).forEach(b);return a};this.deactivateProtRay=function(){this.point.classList.add("unselectable");this.point.classList.remove("CTATProtractor--select")};this.reactivateProtRay=function(){this.point.classList.remove("unselectable");this.point.classList.add("CTATProtractor--select")};this.hideProtRay=function(){this.deactivateProtRay();$("#point_"+
this.name).hide();$("#label_"+this.name).hide();$("#ray_"+this.name).hide();$("#arrow_"+this.name).hide();this.hidden=!0};this.showProtRay=function(){this.reactivateProtRay();$("#point_"+this.name).show();$("#label_"+this.name).show();$("#ray_"+this.name).show();$("#arrow_"+this.name).show();this.hidden=!1};this.fadeOutProtRay=function(){this.deactivateProtRay();$("#point_"+this.name).fadeOut(this.protractor.fadespd);$("#label_"+this.name).fadeOut(this.protractor.fadespd);$("#ray_"+this.name).fadeOut(this.protractor.fadespd);
$("#arrow_"+this.name).fadeOut(this.protractor.fadespd);this.hidden=!0};this.fadeInProtRay=function(){this.reactivateProtRay();$("#point_"+this.name).fadeIn(this.protractor.fadespd);$("#label_"+this.name).fadeIn(this.protractor.fadespd);$("#ray_"+this.name).fadeIn(this.protractor.fadespd);$("#arrow_"+this.name).fadeIn(this.protractor.fadespd);this.hidden=!1};this.styleCorrect=function(){this.deStyle();this.ray.classList.add("CTATProtractor--correct")};this.styleIncorrect=function(){this.deStyle();
this.point.classList.add("CTATProtractor--incorrect");this.ray.classList.add("CTATProtractor--incorrect")};this.styleHint=function(){this.deStyle();this.point.classList.add("CTATProtractor--hint");this.ray.classList.add("CTATProtractor--hint")};this.deStyle=function(){this.point.classList.remove("CTATProtractor--correct");this.point.classList.remove("CTATProtractor--incorrect");this.point.classList.remove("CTATProtractor--hint");this.ray.classList.remove("CTATProtractor--correct");this.ray.classList.remove("CTATProtractor--incorrect");
this.ray.classList.remove("CTATProtractor--hint")}}CTAT.Component.Base.SVG.call(this,"CTATProtractor","aProtractor",a,f,g,e,c);this.magnitude;this.numIntPoints=1;this.radians=0;this.interval=15;this.snap=!0;this.snaps=[];this.protRays=[];this.origin={x:null,y:null};this.leftBound;this.rightBound;this.topBound;this.bottomBound;this.fadespd=1E3;this.basePointString="OB";this.baseOrigin="O";this.basePoints={};this.interactivePointString="A";this.interactivePoints={};this.innerLabels="none";this.outerLabels=
"counterclockwise degrees";this.chosenAngle;this.chosen=!1;this.measureunit="degrees";this.precision=2;this.denominator=null;this.dragOnArc=!0;this.radsnap=!1;this.radsnaps=[];var d=CTATGlobals.NameSpace.svg,h;this.getConfigurationActions=function(){var b=[],a,c=$(this.getDivWrap());c.attr("data-ctat-interactive-points")&&(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("setInteractivePoints"),a.setInput(c.attr("data-ctat-interactive-points")),b.push(a));c.attr("data-ctat-base-points")&&
(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("setBasePoints"),a.setInput(c.attr("data-ctat-base-points")),b.push(a));c.attr("data-ctat-outer-labels")&&(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("setOuterLabels"),a.setInput(c.attr("data-ctat-outer-labels")),b.push(a));c.attr("data-ctat-inner-labels")&&(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("setInnerLabels"),a.setInput(c.attr("data-ctat-inner-labels")),b.push(a));c.attr("data-ctat-unit-of-measure")&&(a=
new CTATSAI,a.setSelection(this.getName()),a.setAction("setUOM"),a.setInput(c.attr("data-ctat-unit-of-measure")),b.push(a));c.attr("data-ctat-precision")&&(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("setRadPrecision"),a.setInput(c.attr("data-ctat-precision")),b.push(a));c.attr("data-ctat-interval")&&(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("setInterval"),a.setInput(c.attr("data-ctat-interval")),b.push(a));c.attr("data-ctat-snap")&&(a=new CTATSAI,a.setSelection(this.getName()),
a.setAction("setSnap"),a.setInput(c.attr("data-ctat-snap")),b.push(a));c.attr("data-ctat-drag-on-arc")&&(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("setDragOnArc"),a.setInput(c.attr("data-ctat-drag-on-arc")),b.push(a));return b};this.setInteractivePoints=function(b){this.interactivePointString=b;this.numIntPoints=b.length};this.setParameterHandler("interactivePoints",this.setInteractivePoints);this.data_ctat_handlers.interactivePoints=this.setInteractivePoints;this.setBasePoints=function(b){this.basePointString=
b};this.setParameterHandler("basePoints",this.setBasePoints);this.data_ctat_handlers.basePoints=this.setBasePoints;this.setUOM=function(b){b.includes("rad")?(this.measureunit="rad",this.radsnap=!0):b.includes("frac")&&(this.measureunit="frac",this.radsnap=!0)};this.setParameterHandler("unitOfMeasure",this.setUOM);this.data_ctat_handlers.unitOfMeasure=this.setUOM;this.setRadPrecision=function(b){this.measureunit.includes("frac")?this.denominator=b:this.precision=b};this.setParameterHandler("precision",
this.setRadPrecision);this.data_ctat_handlers.precision=this.setRadPrecision;this.setSnap=function(b){b||(this.snap=!1)};this.setParameterHandler("snap",this.setSnap);this.data_ctat_handlers.snap=this.setSnap;this.setInterval=function(b){0!==180%b||90<b?console.log("Unacceptable value for data-ctat-interval set.  Value must evenly divide 180 degrees. Defaulting to 15."):this.interval=b};this.setParameterHandler("interval",this.setInterval);this.data_ctat_handlers.interval=this.setInterval;this.setDragOnArc=
function(b){this.dragOnArc=b};this.setParameterHandler("dragOnArc",this.setDragOnArc);this.data_ctat_handlers.dragOnArc=this.setDragOnArc;var n=function(b){b.target.classList.contains("CTATProtractor--select")&&(b.preventDefault(),this.removeRayStyles(),h=b.target.getProtRay())}.bind(this),l=function(b){h&&(b.preventDefault(),b=this.getMousePosition(b),b.x<this.leftBound&&(b.x=this.leftBound),b.x>this.rightBound&&(b.x=this.rightBound),b.y<this.topBound&&(b.y=this.topBound),b.y>this.bottomBound&&(b.y=
this.bottomBound),this.snap?h.moveTo(this.getClosestSnap(b)):this.radsnap?h.moveTo(this.getClosestSnap(b,!0)):this.dragOnArc?h.moveTo(this.getPointFromAnglitude(this.calcAngle(b),this.magnitude)):h.moveTo(b))}.bind(this),p=function(b){h&&(b=this.getMousePosition(b),this.snap?b=this.getClosestSnap(b):this.radsnap&&(b=this.getClosestSnap(b,!0)),b=Math.round(this.calcAngle(b)),0>b?b=0:180<b&&(b=180),h.setPoint(b),sas_input=h.genInput(),b=this.chosen?void 0!==sas_input[this.chosenAngle]?sas_input[this.chosenAngle]:
sas_input[this.chosenAngle.charAt(2)+this.chosenAngle.charAt(1)+this.chosenAngle.charAt(0)]?sas_input[this.chosenAngle.charAt(2)+this.chosenAngle.charAt(1)+this.chosenAngle.charAt(0)]:"Incorrect point selected!":JSON.stringify(sas_input).slice(1,-1),this.setActionInput("setAngle",b),this.processAction(),h=null)}.bind(this);this.getMousePosition=function(b){var a=this.component.firstElementChild.getScreenCTM();return{x:(b.clientX-a.e)/a.a,y:(b.clientY-a.f)/a.d}};this.removeRayStyles=function(){Object.values(this.interactivePoints).forEach(function(b){b.deStyle()});
Object.values(this.basePoints).forEach(function(b){b.deStyle()})};this.init=function(){var b=this.getDivWrap();this.initSVG();this.component.classList.add("CTATProtractor--container");this._compass=document.createElementNS(d,"g");this._compass.classList.add("CTATProtractor--compass","unselectable");this._labels=document.createElementNS(d,"g");this._labels.classList.add("CTATProtractor--labels","unselectable");this._fgrays=document.createElementNS(d,"g");this._fgrays.classList.add("CTATProtractor--fgrays",
"unselectable");this._protrays=document.createElementNS(d,"g");this._protrays.classList.add("CTATProtractor--protrays");this.component.appendChild(this._compass);this.component.appendChild(this._labels);this.component.appendChild(this._fgrays);this.component.appendChild(this._protrays);this.component.addEventListener("mousedown",n);this.component.addEventListener("mousemove",l);this.component.addEventListener("mouseup",p);this.dimensionalize();this.checkFractionInterval();this.drawCompass();this.initialBasePoints();
this.initialInteractivePoints();this.initialPositions();this.checkSingleAngleMode();this.setSnaps();this.setRadSnaps();this.drawOriginLabel();this.drawLabels();this.component.setAttributeNS(null,"viewBox","0,0,800,400");this.component.setAttributeNS(null,"preserveAspectRatio","xMidYMid meet");this.setComponent(b);this.setInitialized(!0);this.addComponentReference(this,b)};this.oldDimensionalize=function(){var b=this.getBoundingBox();this.leftBound=Math.floor(.05*b.width);this.rightBound=Math.floor(.95*
b.width);this.topBound=Math.floor(.05*b.height);this.bottomBound=Math.floor(.95*b.height);this.magnitude=Math.min(.4*b.width,.8*b.height);this.origin.x=b.width/2;this.origin.y=b.height/2+this.magnitude/2};this.dimensionalize=function(){this.leftBound=10;this.rightBound=790;this.topBound=10;this.bottomBound=360;this.magnitude=320;this.origin.x=400;this.origin.y=360;this.setFontSize()};this.setAngle=function(b){var a="{"+b+"}",c,d,e;this.chosen?(c=this.chosenAngle.charAt(0),d=this.chosenAngle.charAt(2)):
(specified_angles=JSON.parse(a),c=Object.keys(specified_angles)[0][0],d=Object.keys(specified_angles)[0][2]);a=this.findProtray(c);e=this.findProtray(d);targetAngleName=c+this.baseOrigin+d;targetAngle=null;targetAngle=this.chosen?b:specified_angles[targetAngleName];null!=targetAngle&&(this.measureunit.includes("deg")||(targetAngle=this.convertToDegrees(targetAngle)),a.differentialProtrayMove(e,targetAngle))};this.chooseAngle=function(b){this.chosenAngle=b;this.chosen=!0};this.findProtray=function(b){if(this.interactivePoints[b])return this.interactivePoints[b];
if(this.basePoints[b])return this.basePoints[b];console.error("Point/Ray not found! Name: "+b)};this.reportAngle=function(b){reportAngle_selectedKey=b.charAt(0);reportAngle_oppKey=b.charAt(2);reportAngle_selectedRay=this.findProtray(reportAngle_selectedKey);reportAngle_oppRay=this.findProtray(reportAngle_oppKey);reportAngle_final=this.convertUnits(Math.abs(reportAngle_selectedRay.bd-reportAngle_oppRay.bd));"number"===typeof reportAngle_final&&(reportAngle_final=Math.round(reportAngle_final));return reportAngle_final};
this.initialInteractivePoints=function(){for(i=0;i<this.numIntPoints;i++)this.basePointString.includes(this.interactivePointString.charAt(i))?console.error('Interactive point "'+this.interactivePointString.charAt(i)+'" in CTATProtractor "'+this.getDivWrap().id+'" is already a base point; choose unique names for all points!'):this.interactivePoints[this.interactivePointString.charAt(i)]=null;var a=Object.keys(this.interactivePoints);start90=this.getPointFromAnglitude(90,this.magnitude);var c=function(a,
c,d){this.interactivePoints[a]=new b(this,a,start90.x,start90.y)}.bind(this);a.forEach(c);Object.values(this.interactivePoints).forEach(function(b){b.drawProtRay()})};this.initialPositions=function(){start=intrv=Math.floor(180/(this.numIntPoints+1));self=this;Object.values(this.interactivePoints).forEach(function(b){b.moveTo(self.getPointFromAnglitude(start,self.magnitude));start+=intrv})};this.initialBasePoints=function(){var a=this.basePointString.length;0>=a||(this.baseOrigin=this.basePointString.charAt(0),
2>a||(start90=this.getPointFromAnglitude(90,this.magnitude),1<a&&(point_name=this.basePointString.charAt(1),this.basePoints[point_name]=new b(this,point_name,start90.x,start90.y,!1),this.basePoints[point_name].drawProtRay(),this.basePoints[point_name].moveTo(this.getPointFromAnglitude(180,this.magnitude))),2<a&&(this.basePointString.charAt(1)===this.basePointString.charAt(2)?(console.warn('Duplicate names for base points in CTATProtractor "'+this.getDivWrap().id+'"; please check your data-ctat-base-points property.'),
this.basePointString=this.basePointString.slice(0,2)):(point_name=this.basePointString.charAt(2),this.basePoints[point_name]=new b(this,point_name,start90.x,start90.y,!1),this.basePoints[point_name].drawProtRay(),this.basePoints[point_name].moveTo(this.getPointFromAnglitude(0,this.magnitude))))))};this.checkSingleAngleMode=function(){1===Object.keys(this.interactivePoints).length&&1===Object.keys(this.basePoints).length&&this.chooseAngle(this.interactivePointString+this.basePointString)};this.render=
function(){this.dimensionalize();this.renderCompass();Object.values(this.interactivePoints).forEach(function(b){b.rerenderProtray()});Object.values(this.basePoints).forEach(function(b){b.rerenderProtray()});this.snaps=[];this.setSnaps();this.radsnaps=[];this.setRadSnaps();this.redrawLabels()};this.createTick=function(b,a){tick=document.createElementNS(d,"line");tick.setAttributeNS(null,"x1",b.x);tick.setAttributeNS(null,"y1",b.y);tick.setAttributeNS(null,"x2",a.x);tick.setAttributeNS(null,"y2",a.y);
tick.classList.add("CTATProtractor--ticks");return tick};this.createTicks=function(){for(j=intrv=this.interval;179>=j;j+=intrv)coord1=this.getPointFromAnglitude(j,.97*this.magnitude),coord2=this.getPointFromAnglitude(j,1.03*this.magnitude),this._compass.appendChild(this.createTick(coord1,coord2))};this.checkFractionInterval=function(){null!==this.denominator&&(this.interval=180/this.denominator)};this.deleteTicks=function(){ticks=this._compass.children;length=ticks.length;for(i=length-1;1<=i;i--)ticks[i].remove()};
this.drawCompass=function(){compass=document.createElementNS(d,"path");compass.setAttributeNS(null,"d","M "+this.origin.x+" "+this.origin.y+"H "+(this.origin.x+this.magnitude)+" A "+this.magnitude+" "+this.magnitude+" 0 0 0 "+(this.origin.x-this.magnitude)+" "+this.origin.y+" H "+this.origin.x);this._compass.appendChild(compass);this.createTicks()};this.renderCompass=function(){this.deleteTicks();this._compass.firstElementChild.setAttributeNS(null,"d","M "+this.origin.x+" "+this.origin.y+"H "+(this.origin.x+
this.magnitude)+" A "+this.magnitude+" "+this.magnitude+" 0 0 0 "+(this.origin.x-this.magnitude)+" "+this.origin.y+" H "+this.origin.x);this.createTicks()};this.resetLabels=function(b){this.compLabels=parseInt(b);this.getDivWrap().setAttribute("data-ctat-complabels",b);this.redrawLabels()};this.setFontSize=function(){this.component.style.fontSize=7+.04*this.magnitude+"px"};this.resetRadians=function(b){this.radians=parseInt(b);this.getDivWrap().setAttribute("data-ctat-radians",labelcode);this.redrawLabels()};
this.createLabel=function(b,a,c,e){label=document.createElementNS(d,"text");label.setAttributeNS(null,"x",b);label.setAttributeNS(null,"y",a);label.setAttributeNS(null,"class",e);label.appendChild(document.createTextNode(c));this._labels.appendChild(label)};this.drawOriginLabel=function(){this.createLabel(this.origin.x,this.origin.y+.07*this.magnitude,this.baseOrigin,"CTATProtractor--label-origin")};this.drawLabels=function(){0==90%this.interval&&("none"==this.outerLabels||this.outerLabels.includes("rad")&&
this.innerLabels.includes("rad")||this.outerLabels.includes("deg")&&this.innerLabels.includes("deg")||this.drawLabel90("top"),"none"!=this.innerLabels&&this.drawLabel90());"none"!=this.outerLabels&&this.drawLabelOuter();"none"!=this.innerLabels&&this.drawLabelInner()};this.redrawLabels=function(){this.deleteLabels();this.drawLabels();this.drawOriginLabel()};this.lookupRadians=function(b){fraction=this.reduceDegreesToFrac(b);b=fraction[0];if(0===fraction[0])return"0";1===fraction[0]&&(b="");return 1===
fraction[1]?"\u03c0":b+"\u03c0/"+fraction[1]};this.setOuterLabels=function(b){this.outerLabels=b};this.setParameterHandler("outer-labels",this.setOuterLabels);this.data_ctat_handlers["outer-labels"]=this.setOuterLabels;this.drawLabelOuter=function(){var b=!1,a=!0;this.outerLabels.includes("counter")&&(a=!1);this.outerLabels.includes("rad")&&(b=!0);var c;10>this.interval?c=2*this.interval:c=this.interval;for(j=0;180>=j;j+=c)90!==j&&(coord=this.getPointFromAnglitude(j,1.1*this.magnitude),label_num=
a?j:180-j,0===j||180===j?(0===j?xcooord=coord.x-20:180===j&&(xcooord=coord.x+20),b?this.createLabel(xcooord+.05*(xcooord-this.origin.x),coord.y+5,this.lookupRadians(label_num),"outer"):this.createLabel(xcooord,coord.y+5,label_num,"outer")):b?this.createLabel(coord.x+.05*(coord.x-this.origin.x),coord.y+5,this.lookupRadians(label_num),"outer"):this.createLabel(coord.x,coord.y+5,label_num,"outer"))};this.setInnerLabels=function(b){this.innerLabels=b};this.setParameterHandler("inner-labels",this.setInnerLabels);
this.data_ctat_handlers["inner-labels"]=this.setInnerLabels;this.drawLabelInner=function(){var b=!1,a=!0;this.innerLabels.includes("counter")&&(a=!1);this.innerLabels.includes("rad")&&(b=!0);var c;10>this.interval||15>this.interval&&b?c=2*this.interval:c=this.interval;for(j=0;180>=j;j+=c)90!==j&&(label_num=a?j:180-j,coord=this.getPointFromAnglitude(j,.9*this.magnitude),0===j||180===j?b?this.createLabel(coord.x,coord.y-5,this.lookupRadians(label_num),"inner"):this.createLabel(coord.x,coord.y-5,label_num,
"inner"):b?this.createLabel(coord.x-.07*(coord.x-this.origin.x),coord.y,this.lookupRadians(label_num),"inner"):this.createLabel(coord.x,coord.y,label_num,"inner"))};this.drawLabel90=function(b){var a=!1,c=.88*this.magnitude;"top"==(void 0===b?"bottom":b)?(c=1.05*this.magnitude,this.outerLabels.includes("rad")&&(a=!0)):this.innerLabels.includes("rad")&&(a=!0);coord=this.getPointFromAnglitude(90,c);b=a?this.lookupRadians(90):"90";this.createLabel(coord.x,coord.y,b,"CTATProtractor--label90")};this.hideLabels=
function(b){"outer"==b?$(".outer").hide():"inner"==b?$(".inner").hide():($(".outer").hide(),$(".inner").hide(),$(".CTATProtractor--label90").hide())};this.showLabels=function(b){"outer"==b?$(".outer").show():"inner"==b?$(".inner").show():($(".outer").show(),$(".inner").show(),$(".CTATProtractor--label90").show())};this.deleteLabels=function(){labels=this._labels.children;length=labels.length;for(i=length-1;0<=i;i--)labels[i].remove()};this.calcAngle=function(b){var a=b.x;b=b.y;var c=!0;a<=this.origin.x?
a=this.origin.x-a:(a-=this.origin.x,c=!1);calcd_angle=180/Math.PI*Math.atan((b<=this.origin.y?this.origin.y-b:0)/a);c||(calcd_angle=180-calcd_angle);return calcd_angle};this.calcMagMult=function(b){var a=b.y;x_mag=Math.pow(b.x-this.origin.x,2);y_mag=Math.pow(a-this.origin.y,2);return Math.sqrt(x_mag+y_mag)/this.magnitude};this.getPointFromAnglitude=function(b,a){x=this.origin.x-Math.cos(b*Math.PI/180)*a;y=this.origin.y-Math.sin(b*Math.PI/180)*a;return coord={x:x,y:y}};this.convertUnits=function(b){var a=
b;this.measureunit.includes("rad")?a=(b*Math.PI/180).toFixed(this.precision):this.measureunit.includes("frac")&&(this.denominator?(numerator=Math.round(b/180*this.denominator),a=numerator+"/"+this.denominator):(frac=this.reduceDegreesToFrac(b),a=frac[0]+"/"+frac[1]));return a};this.convertToDegrees=function(b){this.measureunit.includes("rad")?converted_val=Math.round(180*b.toInt()/Math.PI):this.measureunit.includes("frac")&&(frac_index=b.search("/"),temp_numerator=b.slice(0,frac_index).toInt(),temp_denom=
b.slice(frac_index+1).toInt(),converted_val=Math.round(temp_numerator/temp_denom*180/Math.PI));return converted_val};this.reduceDegreesToFrac=function(b){return function(b,a){var c=function B(b,a){return a?B(a,b%a):b},c=c(b,a);return[b/c,a/c]}(b,180)};this.setSnaps=function(){for(i=0;180>=i;i+=this.interval)this.snaps.push(i)};this.setRadSnaps=function(){for(i=0;180>=i;i+=this.interval/4)this.radsnaps.push(i)};this.getClosestSnap=function(b,a){a=void 0===a?!1:a;var c=this.calcAngle(b);b=a?this.radsnaps.findIndex(function(b){if(c<=
b)return!0}):this.snaps.findIndex(function(b){if(c<=b)return!0});a?(a=this.radsnaps[b-1],b=this.radsnaps[b]):(a=this.snaps[b-1],b=this.snaps[b]);return b-c>=c-a?this.getPointFromAnglitude(a,this.magnitude):this.getPointFromAnglitude(b,this.magnitude)};this.lockPoints=function(b){Object.values(this.interactivePoints).forEach(function(a){b.includes(a.name)||!b?a.deactivateProtRay():a.reactivateProtRay()})};this.unlockPoints=function(b){Object.values(this.interactivePoints).forEach(function(a){!b.includes(a.name)&&
b||a.reactivateProtRay()})};this.hidePoints=function(b){Object.values(this.interactivePoints).forEach(function(a){!b.includes(a.name)&&b||a.hidden||a.hideProtRay()})};this.showPoints=function(b){Object.values(this.interactivePoints).forEach(function(a){!b.includes(a.name)&&b||!a.hidden||a.showProtRay()})};this.fadeOutPoints=function(b){Object.values(this.interactivePoints).forEach(function(a){!b.includes(a.name)&&b||a.hidden||a.fadeOutProtRay()})};this.fadeInPoints=function(b){Object.values(this.interactivePoints).forEach(function(a){!b.includes(a.name)&&
b||!a.hidden||a.fadeInProtRay()})};this.showCorrect=function(b){var a=b.getInput();switch(b.getAction()){case "setAngle":this.chosen?(a=this.findProtray(this.chosenAngle.charAt(0)),b=this.findProtray(this.chosenAngle.charAt(2))):(showcorrect_angles=JSON.parse("{"+a+"}"),a=this.findProtray(Object.keys(showcorrect_angles)[0][0]),b=this.findProtray(Object.keys(showcorrect_angles)[0][2]));a.styleCorrect();b.styleCorrect();break;default:console.log("Correct highlights not functioning properly.")}};this.showInCorrect=
function(b){var a=b.getInput();switch(b.getAction()){case "setAngle":this.chosen?b=this.findProtray(this.chosenAngle.charAt(0)):(showincorrect_angles=JSON.parse("{"+a+"}"),b=this.findProtray(Object.keys(showincorrect_angles)[0][0]));b.styleIncorrect();break;default:console.log("Incorrect highlights not functioning properly.")}};this.showHintHighlight=function(b,a){if(a)var c=a.getInput(),d=a.getAction();switch(d){case "setAngle":this.chosen?(a=this.findProtray(this.chosenAngle.charAt(0)),b=this.findProtray(this.chosenAngle.charAt(2))):
(showhint_angles=JSON.parse("{"+c+"}"),a=this.findProtray(Object.keys(showhint_angles)[0][0]),b=this.findProtray(Object.keys(showhint_angles)[0][2])),a.styleHint(),b.styleHint()}}};CTATProtractor.prototype=Object.create(CTAT.Component.Base.SVG.prototype);CTATProtractor.prototype.constructor=CTATProtractor;CTAT.ComponentRegistry.addComponentType("CTATProtractor",CTATProtractor);!function(a,f){"object"==typeof exports&&"undefined"!=typeof module?module.exports=f():"function"==typeof define&&define.amd?define(f):a.lifecycle=f()}(this,function(){var a=void 0;try{new EventTarget,a=!1}catch(w){a=!1}var f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(b){return typeof b}:function(b){return b&&"function"==typeof Symbol&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b},g=function(b,a){if(!(b instanceof a))throw new TypeError("Cannot call a class as a function");
},e=function(){function b(b,a){for(var c=0;c<a.length;c++){var d=a[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(b,d.key,d)}}return function(a,c,d){return c&&b(a.prototype,c),d&&b(a,d),a}}(),c=function(b,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function, not "+typeof a);b.prototype=Object.create(a&&a.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}});a&&(Object.setPrototypeOf?
Object.setPrototypeOf(b,a):b.__proto__=a)},b=function(b,a){if(!b)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||"object"!=typeof a&&"function"!=typeof a?b:a},d=function(){function b(){g(this,b);this._registry={}}return e(b,[{key:"addEventListener",value:function(b,a){this._getRegistry(b).push(a)}},{key:"removeEventListener",value:function(b,a){b=this._getRegistry(b);a=b.indexOf(a);-1<a&&b.splice(a,1)}},{key:"dispatchEvent",value:function(b){return b.target=
this,Object.freeze(b),this._getRegistry(b.type).forEach(function(a){return a(b)}),!0}},{key:"_getRegistry",value:function(b){return this._registry[b]=this._registry[b]||[]}}]),b}(),h=a?EventTarget:d,n=a?Event:function B(b){g(this,B);this.type=b},l=function(a){function d(a,c){g(this,d);a=b(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,a));return a.newState=c.newState,a.oldState=c.oldState,a.originalEvent=c.originalEvent,a}return c(d,n),d}(),p="object"===("undefined"==typeof safari?"undefined":
f(safari))&&safari.pushNotification,m=["focus","blur","visibilitychange","freeze","resume","pageshow","onpageshow"in self?"pagehide":"unload"],q=function(b){return b.preventDefault(),b.returnValue="Are you sure?"},u=[["active","passive","hidden","terminated"],["active","passive","hidden","frozen"],["hidden","passive","active"],["frozen","hidden"],["frozen","active"],["frozen","passive"]].map(function(b){return b.reduce(function(b,a,c){return b[a]=c,b},{})}),v=function(){return"hidden"===document.visibilityState?
"hidden":document.hasFocus()?"active":"passive"};return new (function(a){function d(){g(this,d);var a=b(this,(d.__proto__||Object.getPrototypeOf(d)).call(this)),c=v();return a._state=c,a._unsavedChanges=[],a._handleEvents=a._handleEvents.bind(a),m.forEach(function(b){return addEventListener(b,a._handleEvents,!0)}),p&&addEventListener("beforeunload",function(b){a._safariBeforeUnloadTimeout=setTimeout(function(){b.defaultPrevented||0<b.returnValue.length||a._dispatchChangesIfNeeded(b,"hidden")},0)}),
a}return c(d,h),e(d,[{key:"addUnsavedChanges",value:function(b){-1< !this._unsavedChanges.indexOf(b)&&(0===this._unsavedChanges.length&&addEventListener("beforeunload",q),this._unsavedChanges.push(b))}},{key:"removeUnsavedChanges",value:function(b){b=this._unsavedChanges.indexOf(b);-1<b&&(this._unsavedChanges.splice(b,1),0===this._unsavedChanges.length&&removeEventListener("beforeunload",q))}},{key:"_dispatchChangesIfNeeded",value:function(b,a){if(a!==this._state){a:{for(var c=this._state,d,e=0;d=
u[e];++e){var g=d[c],f=d[a];if(0<=g&&0<=f&&f>g){a=Object.keys(d).slice(g,f+1);break a}}a=[]}for(c=0;c<a.length-1;++c)d=a[c],this._state=e=a[c+1],this.dispatchEvent(new l("statechange",{oldState:d,newState:e,originalEvent:b}))}}},{key:"_handleEvents",value:function(b){switch(p&&clearTimeout(this._safariBeforeUnloadTimeout),b.type){case "pageshow":case "resume":this._dispatchChangesIfNeeded(b,v());break;case "focus":this._dispatchChangesIfNeeded(b,"active");break;case "blur":"active"===this._state&&
this._dispatchChangesIfNeeded(b,v());break;case "pagehide":case "unload":this._dispatchChangesIfNeeded(b,b.persisted?"frozen":"terminated");break;case "visibilitychange":"frozen"!==this._state&&"terminated"!==this._state&&this._dispatchChangesIfNeeded(b,v());break;case "freeze":this._dispatchChangesIfNeeded(b,"frozen")}}},{key:"state",get:function(){return this._state}},{key:"pageWasDiscarded",get:function(){return document.wasDiscarded||!1}}]),d}())});var CTATLogger=function(a){var f={},g=0;a&&a.forEach(function(a){f[a]=!1});this.isSet=function(a){return!!f[a]};this.set=function(e){if(a&&!(e in f))return!1;g++;return f[e]=!0};this.unset=function(e){if(a&&!(e in f))return!1;g--;return!(f[e]=!1)};this.getFlags=function(){return f};this.getNFlagsSet=function(){return g};this.log=function(a,c){for(var b=[],d=1;d<arguments.length;++d)b[d-1]=arguments[d];if(f[a])d="["+a+"]:";else if("override"===a)d="";else return;2>b.length?console.log(d+(d?" ":"")+
b[0]):console.log.apply(console,[].concat([d],$jscomp.arrayFromIterable(b)))}};var CTATNoolsTracerUtil=function(){var a={},f=/^(?:[a-z]+:\/)?\//i;this.setTypes=function(g,e){console.log("setTypes()");e.forEach(function(c){a[c]=g.getDefined(c);a[c]?console.log("set type "+c):console.log("couldn't get "+c)})};this.getFactType=function(g){var e=typeof g;if("object"===e)if(e=null,g instanceof Array)e="Array";else if(g instanceof RegExp)e="RegExp";else if(g instanceof Date)e="Date";else for(t in a)if(a.hasOwnProperty(t)&&a[t]===g.constructor){e=t;break}return e};this.getTypeConstructor=
function(g){return a[g]};this.relativeToAbsolute=function(a,e){if(this.isAbsoluteURL(a))return a;e=e||window.location.origin+window.location.pathname;e=e.split("/");a=a.split("/");e.pop();for(var c=0;c<a.length;c++)"."!=a[c]&&(".."==a[c]?e.pop():e.push(a[c]));return e.join("/")};this.isAbsoluteURL=function(a){return f.test(a)};this.buildStartStateMsg=function(){var a=0,e=new CTATTutoringServiceMessageBuilder;return function(c){return e.createInterfaceActionMessage(a++,new CTATSAI(c.selection,c.action,
c.input))}}();this.buildStateGraphMsg=function(a){var e="<message><verb>SendNoteProperty</verb><properties><MessageType>StateGraph</MessageType>",c;for(c in a)a.hasOwnProperty(c)&&(e+="<"+c+">"+a[c]+"</"+c+">");return e+"</properties></message>"};this.printAgenda=function(a){return JSON.stringify(a.getAgenda())};this.printConflictTree=function(a,e){return a.getConflictTree().toString(e)};this.printFact=function(a,e,c){var b=a.getFact(e),d="";if(b){c&&(d="id: "+e+", ");var d=d+("type: "+a.getFactType(b.object)+
", "),g;try{g="values: "+JSON.stringify(b.object)}catch(n){g="< Error converting fact to JSON >"}d+=g}else d="no fact found with ID "+e;return d};this.getFacts=function(a,e){var c=[];if(Array.isArray(e)){e=$jscomp.makeIterator(e);for(var b=e.next();!b.done;b=e.next())type=b.value,c=c.concat(this.getFacts(a,type));return c}if(Number.isInteger(e))return this.getFact(a,e);c=a.getFacts(e,!0);e||(c=c.filter(function(b){b=a.getFactType(b.object);return!("hint"===b||"tpa"===b||"customfield"===b||"skill"===
b)}));return c.map(function(b){return b.object})};this.getFact=function(a,e){var c=null;"number"===typeof e?(c=a.getFact(e))&&(c=c.object):e&&"string"!==typeof e||(a=this.getFacts(a,e))&&(c=a[0]);return c};this.printFacts=function(a,e){var c=e,b="";if(Array.isArray(c)){for(var c=$jscomp.makeIterator(c),d=c.next();!d.done;d=c.next())e=d.value,b+=Number.isInteger(e)?this.printFact(a,e,!0):this.printFacts(a,e),b+="\n";return b}if(Number.isInteger(e))return this.printFact(a,e);c=a.getFacts(e,!0);e||(c=
c.filter(function(b){b=a.getFactType(b.object);return!("hint"===b||"tpa"===b||"customfield"===b||"skill"===b)}));b="got "+c.length+(e?" "+e:"")+" fact(s):\n";c.forEach(function(c){b+="id: "+c.id+", "+(e?"":"type: "+a.getFactType(c.object)+", ");var d;try{d="values: "+JSON.stringify(c.object)+"\n"}catch(l){d="< Error converting fact to JSON >\n"}b+=d});return b};this.printRules=function(a,e){a=a.getRuleNames();e&&(a=a.filter(function(a){return a.toLowerCase().includes(e)}));return a.join(", ")};this.printCtNodeMatch=
function(a,e){a=a.getNodeMatcherResult(e);var c;a&&"no match"!==a?(e=a.student,c=a.tutor,a="rule: "+a.rule+"\nstudent: "+e.selection+", "+e.action+", "+e.input+"\ntutor:   "+c.selection+", "+c.action+", "+c.input+"\nresult: "+(a.isMatch?"match":"no match")):a="no match"===a?"No match found at node "+e:"No conflict tree node found for ID "+e;return a};this.printRuleNodes=function(){function a(a){var b={};a.facts.forEach(function(c,e){var d;for(e=0;!d&&e<a.aliases.length;e++)a.factHash[a.aliases[e]]===
c.object&&(d=a.aliases[e]);d?b[d]=c:console.warn("no alias found for "+JSON.stringify(c))});return b}function e(c,b){c={};var d="NotNode"===b.nodeType||"FromNotNode"===b.nodeType;switch(b.nodeType){case "BetaNode":case "NotNode":case "ExistsNode":var e=b.rightMemory,g,f=[],p;for(p in e)g=e[p].data.match,f.push(a(g));c.factBindings=f;break;case "JoinNode":var f=b.leftMemory,m;b=[];for(e in f)for(g in m=f[e].data.rightMatches,m)p=m[g].match,b.push(a(p));c.factBindings=b;break;case "FromNode":case "FromNotNode":e=
b.fromMemory;b=[];for(f in e)for(m in g=e[f],g)p=g[m][1],p.match&&b.push(a(p.match));c.factBindings=b;break;default:c.factBindings=[]}c.isMatch=c.factBindings.length&&!d||!c.factBindings.length&&d;return c}return function(a,b){var c=!0;a=a.getRuleData(b);var g="";if(a){b=a.memoryNodes;a=[].concat(a.patterns);for(var f={},l=null,p,m,q=/("([^"]*)"):/g,u=0;u<a.length;u++)if(g+=l?"\n\t":'\npattern: "',m=a[u],m.disjuncts&&(g+="or (\n\t",l=u-1+m.disjuncts.length,a.splice.apply(a,[].concat([u,1],$jscomp.arrayFromIterable(m.disjuncts))),
m=a[u]),g+=m.string+(l?"":'"'),p=m.alias,f[p]||(f[p]=0),p=e(m,b[p][f[p]++]),p.isMatch||(g+=" NOT"),g+=" MATCHED",(m=p.factBindings).length&&(g+=" - "+m.length+" Possible bindings: ",m.forEach(function(b,a){for(var c in b)try{if("__i__"!==c){var d=JSON.stringify(b[c].object);for(a=null;a=q.exec(d);)d=d.replace(a[1],a[2]);g+="\n\t"+(l?"\t":"")+c+": "+d+" (fact ID "+b[c].id+")"}}catch(F){if(F.message.includes("circular structure"))g+="\n\t"+c+": can't print binding -- circular fact structure ";else throw F;
}g+="\n"})),u===l&&(g+='\n)"',l=null),!p.isMatch){c=!1;break}return g+"\nRule "+(c?"":"not ")+"matched"}return"Rule "+b+" not found"}}();this.printBreakpoints=function(a){return"breakpoints set for rules: "+a.getBreakpoints().join(", ")}};var CTATNoolsTracerWrapper=function(a){this.printAgenda=function(){a.printAgenda("override")};this.getAgenda=function(){return a.getAgenda()};this.printConflictTree=function(f,g){a.printConflictTree("override",f,g)};this.printPregenTrees=function(f,g){a.printPregenTrees("override",f,g)};this.printTutorSAIs=function(f){a.printTutorSAIs("override",f)};this.printFact=function(f){a.printFact(f)};this.getFact=function(f){return a.getFact(f)};this.printFacts=function(f){a.printFacts(f)};this.getFacts=function(f){return a.getFacts(f)};
this.printRules=function(f){a.printRules(f)};this.printMatch=function(f){a.printCtNodeMatch(f)};this.printRuleNodes=function(f){a.printRuleNodes(f)};this.setStepperMode=function(f){a.setInStepMode(f)};this.takeSteps=function(f,g){a.takeSteps(f,g)};this.setBreakpoint=function(f,g){a.setBreakpoint(f,g)};this.printBreakpoints=function(){a.printBreakpoints()};this.resume=function(){a.resume()};this.getProblemStateStatus=function(){return a.getProblemStateStatus()}};var CTATAlgebraTreeNode={};
(function(){var a,f=[].slice;a=function(){function a(){}a.operators=[["UNKNOWN"],["CONST"],["VAR"],["EXP","ROOT"],["UPLUS","UMINUS"],["ITIMES","TIMES","DIVIDE"],["IDIVIDE","REM"],["PLUS","MINUS"],"LESS LESSEQUAL EQUAL NOTEQUAL GREATEREQUAL GREATER".split(" ")];a.relationalOperators="LESS LESSEQUAL EQUAL NOTEQUAL GREATEREQUAL GREATER".split(" ");a.operatorPrecedence=function(a,c){return Math.sign(this.operators.findIndex(function(b){return b.includes(a)})-this.operators.findIndex(function(b){return b.includes(c)}))};a.operatorStrings=
{EXP:["^","**"],ROOT:["|","\u221a"],UPLUS:["+"],UMINUS:["-"],ITIMES:[""],TIMES:["*","\u00d7"],DIVIDE:["/","\u00f7"],IDIVIDE:["//"],REM:["%"],PLUS:["+"],MINUS:["-"],LESS:["<"],LESSEQUAL:["<=","\u2264"],EQUAL:["=","=="],NOTEQUAL:["!=","/=","<>","\u2260"],GREATEREQUAL:[">=","\u2265"],GREATER:[">"]};a.toOperatorString=function(a){var c;return(null!=(c=this.operatorStrings[a])?c[0]:void 0)||""};a.toOperator=function(a,c){var b;return null!=(b=Object.entries(this.operatorStrings).find(function(b){return function(b){return b[1].includes(a)&&
(!["UPLUS","UMINUS"].includes(b[0])||1===c)}}(this)))?b[0]:void 0};a.diff=function(a,c){return a.filter(function(b){return!c.includes(b)})};a.prototype.toString=function(a,c,b){var d,e;null==c&&(c="EQUAL");null==b&&(b=!1);d=0;for(e=this.parens;0<=e?d<e:d>e;0<=e?++d:--d)a="("+a+")";!this.parented()&&this.addParens(null,!0)&&(a="("+a+")");this.inverted()&&(a="1/"+a);this.negated()&&(a="-"+a);!this.parented()&&this.addParens(c,b)&&(a="("+a+")");return a};a.prototype.setParens=function(){this.parens++;
return this};a.prototype.addParens=function(e,c){var b;null==e&&(e=null);null==c&&(c=!1);null!=e?b=this.negated()?"UMINUS":this.inverted()?"DIVIDE":this.operator:(e=this.negated()?"MINUS":this.inverted()?"DIVIDE":null,b=this.operator);b=a.operatorPrecedence(e,b);return null!=e&&(0>b||0===b&&c)};a.prototype.addPaths=function(a){return Object.assign(this,{path:a})};a.prototype.evaluate=function(a,c){null==c&&(c=!0);return this.sign*(this.inverted()&&c?1/a:a)};a.prototype.applyOperator=function(a,c,
b){var d;null==b&&(b=!1);d=b?"DIVIDE":this.operator;return function(){switch(d){case "LESS":return a<c;case "GREATER":return a>c;case "LESSEQUAL":return a<=c;case "GREATEREQUAL":return a>=c;case "EQUAL":return a===c;case "NOTEQUAL":return a!==c;case "PLUS":return a+c;case "MINUS":return a-c;case "TIMES":case "ITIMES":return a*c;case "DIVIDE":return a/c;case "EXP":return Math.pow(a,c);case "ROOT":return Math.pow(a,1/c);case "REM":return a%c;case "IDIVIDE":return Math.floor(a/c);case "UPLUS":return a;
case "UMINUS":return-a}}()};a.prototype.equals=function(a){return a&&this.operator===a.operator&&this.sign===a.sign&&this.exp===a.exp&&this.parens===a.parens};a.prototype.subEquals=function(a,c){return!1};a.prototype.subNode=function(a,c){return this};a.prototype.countOperands=function(){return 0};a.prototype.getOperator=function(a,c){null==a&&(a=!1);return a&&this.inverted()&&"DIVIDE"||a&&this.negated()&&"UMINUS"||void 0};a.prototype.getOperators=function(a){null==a&&(a=!1);return this.getOperator(a)&&
[void 0]||[]};a.prototype.getVariables=function(){return[]};a.prototype.getOperands=function(){return[]};a.prototype.getExpression=function(a,c){null==a&&(a=0);null==c&&(c=this.countOperands()-1);return c<=this.countOperands()-1&&1<=c-a&&this.subNode(a,c+1)||null};a.prototype.findExpression=function(a,c,b){var d;null==b&&(b=null);return!b&&this.equals(a)?[Object.assign(this,{path:c})]:null!=b&&null!=this.terms&&this.subEquals(a,b)?[Object.assign(this.subNode(b,d=b+a.terms.length),{path:c.concat([["terms",
b,d]])})]:null!=b&&null!=this.factors&&this.subEquals(a,b)?[Object.assign(this.subNode(b,d=b+a.factors.length),{path:c.concat([["factors",b,d]])})]:[]};a.prototype.createExpression=function(){var e,c,b;c=arguments[0];e=2<=arguments.length?f.call(arguments,1):[];return(null!=(b=function(){switch(c=a.toOperator(c,e.length+1)||c){case "LESS":case "LESSEQUAL":case "EQUAL":case "NOTEQUAL":case "GREATEREQUAL":case "GREATER":return e[0]&&new CTATRelationNode(c,this,e[0])||null;case "PLUS":case "MINUS":return 1<
e.unshift(this)&&new CTATAdditionNode(c,e)||null;case "UPLUS":case "UMINUS":return new CTATUnaryNode(c,this);case "TIMES":case "DIVIDE":return 1<e.unshift(this)&&new CTATMultiplicationNode(c,e)||null;case "IDIVIDE":case "REM":return e[0]&&new CTATIntDivisionNode(c,this,e[0])||null;case "EXP":return e[0]&&new CTATPowerNode(c,this,e[0])||null;case "ROOT":return new CTATPowerNode(c,this,new CTATConstantNode(2))}}.call(this))?b.simpleFlatten():void 0)||null};a.prototype.replaceExpression=function(a,c,
b){var d,e,g,f,p;"number"===typeof b&&(a=this.findExpression(a,[])[b])&&(b=a.path,delete a.path);if(0===(null!=b?b.length:void 0))return c;if(null!=(p=null!=b?b.shift():void 0))return d=this.clone(!1),"string"===typeof p?(d[p]=null!=(e=this[p])?e.replaceExpression(a,c,b):void 0,d.simpleFlatten()):"object"===typeof p&&2===p.length?(d[p[0]]=d[p[0]].slice(0),d[p[0]][p[1]]=null!=(g=this[p[0]])?g[p[1]].replaceExpression(a,c,b):void 0,d.simpleFlatten()):"object"===typeof p&&3===p.length?(d[p[0]]=d[p[0]].slice(0),
[].splice.apply(d[p[0]],[f=p[1],p[2]-f].concat(c)),c,d.simpleFlatten()):this};a.prototype.deleteExpression=function(a,c){var b,d,e,g,f;"number"===typeof c&&(a=this.findExpression(a,[])[c])&&(c=a.path,delete a.path);if(0===(null!=c?c.length:void 0))return null;if(null!=(f=null!=c?c.shift():void 0))return b=this.clone(!1),"string"===typeof f?(b[f]=null!=(d=this[f])?d.deleteExpression(a,c):void 0,b.removeNull()):"object"===typeof f&&2===f.length?(b[f[0]]=b[f[0]].slice(0),b[f[0]][f[1]]=null!=(e=this[f[0]])?
e[f[1]].deleteExpression(a,c):void 0,b.removeNull()):"object"===typeof f&&3===f.length?(b[f[0]]=b[f[0]].slice(0),[].splice.apply(b[f[0]],[g=f[1],f[2]-g].concat(null)),null,b.removeNull()):this};a.prototype.applyRulesSelectively=function(){var a,c,b,d,g,n;g=arguments[0];a=arguments[1];c=arguments[2];b=4<=arguments.length?f.call(arguments,3):[];this.rules=g;null==a&&(a=!0);null==c&&(c=null);return this.checkIndices(b.concat(c))&&(!["PLUS","TIMES"].includes(this.operator)||this.wholeNode(c,b)?this.applyRules(this.rules,
a):(n=this.selectOperands(b.concat(c)))&&n.equals(d=n.applyRules(this.rules,a))?this:this.replaceOperands(d,c,b))||null};a.prototype.applyRules=function(a,c){var b,d,e;this.rules=a;d=this;b=this.rules;a=0;for(c=b.length;a<c;a++)e=b[a],d=d[e].call(d),d.rules=this.rules;delete d.rules;return d};a.prototype.removeNull=function(){return this};a.prototype.checkIndices=function(a){return a.every(function(c,b){return null==c||0<=c&&1>=c&&a.indexOf(c)===b})};a.prototype.wholeNode=function(a,c){return null==
a||0===c.length||c.concat(a).length>=this.countOperands()};a.prototype.selectOperands=function(a,c){return this};a.prototype.replaceOperands=function(a,c,b){return a};a.prototype.simpleFlatten=function(){return this};a.prototype.flatten=function(){this.parens=0;return this.simpleFlatten()};a.prototype.computeConstants=function(){return this};a.prototype.combineSimilar=function(){return this};a.prototype.expand=function(){return this};a.prototype.distribute=function(){return this};a.prototype.removeIdentity=
function(){return this};a.prototype.sort=function(){return this};a.prototype.spreadIdentity=function(){return this};a.prototype.stripIdentity=function(){return this};a.prototype.multiplyOne=function(a){null==a&&(a=!1);return(new CTATMultiplicationNode("TIMES",[new CTATConstantNode(1,a),this])).popNegation().pushNegation()};a.prototype.powerOne=function(a){null==a&&(a=!1);return(new CTATPowerNode("EXP",this,new CTATConstantNode(1,a))).popInversion().pushInversion().popNegation()};a.prototype.findGroup=
function(a,c){return a.find(function(b){var a,e;return(null!=(a=b[0])?a.equals(c[0]):void 0)||b[0]===(e=c[0])&&null===e})};a.prototype.compareFactors=function(a,c){return this.compareSigns(a,!c)||this.compare(a,c)};a.prototype.compare=function(e,c){return a.operatorPrecedence(this.operator,e.operator)};a.prototype.compareSigns=function(a,c){return(Math.sign(this.sign-a.sign)||Math.sign(this.exp-a.exp))*(c?-1:1)};a.prototype.countVariables=function(){return 0};a.prototype.pushNegation=function(){return this};
a.prototype.popNegation=function(){return this};a.prototype.pushInversion=function(){return this};a.prototype.popInversion=function(){return this};a.prototype.negate=function(){this.sign=-this.sign;return this};a.prototype.invert=function(){this.exp=-this.exp;return this};a.prototype.addition=function(){return"PLUS"===this.operator};a.prototype.subtraction=function(){return"MINUS"===this.operator};a.prototype.multiplication=function(){return"TIMES"===this.operator};a.prototype.division=function(){return"DIVIDE"===
this.operator};a.prototype.intDivision=function(){return"IDIVIDE"===this.operator};a.prototype.power=function(){return"EXP"===this.operator};a.prototype.root=function(){return"ROOT"===this.operator};a.prototype.negation=function(){return"UMINUS"===this.operator};a.prototype.unary=function(){var a;return"UPLUS"===(a=this.operator)||"UMINUS"===a};a.prototype.constant=function(a){return!1};a.prototype.unknown=function(){return!1};a.prototype.integer=function(){return!1};a.prototype.negated=function(){return 0>
this.sign};a.prototype.inverted=function(){return 0>this.exp};a.prototype.parented=function(){return 0<this.parens};a.prototype.even=function(){return!1};return a}();"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATAlgebraTreeNode=a}).call(this);var CTATRelationNode={};
(function(){var a,f=function(a,c){function b(){this.constructor=a}for(var d in c)g.call(c,d)&&(a[d]=c[d]);b.prototype=c.prototype;a.prototype=new b;a.__super__=c.prototype;return a},g={}.hasOwnProperty;a=function(a){function c(b,a,c,e,g,f){this.operator=b;this.left=a;this.right=c;this.parens=null!=e?e:0;this.sign=null!=g?g:1;this.exp=null!=f?f:1}f(c,a);c.prototype.clone=function(b){null==b&&(b=!0);return new c(this.operator,b?this.left.clone():this.left,b?this.right.clone():this.right,this.parens,
this.sign,this.exp)};c.prototype.toString=function(b,a){null==b&&(b="EQUAL");null==a&&(a=!1);return c.__super__.toString.call(this,""+this.left.toString(this.operator)+CTATAlgebraTreeNode.toOperatorString(this.operator)+this.right.toString(this.operator),b,a)};c.prototype.addPaths=function(b){this.left.addPaths(b.concat(["left"]));this.right.addPaths(b.concat(["right"]));return c.__super__.addPaths.apply(this,arguments)};c.prototype.evaluate=function(b){null==b&&(b=null);return this.applyOperator(this.left.evaluate(b),
this.right.evaluate(b))};c.prototype.equals=function(b){return c.__super__.equals.call(this,b)&&this.left.equals(b.left)&&this.right.equals(b.right)};c.prototype.countOperands=function(){return 2};c.prototype.getOperator=function(b,a){return this.operator};c.prototype.getOperators=function(b){return this.left.getOperators().concat(this.getOperator(),this.right.getOperators())};c.prototype.getVariables=function(){return this.left.getVariables().concat(this.right.getVariables())};c.prototype.getOperands=
function(){return[this.left,this.right]};c.prototype.findExpression=function(b,a){return this.left.findExpression(b,a.concat(["left"])).concat(c.__super__.findExpression.call(this,b,a),this.right.findExpression(b,a.concat(["right"])))};c.prototype.applyRules=function(b,a){this.rules=b;null==a&&(a=!0);a&&(this.left=this.left.applyRules(this.rules),this.right=this.right.applyRules(this.rules));return c.__super__.applyRules.apply(this,arguments)};c.prototype.removeNull=function(){var b,a;this.left=null!=
(b=this.left)?b.removeNull():void 0;this.right=null!=(a=this.right)?a.removeNull():void 0;return null!=this.left&&null!=this.right?this:this.left||this.right||null};c.prototype.computeConstants=function(){return this.left.constant()&&this.right.constant()?new CTATConstantNode(this.evaluate()):this};c.prototype.sort=function(){var b;switch(this.operator){case "GREATER":this.operator="LESS";b=[this.right,this.left];this.left=b[0];this.right=b[1];break;case "GREATEREQUAL":this.operator="LESSEQUAL";b=
[this.right,this.left];this.left=b[0];this.right=b[1];break;case "EQUAL":case "NOTEQUAL":0>this.left.compare(this.right)&&(b=[this.right,this.left],this.left=b[0],this.right=b[1])}return this};c.prototype.countVariables=function(){return this.left.countVariables()+this.right.countVariables()};return c}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATRelationNode=a}).call(this);var CTATAdditionNode={};
(function(){var a,f=function(a,c){function b(){this.constructor=a}for(var d in c)g.call(c,d)&&(a[d]=c[d]);b.prototype=c.prototype;a.prototype=new b;a.__super__=c.prototype;return a},g={}.hasOwnProperty;a=function(a){function c(b,a,c,e,g){this.operator=b;this.terms=a;this.parens=null!=c?c:0;this.sign=null!=e?e:1;this.exp=null!=g?g:1}f(c,a);c.prototype.clone=function(b){null==b&&(b=!0);return new c(this.operator,b?this.terms.map(function(b){return b.clone()}):this.terms,this.parens,this.sign,this.exp)};
c.prototype.toString=function(b,a){null==b&&(b="EQUAL");null==a&&(a=!1);return c.__super__.toString.call(this,this.terms.reduce(function(b){return function(a,c){var d;d=a&&!c.negated()?b.operator:"";return""+a+CTATAlgebraTreeNode.toOperatorString(d)+c.toString(b.operator)}}(this),""),b,a)};c.prototype.addPaths=function(b){this.terms.forEach(function(a,c){return a.addPaths(b.concat([["terms",c]]))});return c.__super__.addPaths.apply(this,arguments)};c.prototype.evaluate=function(b){null==b&&(b=null);
return c.__super__.evaluate.call(this,this.terms.reduce(function(a){return function(c,d){return a.applyOperator(c,d.evaluate(b))}}(this),0))};c.prototype.equals=function(b){return c.__super__.equals.call(this,b)&&this.terms.length===b.terms.length&&this.terms.every(function(a,c){return a.equals(b.terms[c])})};c.prototype.subEquals=function(b,a){return this.operator===b.operator&&!b.negated()&&this.terms.length>=b.terms.length&&b.terms.every(function(b){return function(c,d){return c.equals(b.terms[a+
d])}}(this))};c.prototype.subNode=function(b,a){console.log(b,a);return null!=b?Object.assign(this.clone(!1),{terms:this.terms.slice(b,a)}):this};c.prototype.countOperands=function(){return this.terms.length};c.prototype.getOperator=function(b,a){null==b&&(b=!1);null==a&&(a=null);return b&&c.__super__.getOperator.apply(this,arguments)||null!=a&&this.terms[a].negated()&&"MINUS"||this.operator};c.prototype.getOperators=function(b){null==b&&(b=!1);return this.terms.slice(1).reduce(function(a){return function(c,
d,e){return c.concat(a.getOperator(b,e+1),d.getOperators())}}(this),this.terms[0].getOperators())};c.prototype.getVariables=function(){return this.terms.slice(1).reduce(function(b){return function(b,a){return b.concat(a.getVariables())}}(this),this.terms[0].getVariables())};c.prototype.getOperands=function(){return this.terms.slice(0)};c.prototype.findExpression=function(b,a){return this.terms.slice(1).reduce(function(d){return function(e,g,f){return e.concat(c.__super__.findExpression.call(d,b,a,
f),g.findExpression(b,a.concat([["terms",f+1]])))}}(this),this.terms[0].findExpression(b,a.concat([["terms",0]])))};c.prototype.applyRules=function(b,a){this.rules=b;null==a&&(a=!0);a&&(this.terms=this.terms.map(function(b){return function(a){return a.applyRules(b.rules)}}(this)));return c.__super__.applyRules.apply(this,arguments)};c.prototype.removeNull=function(){this.terms=this.terms.map(function(b){return null!=b?b.removeNull():void 0}).filter(function(b){return b});return 1<this.terms.length?
this:this.terms[0]||null};c.prototype.checkIndices=function(b){var a;a=this.terms.length;return b.every(function(c,d){return null==c||0<=c&&c<a&&b.indexOf(c)===d})};c.prototype.selectOperands=function(b){return Object.assign(this.clone(!1),{terms:this.terms.filter(function(a,c){return b.includes(c)})})};c.prototype.replaceOperands=function(b,a,c){var d;(d=this.clone(!1)).terms=this.terms.slice(0);[].splice.apply(d.terms,[a,a-a+1].concat(b="PLUS"===b.operator?b.terms:b));b;c.forEach(function(b){var a;
return[].splice.apply(d.terms,[b,b-b+1].concat(a=[])),a});return d};c.prototype.simpleFlatten=function(){!this.terms[0].negation()||this.terms[0].inverted()||this.terms[0].parented()||(this.terms[0]=this.terms[0].base.negate());this.subtraction()&&(this.terms[1].negate(),this.operator="PLUS");this.terms=this.terms.reduce(function(b,a){a.inverted()||a.parented()||!a.addition()?b.push(a):b.push.apply(b,a.pushNegation().terms);return b},[]);return this};c.prototype.flatten=function(){return c.__super__.flatten.apply(this,
arguments).pushNegation()};c.prototype.computeConstants=function(){var b,a;0<=(a=this.terms.findIndex(function(b){return b.constant()}))&&(b=this.terms[a].evaluate(),this.terms=this.terms.filter(function(c,d){return d<=a||!c.constant()||(b+=c.evaluate())&&!1}),0===b&&1<this.terms.length?this.terms.splice(a,1):this.terms[a]=new CTATConstantNode(b));return 1<this.terms.length?this:this.pushInversion().terms[0]};c.prototype.combineSimilar=function(){var b;b=[];this.terms.forEach(function(a){return function(c){var d,
e,g;g=c.constant()?[null,c]:(c=c.multiplyOne(),[c,c.factors.shift()]);return null!=(e=g[0])&&e.unknown()||!(d=a.findGroup(b,g))?b.push([g[0],g[1].evaluate()]):d[1]+=g[1].evaluate()}}(this));this.terms=b.reduce(function(b,a){0!==a[1]&&(a[1]=(new CTATConstantNode(a[1])).popNegation(),a[0]?(a[0].factors.unshift(a[1]),b.push(a[0].removeIdentity())):b.push(a[1]));return b},[]);if(1<this.terms.length)return this;1!==this.terms.length&&(this.terms[0]=new CTATConstantNode(0));return this.pushInversion().terms[0]};
c.prototype.removeIdentity=function(b){var a;null==b&&(b=!1);a=this.terms.filter(function(a){return!a.constant(0,b)});this.terms=a.length?a:this.terms.slice(0,1);return 1<this.terms.length?this.pushNegation():this.pushInversion().terms[0]};c.prototype.sort=function(){this.spreadIdentity();this.terms=this.terms.sort(function(b,a){return-b.compare(a,!0)});return this.stripIdentity()};c.prototype.spreadIdentity=function(){this.terms=this.terms.map(function(b){return b.multiplyOne(!0)});return this};
c.prototype.stripIdentity=function(){this.terms=this.terms.map(function(b){return b.removeIdentity(!0)});return this};c.prototype.compare=function(b,a){var d;return c.__super__.compare.apply(this,arguments)||this.countVariables()-b.countVariables()||(d=null,this.terms.some(function(c,e){return d=c.compare(b.terms[e],a)})&&d)||this.compareSigns(b,a)};c.prototype.countVariables=function(){return this.terms.reduce(function(b,a){return b+a.countVariables()},0)};c.prototype.pushNegation=function(){this.negated()&&
(this.negate(),this.terms.forEach(function(b){return b.negate()}));return this};c.prototype.popNegation=function(){this.terms[0].negated()&&(this.negate(),this.terms.forEach(function(b){return b.negate()}));return this};c.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.terms[0].invert());return this};c.prototype.unknown=function(){return this.terms.some(function(b){return b.unknown()})};c.prototype.even=function(){return!this.inverted&&this.terms.every(function(b){return b.even()})};
return c}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATAdditionNode=a}).call(this);var CTATMultiplicationNode={};
(function(){var a,f=function(a,c){function b(){this.constructor=a}for(var d in c)g.call(c,d)&&(a[d]=c[d]);b.prototype=c.prototype;a.prototype=new b;a.__super__=c.prototype;return a},g={}.hasOwnProperty;a=function(a){function c(b,a,c,e,g){this.operator=b;this.factors=a;this.parens=null!=c?c:0;this.sign=null!=e?e:1;this.exp=null!=g?g:1}f(c,a);c.prototype.clone=function(b){null==b&&(b=!0);return new c(this.operator,b?this.factors.map(function(b){return b.clone()}):this.factors,this.parens,this.sign,
this.exp)};c.prototype.toString=function(b,a){null==b&&(b="EQUAL");null==a&&(a=!1);return c.__super__.toString.call(this,this.factors.reduce(function(b){return function(a,c){var d,e;c.inverted()?(c.invert(),d=c.toString("DIVIDE",a),c.invert()):d=c.toString(b.operator,a);e=a?c.inverted()?"DIVIDE":"DIVIDE"===b.operator||/^[\d+-]/.test(d)&&/\d$/.test(a)?b.operator:"":"";d=""===e&&c.negated()?"("+d+")":d;return""+a+CTATAlgebraTreeNode.toOperatorString(e)+d}}(this),"TIMES"===this.operator&&this.factors[0].inverted()?
"1":""),b,a)};c.prototype.addPaths=function(b){this.factors.forEach(function(a,c){return a.addPaths(b.concat([["factors",c]]))});return c.__super__.addPaths.apply(this,arguments)};c.prototype.evaluate=function(b){var a;null==b&&(b=null);a=this.factors.reduce(function(a){return function(c,d){return d.inverted()?c:a.applyOperator(c,d.evaluate(b,!1))}}(this),1);return c.__super__.evaluate.call(this,this.factors.reduce(function(a){return function(c,d){return d.inverted()?a.applyOperator(c,d.evaluate(b,
!1),!0):c}}(this),a))};c.prototype.equals=function(b){return c.__super__.equals.call(this,b)&&this.factors.length===b.factors.length&&this.factors.every(function(a,c){return a.equals(b.factors[c])})};c.prototype.subEquals=function(b,a){return this.operator===b.operator&&!b.inverted()&&this.factors.length>=b.factors.length&&b.factors.every(function(b){return function(c,d){return c.equals(b.factors[a+d])}}(this))};c.prototype.subNode=function(b,a){console.log(b,a);return null!=b?Object.assign(this.clone(!1),
{factors:this.factors.slice(b,a)}):this};c.prototype.countOperands=function(){return this.factors.length};c.prototype.getOperator=function(b,a){null==b&&(b=!1);null==a&&(a=null);return b&&c.__super__.getOperator.apply(this,arguments)||null!=a&&this.factors[a].inverted()&&"DIVIDE"||this.operator};c.prototype.getOperators=function(b){null==b&&(b=!1);return this.factors.slice(1).reduce(function(a){return function(c,d,e){return c.concat(a.getOperator(b,e+1),d.getOperators())}}(this),this.factors[0].getOperators())};
c.prototype.getVariables=function(){return this.factors.slice(1).reduce(function(b){return function(b,a){return b.concat(a.getVariables())}}(this),this.factors[0].getVariables())};c.prototype.getOperands=function(){return this.factors.slice(0)};c.prototype.findExpression=function(b,a){return this.factors.slice(1).reduce(function(d){return function(e,g,f){return e.concat(c.__super__.findExpression.call(d,b,a,f),g.findExpression(b,a.concat([["factors",f+1]])))}}(this),this.factors[0].findExpression(b,
a.concat([["factors",0]])))};c.prototype.applyRules=function(b,a){this.rules=b;null==a&&(a=!0);a&&(this.factors=this.factors.map(function(b){return function(a){return a.applyRules(b.rules)}}(this)));return c.__super__.applyRules.apply(this,arguments)};c.prototype.removeNull=function(){this.factors=this.factors.map(function(b){return null!=b?b.removeNull():void 0}).filter(function(b){return b});return 1<this.factors.length?this:this.factors[0]||null};c.prototype.checkIndices=function(b){var a;a=this.factors.length;
return b.every(function(c,d){return null==c||0<=c&&c<a&&b.indexOf(c)===d})};c.prototype.selectOperands=function(b){return Object.assign(this.clone(!1),{factors:this.factors.filter(function(a,c){return b.includes(c)})})};c.prototype.replaceOperands=function(b,a,c){var d;(d=this.clone(!1)).terms=this.factors.slice(0);[].splice.apply(d.factors,[a,a-a+1].concat(b="TIMES"===b.operator?b.factors:b));b;c.forEach(function(b){var a;return[].splice.apply(d.factors,[b,b-b+1].concat(a=[])),a});return d};c.prototype.simpleFlatten=
function(){this.division()&&this.factors[1].invert();this.operator="TIMES";this.factors=this.factors.reduce(function(b,a){a.parented()||!a.multiplication()?b.push(a):b.push.apply(b,a.pushNegation().pushInversion().factors);return b},[]);return this};c.prototype.flatten=function(){return c.__super__.flatten.apply(this,arguments).popNegation()};c.prototype.computeConstants=function(){var b,a,e;0<=(a=this.factors.findIndex(function(b){return b.constant()}))&&(b=new c("TIMES",[new CTATConstantNode(1)]),
this.factors=this.factors.filter(function(c,d){return d<a||!c.constant()||b.factors.push(c)&&!1}),1===(e=b.evaluate())&&0!==this.factors.length||this.factors.unshift(new CTATConstantNode(e)));return 1<this.factors.length?this:this.pushNegation().pushInversion().factors[0]};c.prototype.combineSimilar=function(){var b;b=[];this.factors.forEach(function(a){return function(c){var d,e,g,f,h;h=c.constant()?[null,c]:c.power()?c.exponent.constant()?(c.pushInversion(),[c.base,c.exponent]):(c.exponent=c.exponent.multiplyOne(),
[c,c.exponent.factors.shift()]):(c=c.powerOne(),[c.base,c.exponent]);return null!=(e=h[0])&&e.unknown()||!(d=a.findGroup(b,h))?b.push([h[0],(null!=(f=h[1])?f.evaluate():void 0)||1]):d[1]+=(null!=(g=h[1])?g.evaluate():void 0)||1}}(this));this.factors=b.reduce(function(b,a){0!==a[1]&&(a[1]=(new CTATConstantNode(a[1])).popNegation(),a[0]?a[1].constant(1)?b.push(a[0]):a[1].constant(-1)?b.push(a[0].invert()):a[0].power()?(a[0].exponent.factors.unshift(a[1]),b.push(a[0])):b.push((new CTATPowerNode("EXP",
a[0],a[1])).popInversion()):b.push(a[1]));return b},[]);if(1<this.factors.length)return this;1!==this.factors.length&&(this.factors[0]=new CTATConstantNode(1));return this.pushNegation().pushInversion().factors[0]};c.prototype.distribute=function(){var b,a;b=this.factors.filter(function(b){return!b.inverted()});a=this.factors.filter(function(b){return b.inverted()});return!this.distributedOrSingle(b)||!this.distributedOrSingle(a)||this.single(b)&&a.length&&this.distributed(a)?(this.distributed(a)?
(b=this.distributeFactors(this.factors),a=[]):this.distributed(b)?(a=this.distributeFactors(this.factors),b=[]):(b=this.distributeFactors(b),a=this.distributeFactors(a)),this.factors=a.length?b.length?[this.packTerms(b),this.packTerms(a).invert()]:[this.packTerms(a).invert()]:[this.packTerms(b)],1<this.factors.length?this:this.pushNegation().pushInversion().factors[0]):this};c.prototype.distributedOrSingle=function(b){return this.distributed(b)||this.single(b)};c.prototype.distributed=function(b){return b.every(function(b){return!b.addition()})};
c.prototype.single=function(b){return 1===b.length&&b[0].addition()};c.prototype.distributeFactors=function(b){var a;a=b[0].addition()?b[0].terms.map(function(b){return b.multiplication()?b.pushNegation().factors:[b]}):[[b[0]]];b.slice(1).forEach(function(b){var c;return b.addition()?1===a.length?a=b.terms.map(function(b){var c;c=a[0].map(function(b){return b.clone()});b.multiplication()?c.push.apply(c,b.pushNegation().factors):c.push(b);return c}):a=a.reduce(function(a,c){a.push.apply(a,b.terms.map(function(b){var a;
a=c.map(function(b){return b.clone()});b.multiplication()?a.push.apply(a,b.pushNegation().factors.map(function(b){return b.clone()})):a.push(b.clone());return a}));return a},[]):1===a.length?b.multiplication()?(c=a[0]).push.apply(c,b.pushNegation().factors):a[0].push(b):a.forEach(function(c,d){var e;return b.multiplication()?(e=a[d]).push.apply(e,b.pushNegation().factors.map(function(b){return b.clone()})):a[d].push(b.clone())})});return a};c.prototype.packTerms=function(b){var a;a=CTATAlgebraTreeNode.diff(this.rules,
["flatten","distribute"]);return(new CTATAdditionNode("PLUS",b.map(function(b){return(new c("TIMES",b)).popNegation().applyRules(a,!1)}))).applyRules(a,!1)};c.prototype.removeIdentity=function(b){var a;null==b&&(b=!1);this.popNegation();a=this.factors.filter(function(a){return!a.constant(1,b)});this.factors=a.length?a:this.factors.slice(0,1);(a=this.factors.find(function(a){return a.constant(0,b)}))&&this.factors.every(function(b){return!b.inverted()&&(!b.power()||b.exponent.constant())})&&(this.factors=
[a]);return 1<this.factors.length?this:this.pushNegation().pushInversion().factors[0]};c.prototype.sort=function(){this.factors=this.factors.sort(function(b,a){return b.compareFactors(a)});return this};c.prototype.spreadIdentity=function(){this.factors=this.factors.map(function(b){return b.powerOne(!0)});return this};c.prototype.stripIdentity=function(){this.factors=this.factors.map(function(b){return b.removeIdentity(!0)});return this.popNegation()};c.prototype.multiplyOne=function(b){null==b&&(b=
!1);this.factors[0].constant()||this.factors.unshift(new CTATConstantNode(1,b));return this.pushNegation()};c.prototype.compare=function(b,a){var d,e;return c.__super__.compare.apply(this,arguments)||this.countVariables()-b.countVariables()||(e=null,(d=b.factors.slice(0).reverse())&&this.factors.slice(0).reverse().some(function(b,c){return d[c]?e=b.compareFactors(d[c],a):e})&&e)||this.compareSigns(b,a)};c.prototype.countVariables=function(){return this.factors.reduce(function(b,a){return b+a.countVariables()},
0)};c.prototype.pushNegation=function(){this.negated()&&(this.negate(),this.factors[0].negate());return this};c.prototype.popNegation=function(){this.factors.forEach(function(b){return function(a){if(a.negated())return b.negate(),a.negate()}}(this));return this};c.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.factors.forEach(function(b){return b.invert()}));return this};c.prototype.unknown=function(){return this.factors.some(function(b){return b.unknown()})};c.prototype.even=
function(){return!this.inverted()&&this.factors.every(function(b){return b.integer()})&&this.factors.some(function(b){return b.even()})};return c}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATMultiplicationNode=a}).call(this);var CTATIntDivisionNode={};
(function(){var a,f=function(a,c){function b(){this.constructor=a}for(var d in c)g.call(c,d)&&(a[d]=c[d]);b.prototype=c.prototype;a.prototype=new b;a.__super__=c.prototype;return a},g={}.hasOwnProperty;a=function(a){function c(b,a,c,e,g,f){this.operator=b;this.dividend=a;this.divisor=c;this.parens=null!=e?e:0;this.sign=null!=g?g:1;this.exp=null!=f?f:1}f(c,a);c.prototype.clone=function(b){null==b&&(b=!0);return new c(this.operator,b?this.dividend.clone():this.dividend,b?this.divisor.clone():this.divisor,
this.parens,this.sign,this.exp)};c.prototype.toString=function(b,a){null==b&&(b="EQUAL");null==a&&(a=!1);return c.__super__.toString.call(this,""+this.dividend.toString(this.operator)+CTATAlgebraTreeNode.toOperatorString(this.operator)+this.divisor.toString(this.operator),b,a)};c.prototype.addPaths=function(b){this.dividend.addPaths(b.concat(["dividend"]));this.divisor.addPaths(b.concat(["divisor"]));return c.__super__.addPaths.apply(this,arguments)};c.prototype.evaluate=function(b){null==b&&(b=null);
return c.__super__.evaluate.call(this,this.applyOperator(this.dividend.evaluate(b),this.divisor.evaluate(b)))};c.prototype.equals=function(b){return c.__super__.equals.call(this,b)&&this.dividend.equals(b.dividend)&&this.divisor.equals(b.divisor)};c.prototype.countOperands=function(){return 2};c.prototype.getOperator=function(b,a){null==b&&(b=!1);null==a&&(a=null);return b&&c.__super__.getOperator.apply(this,arguments)||this.operator};c.prototype.getOperators=function(b){null==b&&(b=!1);return this.dividend.getOperators().concat(this.getOperator(b),
this.divisor.getOperators())};c.prototype.getVariables=function(){return this.dividend.getVariables().concat(this.divisor.getVariables())};c.prototype.getOperands=function(){return[this.dividend,this.divisor]};c.prototype.findExpression=function(b,a){return this.dividend.findExpression(b,a.concat(["dividend"])).concat(c.__super__.findExpression.call(this,b,a),this.divisor.findExpression(b,a.concat(["divisor"])))};c.prototype.applyRules=function(b,a){this.rules=b;null==a&&(a=!0);a&&(this.dividend=
this.dividend.applyRules(this.rules),this.divisor=this.divisor.applyRules(this.rules));return c.__super__.applyRules.apply(this,arguments)};c.prototype.removeNull=function(){var b,a;this.dividend=null!=(b=this.dividend)?b.removeNull():void 0;this.divisor=null!=(a=this.divisor)?a.removeNull():void 0;return null!=this.dividend&&null!=this.divisor?this:this.dividend||this.divisor||null};c.prototype.computeConstants=function(){return this.dividend.constant()&&this.divisor.constant()?new CTATConstantNode(this.evaluate()):
this};c.prototype.removeIdentity=function(b){null==b&&(b=!1);return this.divisor.constant(1,b)?(this.intDivision()||(this.dividend=new CTATConstantNode(0,b)),this.pushNegation().pushInversion().dividend):this.popNegation()};c.prototype.compare=function(b,a){return c.__super__.compare.apply(this,arguments)||this.dividend.compare(b.dividend,a)||this.divisor.compare(b.divisor,a)||this.operator!==b.operator&&(this.intDivision()&&-1||1)||this.compareSigns(b,a)};c.prototype.countVariables=function(){return this.dividend.countVariables()+
divisor.countVariables()};c.prototype.pushNegation=function(){this.intDivision()&&this.negated()&&(this.negate(),this.dividend.negate());return this};c.prototype.pushInversion=function(){this.intDivision()&&this.inverted()&&(this.invert(),this.dividend.invert());return this};c.prototype.popNegation=function(){this.divisor.negated()&&(this.divisor.negate(),this.intDivision()&&this.dividend.negate());return this};c.prototype.unknown=function(){return this.dividend.unknown()||this.divisor.unknown()};
c.prototype.even=function(){return!this.inverted&&"REM"===this.operator&&this.dividend.even()&&this.divisor.even()};return c}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATIntDivisionNode=a}).call(this);var CTATUnaryNode={};
(function(){var a,f=function(a,c){function b(){this.constructor=a}for(var d in c)g.call(c,d)&&(a[d]=c[d]);b.prototype=c.prototype;a.prototype=new b;a.__super__=c.prototype;return a},g={}.hasOwnProperty;a=function(a){function c(b,a,c,e,g){this.operator=b;this.base=a;this.parens=null!=c?c:0;this.sign=null!=e?e:1;this.exp=null!=g?g:1}f(c,a);c.prototype.clone=function(b){null==b&&(b=!0);return new c(this.operator,b?this.base.clone():this.base,this.parens,this.sign,this.exp)};c.prototype.toString=function(b,
a){null==b&&(b="EQUAL");null==a&&(a=!1);return c.__super__.toString.call(this,""+CTATAlgebraTreeNode.toOperatorString(this.operator)+this.base.toString(this.operator),b,a)};c.prototype.addPaths=function(b){this.base.addPaths(b.concat(["base"]));return c.__super__.addPaths.apply(this,arguments)};c.prototype.evaluate=function(b,a){null==b&&(b=null);null==a&&(a=!0);return c.__super__.evaluate.call(this,this.applyOperator(this.base.evaluate(b)),a)};c.prototype.equals=function(b){return c.__super__.equals.call(this,
b)&&this.base.equals(b.base)};c.prototype.countOperands=function(){return 1};c.prototype.getOperator=function(b,a){null==b&&(b=!1);null==a&&(a=null);return b&&c.__super__.getOperator.apply(this,arguments)||this.operator};c.prototype.getOperators=function(b){null==b&&(b=!1);return[this.getOperator(b)].concat(this.base.getOperators())};c.prototype.getVariables=function(){return this.base.getVariables()};c.prototype.getOperands=function(){return[this.base]};c.prototype.findExpression=function(b,a){return this.base.findExpression(b,
a.concat(["base"])).concat(c.__super__.findExpression.call(this,b,a))};c.prototype.applyRules=function(b,a){this.rules=b;null==a&&(a=!0);a&&(this.base=this.base.applyRules(this.rules));return c.__super__.applyRules.apply(this,arguments)};c.prototype.removeNull=function(){var b;this.base=null!=(b=this.base)?b.removeNull():void 0;return null!=this.base?this:null};c.prototype.simpleFlatten=function(){if(this.parented())return this;this.negation()&&(this.negate(),this.operator="UPLUS");return this.pushNegation().pushInversion().base};
c.prototype.flatten=function(){return c.__super__.flatten.apply(this,arguments).popNegation()};c.prototype.compare=function(b,a){return b.unary()&&this.base.compare(b.base,a)||c.__super__.compare.apply(this,arguments)||this.compareSigns(b,a)};c.prototype.countVariables=function(){return this.base.countVariables()};c.prototype.pushNegation=function(){this.negated()&&(this.negate(),this.base.negate());return this};c.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.base.invert());
return this};c.prototype.constant=function(b,a){null==a&&(a=!1);return this.base.constant(b,a)};c.prototype.unknown=function(){return this.base.unknown()};return c}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATUnaryNode=a}).call(this);var CTATPowerNode={};
(function(){var a,f=function(a,c){function b(){this.constructor=a}for(var d in c)g.call(c,d)&&(a[d]=c[d]);b.prototype=c.prototype;a.prototype=new b;a.__super__=c.prototype;return a},g={}.hasOwnProperty;a=function(a){function c(b,a,c,e,g,f){this.operator=b;this.base=a;this.exponent=c;this.parens=null!=e?e:0;this.sign=null!=g?g:1;this.exp=null!=f?f:1}f(c,a);c.prototype.clone=function(b){null==b&&(b=!0);return new c(this.operator,b?this.base.clone():this.base,b?this.exponent.clone():this.exponent,this.parens,
this.sign,this.exp)};c.prototype.toString=function(b,a){null==b&&(b="EQUAL");null==a&&(a=!1);return c.__super__.toString.call(this,""+this.base.toString(this.operator)+CTATAlgebraTreeNode.toOperatorString(this.operator)+this.exponent.toString(this.operator),b,a)};c.prototype.addPaths=function(b){this.base.addPaths(b.concat(["base"]));this.exponent.addPaths(b.concat(["exponent"]));return c.__super__.addPaths.apply(this,arguments)};c.prototype.evaluate=function(b){null==b&&(b=null);return c.__super__.evaluate.call(this,
this.applyOperator(this.base.evaluate(b),this.exponent.evaluate(b)))};c.prototype.equals=function(b){return c.__super__.equals.call(this,b)&&this.base.equals(b.base)&&this.exponent.equals(b.exponent)};c.prototype.countOperands=function(){return 2};c.prototype.getOperator=function(b,a){null==b&&(b=!1);null==a&&(a=null);return b&&c.__super__.getOperator.apply(this,arguments)||this.operator};c.prototype.getOperators=function(b){null==b&&(b=!1);return this.base.getOperators().concat(this.getOperator(b),
this.exponent.getOperators())};c.prototype.getVariables=function(){return this.base.getVariables().concat(this.exponent.getVariables())};c.prototype.getOperands=function(){return[this.base,this.exponent]};c.prototype.findExpression=function(b,a){return this.base.findExpression(b,a.concat(["base"])).concat(c.__super__.findExpression.call(this,b,a),this.exponent.findExpression(b,a.concat(["exponent"])))};c.prototype.applyRules=function(b,a){this.rules=b;null==a&&(a=!0);a&&(this.base=this.base.applyRules(this.rules),
this.exponent=this.exponent.applyRules(this.rules));return c.__super__.applyRules.apply(this,arguments)};c.prototype.removeNull=function(){var b,a;this.base=null!=(b=this.base)?b.removeNull():void 0;this.exponent=null!=(a=this.exponent)?a.removeNull():void 0;return null!=this.base&&null!=this.exponent?this:this.base||this.exponent||null};c.prototype.flatten=function(){var b,a;c.__super__.flatten.apply(this,arguments);this.root()&&(this.exponent.invert(),this.operator="EXP");this.popNegation().popInversion();
return this.base.power()?(a=CTATAlgebraTreeNode.diff(this.rules,["flatten"]),b=this.base.exponent.multiplication()?this.base.exponent.pushNegation().pushInversion().factors:[this.base.exponent],this.exponent.multiplication()?b.push.apply(b,this.exponent.pushNegation().pushInversion().factors):b.push(this.exponent),this.base.exponent=(new CTATMultiplicationNode("TIMES",b)).applyRules(a,!1),this.pushBaseNegation().pushBaseInversion().base):this};c.prototype.computeConstants=function(){return this.base.constant()&&
(this.exponent.constant()||this.exponent.multiplication()&&this.exponent.factors[0].constant())?(this.exponent.constant()?(this.base=new CTATConstantNode(this.evaluate()),this.exponent=null,this.exp=1):(this.base=new CTATConstantNode((new c("EXP",this.base,this.exponent.factors.shift())).evaluate()),1===this.exponent.factors.length&&(this.exponent=this.exponent.pushNegation().pushInversion().factors[0])),this.exponent?this:this.pushBaseNegation().pushBaseInversion().base):this};c.prototype.powerOne=
function(b){null==b&&(b=!1);this.exponent=this.exponent.multiplyOne(b);return this.pushInversion()};c.prototype.expand=function(){var b,a,c;if(this.base.addition()&&(this.exponent.integer()&&1<this.exponent.value||this.exponent.multiplication()&&this.exponent.factors[0].integer()&&1<this.exponent.factors[0].value)){this.exponent.integer()?(b=this.exponent,this.exponent=null):(b=this.exponent.factors.shift(),1===this.exponent.factors.length&&(this.exponent=this.exponent.pushNegation().pushInversion().factors[0]));
a=[this.base];c=1;for(b=b.evaluate();1<=b?c<b:c>b;1<=b?++c:--c)a.push(this.base.clone());this.base=(new CTATMultiplicationNode("TIMES",a)).applyRules(["distribute"],!1);return this.exponent?this:this.pushBaseNegation().pushBaseInversion().base}return this};c.prototype.distribute=function(){var b;return this.base.multiplication()||this.exponent.addition()?(b=this.base.multiplication()?this.base.pushNegation().pushInversion().factors:[this.base],b=this.exponent.addition()?b.reduce(function(b){return function(a,
c){a.push.apply(a,b.exponent.terms.map(function(b){return[c.clone(),b.clone()]}));return a}}(this),[]):b.map(function(b){return function(a){return[a,b.exponent.clone()]}}(this)),this.base=this.packFactors(b),this.pushBaseNegation().pushBaseInversion().base):this};c.prototype.packFactors=function(b){var a;a=CTATAlgebraTreeNode.diff(this.rules,["flatten"]);return new CTATMultiplicationNode("TIMES",b.map(function(b){return(new c("EXP",b[0],b[1])).applyRules(a,!1)}))};c.prototype.removeIdentity=function(b){null==
b&&(b=!1);this.popInversion();if(this.exponent.constant(0,b))return this.base=new CTATConstantNode(1,b),this.pushBaseNegation().base;if(this.base.constant(0,b))return this.pushBaseInversion().base;if(this.exponent.constant(1,b))return this.pushBaseNegation().pushBaseInversion().base;this.exponent=this.exponent.removeIdentity(b);return this};c.prototype.compare=function(b,a){return c.__super__.compare.apply(this,arguments)||(this.countVariables()-b.countVariables())*(a?-1:1)||this.exponent.compare(b.exponent,
a)||this.base.compare(b.base,a)||this.compareSigns(b,a)};c.prototype.countVariables=function(){return this.base.countVariables()*(this.exponent.constant()?Math.abs(this.exponent.evaluate()):Infinity)};c.prototype.pushBaseNegation=function(){this.negated()&&(this.negate(),this.base.negate());return this};c.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.exponent.negate());return this};c.prototype.pushBaseInversion=function(){this.inverted()&&(this.invert(),this.base.invert());
return this};c.prototype.popNegation=function(){this.base.negated()&&this.exponent.constant()&&(this.base.negate(),this.exponent.even()||this.negate());return this};c.prototype.popInversion=function(){this.exponent.negated()&&(this.invert(),this.exponent.negate());this.base.inverted()&&(this.invert(),this.base.invert());return this};c.prototype.unknown=function(){return this.base.unknown()||this.exponent.unknown()};c.prototype.even=function(){return!this.inverted()&&this.base.even()&&this.exponent.integer()};
return c}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATPowerNode=a}).call(this);var CTATVariableNode={};
(function(){var a,f=function(a,c){function b(){this.constructor=a}for(var d in c)g.call(c,d)&&(a[d]=c[d]);b.prototype=c.prototype;a.prototype=new b;a.__super__=c.prototype;return a},g={}.hasOwnProperty;a=function(a){function c(b,a,c,e,g){this.variableTable=b;this.variable=a;this.parens=null!=c?c:0;this.sign=null!=e?e:1;this.exp=null!=g?g:1;this.operator="VAR"}f(c,a);c.prototype.clone=function(){return new c(this.variableTable,this.variable,this.parens,this.sign,this.exp)};c.prototype.toString=function(b,
a){null==b&&(b="EQUAL");null==a&&(a=!1);return c.__super__.toString.call(this,this.variable,b,a)};c.prototype.evaluate=function(b){null==b&&(b=null);return c.__super__.evaluate.call(this,null!=b?("function"===typeof b.get?b.get(this.variable):void 0)||b[this.variable]:null!=this.variableTable?this.variableTable.get(this.variable):function(){try{return eval(this.variable)}catch(d){}}.call(this))};c.prototype.equals=function(b){return c.__super__.equals.call(this,b)&&this.variable===b.variable};c.prototype.getOperator=
function(b,a){null==b&&(b=!1);null==a&&(a=null);return b&&c.__super__.getOperator.apply(this,arguments)};c.prototype.getVariables=function(){return[this.variable]};c.prototype.compare=function(b,a){a=null!=a?-1:1;return c.__super__.compare.apply(this,arguments)||this.variable>b.variable&&a||this.variable<b.variable&&-a||this.compareSigns(b,a)};c.prototype.countVariables=function(){return 1};return c}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATVariableNode=
a}).call(this);var CTATConstantNode={};
(function(){var a,f=function(a,c){function b(){this.constructor=a}for(var d in c)g.call(c,d)&&(a[d]=c[d]);b.prototype=c.prototype;a.prototype=new b;a.__super__=c.prototype;return a},g={}.hasOwnProperty;a=function(a){function c(b,a,c,e,g){this.value=b;this.marked=null!=a?a:!1;this.parens=null!=c?c:0;this.sign=null!=e?e:1;this.exp=null!=g?g:1;this.operator="CONST"}f(c,a);c.prototype.clone=function(){return new c(this.value,this.marked,this.parens,this.sign,this.exp)};c.prototype.toString=function(b,
a){null==b&&(b="EQUAL");null==a&&(a=!1);return c.__super__.toString.call(this,this.value.toString(),b,a)};c.prototype.evaluate=function(b,a){null==a&&(a=!0);return c.__super__.evaluate.call(this,this.value,a)};c.prototype.equals=function(b){return c.__super__.equals.call(this,b)&&this.value===b.value};c.prototype.getOperator=function(b,a){null==b&&(b=!1);null==a&&(a=null);return b&&c.__super__.getOperator.apply(this,arguments)};c.prototype.multiplyOne=function(){return this};c.prototype.powerOne=
function(){return this};c.prototype.compare=function(b,a){a=null!=a?1:-1;return c.__super__.compare.apply(this,arguments)||Math.sign(Math.abs(this.evaluate())-Math.abs(b.evaluate()))*a||this.compareSigns(b,a)};c.prototype.popNegation=function(){0>this.value&&(this.negate(),this.value=-this.value);return this};c.prototype.constant=function(b,a){null==a&&(a=!1);return null==b||this.evaluate()===b&&this.marked===a};c.prototype.integer=function(){return Math.floor(this.evaluate())===this.value};c.prototype.even=
function(){return 0===this.evaluate()%2};c.prototype.set=function(b){this.exp=1;this.value=Math.abs(b);return this.sign=Math.sign(b)};return c}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATConstantNode=a}).call(this);var CTATUnknownNode={};
(function(){var a,f=function(a,c){function b(){this.constructor=a}for(var d in c)g.call(c,d)&&(a[d]=c[d]);b.prototype=c.prototype;a.prototype=new b;a.__super__=c.prototype;return a},g={}.hasOwnProperty;a=function(a){function c(b,a,c){this.parens=null!=b?b:0;this.sign=null!=a?a:1;this.exp=null!=c?c:1;this.operator="UNKNOWN"}f(c,a);c.prototype.clone=function(){return new c(this.parens,this.sign,this.exp)};c.prototype.toString=function(b,a){null==b&&(b="EQUAL");null==a&&(a=!1);return c.__super__.toString.call(this,
"?",b,a)};c.prototype.evaluate=function(b){return NaN};c.prototype.getOperator=function(b,a){null==b&&(b=!1);null==a&&(a=null);return b&&c.__super__.getOperator.apply(this,arguments)};c.prototype.compare=function(b,a){a=null!=a?1:-1;return c.__super__.compare.apply(this,arguments)||this.compareSigns(b,a)};c.prototype.unknown=function(){return!0};return c}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATUnknownNode=a}).call(this);var CTATAlgebraGrammar=function(){function a(){this.yy={}}var f=function(b,a,c,d){c=c||{};for(d=b.length;d--;c[b[d]]=a);return c},g=[1,6],e=[1,7],c=[1,10],b=[1,11],d=[1,12],h=[1,13],n=[1,14],l=[1,22],p=[1,23],m=[5,7,8,9,10,11,12,13,15,26],q=[1,24],u=[1,25],v=[1,27],w=[1,28],B=[5,7,8,9,10,11,12,13,15,16,18,20,21,24,25,26,27,28,29],C=[5,7,8,9,10,11,12,13,15,16,18,20,21,23,24,25,26,27,28,29],f={trace:function(){},yy:{},symbols_:{error:2,expression:3,relational:4,EOF:5,arithmetic:6,LESS:7,GREATER:8,LESSEQUAL:9,
GREATEREQUAL:10,EQUAL:11,NOTEQUAL:12,PLUS:13,term:14,MINUS:15,TIMES:16,signedfactor:17,DIVIDE:18,factor:19,IDIVIDE:20,REM:21,atom:22,EXP:23,SQRT:24,LPAREN:25,RPAREN:26,VARIABLE:27,NUMBER:28,UNKNOWN:29,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",7:"LESS",8:"GREATER",9:"LESSEQUAL",10:"GREATEREQUAL",11:"EQUAL",12:"NOTEQUAL",13:"PLUS",15:"MINUS",16:"TIMES",18:"DIVIDE",20:"IDIVIDE",21:"REM",23:"EXP",24:"SQRT",25:"LPAREN",26:"RPAREN",27:"VARIABLE",28:"NUMBER",29:"UNKNOWN"},productions_:[0,[3,2],[4,
3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,1],[6,3],[6,3],[6,1],[14,3],[14,3],[14,2],[14,3],[14,3],[14,1],[17,2],[17,2],[17,1],[19,3],[19,2],[19,1],[22,3],[22,1],[22,1],[22,1]],performAction:function(b,a,c,d,e,g,f){b=g.length-1;switch(e){case 1:return g[b-1];case 2:this.$=new d.CTATRelationNode("LESS",g[b-2],g[b]);break;case 3:this.$=new d.CTATRelationNode("GREATER",g[b-2],g[b]);break;case 4:this.$=new d.CTATRelationNode("LESSEQUAL",g[b-2],g[b]);break;case 5:this.$=new d.CTATRelationNode("GREATEREQUAL",
g[b-2],g[b]);break;case 6:this.$=new d.CTATRelationNode("EQUAL",g[b-2],g[b]);break;case 7:this.$=new d.CTATRelationNode("NOTEQUAL",g[b-2],g[b]);break;case 8:case 11:case 17:case 20:case 23:this.$=g[b];break;case 9:this.$=new d.CTATAdditionNode("PLUS",[g[b-2],g[b]]);break;case 10:this.$=new d.CTATAdditionNode("MINUS",[g[b-2],g[b]]);break;case 12:this.$=new d.CTATMultiplicationNode("TIMES",[g[b-2],g[b]]);break;case 13:this.$=new d.CTATMultiplicationNode("DIVIDE",[g[b-2],g[b]]);break;case 14:this.$=
new d.CTATMultiplicationNode("ITIMES",[g[b-1],g[b]]);break;case 15:this.$=new d.CTATIntDivisionNode("IDIVIDE",g[b-2],g[b]);break;case 16:this.$=new d.CTATIntDivisionNode("REM",g[b-2],g[b]);break;case 18:this.$=new d.CTATUnaryNode("UPLUS",g[b]);break;case 19:this.$=new d.CTATUnaryNode("UMINUS",g[b]);break;case 21:this.$=new d.CTATPowerNode("EXP",g[b-2],g[b]);break;case 22:this.$=new d.CTATPowerNode("ROOT",g[b],new d.CTATConstantNode(2));break;case 24:this.$=g[b-1].setParens();break;case 25:this.$=
new d.CTATVariableNode(d.variableTable,g[b]);break;case 26:this.$=new d.CTATConstantNode(Number(g[b]));break;case 27:this.$=new d.CTATUnknownNode}},table:[{3:1,4:2,6:3,13:g,14:4,15:e,17:5,19:8,22:9,24:c,25:b,27:d,28:h,29:n},{1:[3]},{5:[1,15]},{5:[2,8],7:[1,16],8:[1,17],9:[1,18],10:[1,19],11:[1,20],12:[1,21],13:l,15:p},f(m,[2,11],{22:9,19:26,16:q,18:u,20:v,21:w,24:c,25:b,27:d,28:h,29:n}),f(B,[2,17]),{13:g,15:e,17:29,19:8,22:9,24:c,25:b,27:d,28:h,29:n},{13:g,15:e,17:30,19:8,22:9,24:c,25:b,27:d,28:h,
29:n},f(B,[2,20]),f(B,[2,23],{23:[1,31]}),{13:g,15:e,17:32,19:8,22:9,24:c,25:b,27:d,28:h,29:n},{6:33,13:g,14:4,15:e,17:5,19:8,22:9,24:c,25:b,27:d,28:h,29:n},f(C,[2,25]),f(C,[2,26]),f(C,[2,27]),{1:[2,1]},{6:34,13:g,14:4,15:e,17:5,19:8,22:9,24:c,25:b,27:d,28:h,29:n},{6:35,13:g,14:4,15:e,17:5,19:8,22:9,24:c,25:b,27:d,28:h,29:n},{6:36,13:g,14:4,15:e,17:5,19:8,22:9,24:c,25:b,27:d,28:h,29:n},{6:37,13:g,14:4,15:e,17:5,19:8,22:9,24:c,25:b,27:d,28:h,29:n},{6:38,13:g,14:4,15:e,17:5,19:8,22:9,24:c,25:b,27:d,
28:h,29:n},{6:39,13:g,14:4,15:e,17:5,19:8,22:9,24:c,25:b,27:d,28:h,29:n},{13:g,14:40,15:e,17:5,19:8,22:9,24:c,25:b,27:d,28:h,29:n},{13:g,14:41,15:e,17:5,19:8,22:9,24:c,25:b,27:d,28:h,29:n},{13:g,15:e,17:42,19:8,22:9,24:c,25:b,27:d,28:h,29:n},{13:g,15:e,17:43,19:8,22:9,24:c,25:b,27:d,28:h,29:n},f(B,[2,14]),{13:g,15:e,17:44,19:8,22:9,24:c,25:b,27:d,28:h,29:n},{13:g,15:e,17:45,19:8,22:9,24:c,25:b,27:d,28:h,29:n},f(B,[2,18]),f(B,[2,19]),{13:g,15:e,17:46,19:8,22:9,24:c,25:b,27:d,28:h,29:n},f(B,[2,22]),
{13:l,15:p,26:[1,47]},{5:[2,2],13:l,15:p},{5:[2,3],13:l,15:p},{5:[2,4],13:l,15:p},{5:[2,5],13:l,15:p},{5:[2,6],13:l,15:p},{5:[2,7],13:l,15:p},f(m,[2,9],{22:9,19:26,16:q,18:u,20:v,21:w,24:c,25:b,27:d,28:h,29:n}),f(m,[2,10],{22:9,19:26,16:q,18:u,20:v,21:w,24:c,25:b,27:d,28:h,29:n}),f(B,[2,12]),f(B,[2,13]),f(B,[2,15]),f(B,[2,16]),f(B,[2,21]),f(C,[2,24])],defaultActions:{15:[2,1]},parseError:function(b,a){if(a.recoverable)this.trace(b);else throw b=Error(b),b.hash=a,b;},parse:function(b){var a=[0],c=
[null],d=[],e=this.table,g="",f=0,h=0,l=0,n=d.slice.call(arguments,1),m=Object.create(this.lexer),p={},q;for(q in this.yy)Object.prototype.hasOwnProperty.call(this.yy,q)&&(p[q]=this.yy[q]);m.setInput(b,p);p.lexer=m;p.parser=this;"undefined"==typeof m.yylloc&&(m.yylloc={});q=m.yylloc;d.push(q);var w=m.options&&m.options.ranges;this.parseError="function"===typeof p.parseError?p.parseError:Object.getPrototypeOf(this).parseError;for(var B,u,v,F,C={},V,U;;){v=a[a.length-1];if(this.defaultActions[v])F=
this.defaultActions[v];else{if(null===B||"undefined"==typeof B)B=m.lex()||1,"number"!==typeof B&&(B=this.symbols_[B]||B);F=e[v]&&e[v][B]}if("undefined"===typeof F||!F.length||!F[0]){var ea;U=[];for(V in e[v])this.terminals_[V]&&2<V&&U.push("'"+this.terminals_[V]+"'");ea=m.showPosition?"Parse error on line "+(f+1)+":\n"+m.showPosition()+"\nExpecting "+U.join(", ")+", got '"+(this.terminals_[B]||B)+"'":"Parse error on line "+(f+1)+": Unexpected "+(1==B?"end of input":"'"+(this.terminals_[B]||B)+"'");
this.parseError(ea,{text:m.match,token:this.terminals_[B]||B,line:m.yylineno,loc:q,expected:U})}if(F[0]instanceof Array&&1<F.length)throw Error("Parse Error: multiple actions possible at state: "+v+", token: "+B);switch(F[0]){case 1:a.push(B);c.push(m.yytext);d.push(m.yylloc);a.push(F[1]);B=null;u?(B=u,u=null):(h=m.yyleng,g=m.yytext,f=m.yylineno,q=m.yylloc,0<l&&l--);break;case 2:U=this.productions_[F[1]][1];C.$=c[c.length-U];C._$={first_line:d[d.length-(U||1)].first_line,last_line:d[d.length-1].last_line,
first_column:d[d.length-(U||1)].first_column,last_column:d[d.length-1].last_column};w&&(C._$.range=[d[d.length-(U||1)].range[0],d[d.length-1].range[1]]);v=this.performAction.apply(C,[g,h,f,p,F[1],c,d].concat(n));if("undefined"!==typeof v)return v;U&&(a=a.slice(0,-2*U),c=c.slice(0,-1*U),d=d.slice(0,-1*U));a.push(this.productions_[F[1]][0]);c.push(C.$);d.push(C._$);F=e[a[a.length-2]][a[a.length-1]];a.push(F);break;case 3:return!0}}}},g=function(){return{EOF:1,parseError:function(b,a){if(this.yy.parser)this.yy.parser.parseError(b,
a);else throw Error(b);},setInput:function(b,a){this.yy=a||this.yy||{};this._input=b;this._more=this._backtrack=this.done=!1;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};this.options.ranges&&(this.yylloc.range=[0,0]);this.offset=0;return this},input:function(){var b=this._input[0];this.yytext+=b;this.yyleng++;this.offset++;this.match+=b;this.matched+=b;b.match(/(?:\r\n?|\n).*/g)?
(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++;this.options.ranges&&this.yylloc.range[1]++;this._input=this._input.slice(1);return b},unput:function(b){var a=b.length,c=b.split(/(?:\r\n?|\n)/g);this._input=b+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-a);this.offset-=a;b=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1);this.matched=this.matched.substr(0,this.matched.length-1);c.length-1&&(this.yylineno-=c.length-1);var d=
this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:c?(c.length===b.length?this.yylloc.first_column:0)+b[b.length-c.length].length-c[0].length:this.yylloc.first_column-a};this.options.ranges&&(this.yylloc.range=[d[0],d[0]+this.yyleng-a]);this.yyleng=this.yytext.length;return this},more:function(){this._more=!0;return this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+
(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(b){this.unput(this.match.slice(b))},pastInput:function(){var b=this.matched.substr(0,this.matched.length-this.match.length);return(20<b.length?"...":"")+b.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var b=this.match;20>b.length&&(b+=this._input.substr(0,
20-b.length));return(b.substr(0,20)+(20<b.length?"...":"")).replace(/\n/g,"")},showPosition:function(){var b=this.pastInput(),a=Array(b.length+1).join("-");return b+this.upcomingInput()+"\n"+a+"^"},test_match:function(b,a){var c,d;this.options.backtrack_lexer&&(d={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,
yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(d.yylloc.range=this.yylloc.range.slice(0)));if(c=b[0].match(/(?:\r\n?|\n).*/g))this.yylineno+=c.length;this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:c?c[c.length-1].length-c[c.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+b[0].length};this.yytext+=
b[0];this.match+=b[0];this.matches=b;this.yyleng=this.yytext.length;this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]);this._backtrack=this._more=!1;this._input=this._input.slice(b[0].length);this.matched+=b[0];b=this.performAction.call(this,this.yy,this,a,this.conditionStack[this.conditionStack.length-1]);this.done&&this._input&&(this.done=!1);if(b)return b;if(this._backtrack)for(var e in d)this[e]=d[e];return!1},next:function(){if(this.done)return this.EOF;this._input||
(this.done=!0);var b,a,c;this._more||(this.match=this.yytext="");for(var d=this._currentRules(),e=0;e<d.length;e++)if((a=this._input.match(this.rules[d[e]]))&&(!b||a[0].length>b[0].length))if(b=a,c=e,this.options.backtrack_lexer){b=this.test_match(a,d[e]);if(!1!==b)return b;if(this._backtrack)b=!1;else return!1}else if(!this.options.flex)break;return b?(b=this.test_match(b,d[c]),!1!==b?b:!1):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+
this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var b=this.next();return b?b:this.lex()},begin:function(b){this.conditionStack.push(b)},popState:function(){return 0<this.conditionStack.length-1?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(b){b=
this.conditionStack.length-1-Math.abs(b||0);return 0<=b?this.conditionStack[b]:"INITIAL"},pushState:function(b){this.begin(b)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(b,a,c,d){switch(c){case 1:return 25;case 2:return 26;case 3:return 23;case 4:return 23;case 5:return 24;case 6:return 24;case 7:return 16;case 8:return 16;case 9:return 16;case 10:return 20;case 11:return 18;case 12:return 18;case 13:return 21;case 14:return 15;case 15:return 13;
case 16:return 9;case 17:return 9;case 18:return 10;case 19:return 10;case 20:return 7;case 21:return 8;case 22:return 12;case 23:return 12;case 24:return 12;case 25:return 12;case 26:return 11;case 27:return 11;case 28:return 28;case 29:return 28;case 30:return 27;case 31:return 29;case 32:return 5}},rules:[/^(?:\s+)/,/^(?:\()/,/^(?:\))/,/^(?:\*\*)/,/^(?:\^)/,/^(?:\|)/,/^(?:\u221a)/,/^(?:\*)/,/^(?:\u00d7)/,/^(?:\u22c5)/,/^(?:\/\/)/,/^(?:\/)/,/^(?:\u00f7)/,/^(?:%)/,/^(?:-)/,/^(?:\+)/,/^(?:<=)/,/^(?:\u2264)/,
/^(?:>=)/,/^(?:\u2265)/,/^(?:<)/,/^(?:>)/,/^(?:!=)/,/^(?:\/=)/,/^(?:<>)/,/^(?:\u2260)/,/^(?:==)/,/^(?:=)/,/^(?:(([0-9])+\.?([0-9])*|\.([0-9])+)([Ee][+-]?([0-9])+)?)/,/^(?:(0[Bb]([0-1])+|0[Oo]([0-7])+|0[Xx]([0-9A-Fa-f])+))/,/^(?:([A-Za-z]))/,/^(?:\?)/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32],inclusive:!0}}}}();f.lexer=g;a.prototype=f;f.Parser=a;return new a}();var CTATAlgebraParser={};
(function(){var a,f=[].slice;a=function(){function a(a){this.parser=new CTATAlgebraGrammar.Parser;this.parser.yy={CTATRelationNode:CTATRelationNode,CTATAdditionNode:CTATAdditionNode,CTATMultiplicationNode:CTATMultiplicationNode,CTATIntDivisionNode:CTATIntDivisionNode,CTATUnaryNode:CTATUnaryNode,CTATPowerNode:CTATPowerNode,CTATVariableNode:CTATVariableNode,CTATConstantNode:CTATConstantNode,CTATUnknownNode:CTATUnknownNode,CTATAlgebraTreeNode:CTATAlgebraTreeNode};this.parser.yy.variableTable=a}a.partial=
["flatten","removeIdentity"];a.full="flatten computeConstants combineSimilar expand distribute removeIdentity".split(" ");a.prototype.toTree=function(a,c,b,d){null==c&&(c=!1);null==b&&(b=!1);null==d&&(d=!1);return(a instanceof CTATAlgebraTreeNode?b?a.clone():a:this.parser.parse(String(a))).applyRules([d?"flatten":"simpleFlatten"].concat(c?"sort":[]))};a.prototype.toExpression=function(a,c,b){null==b&&(b=!0);return a instanceof CTATAlgebraTreeNode?b&&c instanceof CTATAlgebraTreeNode?c.addPaths(c.path||
[]):c:null!=c?c.toString():c};a.prototype.equalExpressions=function(a,c){return a instanceof CTATAlgebraTreeNode||c instanceof CTATAlgebraTreeNode?a.toString()===c.toString():a===c};a.prototype.algParse=function(a,c,b){null==c&&(c=!1);null==b&&(b=!1);try{return this.toTree(a,c,!0,b).addPaths([])}catch(d){return null}};a.prototype.algGetError=function(a){try{return a instanceof CTATAlgebraTreeNode||this.parser.parse(String(a)),null}catch(c){return c}};a.prototype.algStringify=function(a){return(null!=
a?a.toString():void 0)||null};a.prototype.algEvaluate=function(a,c){null==c&&(c=null);try{return this.toTree(a).evaluate(c)}catch(b){return null}};a.prototype.algSort=function(a){try{return this.toExpression(a,this.toTree(a,!0,!0))}catch(c){return null}};a.prototype.algGetOperator=function(a){try{return this.toTree(a).getOperator(!0,1)}catch(c){return null}};a.prototype.algGetOperators=function(a){try{return this.toTree(a).getOperators(!0)}catch(c){return null}};a.prototype.algGetVariables=function(a){try{return this.toTree(a).getVariables()}catch(c){return null}};
a.prototype.algGetOperands=function(a){var c;try{return null!=(c=this.toTree(a))?c.getOperands().map(function(b){return function(c){return b.toExpression(a,c,!1)}}(this)):void 0}catch(b){return null}};a.prototype.algGetExpression=function(a,c,b){try{return this.toExpression(a,this.toTree(a).getExpression(c,b),!1)}catch(d){return null}};a.prototype.algFindExpression=function(a,c){try{return this.toTree(a).findExpression(this.toTree(c),[]).map(function(b){return function(c){return b.toExpression(a,
c,!1)}}(this))}catch(b){return null}};a.prototype.algCreateExpression=function(){var a,c,b,d;b=arguments[0];a=arguments[1];c=3<=arguments.length?f.call(arguments,2):[];try{return this.toExpression(a,(d=this.toTree(a,!1,!0)).createExpression.apply(d,[b].concat(f.call(c.map(function(b){return function(a){return b.toTree(a,!1,!0)}}(this))))))}catch(h){return null}};a.prototype.algReplaceExpression=function(a,c,b,d){var e,g;null==d&&(d=null);d=(null!=d?d:null!=(e=c.path)?e.slice(0):void 0)||0;try{return this.toExpression(a,
null!=(g=this.toTree(a))?g.replaceExpression(this.toTree(c),this.toTree(b),d):void 0)}catch(l){return null}};a.prototype.algDeleteExpression=function(a,c,b){var d,e;null==b&&(b=null);b=(null!=b?b:null!=(d=c.path)?d.slice(0):void 0)||0;try{return this.toExpression(a,null!=(e=this.toTree(a))?e.deleteExpression(this.toTree(c),b):void 0)}catch(n){return null}};a.prototype.algApplyRulesSelectively=function(){var a,c,b,d,g,n;a=arguments[0];n=arguments[1];c=arguments[2];b=arguments[3];d=5<=arguments.length?
f.call(arguments,4):[];null==c&&(c=!0);null==b&&(b=null);try{return this.toExpression(a,(g=this.toTree(a,!1,!0)).applyRulesSelectively.apply(g,[n,c,b].concat(f.call(d))))}catch(l){return null}};a.prototype.algApplyRules=function(a,c,b){null==b&&(b=!0);try{return this.toExpression(a,this.toTree(a,!1,!0).applyRules(c,b))}catch(d){return null}};a.prototype.algPartiallySimplify=function(e,c){null==c&&(c=!1);return this.algApplyRules(e,a.partial.concat(c?"sort":[]),!0)};a.prototype.algSimplify=function(e,
c){null==c&&(c=!1);return this.algApplyRules(e,a.full.concat(c?"sort":[]),!0)};a.prototype.algValid=function(a,c){var b,d;null==c&&(c=!1);return null!=(b=this.algParse(a,!0))&&null!=(d=this.algParse(a,!c))?this.equalExpressions(b,d):null};a.prototype.algValued=function(a,c){var b;null==c&&(c=null);return null!=(b=this.algEvaluate(a,c))?!isNaN(b):null};a.prototype.algPartiallySimplified=function(a,c){var b,d;null==c&&(c=!1);return null!=(b=this.algPartiallySimplify(a,!0))&&null!=(d=this.algParse(a,
!c))?this.equalExpressions(b,d):null};a.prototype.algSimplified=function(a,c){var b,d;null==c&&(c=!1);return null!=(b=this.algSimplify(a,!0))&&null!=(d=this.algParse(a,!c))?this.equalExpressions(b,d):null};a.prototype.algIdentical=function(a,c,b,d){null==b&&(b=!1);null==d&&(d=!1);return null!=(a=this.algParse(a,!b,d))&&null!=(c=this.algParse(c,!b,d))?this.equalExpressions(a,c):null};a.prototype.algEqual=function(a,c,b){var d,e;null==b&&(b=null);return null!=(d=this.algEvaluate(a,b))&&null!=(e=this.algEvaluate(c,
b))?d===e:null};a.prototype.algPartiallyEquivalent=function(a,c,b){null==b&&(b=!1);return null!=(a=this.algPartiallySimplify(a,!b))&&null!=(c=this.algPartiallySimplify(c,!b))?this.equalExpressions(a,c):null};a.prototype.algEquivalent=function(a,c,b){null==b&&(b=!1);return null!=(a=this.algSimplify(a,!b))&&null!=(c=this.algSimplify(c,!b))?this.equalExpressions(a,c):null};a.prototype.isAlgValid=a.prototype.algValid;a.prototype.algEval=a.prototype.algEvaluate;a.prototype.algStrictEquivTermsSameOrder=
function(a,c){return this.algPartiallyEquivalent(a,c,!0)};a.prototype.algEquivTermsSameOrder=a.prototype.algStrictEquivTermsSameOrder;a.prototype.algStrictEquivTerms=a.prototype.algPartiallyEquivalent;a.prototype.algEquivTerms=a.prototype.algStrictEquivTerms;a.prototype.algEquiv=a.prototype.algEquivalent;a.prototype.isSimplified=function(a){return this.algSimplified(a,!0)};a.prototype.calc=a.prototype.algEvaluate;a.prototype.calca=function(a){return(+this.algEvaluate(a)).toFixed(2)};a.prototype.simplify=
function(a){return this.algSimplify(a,!0)};a.prototype.algebraicEqual=a.prototype.algEqual;a.prototype.patternMatches=function(a,c){return this.algIdentical(a,c,!0)};a.prototype.polyTermsEqual=function(a,c){return this.algPartiallyEquivalent(a,c)};a.prototype.algebraicMatches=function(a,c){return this.algEquivalent(a,c,!0)};a.prototype.expressionMatches=a.prototype.algebraicMatches;return a}();"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATAlgebraParser=a}).call(this);var CTATLogicTreeNode={};
(function(){var a,f=[].slice;a=function(){function a(){var e,c;null!=this.string?a.operatorStrings[null!=(e=this.value)?e:this.operator]=this.string:this.string=a.operatorStrings[null!=(c=this.value)?c:this.operator]}a.operators=[["CONST"],["VAR"],["NOT"],["AND","NAND"],["OR","NOR"],["IF"],["IFF","XOR"]];a.operatorStrings={NOT:"\u00ac",AND:"\u2227",OR:"\u2228",NAND:"\u22bc",NOR:"\u22bd",XOR:"\u2295",IF:"\u2192",IFF:"\u2194","true":"\u22a4","false":"\u22a5"};a.toOperatorString=function(a){return this.operatorStrings[a]||
""};a.diff=function(a,c){return a.filter(function(b){return!c.includes(b)})};a.uniq=function(a){return f.call(new Set(a))};a.removeIndex=function(a,c){a=a.slice(0);[].splice.apply(a,[c,c-c+1].concat(c=[]));c;return a};a.difference=function(a,c){return a.filter(function(b){return!c.some(function(a){return a===b})})};a.intersection=function(a){return a[0].filter(function(c){return a.every(function(b){return b.some(function(b){return b.equals(c)})})})};a.commonLength=function(a){var c;c=null;return a.every(function(b){return(null!=
c?c:c=b.length)===b.length})&&c};a.sameNegation=function(a){return 2===a.length&&a[0].negationNode()===a[1].negationNode()};a.oppositeNegation=function(a){return 2===a.length&&a[0].negationNode()!==a[1].negationNode()};a.replaceTerms=function(a,c,b){var d,e,g,f,p;f=[];d=0;for(e=a.length;d<e;d++)p=a[d],(!(g=c.find(function(b){return b[0]===p}))||b&&(p=p.junctionNode(this.removeIndex(p.terms,g[1]))))&&f.push(p);return f};a.prototype.addOperand=function(a,c,b){null==b&&(b=null);return new CTATLogicFlattenNode(a,
[this,c],b)};a.prototype.setParens=function(){this.parens=!0;return this};a.prototype.checkParens=function(){var a;return"NOT"===(a=this.operator)||"VAR"===a||"CONST"===a||this.parens};a.prototype.toString=function(e,c,b,d){null==c&&(c=!1);null==b&&(b=null);null==d&&(d=!1);this.addParens(c,b,d)&&(e="("+e+")");this.negated&&(e=""+a.operatorStrings.NOT+e);return e};a.prototype.addParens=function(a,c,b){return(null!=this.left||null!=this.terms)&&null!=c&&(a||this.precedence()>c.precedence()||b&&this.precedence()===
c.precedence())};a.prototype.operatorString=function(){return""+(this.binaryOp()?" ":"")+this.string+(this.binaryOp()?" ":"")};a.prototype.evaluate=function(a){return this.negated?applyOperator("NOT",a):a};a.prototype.applyOperator=function(a,c,b){switch(a){case "NOT":if(null!=c)return!c;break;case "AND":return null!=c?c&&b:b&&c;case "OR":return null!=c?c||b:b||c}};a.prototype.equals=function(a,c){return a&&this.operator===a.operator&&c!==(this.negated===a.negated)};a.prototype.inverse=function(a){return this.negationOp()?
this.right.equals(a):a.negationOp()?this.equals(a.right):!1};a.prototype.subEquals=function(a,c){return!1};a.prototype.subNode=function(a,c){return this};a.prototype.countOperands=function(){return 0};a.prototype.getOperator=function(a){null==a&&(a=!1);return!a&&this.operator||this.string};a.prototype.getOperators=function(a){return[]};a.prototype.getVariables=function(){return[]};a.prototype.getOperands=function(){return[]};a.prototype.getExpression=function(a,c){null==a&&(a=0);null==c&&(c=this.countOperands()-
1);return c<=this.countOperands()-1&&1<=c-a&&this.subNode(a,c+1)||null};a.prototype.findOperator=function(a,c,b,d){null==b&&(b=null);null==d&&(d="none");return b||this.operator!==a||null!=this.terms&&2!==this.terms.length&&"none"!==d?null!=b&&this.operator===a&&"none"!==d?(b="left"===d?[0,b+2]:[b,this.terms.length],a=b[0],b=b[1],[Object.assign(this.subNode(a,b),{path:c.concat([[a,b]])})]):[]:[Object.assign(this,{path:c})]};a.prototype.findExpression=function(a,c,b){var d;null==b&&(b=null);return!b&&
this.equals(a)?[Object.assign(this,{path:c})]:null!=b&&this.subEquals(a,b)?[Object.assign(this.subNode(b,d=b+a.terms.length),{path:c.concat([[b,d]])})]:[]};a.prototype.findRule=function(a,c,b,d){null==b&&(b=!1);null==d&&(d=null);return!d&&this.testRule(a,b)?[Object.assign(this,{path:c})]:null!=d&&this.testRule(a,b,d)?[Object.assign(this.subNode(d,d+2),{path:c.concat([[d,d+2]])})]:[]};a.prototype.createExpression=function(){var a,c;c=arguments[0];a=2<=arguments.length?f.call(arguments,1):[];switch(c){case "NAND":case "NOR":case "XOR":case "IF":case "IFF":return a[0]&&
new CTATLogicRelationNode(c,this,a[0])||null;case "AND":case "OR":return 1<a.unshift(this)&&new CTATLogicFlattenNode(c,a)||null;case "NOT":return new CTATLogicRelationNode(c,null,this)}};a.prototype.replaceExpression=function(a,c,b){var d,e,g,f,p;"number"===typeof b&&(a=this.findExpression(a,[])[b])&&(b=a.path,delete a.path);if(0===(null!=b?b.length:void 0))return c;if(null!=(p=null!=b?b.shift():void 0))return d=this.clone(!1),"string"===typeof p?(d[p]=null!=(e=this[p])?e.replaceExpression(a,c,b):
void 0,d):"number"===typeof p?(d.terms=d.terms.slice(0),d.terms[p]=null!=(g=this.terms[p])?g.replaceExpression(a,c,b):void 0,d):"object"===typeof p?(d.terms=d.terms.slice(0),[].splice.apply(d.terms,[f=p[0],p[1]-f].concat(c)),c,d):this};a.prototype.deleteExpression=function(a,c){var b,d,e,g,f;"number"===typeof c&&(a=this.findExpression(a,[])[c])&&(c=a.path,delete a.path);if(0===(null!=c?c.length:void 0))return null;if(null!=(f=null!=c?c.shift():void 0))return b=this.clone(!1),"string"===typeof f?(b[f]=
null!=(d=this[f])?d.deleteExpression(a,c):void 0,b.removeNull()):"number"===typeof f?(b.terms=b.terms.slice(0),b.terms[f]=null!=(e=this.terms[f])?e.deleteExpression(a,c):void 0,b.removeNull()):"object"===typeof f?(b.terms=b.terms.slice(0),[].splice.apply(b.terms,[g=f[0],f[1]-g].concat(null)),null,b.removeNull()):this};a.prototype.removeNull=function(){return this};a.prototype.applyTests=function(a){return a.every(function(a){return function(b){return a[b]()}}(this))};a.prototype.applyRules=function(a,
c,b){null==c&&(c=!1);null==b&&(b=!1);b=("string"===typeof a?[a]:a).reduce(function(b,e){b.rules=a;return b=b[e](c)},this);delete b.rules;return b};a.prototype.testRule=function(a,c,b){null==c&&(c=!1);null==b&&(b=null);return this.subNode(b)[a](c,!0)};a.prototype.findCounterExample=function(e){return this.checkExpressions(e,a.uniq(this.getVariables().concat(e.getVariables())),{})};a.prototype.checkExpressions=function(a,c,b){var d,e;if(c.length)return this.checkExpressions(a,c.slice(1),Object.assign(b,
(d={},d[""+c[0]]=!0,d)))||this.checkExpressions(a,c.slice(1),Object.assign(b,(e={},e[""+c[0]]=!1,e)));if(this.evaluate(b)!==a.evaluate(b))return b};a.prototype.truth=function(a,c){null==c&&(c=!1);return!c&&this};a.prototype.domination=function(a,c){null==c&&(c=!1);return!c&&this};a.prototype.negation=function(a,c){null==c&&(c=!1);return!c&&this};a.prototype.identity=function(a,c){null==a&&(a=!1);null==c&&(c=!1);return a?c||new CTATLogicFlattenNode("OR",this,new CTATLogicConstantNode(!0)):!c&&this};
a.prototype.idempotence=function(a,c){null==a&&(a=!1);null==c&&(c=!1);return a?c||new CTATLogicFlattenNode("OR",[this,this]):!c&&this};a.prototype.absorption=function(a,c){null==c&&(c=!1);return!c&&this};a.prototype.inverseAbsorption=function(a,c){null==c&&(c=!1);return!c&&this};a.prototype.commutativity=function(a,c){null==c&&(c=!1);return!c&&this};a.prototype.associativity=function(a,c){null==c&&(c=!1);return!c&&this};a.prototype.distributivity=function(a,c){null==c&&(c=!1);return!c&&this};a.prototype.deMorgan=
function(a,c){null==c&&(c=!1);return!c&&this};a.prototype.doubleNegation=function(a,c){null==a&&(a=!1);null==c&&(c=!1);return a&&!this.negationOp()?c||this.negateNode().negateNode():!c&&this};a.prototype.implication=function(a,c){null==c&&(c=!1);return!c&&this};a.prototype.biimplication=function(a,c){null==c&&(c=!1);return!c&&this};a.prototype.biimplicationToImplication=function(a,c){null==c&&(c=!1);return!c&&this};a.prototype.exclusiveDisjunction=function(a,c){null==c&&(c=!1);return!c&&this};a.prototype.exclusiveDisjunctionToImplication=
function(a,c){null==c&&(c=!1);return!c&&this};a.prototype.findPairs=function(a,c,b){var d,e,g,f,p;f=[];d=0;for(g=c.length;d<g;d++)p=c[d],p.operator===a&&-1!==(e=p.terms.findIndex(function(a){return function(c){return c[b](a)}}(this)))&&f.push([p,e]);return f};a.prototype.normalFormOperators=function(){var a;return"NOT"===(a=this.operator)||"AND"===a||"OR"===a||"VAR"===a||"CONST"===a};a.prototype.atomicNegation=function(){return!0};a.prototype.atomicConjunction=function(){return!0};a.prototype.atomicDisjunction=
function(){return!0};a.prototype.replaceNodes=function(){return this};a.prototype.flatten=function(){return this};a.prototype.pushNegation=function(){return this};a.prototype.distributeDisjunction=function(){return this};a.prototype.distributeConjunction=function(){return this};a.prototype.sort=function(){return this};a.prototype.absorb=function(){return this};a.prototype.compare=function(a){return Math.sign(this.countLevels()-a.countLevels()||this.precedence(!0)-a.precedence(!0)||this.countVariables()-
a.countVariables())};a.prototype.compareNegations=function(a){return this.negationNode()-a.negationNode()};a.prototype.precedence=function(e){null==e&&(e=!1);return a.operators.findIndex(function(a){return function(b){return b.includes(a.operator)}}(this))};a.prototype.countVariables=function(){return 0};a.prototype.countLevels=function(){return 0};a.prototype.invertOperator=function(){this.operator=this.inverseOperator();this.string=a.operatorStrings[this.operator];return this};a.prototype.inverseOperator=
function(){return this.conjunctionOp()?"OR":this.disjunctionOp()?"AND":this.operator};a.prototype.negateNode=function(){return new CTATLogicRelationNode("NOT",null,this)};a.prototype.unnegateNode=function(){return this.negationOp()?this.right:this};a.prototype.unnegateOperator=function(){return this.negativeConjunctionOp()?"AND":this.negativeDisjunctionOp()?"OR":this.operator};a.prototype.negationNode=function(){return this.negationOp()&&!this.right.negationNode()||this.negated};a.prototype.negate=
function(){this.negated&&this.setSteps(this.steps+1);this.negated=!this.negated;return this};a.prototype.setSteps=function(a){isNaN(a)||(this.steps=a);return this};a.prototype.atomic=function(){var a,c;return"VAR"===(a=this.operator)||"CONST"===a||"NOT"===this.operator&&("VAR"===(c=this.right.operator)||"CONST"===c)};a.prototype.negationOp=function(){return"NOT"===this.operator};a.prototype.conjunctionOp=function(){return"AND"===this.operator};a.prototype.disjunctionOp=function(){return"OR"===this.operator};
a.prototype.negativeConjunctionOp=function(){return"NAND"===this.operator};a.prototype.negativeDisjunctionOp=function(){return"NOR"===this.operator};a.prototype.junctionOp=function(){var a;return"AND"===(a=this.operator)||"OR"===a};a.prototype.negativeJunctionOp=function(){var a;return"NAND"===(a=this.operator)||"NOR"===a};a.prototype.exclusiveDisjunctionOp=function(){return"XOR"===this.operator};a.prototype.implicationOp=function(){return"IF"===this.operator};a.prototype.biimplicationOp=function(){return"IFF"===
this.operator};a.prototype.binaryOp=function(){var a;return"AND"===(a=this.operator)||"OR"===a||"NAND"===a||"NOR"===a||"IF"===a||"IFF"===a||"XOR"===a};a.prototype.constant=function(a){return!1};return a}();"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATLogicTreeNode=a}).call(this);var CTATLogicRelationNode={};
(function(){var a,f=function(a,c){function b(){this.constructor=a}for(var d in c)g.call(c,d)&&(a[d]=c[d]);b.prototype=c.prototype;a.prototype=new b;a.__super__=c.prototype;return a},g={}.hasOwnProperty;a=function(a){function c(b,a,e,g,f){this.operator=b;this.left=a;this.right=e;this.string=null!=g?g:null;this.negated=null!=f?f:!1;c.__super__.constructor.apply(this,arguments)}f(c,a);c.prototype.clone=function(b){var a;null==b&&(b=!0);return new c(this.operator,b?(null!=(a=this.left)?a.clone():void 0)||
null:this.left,b?this.right.clone():this.right,this.string,this.negated)};c.prototype.toString=function(b,a,e){var d,g,f;null==b&&(b=!1);null==a&&(a=null);null==e&&(e=!1);return c.__super__.toString.call(this,""+((null!=(d=this.left)?d.toString(b,this,"IF"===(g=this.operator)||"IFF"===g||"XOR"===g):void 0)||"")+(""+this.operatorString())+this.right.toString(b,this,"AND"===(f=this.operator)||"NAND"===f||"OR"===f||"NOR"===f),b,a,e)};c.prototype.evaluate=function(b){var a,e,g;null==b&&(b=null);a=null!=
(e=this.left)?e.evaluate(b):void 0;g=this.right.evaluate(b);return c.__super__.evaluate.call(this,function(){switch(this.operator){case "NOT":return this.applyOperator("NOT",g);case "NAND":return this.applyOperator("NOT",this.applyOperator("AND",a,g));case "NOR":return this.applyOperator("NOT",this.applyOperator("OR",a,g));case "IF":return this.applyOperator("OR",this.applyOperator("NOT",a),g);case "IFF":return this.applyOperator("OR",this.applyOperator("AND",a,g),this.applyOperator("AND",this.applyOperator("NOT",
a),this.applyOperator("NOT",g)));case "XOR":return this.applyOperator("OR",this.applyOperator("AND",a,this.applyOperator("NOT",g)),this.applyOperator("AND",this.applyOperator("NOT",a),g))}}.call(this))};c.prototype.equals=function(b,a){return c.__super__.equals.call(this,b,a)&&(null==this.left||this.left.equals(b.left,!1))&&this.right.equals(b.right,!1)};c.prototype.countOperands=function(){return 2};c.prototype.getOperators=function(b){var a,c;null==b&&(b=!1);return(null!=(a=null!=(c=this.left)?
c.getOperators(b):void 0)?a:[]).concat(this.getOperator(b),this.right.getOperators(b))};c.prototype.getVariables=function(){var b,a;return(null!=(b=null!=(a=this.left)?a.getVariables():void 0)?b:[]).concat(this.right.getVariables())};c.prototype.getOperands=function(){return null!=this.left?[this.left,this.right]:[this.right]};c.prototype.findOperator=function(b,a,e){var d,g;null==e&&(e="none");return(null!=(d=null!=(g=this.left)?g.findOperator(b,a.concat(["left"]),e):void 0)?d:[]).concat(c.__super__.findOperator.call(this,
b,a,null,e),this.right.findOperator(b,a.concat(["right"]),e))};c.prototype.findExpression=function(b,a){var d,e;return(null!=(d=null!=(e=this.left)?e.findExpression(b,a.concat(["left"])):void 0)?d:[]).concat(c.__super__.findExpression.call(this,b,a),this.right.findExpression(b,a.concat(["right"])))};c.prototype.findRule=function(b,a,e){var d,g;null==e&&(e=!1);return(null!=(d=null!=(g=this.left)?g.findRule(b,a.concat(["left"]),e):void 0)?d:[]).concat(c.__super__.findRule.call(this,b,a,e),this.right.findRule(b,
a.concat(["right"]),e))};c.prototype.removeNull=function(){var b,a;this.left=null!=(b=this.left)?b.removeNull():void 0;this.right=null!=(a=this.right)?a.removeNull():void 0;return null!=this.left&&null!=this.right?this:this.left||this.right||null};c.prototype.applyRules=function(b,a,e){var d,g,f;this.rules=b;null==a&&(a=!1);null==e&&(e=!1);e&&(this.left=(null!=(d=this.left)?null!=(g=d.setSteps(this.steps))?g.applyRules(this.rules,a,!0):void 0:void 0)||null,this.right=this.right.setSteps((null!=(f=
this.left)?f.steps:void 0)||this.steps).applyRules(this.rules,a,!0),this.setSteps(this.right.steps));return c.__super__.applyRules.apply(this,arguments)};c.prototype.truth=function(b,a){null==b&&(b=!1);null==a&&(a=!1);return!b&&this.negationOp()&&this.right.constant()?a||this.right.clone().negate():!a&&this};c.prototype.deMorgan=function(b,a){null==b&&(b=!1);null==a&&(a=!1);return!b&&this.negationOp()&&this.right.junctionOp()?a||this.right.reverseNode():!a&&this};c.prototype.doubleNegation=function(b,
a){null==b&&(b=!1);null==a&&(a=!1);return!b&&this.negationOp()&&this.right.negationOp()?a||this.unnegateNode().unnegateNode():c.__super__.doubleNegation.apply(this,arguments)};c.prototype.negativeConjunction=function(b,a){null==b&&(b=!1);null==a&&(a=!1);return!b&&this.negativeConjunctionOp()?a||(new CTATLogicFlattenNode("AND",[this.left,this.right])).negateNode():b&&this.negationOp()&&this.right.conjunctionOp()&&2===this.right.terms.length?a||new c("NAND",this.right.terms[0],this.right.terms[1]):
!a&&this};c.prototype.negativeDisjunction=function(b,a){null==b&&(b=!1);null==a&&(a=!1);return!b&&this.negativeDisjunctionOp()?a||(new CTATLogicFlattenNode("OR",[this.left,this.right])).negateNode():b&&this.negationOp()&&this.right.disjunctionOp()&&2===this.right.terms.length?a||new c("NOR",this.right.terms[0],this.right.terms[1]):!a&&this};c.prototype.implication=function(b,a){null==b&&(b=!1);null==a&&(a=!1);return!b&&this.implicationOp()?a||new CTATLogicFlattenNode("OR",[this.left.negateNode(),
this.right]):!a&&this};c.prototype.biimplication=function(b,a){null==b&&(b=!1);null==a&&(a=!1);return!b&&this.biimplicationOp()?a||new CTATLogicFlattenNode("OR",[new CTATLogicFlattenNode("AND",[this.left,this.right]),new CTATLogicFlattenNode("AND",[this.left.negateNode(),this.right.negateNode()])]):!a&&this};c.prototype.biimplicationToImplication=function(b,a){null==b&&(b=!1);null==a&&(a=!1);return!b&&this.biimplicationOp()?a||new CTATLogicFlattenNode("AND",[new c("IF",this.left,this.right),new c("IF",
this.right,this.left)]):!a&&this};c.prototype.exclusiveDisjunction=function(b,a){null==b&&(b=!1);null==a&&(a=!1);return!b&&this.exclusiveDisjunctionOp()?a||new CTATLogicFlattenNode("OR",[new CTATLogicFlattenNode("AND",[this.left,this.right.negateNode()]),new CTATLogicFlattenNode("AND",[this.left.negateNode(),this.right])]):!a&&this};c.prototype.exclusiveDisjunctionToImplication=function(b,a){null==b&&(b=!1);null==a&&(a=!1);return!b&&this.exclusiveDisjunctionOp()?a||new CTATLogicFlattenNode("AND",
[new c("IF",this.left,this.right.negateNode()),new c("IF",this.right.negateNode(),this.left)]):!a&&this};c.prototype.normalFormOperators=function(){return c.__super__.normalFormOperators.apply(this,arguments)&&(null==this.left||this.left.normalFormOperators())&&this.right.normalFormOperators()};c.prototype.atomicNegation=function(){return this.atomic()||!this.negationOp()&&!this.negated&&this.left.atomicNegation()&&this.right.atomicNegation()};c.prototype.atomicConjunction=function(){return this.atomic()||
(null==this.left||this.left.atomicConjunction())&&this.right.atomicConjunction()};c.prototype.atomicDisjunction=function(){return this.atomic()||(null==this.left||this.left.atomicDisjunction())&&this.right.atomicDisjunction()};c.prototype.replaceNodes=function(){var b,a,c,e;e=CTATLogicTreeNode.diff(this.rules,["replaceNodes"]);switch(this.operator){case "NOT":return this.right.setSteps(this.steps).negate();case "NAND":case "NOR":return(new CTATLogicFlattenNode(this.unnegateOperator(),[this.left,this.right])).setSteps(this.steps+
1).negate().applyRules(e);case "IF":return(new CTATLogicFlattenNode("OR",[b=this.left.setSteps(this.steps).negate().applyRules(e),this.right])).setSteps(b.steps+1);case "IFF":return a=new CTATLogicFlattenNode("OR",[new CTATLogicFlattenNode("AND",[this.left,this.right]),new CTATLogicFlattenNode("AND",[b=this.left.clone().setSteps(this.steps).negate().applyRules(e),c=this.right.clone().setSteps(b.steps).negate().applyRules(e)])]),a.setSteps(c.steps).terms=a.terms.map(function(b){return function(b){b=
b.setSteps(a.steps).applyRules(e);a.setSteps(b.steps);return b}}(this)),a.setSteps(a.steps+1);case "XOR":return a=new CTATLogicFlattenNode("OR",[new CTATLogicFlattenNode("AND",[this.left,c=this.right.clone().setSteps(this.steps).negate().applyRules(e)]),new CTATLogicFlattenNode("AND",[b=this.left.clone().setSteps(c.steps).negate().applyRules(e),this.right])]),a.setSteps(b.steps).terms=a.terms.map(function(b){return function(b){b=b.setSteps(a.steps).applyRules(e);a.setSteps(b.steps);return b}}(this)),
a.setSteps(a.steps+1)}};c.prototype.sort=function(){var b;("NAND"===(b=this.operator)||"NOR"===b||"IFF"===b||"XOR"===b)&&0<this.left.compare(this.right)&&(b=[this.right,this.left],this.left=b[0],this.right=b[1]);return this};c.prototype.compare=function(b){return c.__super__.compare.apply(this,arguments)||("NOT"===this.operator&&"NOT"===b.operator?this.right.compare(b.right):"NOT"===this.operator?this.right.compare(b):"NOT"===b.operator?this.compare(b.right):this.left.compare(b.left)||this.right.compare(b.right))||
this.compareNegations(b)};c.prototype.precedence=function(b){null==b&&(b=!1);return b&&"NOT"===this.operator?this.right.precedence():c.__super__.precedence.apply(this,arguments)};c.prototype.countVariables=function(){var b;return((null!=(b=this.left)?b.countVariables():void 0)||0)+this.right.countVariables()};c.prototype.countLevels=function(){var b;return"NOT"===this.operator?this.right.countLevels():1+Math.max((null!=(b=this.left)?b.countLevels():void 0)||0,this.right.countLevels())};return c}(CTATLogicTreeNode);
"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATLogicRelationNode=a}).call(this);var CTATLogicVariableNode={};
(function(){var a,f=function(a,c){function b(){this.constructor=a}for(var d in c)g.call(c,d)&&(a[d]=c[d]);b.prototype=c.prototype;a.prototype=new b;a.__super__=c.prototype;return a},g={}.hasOwnProperty;a=function(a){function c(b,a,c){this.variableTable=b;this.variable=a;this.negated=null!=c?c:!1;this.operator="VAR"}f(c,a);c.prototype.clone=function(){return new c(this.variableTable,this.variable,this.negated)};c.prototype.toString=function(b,a,e){null==b&&(b=!1);null==a&&(a=null);null==e&&(e=!1);
return c.__super__.toString.call(this,this.variable,b,a,e)};c.prototype.evaluate=function(b){null==b&&(b=null);return c.__super__.evaluate.call(this,function(){if(null!=b)return("function"===typeof b.get?b.get(this.variable):void 0)||b[this.variable];if(null!=this.variableTable)return this.variableTable.get(this.variable);try{return eval(this.variable)}catch(d){}}.call(this))};c.prototype.equals=function(b,a){return c.__super__.equals.call(this,b,a)&&this.variable===b.variable};c.prototype.getVariables=
function(){return[this.variable]};c.prototype.compare=function(b){return c.__super__.compare.apply(this,arguments)||this.variable>b.variable&&1||this.variable<b.variable&&-1||this.compareNegations(b)};c.prototype.countVariables=function(){return 1};return c}(CTATLogicTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATLogicVariableNode=a}).call(this);var CTATLogicConstantNode={};
(function(){var a,f=function(a,c){function b(){this.constructor=a}for(var d in c)g.call(c,d)&&(a[d]=c[d]);b.prototype=c.prototype;a.prototype=new b;a.__super__=c.prototype;return a},g={}.hasOwnProperty;a=function(a){function c(b,a,e){this.value=b;this.string=null!=a?a:null;this.negated=null!=e?e:!1;this.operator="CONST";c.__super__.constructor.apply(this,arguments)}f(c,a);c.prototype.clone=function(){return new c(this.value,this.string,this.negated)};c.prototype.toString=function(b,a,e){null==b&&
(b=!1);null==a&&(a=null);null==e&&(e=!1);return c.__super__.toString.call(this,this.string,b,a,e)};c.prototype.evaluate=function(b){return c.__super__.evaluate.call(this,this.value)};c.prototype.equals=function(b,a){return c.__super__.equals.call(this,b,a)&&a!==(this.value===b.value)};c.prototype.truth=function(b,a){null==b&&(b=!1);null==a&&(a=!1);return b?a||this.negateNode():!a&&this};c.prototype.compare=function(b){return c.__super__.compare.apply(this,arguments)||this.value-b.value};c.prototype.negate=
function(){this.setSteps(this.steps+1);this.value=!this.value;this.string=CTATLogicTreeNode.toOperatorString(this.value);return this};c.prototype.constant=function(b){null==b&&(b=null);return null==b||this.value===b};return c}(CTATLogicTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATLogicConstantNode=a}).call(this);var CTATLogicGrammar=function(){function a(){this.yy={}}var f=function(b,a,c,d){c=c||{};for(d=b.length;d--;c[b[d]]=a);return c},g=[1,3],e=[1,5],c=[1,6],b=[1,7],d=[1,8],h=[1,10],n=[1,11],l=[1,12],p=[1,13],m=[1,14],q=[1,15],u=[1,16],v=[5,6,7,8,9,10,11,12,16],w=[5,7,9,10,11,12,16],f={trace:function(){},yy:{},symbols_:{error:2,expression:3,logical:4,EOF:5,AND:6,OR:7,NAND:8,NOR:9,XOR:10,IF:11,IFF:12,NOT:13,atom:14,LPAREN:15,RPAREN:16,VARIABLE:17,TRUE:18,FALSE:19,$accept:0,$end:1},terminals_:{2:"error",
5:"EOF",6:"AND",7:"OR",8:"NAND",9:"NOR",10:"XOR",11:"IF",12:"IFF",13:"NOT",15:"LPAREN",16:"RPAREN",17:"VARIABLE",18:"TRUE",19:"FALSE"},productions_:[0,[3,2],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,2],[4,1],[14,3],[14,1],[14,1],[14,1]],performAction:function(b,a,c,d,e,g,f){b=g.length-1;switch(e){case 1:return g[b-1];case 2:d.parser.checkStrict(g[b-2],f[b-2],d.lexer.matched);d.parser.checkStrict(g[b],f[b],d.lexer.matched);this.$=g[b-2].addOperand("AND",g[b],g[b-1]);break;case 3:d.parser.checkStrict(g[b-
2],f[b-2],d.lexer.matched);d.parser.checkStrict(g[b],f[b],d.lexer.matched);this.$=g[b-2].addOperand("OR",g[b],g[b-1]);break;case 4:d.parser.checkStrict(g[b-2],f[b-2],d.lexer.matched);d.parser.checkStrict(g[b],f[b],d.lexer.matched);this.$=new d.CTATLogicRelationNode("NAND",g[b-2],g[b],g[b-1]);break;case 5:d.parser.checkStrict(g[b-2],f[b-2],d.lexer.matched);d.parser.checkStrict(g[b],f[b],d.lexer.matched);this.$=new d.CTATLogicRelationNode("NOR",g[b-2],g[b],g[b-1]);break;case 6:d.parser.checkStrict(g[b-
2],f[b-2],d.lexer.matched);d.parser.checkStrict(g[b],f[b],d.lexer.matched);this.$=new d.CTATLogicRelationNode("XOR",g[b-2],g[b],g[b-1]);break;case 7:d.parser.checkStrict(g[b-2],f[b-2],d.lexer.matched);d.parser.checkStrict(g[b],f[b],d.lexer.matched);this.$=new d.CTATLogicRelationNode("IF",g[b-2],g[b],g[b-1]);break;case 8:d.parser.checkStrict(g[b-2],f[b-2],d.lexer.matched);d.parser.checkStrict(g[b],f[b],d.lexer.matched);this.$=new d.CTATLogicRelationNode("IFF",g[b-2],g[b],g[b-1]);break;case 9:d.parser.checkStrict(g[b],
f[b],d.lexer.matched);this.$=new d.CTATLogicRelationNode("NOT",null,g[b],g[b-1]);break;case 10:this.$=g[b];break;case 11:this.$=g[b-1].setParens();break;case 12:this.$=new d.CTATLogicVariableNode(d.variableTable,g[b]);break;case 13:this.$=new d.CTATLogicConstantNode(!0,g[b]);break;case 14:this.$=new d.CTATLogicConstantNode(!1,g[b])}},table:[{3:1,4:2,13:g,14:4,15:e,17:c,18:b,19:d},{1:[3]},{5:[1,9],6:h,7:n,8:l,9:p,10:m,11:q,12:u},{4:17,13:g,14:4,15:e,17:c,18:b,19:d},f(v,[2,10]),{4:18,13:g,14:4,15:e,
17:c,18:b,19:d},f(v,[2,12]),f(v,[2,13]),f(v,[2,14]),{1:[2,1]},{4:19,13:g,14:4,15:e,17:c,18:b,19:d},{4:20,13:g,14:4,15:e,17:c,18:b,19:d},{4:21,13:g,14:4,15:e,17:c,18:b,19:d},{4:22,13:g,14:4,15:e,17:c,18:b,19:d},{4:23,13:g,14:4,15:e,17:c,18:b,19:d},{4:24,13:g,14:4,15:e,17:c,18:b,19:d},{4:25,13:g,14:4,15:e,17:c,18:b,19:d},f(v,[2,9]),{6:h,7:n,8:l,9:p,10:m,11:q,12:u,16:[1,26]},f(v,[2,2]),f(w,[2,3],{6:h,8:l}),f(w,[2,4],{6:h}),f([5,10,11,12,16],[2,5],{6:h,7:n,8:l}),f([5,11,12,16],[2,6],{6:h,7:n,8:l,9:p,
10:m}),f([5,12,16],[2,7],{6:h,7:n,8:l,9:p,10:m,11:q}),f([5,16],[2,8],{6:h,7:n,8:l,9:p,10:m,11:q,12:u}),f(v,[2,11])],defaultActions:{9:[2,1]},parseError:function(b,a){if(a.recoverable)this.trace(b);else throw b=Error(b),b.hash=a,b;},parse:function(b){var a=[0],c=[null],d=[],e=this.table,g="",f=0,h=0,l=0,n=d.slice.call(arguments,1),m=Object.create(this.lexer),p={},q;for(q in this.yy)Object.prototype.hasOwnProperty.call(this.yy,q)&&(p[q]=this.yy[q]);m.setInput(b,p);p.lexer=m;p.parser=this;"undefined"==
typeof m.yylloc&&(m.yylloc={});q=m.yylloc;d.push(q);var w=m.options&&m.options.ranges;this.parseError="function"===typeof p.parseError?p.parseError:Object.getPrototypeOf(this).parseError;for(var u,B,v,z,T={},X,S;;){v=a[a.length-1];if(this.defaultActions[v])z=this.defaultActions[v];else{if(null===u||"undefined"==typeof u)u=m.lex()||1,"number"!==typeof u&&(u=this.symbols_[u]||u);z=e[v]&&e[v][u]}if("undefined"===typeof z||!z.length||!z[0]){var V;S=[];for(X in e[v])this.terminals_[X]&&2<X&&S.push("'"+
this.terminals_[X]+"'");V=m.showPosition?"Parse error on line "+(f+1)+":\n"+m.showPosition()+"\nExpecting "+S.join(", ")+", got '"+(this.terminals_[u]||u)+"'":"Parse error on line "+(f+1)+": Unexpected "+(1==u?"end of input":"'"+(this.terminals_[u]||u)+"'");this.parseError(V,{text:m.match,token:this.terminals_[u]||u,line:m.yylineno,loc:q,expected:S})}if(z[0]instanceof Array&&1<z.length)throw Error("Parse Error: multiple actions possible at state: "+v+", token: "+u);switch(z[0]){case 1:a.push(u);c.push(m.yytext);
d.push(m.yylloc);a.push(z[1]);u=null;B?(u=B,B=null):(h=m.yyleng,g=m.yytext,f=m.yylineno,q=m.yylloc,0<l&&l--);break;case 2:S=this.productions_[z[1]][1];T.$=c[c.length-S];T._$={first_line:d[d.length-(S||1)].first_line,last_line:d[d.length-1].last_line,first_column:d[d.length-(S||1)].first_column,last_column:d[d.length-1].last_column};w&&(T._$.range=[d[d.length-(S||1)].range[0],d[d.length-1].range[1]]);v=this.performAction.apply(T,[g,h,f,p,z[1],c,d].concat(n));if("undefined"!==typeof v)return v;S&&(a=
a.slice(0,-2*S),c=c.slice(0,-1*S),d=d.slice(0,-1*S));a.push(this.productions_[z[1]][0]);c.push(T.$);d.push(T._$);z=e[a[a.length-2]][a[a.length-1]];a.push(z);break;case 3:return!0}}},checkStrict:function(b,a,c){var d=c+"\n"+"-".repeat(a.first_column)+"^",e=["'LPAREN'","'VARIABLE'","'TRUE'","'FALSE'"],d="Parse error on line "+a.first_line+":\n"+d+"\nExpecting "+e.join(", ")+" got '"+c[a.first_column]+"'";this.yy.strictMode&&!b.checkParens()&&this.parseError(d,{text:c,token:b.operator,line:a.first_line,
loc:a,expected:e})}},g=function(){return{EOF:1,parseError:function(b,a){if(this.yy.parser)this.yy.parser.parseError(b,a);else throw Error(b);},setInput:function(b,a){this.yy=a||this.yy||{};this._input=b;this._more=this._backtrack=this.done=!1;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};this.options.ranges&&(this.yylloc.range=[0,0]);this.offset=0;return this},input:function(){var b=
this._input[0];this.yytext+=b;this.yyleng++;this.offset++;this.match+=b;this.matched+=b;b.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++;this.options.ranges&&this.yylloc.range[1]++;this._input=this._input.slice(1);return b},unput:function(b){var a=b.length,c=b.split(/(?:\r\n?|\n)/g);this._input=b+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-a);this.offset-=a;b=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-
1);this.matched=this.matched.substr(0,this.matched.length-1);c.length-1&&(this.yylineno-=c.length-1);var d=this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:c?(c.length===b.length?this.yylloc.first_column:0)+b[b.length-c.length].length-c[0].length:this.yylloc.first_column-a};this.options.ranges&&(this.yylloc.range=[d[0],d[0]+this.yyleng-a]);this.yyleng=this.yytext.length;return this},more:function(){this._more=
!0;return this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(b){this.unput(this.match.slice(b))},pastInput:function(){var b=this.matched.substr(0,this.matched.length-this.match.length);return(20<
b.length?"...":"")+b.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var b=this.match;20>b.length&&(b+=this._input.substr(0,20-b.length));return(b.substr(0,20)+(20<b.length?"...":"")).replace(/\n/g,"")},showPosition:function(){var b=this.pastInput(),a=Array(b.length+1).join("-");return b+this.upcomingInput()+"\n"+a+"^"},test_match:function(b,a){var c,d;this.options.backtrack_lexer&&(d={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,
last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(d.yylloc.range=this.yylloc.range.slice(0)));if(c=b[0].match(/(?:\r\n?|\n).*/g))this.yylineno+=c.length;this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:c?
c[c.length-1].length-c[c.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+b[0].length};this.yytext+=b[0];this.match+=b[0];this.matches=b;this.yyleng=this.yytext.length;this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]);this._backtrack=this._more=!1;this._input=this._input.slice(b[0].length);this.matched+=b[0];b=this.performAction.call(this,this.yy,this,a,this.conditionStack[this.conditionStack.length-1]);this.done&&this._input&&(this.done=!1);if(b)return b;
if(this._backtrack)for(var e in d)this[e]=d[e];return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var b,a,c;this._more||(this.match=this.yytext="");for(var d=this._currentRules(),e=0;e<d.length;e++)if((a=this._input.match(this.rules[d[e]]))&&(!b||a[0].length>b[0].length))if(b=a,c=e,this.options.backtrack_lexer){b=this.test_match(a,d[e]);if(!1!==b)return b;if(this._backtrack)b=!1;else return!1}else if(!this.options.flex)break;return b?(b=this.test_match(b,d[c]),!1!==
b?b:!1):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var b=this.next();return b?b:this.lex()},begin:function(b){this.conditionStack.push(b)},popState:function(){return 0<this.conditionStack.length-1?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?
this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(b){b=this.conditionStack.length-1-Math.abs(b||0);return 0<=b?this.conditionStack[b]:"INITIAL"},pushState:function(b){this.begin(b)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(b,a,c,d){switch(c){case 1:return 15;case 2:return 16;case 3:return 12;case 4:return 12;case 5:return 12;case 6:return 12;case 7:return 12;case 8:return 12;
case 9:return 12;case 10:return 10;case 11:return 10;case 12:return 10;case 13:return 10;case 14:return 10;case 15:return 10;case 16:return 11;case 17:return 11;case 18:return 11;case 19:return 11;case 20:return 11;case 21:return 8;case 22:return 8;case 23:return 8;case 24:return 8;case 25:return 8;case 26:return 8;case 27:return 8;case 28:return 8;case 29:return 8;case 30:return 8;case 31:return 8;case 32:return 6;case 33:return 6;case 34:return 6;case 35:return 6;case 36:return 6;case 37:return 6;
case 38:return 9;case 39:return 9;case 40:return 9;case 41:return 9;case 42:return 9;case 43:return 9;case 44:return 9;case 45:return 9;case 46:return 9;case 47:return 9;case 48:return 9;case 49:return 7;case 50:return 7;case 51:return 7;case 52:return 7;case 53:return 7;case 54:return 13;case 55:return 13;case 56:return 13;case 57:return 13;case 58:return 18;case 59:return 18;case 60:return 18;case 61:return 18;case 62:return 19;case 63:return 19;case 64:return 19;case 65:return 19;case 66:return 17;
case 67:return 5}},rules:[/^(?:\s+)/,/^(?:\()/,/^(?:\))/,/^(?:=)/,/^(?:<=>)/,/^(?:<->)/,/^(?:\u21d4)/,/^(?:\u2194)/,/^(?:\u2261)/,/^(?:\u2299)/,/^(?:\u2260)/,/^(?:\u2262)/,/^(?:\u22bb)/,/^(?:\u2295)/,/^(?:\^)/,/^(?:<~>)/,/^(?:=>)/,/^(?:->)/,/^(?:\u21d2)/,/^(?:\u2192)/,/^(?:\u2283)/,/^(?:\u2191)/,/^(?:\u22bc)/,/^(?:~\/\\)/,/^(?:~&&)/,/^(?:~&)/,/^(?:!\/\\)/,/^(?:!&&)/,/^(?:!&)/,/^(?:-\/\\)/,/^(?:-&&)/,/^(?:-&)/,/^(?:&&)/,/^(?:&)/,/^(?:\u2227)/,/^(?:\/\\)/,/^(?:\*)/,/^(?:\.)/,/^(?:\u2193)/,/^(?:\u22bd)/,
/^(?:~\\\/)/,/^(?:~\|\|)/,/^(?:~\|)/,/^(?:!\\\/)/,/^(?:!\|\|)/,/^(?:!\|)/,/^(?:-\\\/)/,/^(?:-\|\|)/,/^(?:-\|)/,/^(?:\|\|)/,/^(?:\|)/,/^(?:\u2228)/,/^(?:\\\/)/,/^(?:\+)/,/^(?:~)/,/^(?:\u00ac)/,/^(?:!)/,/^(?:-)/,/^(?:([Tt][Rr][Uu][Ee]))/,/^(?:T\b)/,/^(?:\u22a4)/,/^(?:1\b)/,/^(?:([Ff][Aa][Ll][Ss][Ee]))/,/^(?:F\b)/,/^(?:\u22a5)/,/^(?:0\b)/,/^(?:([A-Za-z][0-9]*))/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,
37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67],inclusive:!0}}}}();f.lexer=g;a.prototype=f;f.Parser=a;return new a}();var CTATLogicFlattenNode={};
(function(){var a,f=function(a,c){function b(){this.constructor=a}for(var d in c)g.call(c,d)&&(a[d]=c[d]);b.prototype=c.prototype;a.prototype=new b;a.__super__=c.prototype;return a},g={}.hasOwnProperty;a=function(a){function c(b,a,e,g){this.operator=b;this.terms=a;this.string=null!=e?e:null;this.negated=null!=g?g:!1;c.__super__.constructor.apply(this,arguments)}f(c,a);c.prototype.addOperand=function(b,a,e){null==e&&(e=null);if(b!==this.operator||this.parens)return c.__super__.addOperand.apply(this,arguments);
this.terms.push(a);return this};c.prototype.clone=function(b){null==b&&(b=!0);return new c(this.operator,b?this.terms.map(function(b){return b.clone()}):this.terms,this.string,this.negated)};c.prototype.toString=function(b,a,e){null==b&&(b=!1);null==a&&(a=null);null==e&&(e=!1);return c.__super__.toString.call(this,this.terms.reduce(function(a){return function(c,d){return""+c+(c?""+a.operatorString():"")+d.toString(b,a,!0)}}(this),""),b,a,e)};c.prototype.evaluate=function(b){null==b&&(b=null);return c.__super__.evaluate.call(this,
this.terms.reduce(function(a){return function(c,d){return a.applyOperator(a.operator,c,d.evaluate(b))}}(this),this.conjunctionOp()))};c.prototype.equals=function(b,a){return c.__super__.equals.call(this,b,a)&&this.terms.length===b.terms.length&&this.terms.every(function(a,c){return a.equals(b.terms[c],!1)})};c.prototype.subEquals=function(b,a){return this.operator===b.operator&&!b.negated&&this.terms.length>=b.terms.length&&b.terms.every(function(b){return function(c,d){return c.equals(b.terms[a+
d],!1)}}(this))};c.prototype.subNode=function(b,a){return null!=b?Object.assign(this.clone(!1),{terms:this.terms.slice(b,a)}):this};c.prototype.countOperands=function(){return this.terms.length};c.prototype.getOperators=function(b){null==b&&(b=!1);return this.terms.slice(1).reduce(function(a){return function(c,d,e){return c.concat(a.getOperator(b),d.getOperators(b))}}(this),this.terms[0].getOperators(b))};c.prototype.getVariables=function(){return this.terms.slice(1).reduce(function(b){return function(b,
a,c){return b.concat(a.getVariables())}}(this),this.terms[0].getVariables())};c.prototype.getOperands=function(){return this.terms.slice(0)};c.prototype.findOperator=function(b,a,e){null==e&&(e="none");return this.terms.slice(1).reduce(function(d){return function(g,f,h){return g.concat(c.__super__.findOperator.call(d,b,a,h,e),f.findOperator(b,a.concat([h+1]),e))}}(this),this.terms[0].findOperator(b,a.concat([0]),e))};c.prototype.findExpression=function(b,a){return this.terms.slice(1).reduce(function(d){return function(e,
g,f){return e.concat(c.__super__.findExpression.call(d,b,a,f),g.findExpression(b,a.concat([f+1])))}}(this),this.terms[0].findExpression(b,a.concat([0])))};c.prototype.findRule=function(b,a,e){null==e&&(e=!1);return this.terms.slice(1).reduce(function(d){return function(g,f,h){return g.concat(c.__super__.findRule.call(d,b,a,e,h),f.findRule(b,a.concat([h+1]),e))}}(this),this.terms[0].findRule(b,a.concat([0]),e))};c.prototype.removeNull=function(){this.terms=this.terms.map(function(b){return null!=b?
b.removeNull():void 0}).filter(function(b){return b});return 1<this.terms.length?this:this.terms[0]||null};c.prototype.applyRules=function(b,a,e){this.rules=b;null==a&&(a=!1);null==e&&(e=!1);e&&(this.terms=this.terms.map(function(b){return function(c){c=c.setSteps(b.steps).applyRules(b.rules,a,!0);b.setSteps(c.steps);return c}}(this)));return c.__super__.applyRules.apply(this,arguments)};c.prototype.domination=function(b,a){var c;null==b&&(b=!1);null==a&&(a=!1);return!b&&this.junctionOp()&&(c=this.terms.find(function(b){return function(a){return a.constant(b.disjunctionOp())}}(this)))?
a||c:!a&&this};c.prototype.negation=function(b,a){null==b&&(b=!1);null==a&&(a=!1);return!b&&this.junctionOp()&&this.terms.some(function(b){return function(a,c){return b.terms.slice(c+1).some(function(b){return b.inverse(a)})}}(this))?a||new CTATLogicConstantNode(this.disjunctionOp()):!a&&this};c.prototype.identity=function(b,a){var d;null==b&&(b=!1);null==a&&(a=!1);return!b&&this.junctionOp()&&(d=this.terms.filter(function(b){return function(a){return a.constant(b.conjunctionOp())}}(this))).length?
a||this.junctionNode(CTATLogicTreeNode.difference(this.terms,d)):b&&this.junctionOp()?a||this.junctionNode(this.terms.push(new CTATLogicConstantNode(this.conjunctionOp()))):c.__super__.identity.apply(this,arguments)};c.prototype.idempotence=function(b,a){var d;null==b&&(b=!1);null==a&&(a=!1);return!b&&this.junctionOp()&&(d=this.terms.filter(function(b){return function(a,c){return b.terms.slice(c+1).some(function(b){return b.equals(a)})}}(this))).length?a||this.junctionNode(CTATLogicTreeNode.difference(this.terms,
d)):b&&this.junctionOp()?a||this.junctionNode(this.terms.concat(this.terms)):c.__super__.idempotence.apply(this,arguments)};c.prototype.absorption=function(b,a){var c;null==b&&(b=!1);null==a&&(a=!1);return!b&&this.junctionOp()&&(c=this.terms.reduce(function(b){return function(a,c){return a.concat(c.findPairs(b.inverseOperator(),b.terms,"equals"))}}(this),[])).length?a||this.junctionNode(CTATLogicTreeNode.replaceTerms(this.terms,c,!1)):!a&&this};c.prototype.inverseAbsorption=function(b,a){var c;null==
b&&(b=!1);null==a&&(a=!1);return!b&&this.junctionOp()&&(c=this.terms.reduce(function(b){return function(a,c){return a.concat(c.findPairs(b.inverseOperator(),b.terms,"inverse"))}}(this),[])).length?a||this.junctionNode(CTATLogicTreeNode.replaceTerms(this.terms,c,!0)):!a&&this};c.prototype.junctionNode=function(b){return 1===b.length?b[0]:Object.assign(this.clone(),{terms:b})};c.prototype.commutativity=function(b,a){null==a&&(a=!1);return this.junctionOp()?a||new c(this.operator,this.terms.slice(0).reverse()):
!a&&this};c.prototype.associativity=function(b,a){null==b&&(b=!1);null==a&&(a=!1);return this.junctionOp()&&this.terms.some(function(b){return function(a){return a.operator===b.operator}}(this))?a||this.clone().flatten():!a&&this};c.prototype.distributivity=function(b,a){var d,e,g,f,m,q;null==b&&(b=!1);null==a&&(a=!1);return!b&&this.junctionOp()&&-1!==(e=this.terms.findIndex(function(b){return function(a){return a.junctionOp()&&a.operator!==b.operator}}(this)))?(b=this.terms[e],q=CTATLogicTreeNode.removeIndex(this.terms,
e),a||new c(b.operator,b.terms.map(function(b){return function(a){return new c(b.operator,q.concat([a]))}}(this)))):b&&this.junctionOp()&&this.terms.every(function(b){return function(a){return a.junctionOp()&&a.operator!==b.operator}}(this))&&(m=this.terms.map(function(b){return b.terms}))&&(f=CTATLogicTreeNode.commonLength(m))&&(g=CTATLogicTreeNode.intersection(m))&&g.length===f-1?a||(d=m.map(function(b){return function(b){return CTATLogicTreeNode.difference(b,g)[0]}}(this)),new c(this.terms[0].operator,
g.concat([new c(this.operator,d)]))):!a&&this};c.prototype.deMorgan=function(b,a){null==b&&(b=!1);null==a&&(a=!1);return b&&this.junctionOp()&&this.terms.every(function(b){return b.negationOp()})?this.reverseNode(!0).negateNode():!a&&this};c.prototype.reverseNode=function(b){null==b&&(b=!1);return new c(this.inverseOperator(),this.terms.map(function(a){return b?a.unnegateNode():a.negateNode()}))};c.prototype.implication=function(b,a){var d,e;null==b&&(b=!1);null==a&&(a=!1);return b&&this.disjunctionOp()&&
this.terms.some(function(b){return b.negationOp()})&&this.terms.some(function(b){return!b.negationOp()})?a||(d=this.terms.filter(function(b){return b.negationOp()}).map(function(b){return b.unnegateNode()}),e=this.terms.filter(function(b){return!b.negationOp()}),new CTATLogicRelationNode("IF",1<d.length?new c("AND",d):d[0],1<e.length?new c("OR",e):e[0])):!a&&this};c.prototype.biimplication=function(b,a){null==b&&(b=!1);null==a&&(a=!1);return b&&this.disjunctionOp()&&2===this.terms.length&&this.terms.every(function(b){return b.conjunctionOp()})&&
this.terms[0].terms.every(function(b){return function(a){return b.terms[1].terms.some(function(b){return b.inverse(a)})}}(this))&&CTATLogicTreeNode.sameNegation(this.terms[0].terms)&&CTATLogicTreeNode.sameNegation(this.terms[1].terms)?a||new CTATLogicRelationNode("IFF",this.terms[0].terms[0].unnegateNode(),this.terms[0].terms[1].unnegateNode()):!a&&this};c.prototype.biimplicationToImplication=function(b,a){null==b&&(b=!1);null==a&&(a=!1);return b&&this.conjunctionOp()&&2===this.terms.length&&this.terms.every(function(b){return b.implicationOp()})&&
this.terms[0].left.equals(this.terms[1].right)&&this.terms[0].right.equals(this.terms[1].left)?a||new CTATLogicRelationNode("IFF",this.terms[0].left,this.terms[0].right):!a&&this};c.prototype.exclusiveDisjunction=function(b,a){null==b&&(b=!1);null==a&&(a=!1);return b&&this.disjunctionOp()&&2===this.terms.length&&this.terms.every(function(b){return b.conjunctionOp()})&&this.terms[0].terms.every(function(b){return function(a){return b.terms[1].terms.some(function(b){return b.inverse(a)})}}(this))&&
CTATLogicTreeNode.oppositeNegation(this.terms[0].terms)&&CTATLogicTreeNode.oppositeNegation(this.terms[1].terms)?a||new CTATLogicRelationNode("XOR",this.terms[0].terms[0].unnegateNode(),this.terms[0].terms[1].unnegateNode()):!a&&this};c.prototype.exclusiveDisjunctionToImplication=function(b,a){null==b&&(b=!1);null==a&&(a=!1);return b&&this.conjunctionOp()&&2===this.terms.length&&this.terms.every(function(b){return b.implicationOp()})&&this.terms[0].left.equals(this.terms[1].right)&&this.terms[0].right.equals(this.terms[1].left)?
a||new CTATLogicRelationNode("XOR",this.terms[0].left.unnegateNode(),this.terms[0].right.unnegateNode()):!a&&this};c.prototype.normalFormOperators=function(){return c.__super__.normalFormOperators.apply(this,arguments)&&this.terms.every(function(b){return b.normalFormOperators()})};c.prototype.atomicNegation=function(){return!this.negated&&this.terms.every(function(b){return b.atomicNegation()})};c.prototype.atomicConjunction=function(){return this.conjunctionOp()&&this.terms.every(function(b){return b.atomic()})||
!this.conjunctionOp()&&this.terms.every(function(b){return b.atomicConjunction()})};c.prototype.atomicDisjunction=function(){return this.disjunctionOp()&&this.terms.every(function(b){return b.atomic()})||!this.disjunctionOp()&&this.terms.every(function(b){return b.atomicDisjunction()})};c.prototype.pushNegation=function(){this.negated&&(this.negate(),this.invertOperator(),this.terms.forEach(function(b){return function(a){a.setSteps(b.steps).negate().pushNegation();return b.setSteps(a.steps)}}(this)),
this.setSteps(this.steps+1));return this};c.prototype.flatten=function(){this.terms=this.terms.reduce(function(b){return function(a,c){c.operator!==b.operator?a.push(c):a.push.apply(a,c.terms);return a}}(this),[]);return this};c.prototype.distributeDisjunction=function(){var b,a;return this.disjunctionOp()&&this.conjunctiveTerms()?(b=CTATLogicTreeNode.diff(this.rules,["replaceNodes","pushNegation"]),(a=this.terms.pop()).setSteps(this.steps).terms=a.terms.map(function(c){return function(d){var e;e=
c.clone();e.terms.push(d);e=e.setSteps(a.steps).applyRules(b);a.setSteps(e.steps);return e}}(this)),a.setSteps(a.steps+1).applyRules(["flatten","sort","distributeDisjunction"])):this};c.prototype.conjunctiveTerms=function(){return this.terms.some(function(b){return b.conjunctionOp()})};c.prototype.distributeConjunction=function(){var b,a;return this.conjunctionOp()&&this.disjunctiveTerms()?(b=CTATLogicTreeNode.diff(this.rules,["replaceNodes","pushNegation"]),(a=this.terms.pop()).setSteps(this.steps).terms=
a.terms.map(function(c){return function(d){var e;e=c.clone();e.terms.push(d);e=e.setSteps(a.steps).applyRules(b);a.setSteps(e.steps);return e}}(this)),a.setSteps(a.steps+1).applyRules(["flatten","sort","distributeConjunction"])):this};c.prototype.disjunctiveTerms=function(){return this.terms.some(function(b){return b.disjunctionOp()})};c.prototype.absorb=function(){this.terms=this.terms.reduce(function(b){return function(a,c){var d,e,g,f;a instanceof Array&&(b.disjunctionOp()&&c.constant(!0)||b.conjunctionOp()&&
c.constant(!1)?a=c.setSteps(b.steps+1):c.constant()&&0===a.length?a.push(c):null!=(e=a[a.length-1])&&e.equals(c,!1)?b.setSteps(b.steps+1):null!=(g=a[a.length-1])&&g.equals(c,!0)?a=(new CTATLogicConstantNode(b.disjunctionOp(),CTATLogicTreeNode.operatorStrings[b.disjunctionOp()])).setSteps(b.steps+1):c.junctionOp()&&a.find(function(b){return c.subterm(b,!1)})?b.setSteps(b.steps+1):c.junctionOp()&&(d=a.find(function(b){return c.subterm(b,!0)}))?(b.setSteps(b.steps+1),a.push(c.removeInverse(d))):(null!=
(f=a[0])&&f.constant()&&(a.pop(),b.setSteps(b.steps+1)),a.push(c)));return a}}(this),[]);return this.terms instanceof Array?this.prune():this.terms};c.prototype.subterm=function(b,a){return this.terms.some(function(c){return b.equals(c,a)})};c.prototype.removeInverse=function(b){this.terms=this.terms.filter(function(a){return!b.equals(a,!0)});return this.prune()};c.prototype.prune=function(){return 1===this.terms.length?this.terms[0].setSteps(this.steps):this};c.prototype.sort=function(){this.terms=
this.terms.sort(function(b,a){return b.compare(a)});return this};c.prototype.compare=function(b){var a;return(a=c.__super__.compare.apply(this,arguments))||this.terms.some(function(c,d){return a=c.compare(b.terms[d])})&&a||this.compareNegations(b)};c.prototype.countVariables=function(){return this.terms.reduce(function(b,a){return b+a.countVariables()},0)};c.prototype.countLevels=function(){return 1+this.terms.reduce(function(b,a){return Math.max(b,a.countLevels())},0)};return c}(CTATLogicTreeNode);
"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATLogicFlattenNode=a}).call(this);var CTATLogicParser={};
(function(){var a,f=[].slice;a=function(){function a(a){this.parser=new CTATLogicGrammar.Parser;this.parser.yy={CTATLogicRelationNode:CTATLogicRelationNode,CTATLogicFlattenNode:CTATLogicFlattenNode,CTATLogicVariableNode:CTATLogicVariableNode,CTATLogicConstantNode:CTATLogicConstantNode,CTATLogicTreeNode:CTATLogicTreeNode};this.parser.yy.variableTable=a}a.SORTRule=["sort"];a.NNFRules="replaceNodes pushNegation flatten sort absorb sort".split(" ");a.CNFRules="replaceNodes pushNegation flatten sort distributeDisjunction absorb sort".split(" ");a.DNFRules=
"replaceNodes pushNegation flatten sort distributeConjunction absorb sort".split(" ");a.NNFTests=["normalFormOperators","atomicNegation"];a.CNFTests=["normalFormOperators","atomicNegation","atomicDisjunction"];a.DNFTests=["normalFormOperators","atomicNegation","atomicConjunction"];a.prototype.getTree=function(a,c,b){null==c&&(c=!1);null==b&&(b=!1);a=a instanceof CTATLogicTreeNode?c?a.clone():a:this.parser.parse(a);b&&null!=a&&a.setSteps(0);return a};a.prototype.getExpression=function(a,c,b){null==
b&&(b=!1);return a instanceof CTATLogicTreeNode?c:"string"===typeof c?c:null!=c?c.toString(b):c};a.prototype.equalExpressions=function(a,c){return a instanceof CTATLogicTreeNode&&c instanceof CTATLogicTreeNode?a.toString()===c.toString():a===c};a.prototype.logicSetMode=function(a){Object.assign(this.parser.yy,a);return a};a.prototype.logicParse=function(a){try{return this.getTree(a)}catch(c){return null}};a.prototype.logicGetError=function(a){try{return a instanceof CTATLogicTreeNode||this.parser.parse(String(a)),
null}catch(c){return c}};a.prototype.logicStringify=function(a){return this.getExpression("",a,this.parser.yy.strictMode)};a.prototype.logicEvaluate=function(a,c){null==c&&(c=null);try{return this.getTree(a).evaluate(c)}catch(b){return null}};a.prototype.logicSort=function(e){return this.getExpression(e,function(){try{return this.getTree(e,!0).applyRules(a.SORTRule,!1,!0)}catch(c){return null}}.call(this))};a.prototype.logicGetOperator=function(a,c){null==c&&(c=!1);try{return this.getTree(a).getOperator(c)}catch(b){return null}};
a.prototype.logicGetOperators=function(a,c){null==c&&(c=!1);try{return this.getTree(a).getOperators(c)}catch(b){return null}};a.prototype.logicGetVariables=function(a){try{return this.getTree(a).getVariables()}catch(c){return null}};a.prototype.logicGetOperands=function(a){try{return this.getTree(a).getOperands().map(function(c){return function(b){return c.getExpression(a,b)}}(this))}catch(c){return null}};a.prototype.logicGetExpression=function(a,c,b){return this.getExpression(a,function(){try{return this.getTree(a).getExpression(c,
b)}catch(d){return null}}.call(this))};a.prototype.logicFindOperator=function(a,c,b){null==b&&(b="none");try{return this.getTree(a).findOperator(c,[],b).map(function(b){return function(c){return b.getExpression(a,c)}}(this))}catch(d){return null}};a.prototype.logicFindExpression=function(a,c){try{return this.getTree(a).findExpression(this.getTree(c),[]).map(function(b){return function(c){return b.getExpression(a,c)}}(this))}catch(b){return null}};a.prototype.logicFindRule=function(a,c,b){null==b&&
(b=!1);try{return this.getTree(a).findRule(c,[],b).map(function(b){return function(c){return b.getExpression(a,c)}}(this))}catch(d){return null}};a.prototype.logicApplyRules=function(a,c,b,d){null==b&&(b=!1);null==d&&(d=!1);return this.getExpression(a,function(){try{return this.getTree(a,d).applyRules(c,b,d)}catch(h){return null}}.call(this))};a.prototype.logicCreateExpression=function(){var a,c,b;b=arguments[0];a=arguments[1];c=3<=arguments.length?f.call(arguments,2):[];return this.getExpression(a,
function(){var d;try{return(d=this.getTree(a)).createExpression.apply(d,[b].concat(f.call(c.map(function(b){return function(a){return b.getTree(a)}}(this)))))}catch(h){return null}}.call(this))};a.prototype.logicReplaceExpression=function(a,c,b,d){var e;null==d&&(d=null);d=(null!=d?d:null!=(e=c.path)?e.slice(0):void 0)||0;return this.getExpression(a,function(){try{return this.getTree(a).replaceExpression(this.getTree(c),this.getTree(b),d)}catch(n){return null}}.call(this))};a.prototype.logicDeleteExpression=
function(a,c,b){var d;null==b&&(b=null);b=(null!=b?b:null!=(d=c.path)?d.slice(0):void 0)||0;return this.getExpression(a,function(){try{return this.getTree(a).deleteExpression(this.getTree(c),b)}catch(h){return null}}.call(this))};a.prototype.logicSimplifyNNF=function(e,c){null==c&&(c=!1);return this.getExpression(e,function(){try{return this.getTree(e,!0,c).applyRules(a.NNFRules,!1,!0)}catch(b){return null}}.call(this))};a.prototype.logicSimplifyCNF=function(e,c){null==c&&(c=!1);return this.getExpression(e,
function(){try{return this.getTree(e,!0,c).applyRules(a.CNFRules,!1,!0)}catch(b){return null}}.call(this))};a.prototype.logicSimplifyDNF=function(e,c){null==c&&(c=!1);return this.getExpression(e,function(){try{return this.getTree(e,!0,c).applyRules(a.DNFRules,!1,!0)}catch(b){return null}}.call(this))};a.prototype.logicValid=function(a){return null!=this.logicParse(a)};a.prototype.logicValued=function(a,c){null==c&&(c=null);return null!=this.logicEvaluate(a,c)};a.prototype.logicSorted=function(a){var c,
b;return null!=(c=this.logicSort(a))&&null!=(b=this.getExpression(a,this.getTree(a)))?this.equalExpressions(c,b):null};a.prototype.logicCheckNNF=function(e){try{return this.getTree(e).applyTests(a.NNFTests)}catch(c){return null}};a.prototype.logicCheckCNF=function(e){try{return this.getTree(e).applyTests(a.CNFTests)}catch(c){return null}};a.prototype.logicCheckDNF=function(e){try{return this.getTree(e).applyTests(a.DNFTests)}catch(c){return null}};a.prototype.logicSimplifiedNNF=function(a){var c,
b;return null!=(c=this.logicSimplifyNNF(a))&&null!=(b=this.logicSort(a))?this.equalExpressions(c,b):null};a.prototype.logicSimplifiedCNF=function(a){var c,b;return null!=(c=this.logicSimplifyCNF(a))&&null!=(b=this.logicSort(a))?this.equalExpressions(c,b):null};a.prototype.logicSimplifiedDNF=function(a){var c,b;return null!=(c=this.logicSimplifyDNF(a))&&null!=(b=this.logicSort(a))?this.equalExpressions(c,b):null};a.prototype.logicIdentical=function(a,c){return null!=(a=this.logicSort(a))&&null!=(c=
this.logicSort(c))?this.equalExpressions(a,c):null};a.prototype.logicEqual=function(a,c,b){null==b&&(b=null);a=this.logicEvaluate(a,b);c=this.logicEvaluate(c,b);if(null!=a&&null!=c)return a===c;if(null===a||null===c)return null};a.prototype.logicEquivalent=function(a,c){return null!=(a=this.logicSimplifyDNF(a))&&null!=(c=this.logicSimplifyDNF(c))?this.equalExpressions(a,c):null};a.prototype.logicSemanticEquivalent=function(a,c){try{return!this.getTree(a).findCounterExample(this.getTree(c))}catch(b){return null}};
a.prototype.logicFindCounterExample=function(a,c){try{return this.getTree(a).findCounterExample(this.getTree(c))}catch(b){return null}};return a}();"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATLogicParser=a}).call(this);var CTATChemTreeNode={};
(function(){var a;a=function(){function a(){}a.operators=[["CONST"],["VAR"],["EXP","ROOT"],["UPLUS","UMINUS"],["ITIMES","TIMES","DIVIDE"],["IDIVIDE","REM"],["PLUS","MINUS"],"LESS LESSEQUAL EQUAL NOTEQUAL GREATEREQUAL GREATER".split(" ")];a.relationalOperators="LESS LESSEQUAL EQUAL NOTEQUAL GREATEREQUAL GREATER".split(" ");a.operatorPrecedence=function(a,e){return Math.sign(this.operators.findIndex(function(c){return c.includes(a)})-this.operators.findIndex(function(a){return a.includes(e)}))};a.operatorStrings=
{EXP:"^",ROOT:"|",UPLUS:"+",UMINUS:"-",ITIMES:"",TIMES:"*",DIVIDE:"/",IDIVIDE:"//",REM:"%",PLUS:"+",MINUS:"-",LESS:"<",LESSEQUAL:"<=",EQUAL:"=",NOTEQUAL:"!=",GREATEREQUAL:">=",GREATER:">"};a.toOperatorString=function(a){return this.operatorStrings[a]||""};a.diff=function(a,e){return a.filter(function(a){return!e.includes(a)})};a.round=function(a,e){"number"!==typeof a&&(a=parseFloat(a));e="number"===typeof e&&0===e%1?e:CTATChemParser.CHEM_DECIMAL_PRECISION;-1<e&&(e=Math.pow(10,e),a=Math.round(a*e)/
e);return a};a.prototype.toString=function(a,e,c){var b;null==e&&(e="");null==c&&(c=!1);c&&(a=e+a+e);this.checkParens()&&(a="("+a+")");this.inverted()&&(a="1/"+a);this.negated()&&(a="-"+a);e=0;for(b=this.parens;0<=b?e<b:e>b;0<=b?++e:--e)a="("+a+")";this.units&&(a+=this.units.toString(c));return a};a.prototype.setParens=function(a,e){null==e&&(e=!1);this.checkParens(a,e)&&(this.parens=1);return this};a.prototype.checkParens=function(g,e){var c;null==e&&(e=!1);null!=g?c=this.negated()?"UMINUS":this.inverted()?
"DIVIDE":this.operator:(g=this.negated()?"MINUS":this.inverted()?"DIVIDE":null,c=this.operator);c=a.operatorPrecedence(g,c);return null!=g&&(0>c||0===c&&e)};a.prototype.evaluate=function(a){return this.sign*Math.pow(a,this.exp)};a.prototype.applyOperator=function(g,e){var c;switch(this.operator){case "LESS":c=g<e;break;case "GREATER":c=g>e;break;case "LESSEQUAL":c=g<=e;break;case "GREATEREQUAL":c=g>=e;break;case "EQUAL":c=g===e;break;case "NOTEQUAL":c=g!==e;break;case "PLUS":c=a.round(g+e);break;
case "MINUS":c=a.round(g-e);break;case "TIMES":case "ITIMES":c=a.round(g*e);break;case "DIVIDE":c=a.round(g/e);break;case "EXP":c=a.round(Math.pow(g,e));break;case "ROOT":c=a.round(Math.pow(g,1)/e);break;case "REM":c=g%e;break;case "IDIVIDE":c=Math.floor(g/e);break;case "UPLUS":c=g;break;case "UMINUS":c=-g;break;case "LOG":c=Math.log10(g);break;case "LN":c=Math.log(g)}return c};a.prototype.equals=function(a){return a&&this.operator===a.operator&&this.sign===a.sign&&this.exp===a.exp&&this.parens===
a.parens};a.prototype.simplify=function(a){this.methods=a;return this.simplifyNode(this.methods)};a.prototype.simplifyNode=function(a){var e,c,b,d;this.methods=a;d=this;b=this.methods;a=0;for(e=b.length;a<e;a++)c=b[a],d=d[c].call(d),d.methods=this.methods;delete d.methods;return d};a.prototype.simpleFlatten=function(){return this};a.prototype.flatten=function(){return this};a.prototype.computeConstants=function(){return this};a.prototype.combineSimilar=function(){return this};a.prototype.expand=function(){return this};
a.prototype.distribute=function(){return this};a.prototype.removeIdentity=function(){return this};a.prototype.sort=function(){return this};a.prototype.spreadIdentity=function(){return this};a.prototype.stripIdentity=function(){return this};a.prototype.multiplyOne=function(a){null==a&&(a=!1);return(new CTATChemMultiplicationNode("TIMES",[new CTATChemConstantNode(1,a),this])).popNegation().pushNegation()};a.prototype.powerOne=function(a){null==a&&(a=!1);return(new CTATChemPowerNode("EXP",this,new CTATChemConstantNode(1,
a))).popInversion().pushInversion().popNegation()};a.prototype.compare=function(g,e){return a.operatorPrecedence(this.operator,g.operator)};a.prototype.compareSigns=function(a,e){return(Math.sign(this.sign-a.sign)||Math.sign(this.exp-a.exp))*e};a.prototype.countVariables=function(){return 0};a.prototype.pushNegation=function(){return this};a.prototype.popNegation=function(){return this};a.prototype.pushInversion=function(){return this};a.prototype.popInversion=function(){return this};a.prototype.negate=
function(){this.sign=-this.sign;return this};a.prototype.invert=function(){this.exp=-this.exp;return this};a.prototype.addition=function(){return"PLUS"===this.operator};a.prototype.subtraction=function(){return"MINUS"===this.operator};a.prototype.multiplication=function(){return"TIMES"===this.operator};a.prototype.division=function(){return"DIVIDE"===this.operator};a.prototype.intDivision=function(){return"IDIVIDE"===this.operator};a.prototype.power=function(){return"EXP"===this.operator};a.prototype.root=
function(){return"ROOT"===this.operator};a.prototype.negation=function(){return"UMINUS"===this.operator};a.prototype.unary=function(){var a;return"UPLUS"===(a=this.operator)||"UMINUS"===a};a.prototype.log=function(){var a;return"LOG"===(a=this.operator)||"LN"===a};a.prototype.constant=function(a){return!1};a.prototype.integer=function(){return!1};a.prototype.negated=function(){return 0>this.sign};a.prototype.inverted=function(){return 0>this.exp};a.prototype.parented=function(){return 0<this.parens};
a.prototype.even=function(){return!1};a.prototype.setUnit=function(a){this.units=a;return this};a.prototype.getVariables=function(){return[]};a.prototype.setVariable=function(){return this};return a}();"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATChemTreeNode=a}).call(this);var CTATChemRelationNode={};
(function(){var a,f=function(a,c){function b(){this.constructor=a}for(var d in c)g.call(c,d)&&(a[d]=c[d]);b.prototype=c.prototype;a.prototype=new b;a.__super__=c.prototype;return a},g={}.hasOwnProperty;a=function(a){function c(b,a,c,e,g,f){this.operator=b;this.left=a;this.right=c;this.parens=null!=e?e:0;this.sign=null!=g?g:1;this.exp=null!=f?f:1}f(c,a);c.prototype.clone=function(){return new c(this.operator,this.left.clone(),this.right.clone(),this.parens,this.sign,this.exp)};c.prototype.toString=
function(b){null==b&&(b=!1);this.left.setParens(this.operator);this.right.setParens(this.operator);return c.__super__.toString.call(this,""+this.left.toString(b)+CTATChemTreeNode.toOperatorString(this.operator)+this.right.toString(b))};c.prototype.evaluate=function(){return this.applyOperator(this.left.evaluate(),this.right.evaluate())};c.prototype.equals=function(b){return c.__super__.equals.call(this,b)&&this.left.equals(b.left)&&this.right.equals(b.right)};c.prototype.simplify=function(b){this.methods=
b;this.left=this.left.simplify(this.methods);this.right=this.right.simplify(this.methods);return c.__super__.simplify.apply(this,arguments)};c.prototype.computeConstants=function(){return this.left.constant()&&this.right.constant()?new CTATChemConstantNode(this.evaluate()):this};c.prototype.sort=function(){var b;switch(this.operator){case "GREATER":this.operator="LESS";b=[this.right,this.left];this.left=b[0];this.right=b[1];break;case "GREATEREQUAL":this.operator="LESSEQUAL";b=[this.right,this.left];
this.left=b[0];this.right=b[1];break;case "EQUAL":case "NOTEQUAL":0>this.left.compare(this.right)&&(b=[this.right,this.left],this.left=b[0],this.right=b[1])}return this};c.prototype.countVariables=function(){return this.left.countVariables()+this.right.countVariables()};c.prototype.getVariables=function(){return this.left.getVariables().concat(this.right.getVariables())};c.prototype.setVariable=function(b,a,c){return[this.left,this.right].forEach(function(d){return function(e,g){var f;return"VAR"===
e.operator&&e.variable===b?(f=c(),f.sign=e.sign,f.exp=e.exp,0===g?d.left=f:d.right=f):e.setVariable(b,a,c)}}(this))};return c}(CTATChemTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATChemRelationNode=a}).call(this);var CTATChemAdditionNode={};
(function(){var a,f=function(a,c){function b(){this.constructor=a}for(var d in c)g.call(c,d)&&(a[d]=c[d]);b.prototype=c.prototype;a.prototype=new b;a.__super__=c.prototype;return a},g={}.hasOwnProperty;a=function(a){function c(b,a,c,e,g){this.operator=b;this.terms=a;this.parens=null!=c?c:0;this.sign=null!=e?e:1;this.exp=null!=g?g:1}f(c,a);c.prototype.clone=function(){return new c(this.operator,this.terms.map(function(b){return b.clone()}),this.parens,this.sign,this.exp)};c.prototype.toString=function(b){null==
b&&(b=!1);return c.__super__.toString.call(this,this.terms.reduce(function(a){return function(c,d){d.setParens(a.operator);return""+c+(c&&!d.negated()?"+":"")+d.toString(b)}}(this),""))};c.prototype.evaluate=function(){return c.__super__.evaluate.call(this,this.terms.reduce(function(b){return function(a,c){return b.applyOperator(a,c.evaluate())}}(this),0))};c.prototype.equals=function(b){return c.__super__.equals.call(this,b)&&this.terms.length===b.terms.length&&this.terms.every(function(a,c){return a.equals(b.terms[c])})};
c.prototype.simplify=function(b){this.methods=b;this.terms=this.terms.map(function(b){return function(a){return a.simplify(b.methods)}}(this));return c.__super__.simplify.apply(this,arguments)};c.prototype.simpleFlatten=function(){this.terms[0].negation()&&!this.terms[0].inverted()&&(this.terms[0]=this.terms[0].base.negate());this.subtraction()&&(this.terms[1].negate(),this.operator="PLUS");this.terms=this.terms.reduce(function(b,a){a.inverted()||a.parented()||!a.addition()?b.push(a):b.push.apply(b,
a.pushNegation().terms);return b},[]);return this};c.prototype.flatten=function(){this.simpleFlatten();return this.pushNegation()};c.prototype.computeConstants=function(){var b,a;0<=(a=this.terms.findIndex(function(b){return b.constant()}))&&(b=this.terms[a].evaluate(),this.terms=this.terms.filter(function(c){return function(d,e){return e<=a||!d.constant()||(b=c.applyOperator(b,d.evaluate()))&&!1}}(this)),0===b&&1<this.terms.length?this.terms.splice(a,1):this.terms[a].set(b));return 1<this.terms.length?
this:this.pushInversion().terms[0]};c.prototype.combineSimilar=function(){var b;b=[];this.terms.forEach(function(a){var c,d;c=null;a.constant()?c=[null,a]:(a=a.multiplyOne(),c=[a,a.factors.shift()]);d=c[1].evaluate();if(a=b.find(function(b){var a;return null!=(a=b[0])?a.equals(c[0]):void 0}))return a[1]+=d;a=[c[0],d];return b.push(a)});this.terms=b.reduce(function(b,a){0!==a[1]&&(a[1]=(new CTATChemConstantNode(a[1],!1,0,1,1,void 0)).popNegation(),a[0]?(a[0].factors.unshift(a[1]),b.push(a[0].removeIdentity())):
b.push(a[1]));return b},[]);if(1<this.terms.length)return this;1!==this.terms.length&&(this.terms[0]=new CTATChemConstantNode(0));return this.pushInversion().terms[0]};c.prototype.removeIdentity=function(b){var a;null==b&&(b=!1);a=this.terms.filter(function(a){return!a.constant(0,b)});this.terms=a.length?a:this.terms.slice(0,1);return 1<this.terms.length?this:this.pushInversion().terms[0]};c.prototype.sort=function(){this.spreadIdentity();this.terms=this.terms.sort(function(b,a){return-b.compare(a,
!0)});return this.stripIdentity()};c.prototype.spreadIdentity=function(){this.terms=this.terms.map(function(b){return b.multiplyOne(!0)});return this};c.prototype.stripIdentity=function(){this.terms=this.terms.map(function(b){return b.removeIdentity(!0)});return this};c.prototype.compare=function(b,a){var d;return(d=c.__super__.compare.apply(this,arguments))||this.countVariables()-b.countVariables()||this.terms.some(function(c,e){return d=c.compare(b.terms[e],a)})&&d||this.compareSigns(b,a)};c.prototype.countVariables=
function(){return this.terms.reduce(function(b,a){return b+a.countVariables()},0)};c.prototype.pushNegation=function(){this.negated()&&(this.negate(),this.terms.forEach(function(b){return b.negate()}));return this};c.prototype.popNegation=function(){this.terms[0].negated()&&(this.negate(),this.terms.forEach(function(b){return b.negate()}));return this};c.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.terms[0].invert());return this};c.prototype.even=function(){return!this.inverted&&
this.terms.every(function(b){return b.even()})};c.prototype.getVariables=function(){var b;b=[];this.terms.forEach(function(a){return function(a){return b=b.concat(a.getVariables())}}(this));return b};c.prototype.setVariable=function(b,a,c){var d,e,g;d=0;for(g=[];d<this.terms.length;)"VAR"===this.terms[d].operator&&this.terms[d].variable===b?(e=c(),e.sign=this.terms[d].sign,e.exp=this.terms[d].exp,this.terms[d]=e):this.terms[d].setVariable(b,a,c),g.push(d++);return g};return c}(CTATChemTreeNode);"undefined"!==
typeof module&&null!==module?module.exports=a:this.CTATChemAdditionNode=a}).call(this);var CTATChemMultiplicationNode={};
(function(){var a,f=function(a,c){function b(){this.constructor=a}for(var d in c)g.call(c,d)&&(a[d]=c[d]);b.prototype=c.prototype;a.prototype=new b;a.__super__=c.prototype;return a},g={}.hasOwnProperty;a=function(a){function c(b,a,c,e,g){this.operator=b;this.factors=a;this.parens=null!=c?c:0;this.sign=null!=e?e:1;this.exp=null!=g?g:1}f(c,a);c.prototype.clone=function(){return new c(this.operator,this.factors.map(function(b){return b.clone()}),this.parens,this.sign,this.exp)};c.prototype.toString=
function(b){null==b&&(b=!1);return c.__super__.toString.call(this,this.factors.reduce(function(a){return function(c,d){var e;d=d.inverted()?(d.invert(),d.setParens("DIVIDE",!!c),e=d.toString(b),d.invert(),"/"):(d.setParens(a.operator,!!c),/^[\d+-]/.test(e=d.toString(b))&&/\d$/.test(c)?"*":"");return""+c+(c?d:"")+e}}(this),this.factors[0].inverted()?"1":""))};c.prototype.evaluate=function(){return c.__super__.evaluate.call(this,this.factors.reduce(function(b){return function(a,c){return b.applyOperator(a,
c.evaluate())}}(this),1))};c.prototype.equals=function(b){return c.__super__.equals.call(this,b)&&this.factors.length===b.factors.length&&this.factors.every(function(a,c){return a.equals(b.factors[c])})};c.prototype.simplify=function(b){this.methods=b;this.factors=this.factors.map(function(b){return function(a){return a.simplify(b.methods)}}(this));return c.__super__.simplify.apply(this,arguments)};c.prototype.simpleFlatten=function(){this.division()&&this.factors[1].invert();this.operator="TIMES";
this.factors=this.factors.reduce(function(b,a){a.parented()||!a.multiplication()?b.push(a):b.push.apply(b,a.pushNegation().pushInversion().factors);return b},[]);return this};c.prototype.flatten=function(){this.simpleFlatten();return this.popNegation()};c.prototype.computeConstants=function(){var b,a;a=this.factors.findIndex(function(b){return b.constant()&&0<b.exp});a=0<=a?this.factors.splice(a,1)[0]:null;b=this.factors.findIndex(function(b){return b.constant()&&0>b.exp});b=0<=b?this.factors.splice(b,
1)[0]:null;[a,b].forEach(function(b){return function(a,c){var d;if(a&&(d=a.evaluate(),b.factors=b.factors.filter(function(c,e){return 0>c.exp*a.exp||!c.constant()||(d=b.applyOperator(d,c.evaluate()))&&!1}),!(1===d&&1<b.factors.length)&&(a.set(0===c?d:Math.pow(d,-1)),1===c)))return a.exp=-1}}(this));a&&b?(a.set(this.applyOperator(a.evaluate(),b.evaluate())),this.factors.unshift(a)):a?this.factors.unshift(a):b&&this.factors.push(b);return 1<this.factors.length?this:this.pushNegation().pushInversion().factors[0].pushNegation()};
c.prototype.combineSimilar=function(){var b;b=[];this.factors.forEach(function(a){var c,d,e,g;g=a.constant()?[null,a]:a.power()?a.exponent.constant()?(a.pushInversion(),[a.base,a.exponent]):(a.exponent=a.exponent.multiplyOne(),[a,a.exponent.factors.shift()]):(a=a.powerOne(),[a.base,a.exponent]);return(c=b.find(function(b){var a;return null!=(a=b[0])?a.equals(g[0]):void 0}))?c[1]+=(null!=(d=g[1])?d.evaluate():void 0)||1:b.push([g[0],(null!=(e=g[1])?e.evaluate():void 0)||1])});this.factors=b.reduce(function(b,
a){0!==a[1]&&(a[1]=(new CTATChemConstantNode(a[1])).popNegation(),a[0]?a[1].constant(1)?b.push(a[0]):a[1].constant(-1)?b.push(a[0].invert()):a[0].power()?(a[0].exponent.factors.unshift(a[1]),b.push(a[0])):b.push((new CTATChemPowerNode("EXP",a[0],a[1])).popInversion()):b.push(a[1]));return b},[]);if(1<this.factors.length)return this;1!==this.factors.length&&(this.factors[0]=new CTATChemConstantNode(1));return this.pushNegation().pushInversion().factors[0]};c.prototype.distribute=function(){var b,a;
b=this.factors.filter(function(b){return!b.inverted()});a=this.factors.filter(function(b){return b.inverted()});return!this.distributedOrSingle(b)||!this.distributedOrSingle(a)||this.single(b)&&a.length&&this.distributed(a)?(this.distributed(a)?(b=this.distributeFactors(this.factors),a=[]):this.distributed(b)?(a=this.distributeFactors(this.factors),b=[]):(b=this.distributeFactors(b),a=this.distributeFactors(a)),this.factors=a.length?b.length?[this.packTerms(b),this.packTerms(a).invert()]:[this.packTerms(a).invert()]:
[this.packTerms(b)],1<this.factors.length?this:this.pushNegation().pushInversion().factors[0].pushNegation()):this};c.prototype.distributedOrSingle=function(b){return this.distributed(b)||this.single(b)};c.prototype.distributed=function(b){return b.every(function(b){return!b.addition()})};c.prototype.single=function(b){return 1===b.length&&b[0].addition()};c.prototype.distributeFactors=function(b){var a;a=b[0].addition()?b[0].terms.map(function(b){return b.multiplication()?b.pushNegation().factors:
[b]}):[[b[0]]];b.slice(1).forEach(function(b){var c;return b.addition()?1===a.length?a=b.terms.map(function(b){var c;c=a[0].map(function(b){return b.clone()});b.multiplication()?c.push.apply(c,b.pushNegation().factors):c.push(b);return c}):a=a.reduce(function(a,c){a.push.apply(a,b.terms.map(function(b){var a;a=c.map(function(b){return b.clone()});b.multiplication()?a.push.apply(a,b.pushNegation().factors.map(function(b){return b.clone()})):a.push(b.clone());return a}));return a},[]):1===a.length?
b.multiplication()?(c=a[0]).push.apply(c,b.pushNegation().factors):a[0].push(b):a.forEach(function(c,d){var e;return b.multiplication()?(e=a[d]).push.apply(e,b.pushNegation().factors.map(function(b){return b.clone()})):a[d].push(b.clone())})});return a};c.prototype.packTerms=function(b){var a;a=CTATChemTreeNode.diff(this.methods,["flatten","distribute"]);return(new CTATChemAdditionNode("PLUS",b.map(function(b){return(new c("TIMES",b)).popNegation().simplifyNode(a)}))).simplifyNode(a)};c.prototype.removeIdentity=
function(b){var a;null==b&&(b=!1);this.popNegation();a=this.factors.filter(function(a){return!a.constant(1,b)});this.factors=a.length?a:this.factors.slice(0,1);(a=this.factors.find(function(a){return a.constant(0,b)}))&&this.factors.every(function(b){return!b.inverted()&&(!b.power()||b.exponent.constant())})&&(this.factors=[a]);return 1<this.factors.length?this:this.pushNegation().pushInversion().factors[0]};c.prototype.sort=function(){this.spreadIdentity();this.factors=this.factors.sort(function(b,
a){return b.compare(a)});return this.stripIdentity()};c.prototype.spreadIdentity=function(){this.factors=this.factors.map(function(b){return b.powerOne(!0)});return this};c.prototype.stripIdentity=function(){this.factors=this.factors.map(function(b){return b.removeIdentity(!0)});return this.popNegation()};c.prototype.multiplyOne=function(b){null==b&&(b=!1);this.factors[0].constant()||this.factors.unshift(new CTATChemConstantNode(1,b));return this.pushNegation()};c.prototype.compare=function(b,a){var d,
e;return(e=c.__super__.compare.apply(this,arguments))||this.countVariables()-b.countVariables()||(d=b.factors.slice(0).reverse())&&this.factors.slice(0).reverse().some(function(b,c){return e=b.compare(d[c],a)})&&e||this.compareSigns(b,a)};c.prototype.countVariables=function(){return this.factors.reduce(function(b,a){return b+a.countVariables()},0)};c.prototype.pushNegation=function(){this.negated()&&(this.negate(),this.factors[0].negate());return this};c.prototype.popNegation=function(){this.factors.forEach(function(b){return function(a){if(a.negated())return b.negate(),
a.negate()}}(this));return this};c.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.factors.forEach(function(b){return b.invert()}));return this};c.prototype.even=function(){return!this.inverted()&&this.factors.every(function(b){return b.integer()})&&this.factors.some(function(b){return b.even()})};c.prototype.getVariables=function(){var b;b=[];this.factors.forEach(function(a){return function(a){return b=b.concat(a.getVariables())}}(this));return b};c.prototype.setVariable=
function(b,a,c){var d,e,g;d=0;for(g=[];d<this.factors.length;)"VAR"===this.factors[d].operator&&this.factors[d].variable===b?(e=c(),e.sign=this.factors[d].sign,e.exp=this.factors[d].exp,this.factors[d]=e):this.factors[d].setVariable(b,a,c),g.push(d++);return g};return c}(CTATChemTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATChemMultiplicationNode=a}).call(this);var CTATChemIntDivisionNode={};
(function(){var a,f=function(a,c){function b(){this.constructor=a}for(var d in c)g.call(c,d)&&(a[d]=c[d]);b.prototype=c.prototype;a.prototype=new b;a.__super__=c.prototype;return a},g={}.hasOwnProperty;a=function(a){function c(b,a,c,e,g,f){this.operator=b;this.dividend=a;this.divisor=c;this.parens=null!=e?e:0;this.sign=null!=g?g:1;this.exp=null!=f?f:1}f(c,a);c.prototype.clone=function(){return new c(this.operator,this.dividend.clone(),this.divisor.clone(),this.parens,this.sign,this.exp)};c.prototype.toString=
function(b){null==b&&(b=!1);this.dividend.setParens(this.operator);this.divisor.setParens(this.operator,!0);return c.__super__.toString.call(this,""+this.dividend.toString(b)+CTATChemTreeNode.toOperatorString(this.operator)+this.divisor.toString(b))};c.prototype.evaluate=function(){return c.__super__.evaluate.call(this,this.applyOperator(this.dividend.evaluate(),this.divisor.evaluate()))};c.prototype.equals=function(b){return c.__super__.equals.call(this,b)&&this.dividend.equals(b.dividend)&&this.divisor.equals(b.divisor)};
c.prototype.simplify=function(b){this.methods=b;this.dividend=this.dividend.simplify(this.methods);this.divisor=this.divisor.simplify(this.methods);return c.__super__.simplify.apply(this,arguments)};c.prototype.computeConstants=function(){return this.dividend.constant()&&this.divisor.constant()?new CTATChemConstantNode(this.evaluate()):this};c.prototype.removeIdentity=function(b){null==b&&(b=!1);return this.divisor.constant(1,b)?(this.intDivision()||(this.dividend=new CTATChemConstantNode(0,b)),this.pushNegation().pushInversion().dividend):
this.popNegation()};c.prototype.compare=function(b,a){return c.__super__.compare.apply(this,arguments)||this.dividend.compare(b.dividend,a)||this.divisor.compare(b.divisor,a)||this.operator!==b.operator&&(this.intDivision()&&-1||1)||this.compareSigns(b,a)};c.prototype.countVariables=function(){return this.dividend.countVariables()+divisor.countVariables()};c.prototype.pushNegation=function(){this.intDivision()&&this.negated()&&(this.negate(),this.dividend.negate());return this};c.prototype.pushInversion=
function(){this.intDivision()&&this.inverted()&&(this.invert(),this.dividend.invert());return this};c.prototype.popNegation=function(){this.divisor.negated()&&(this.divisor.negate(),this.intDivision()&&this.dividend.negate());return this};c.prototype.even=function(){return!this.inverted&&"REM"===this.operator&&this.dividend.even()&&this.divisor.even()};c.prototype.getVariables=function(){return this.dividend.getVariables().concat(this.divisor.getVariables())};c.prototype.setVariable=function(b,a,
c){return[this.dividend,this.divisor].forEach(function(d){return function(e,g){var f;return"VAR"===e.operator&&e.variable===b?(f=c(),f.sign=e.sign,f.exp=e.exp,0===g?d.dividend=f:d.divisor=f):e.setVariable(b,a,c)}}(this))};return c}(CTATChemTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATChemIntDivisionNode=a}).call(this);var CTATChemUnaryNode={};
(function(){var a,f=function(a,c){function b(){this.constructor=a}for(var d in c)g.call(c,d)&&(a[d]=c[d]);b.prototype=c.prototype;a.prototype=new b;a.__super__=c.prototype;return a},g={}.hasOwnProperty;a=function(a){function c(b,a,c,e,g){this.operator=b;this.base=a;this.parens=null!=c?c:0;this.sign=null!=e?e:1;this.exp=null!=g?g:1}f(c,a);c.prototype.clone=function(){return new c(this.operator,this.base,this.parens,this.sign,this.exp)};c.prototype.toString=function(b){null==b&&(b=!1);this.base.setParens(this.operator);
return c.__super__.toString.call(this,""+CTATChemTreeNode.toOperatorString(this.operator)+this.base.toString(b))};c.prototype.evaluate=function(){return c.__super__.evaluate.call(this,this.applyOperator(this.base.evaluate()))};c.prototype.equals=function(b){return c.__super__.equals.call(this,b)&&this.base.equals(b.base)};c.prototype.simplify=function(b){this.methods=b;this.base=this.base.simplify(this.methods);return c.__super__.simplify.apply(this,arguments)};c.prototype.flatten=function(){this.negation()&&
(this.negate(),this.operator="UPLUS");return this.pushNegation().pushInversion().base.pushNegation()};c.prototype.compare=function(b,a){return b.unary()&&this.base.compare(b.base,a)||c.__super__.compare.apply(this,arguments)||this.compareSigns(b,a)};c.prototype.countVariables=function(){return this.base.countVariables()};c.prototype.pushNegation=function(){this.negated()&&(this.negate(),this.base.negate());return this};c.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.base.invert());
return this};c.prototype.constant=function(b,a){null==a&&(a=!1);return this.base.constant(b,a)};c.prototype.getVariables=function(){return this.base.getVariables()};c.prototype.setVariable=function(b,a,c){return"VAR"===this.base.operator&&this.base.variable===b?(b=c(),b.sign=this.base.sign,b.exp=this.base.exp,this.base=b):this.base.setVariable(b,a,c)};return c}(CTATChemTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATChemUnaryNode=a}).call(this);var CTATChemPowerNode={};
(function(){var a,f=function(a,c){function b(){this.constructor=a}for(var d in c)g.call(c,d)&&(a[d]=c[d]);b.prototype=c.prototype;a.prototype=new b;a.__super__=c.prototype;return a},g={}.hasOwnProperty;a=function(a){function c(b,a,c,e,g,f){this.operator=b;this.base=a;this.exponent=c;this.parens=null!=e?e:0;this.sign=null!=g?g:1;this.exp=null!=f?f:1}f(c,a);c.prototype.clone=function(){return new c(this.operator,this.base.clone(),this.exponent.clone(),this.parens,this.sign,this.exp)};c.prototype.toString=
function(b){null==b&&(b=!1);this.base.setParens(this.operator);this.exponent.setParens(this.operator);return c.__super__.toString.call(this,""+this.base.toString(b)+CTATChemTreeNode.toOperatorString(this.operator)+this.exponent.toString(b))};c.prototype.evaluate=function(){return c.__super__.evaluate.call(this,this.applyOperator(this.base.evaluate(),this.exponent.evaluate()))};c.prototype.equals=function(b){return c.__super__.equals.call(this,b)&&this.base.equals(b.base)&&this.exponent.equals(b.exponent)};
c.prototype.simplify=function(b){this.methods=b;this.base=this.base.simplify(this.methods);this.exponent=this.exponent.simplify(this.methods);return c.__super__.simplify.apply(this,arguments)};c.prototype.flatten=function(){var b,a;this.root()&&(this.exponent.invert(),this.operator="EXP");this.popNegation().popInversion();return this.base.power()?(a=CTATChemTreeNode.diff(this.methods,["flatten"]),b=this.base.exponent.multiplication()?this.base.exponent.pushNegation().pushInversion().factors:[this.base.exponent],
this.exponent.multiplication()?b.push.apply(b,this.exponent.pushNegation().pushInversion().factors):b.push(this.exponent),this.base.exponent=(new CTATChemMultiplicationNode("TIMES",b)).simplifyNode(a),this.pushBaseNegation().pushBaseInversion().base):this};c.prototype.computeConstants=function(){return this.base.constant()&&(this.exponent.constant()||this.exponent.multiplication()&&this.exponent.factors[0].constant())?(this.exponent.constant()?(this.base=new CTATChemConstantNode(this.evaluate()),
this.exponent=null):(this.base=new CTATChemConstantNode((new c("EXP",this.base,this.exponent.factors.shift())).evaluate()),1===this.exponent.factors.length&&(this.exponent=this.exponent.pushNegation().pushInversion().factors[0])),this.exponent?this:this.pushBaseNegation().base):this};c.prototype.powerOne=function(a){null==a&&(a=!1);this.exponent=this.exponent.multiplyOne(a);return this.pushInversion()};c.prototype.expand=function(){var a,c,e;if(this.base.addition()&&(this.exponent.integer()&&1<this.exponent.value||
this.exponent.multiplication()&&this.exponent.factors[0].integer()&&1<this.exponent.factors[0].value)){this.exponent.integer()?(a=this.exponent,this.exponent=null):(a=this.exponent.factors.shift(),1===this.exponent.factors.length&&(this.exponent=this.exponent.pushNegation().pushInversion().factors[0]));c=[this.base];e=1;for(a=a.evaluate();1<=a?e<a:e>a;1<=a?++e:--e)c.push(this.base.clone());this.base=(new CTATChemMultiplicationNode("TIMES",c)).simplifyNode(["distribute"]);return this.exponent?this:
this.pushBaseNegation().pushBaseInversion().base}return this};c.prototype.distribute=function(){var a;return this.base.multiplication()||this.exponent.addition()?(a=this.base.multiplication()?this.base.pushNegation().pushInversion().factors:[this.base],a=this.exponent.addition()?a.reduce(function(a){return function(b,c){b.push.apply(b,a.exponent.terms.map(function(a){return[c.clone(),a.clone()]}));return b}}(this),[]):a.map(function(a){return function(b){return[b,a.exponent.clone()]}}(this)),this.base=
this.packFactors(a),this.pushBaseNegation().pushBaseInversion().base):this};c.prototype.packFactors=function(a){var b;b=CTATChemTreeNode.diff(this.methods,["flatten"]);return new CTATChemMultiplicationNode("TIMES",a.map(function(a){return(new c("EXP",a[0],a[1])).simplifyNode(b)}))};c.prototype.removeIdentity=function(a){null==a&&(a=!1);this.popInversion();if(this.exponent.constant(0,a))return this.base=new CTATChemConstantNode(1,a),this.pushBaseNegation().base;if(this.base.constant(0,a))return this.pushBaseInversion().base;
if(this.exponent.constant(1,a))return this.pushBaseNegation().pushBaseInversion().base;this.exponent=this.exponent.removeIdentity(a);return this};c.prototype.compare=function(a,d){return c.__super__.compare.apply(this,arguments)||(this.countVariables()-a.countVariables())*(d?-1:1)||this.exponent.compare(a.exponent,d)||this.base.compare(a.base,d)||this.compareSigns(a,d)};c.prototype.countVariables=function(){return this.base.countVariables()*(this.exponent.constant()?Math.abs(this.exponent.evaluate()):
Infinity)};c.prototype.pushBaseNegation=function(){this.negated()&&(this.negate(),this.base.negate());return this};c.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.exponent.negate());return this};c.prototype.pushBaseInversion=function(){this.inverted()&&(this.invert(),this.base.invert());return this};c.prototype.popNegation=function(){this.base.negated()&&this.exponent.constant()&&(this.base.negate(),this.exponent.even()||this.negate());return this};c.prototype.popInversion=
function(){this.exponent.negated()&&(this.invert(),this.exponent.negate());this.base.inverted()&&(this.invert(),this.base.invert());return this};c.prototype.even=function(){return!this.inverted()&&this.base.even()&&this.exponent.integer()};c.prototype.getVariables=function(){return this.base.getVariables().concat(this.exponent.getVariables())};c.prototype.setVariable=function(a,c,e){return[this.base,this.exponent].forEach(function(b){return function(d,g){var f;return"VAR"===d.operator&&d.variable===
a?(f=e(),f.sign=d.sign,f.exp=d.exp,0===g?b.base=f:b.exponent=f):d.setVariable(a,c,e)}}(this))};return c}(CTATChemTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATChemPowerNode=a}).call(this);var CTATChemVariableNode={};
(function(){var a,f=function(a,c){function b(){this.constructor=a}for(var d in c)g.call(c,d)&&(a[d]=c[d]);b.prototype=c.prototype;a.prototype=new b;a.__super__=c.prototype;return a},g={}.hasOwnProperty;a=function(a){function c(a,c,e,g,f,p){this.variableTable=a;this.variable=c;this.parens=null!=e?e:0;this.sign=null!=g?g:1;this.exp=null!=f?f:1;this.symDelim=null!=p?p:"";this.operator="VAR"}f(c,a);c.prototype.clone=function(){return new c(this.variableTable,this.variable,this.parens,this.sign,this.exp,
this.symDelim)};c.prototype.toString=function(a){null==a&&(a=!1);return c.__super__.toString.call(this,this.variable,this.symDelim,a)};c.prototype.evaluate=function(){var a;return c.__super__.evaluate.call(this,(null!=(a=this.variableTable)?a.get(this.variable):void 0)||function(){try{return eval(this.variable)}catch(d){return NaN}}.call(this))};c.prototype.equals=function(a){return c.__super__.equals.call(this,a)&&this.variable===a.variable};c.prototype.compare=function(a,d){d=null!=d?-1:1;return c.__super__.compare.apply(this,
arguments)||this.variable>a.variable&&d||this.variable<a.variable&&-d||this.compareSigns(a,d)};c.prototype.countVariables=function(){return 1};c.prototype.getVariables=function(){return[this.variable]};return c}(CTATChemTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATChemVariableNode=a}).call(this);var CTATChemConstantNode={};
(function(){var a,f=function(a,c){function b(){this.constructor=a}for(var d in c)g.call(c,d)&&(a[d]=c[d]);b.prototype=c.prototype;a.prototype=new b;a.__super__=c.prototype;return a},g={}.hasOwnProperty;a=function(a){function c(a,c,e,g,f,p){this.marked=null!=c?c:!1;this.parens=null!=e?e:0;this.sign=null!=g?g:1;this.exp=null!=f?f:1;this.operator="CONST";this.precision=p||0;0===this.precision&&(this.precision=void 0);this.value=CTATChemParser.chemRoundTo("string"===typeof a?parseFloat(a):a,15)}f(c,a);
c.prototype.clone=function(){return new c(this.value,this.marked,this.parens,this.sign,this.exp,this.precision)};c.prototype.toString=function(){return c.__super__.toString.call(this,this.value.toPrecision?this.value.toPrecision(this.precision):this.value)};c.prototype.evaluate=function(){return c.__super__.evaluate.call(this,this.value)};c.prototype.equals=function(a){return c.__super__.equals.call(this,a)&&this.value===a.value};c.prototype.multiplyOne=function(){return this};c.prototype.powerOne=
function(){return this};c.prototype.compare=function(a,d){d=null!=d?1:-1;return c.__super__.compare.apply(this,arguments)||Math.sign(Math.abs(this.evaluate())-Math.abs(a.evaluate()))*d||this.compareSigns(a,d)};c.prototype.popNegation=function(){0>this.value&&(this.negate(),this.value=-this.value);return this};c.prototype.constant=function(a,c){null==c&&(c=!1);return null==a||this.evaluate()===a&&this.marked===c};c.prototype.integer=function(){return Math.floor(this.evaluate())===this.value};c.prototype.even=
function(){return 0===this.evaluate()%2};c.prototype.set=function(a,c){this.exp=1;this.value=CTATChemParser.chemRoundTo(Math.abs(a),15);this.sign=Math.sign(a);return this.precision=c||void 0};return c}(CTATChemTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATChemConstantNode=a}).call(this);var CTATChemLogNode={};
(function(){var a,f=function(a,c){function b(){this.constructor=a}for(var d in c)g.call(c,d)&&(a[d]=c[d]);b.prototype=c.prototype;a.prototype=new b;a.__super__=c.prototype;return a},g={}.hasOwnProperty;a=function(a){function c(a,c,e,g){this.val=a;this.operator=c;this.sign=null!=e?e:1;this.exp=null!=g?g:1}f(c,a);c.prototype.clone=function(){return new c(this.val,this.val,this.sign,this.exp)};c.prototype.toString=function(a){var b;null==a&&(a=!1);b="LOG"===this.operator?"log(":"ln(";b+=this.val.toString(a);
return c.__super__.toString.call(this,b+")")};c.prototype.evaluate=function(){return c.__super__.evaluate.call(this,this.applyOperator(this.val.evaluate()))};c.prototype.equals=function(a){return c.__super__.equals.call(this,a)&&this.val.equals(a.val)};c.prototype.simplify=function(a){this.methods=a;this.val=this.val.simplify(this.methods);return c.__super__.simplify.apply(this,arguments)};c.prototype.flatten=function(){return this};c.prototype.computeConstants=function(){var a;console.log("logNode computeConstants");
return this.val.constant()?(a=this.evaluate(),console.log("value is "+a),this.val=new CTATChemConstantNode(a),console.log("const node before set: "),console.log(this.val),this.val.set(a),console.log("const node after set: "),console.log(this.val),this.val):this};c.prototype.compare=function(a,d){return a.log()&&this.val.compare(a.val,d)||c.__super__.compare.apply(this,arguments)||this.compareSigns(a,d)};c.prototype.countVariables=function(){return this.val.countVariables()};c.prototype.pushNegation=
function(){this.negated()&&(this.negate(),this.val.negate());return this};c.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.val.invert());return this};c.prototype.constant=function(a,c){null==c&&(c=!1);return this.val.constant(a,c)};c.prototype.getVariables=function(){return this.val.getVariables()};c.prototype.setVariable=function(a,c,e){return"VAR"===this.val.operator&&this.val.variable===a?(a=e(),a.sign=this.val.sign,a.exp=this.val.exp,this.val=a):this.val.setVariable(a,
c,e)};return c}(CTATChemTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATChemLogNode=a}).call(this);var CTATChemGrammar=function(){function a(){this.yy={}}var f=function(a,b,c,d){c=c||{};for(d=a.length;d--;c[a[d]]=b);return c},g=[1,6],e=[1,7],c=[1,11],b=[1,12],d=[1,14],h=[1,13],n=[1,15],l=[1,16],p=[1,17],m=[1,25],q=[1,26],u=[5,7,8,9,10,11,12,13,15,32],v=[1,27],w=[1,28],B=[1,29],C=[1,32],F=[1,33],G=[5,7,8,9,10,11,12,13,15,16,18,19,22,23,29,30,31,32,33,34,35,36],H=[1,37],E=[5,7,8,9,10,11,12,13,15,16,18,19,22,23,26,29,30,31,32,33,34,35,36],D=[1,40],K=[1,41],J=[5,7,8,9,10,11,12,13,15,16,18,19,22,23,
26,28,29,30,31,32,33,34,35,36],f={trace:function(){},yy:{},symbols_:{error:2,expression:3,relational:4,EOF:5,arithmetic:6,LESS:7,GREATER:8,LESSEQUAL:9,GREATEREQUAL:10,EQUAL:11,NOTEQUAL:12,PLUS:13,term:14,MINUS:15,TIMES:16,signedunitfactor:17,DIVIDE:18,ROOT:19,unitfactor:20,factor:21,IDIVIDE:22,REM:23,signedfactor:24,unit:25,UNIT:26,atom:27,EXP:28,SQRT:29,LOG:30,LPAREN:31,RPAREN:32,LN:33,VARIABLE:34,NUMBER:35,SUBSTANCE:36,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",7:"LESS",8:"GREATER",9:"LESSEQUAL",
10:"GREATEREQUAL",11:"EQUAL",12:"NOTEQUAL",13:"PLUS",15:"MINUS",16:"TIMES",18:"DIVIDE",19:"ROOT",22:"IDIVIDE",23:"REM",26:"UNIT",28:"EXP",29:"SQRT",30:"LOG",31:"LPAREN",32:"RPAREN",33:"LN",34:"VARIABLE",35:"NUMBER",36:"SUBSTANCE"},productions_:[0,[3,2],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,1],[6,3],[6,3],[6,1],[14,3],[14,3],[14,3],[14,2],[14,2],[14,3],[14,3],[14,1],[17,2],[17,2],[17,1],[17,1],[24,2],[24,2],[24,1],[20,2],[25,1],[21,3],[21,2],[21,1],[27,4],[27,4],[27,3],[27,1],[27,1],[27,1]],performAction:function(a,
b,c,d,e,g,f){b=g.length-1;switch(e){case 1:return g[b-1];case 2:this.$=new d.CTATChemRelationNode("LESS",g[b-2],g[b]);break;case 3:this.$=new d.CTATChemRelationNode("GREATER",g[b-2],g[b]);break;case 4:this.$=new d.CTATChemRelationNode("LESSEQUAL",g[b-2],g[b]);break;case 5:this.$=new d.CTATChemRelationNode("GREATEREQUAL",g[b-2],g[b]);break;case 6:this.$=new d.CTATChemRelationNode("EQUAL",g[b-2],g[b]);break;case 7:this.$=new d.CTATChemRelationNode("NOTEQUAL",g[b-2],g[b]);break;case 8:case 11:case 19:case 22:case 23:case 26:case 31:this.$=
g[b];break;case 9:this.$=new d.CTATChemAdditionNode("PLUS",[g[b-2],g[b]]);break;case 10:this.$=new d.CTATChemAdditionNode("MINUS",[g[b-2],g[b]]);break;case 12:this.$=new d.CTATChemMultiplicationNode("TIMES",[g[b-2],g[b]]);break;case 13:this.$=new d.CTATChemMultiplicationNode("DIVIDE",[g[b-2],g[b]]);break;case 14:this.$=new d.CTATChemPowerNode("ROOT",g[b-2],g[b]);break;case 15:case 16:this.$=new d.CTATChemMultiplicationNode("ITIMES",[g[b-1],g[b]]);break;case 17:this.$=new d.CTATChemIntDivisionNode("IDIVIDE",
g[b-2],g[b]);break;case 18:this.$=new d.CTATChemIntDivisionNode("REM",g[b-2],g[b]);break;case 20:case 24:this.$=new d.CTATChemUnaryNode("UPLUS",g[b]);break;case 21:case 25:this.$=new d.CTATChemUnaryNode("UMINUS",g[b]);break;case 27:this.$=g[b-1].setUnit(g[b]);break;case 28:this.$=new d.CTATChemVariableNode(d.variableTable,a.replace(/\#/g,""),0,1,1,"#");break;case 29:this.$=new d.CTATChemPowerNode("EXP",g[b-2],g[b]);break;case 30:this.$=new d.CTATChemPowerNode("ROOT",g[b],new d.CTATChemConstantNode(2));
break;case 32:this.$=new d.CTATChemLogNode(g[b-1],"LOG");break;case 33:this.$=new d.CTATChemLogNode(g[b-1],"LN");break;case 34:this.$=g[b-1];break;case 35:this.$=new d.CTATChemVariableNode(d.variableTable,a.replace(/\&/g,""),0,1,1,"&");break;case 36:this.$=new d.CTATChemConstantNode(a);break;case 37:this.$=new d.CTATChemVariableNode(d.variableTable,a.replace(/\$/g,""),0,1,1,"$")}},table:[{3:1,4:2,6:3,13:g,14:4,15:e,17:5,20:8,21:9,27:10,29:c,30:b,31:d,33:h,34:n,35:l,36:p},{1:[3]},{5:[1,18]},{5:[2,
8],7:[1,19],8:[1,20],9:[1,21],10:[1,22],11:[1,23],12:[1,24],13:m,15:q},f(u,[2,11],{27:10,20:30,21:31,16:v,18:w,19:B,22:C,23:F,29:c,30:b,31:d,33:h,34:n,35:l,36:p}),f(G,[2,19]),{13:g,15:e,17:34,20:8,21:9,27:10,29:c,30:b,31:d,33:h,34:n,35:l,36:p},{13:g,15:e,17:35,20:8,21:9,27:10,29:c,30:b,31:d,33:h,34:n,35:l,36:p},f(G,[2,22]),f(G,[2,23],{25:36,26:H}),f(E,[2,31],{28:[1,38]}),{13:D,15:K,21:42,24:39,27:10,29:c,30:b,31:d,33:h,34:n,35:l,36:p},{31:[1,43]},{31:[1,44]},{6:45,13:g,14:4,15:e,17:5,20:8,21:9,27:10,
29:c,30:b,31:d,33:h,34:n,35:l,36:p},f(J,[2,35]),f(J,[2,36]),f(J,[2,37]),{1:[2,1]},{6:46,13:g,14:4,15:e,17:5,20:8,21:9,27:10,29:c,30:b,31:d,33:h,34:n,35:l,36:p},{6:47,13:g,14:4,15:e,17:5,20:8,21:9,27:10,29:c,30:b,31:d,33:h,34:n,35:l,36:p},{6:48,13:g,14:4,15:e,17:5,20:8,21:9,27:10,29:c,30:b,31:d,33:h,34:n,35:l,36:p},{6:49,13:g,14:4,15:e,17:5,20:8,21:9,27:10,29:c,30:b,31:d,33:h,34:n,35:l,36:p},{6:50,13:g,14:4,15:e,17:5,20:8,21:9,27:10,29:c,30:b,31:d,33:h,34:n,35:l,36:p},{6:51,13:g,14:4,15:e,17:5,20:8,
21:9,27:10,29:c,30:b,31:d,33:h,34:n,35:l,36:p},{13:g,14:52,15:e,17:5,20:8,21:9,27:10,29:c,30:b,31:d,33:h,34:n,35:l,36:p},{13:g,14:53,15:e,17:5,20:8,21:9,27:10,29:c,30:b,31:d,33:h,34:n,35:l,36:p},{13:g,15:e,17:54,20:8,21:9,27:10,29:c,30:b,31:d,33:h,34:n,35:l,36:p},{13:g,15:e,17:55,20:8,21:9,27:10,29:c,30:b,31:d,33:h,34:n,35:l,36:p},{13:g,15:e,17:56,20:8,21:9,27:10,29:c,30:b,31:d,33:h,34:n,35:l,36:p},f(G,[2,15]),f(G,[2,16],{25:36,26:H}),{13:g,15:e,17:57,20:8,21:9,27:10,29:c,30:b,31:d,33:h,34:n,35:l,
36:p},{13:g,15:e,17:58,20:8,21:9,27:10,29:c,30:b,31:d,33:h,34:n,35:l,36:p},f(G,[2,20]),f(G,[2,21]),f(G,[2,27]),f(G,[2,28]),{13:D,15:K,21:42,24:59,27:10,29:c,30:b,31:d,33:h,34:n,35:l,36:p},f(E,[2,30]),{13:D,15:K,21:42,24:60,27:10,29:c,30:b,31:d,33:h,34:n,35:l,36:p},{13:D,15:K,21:42,24:61,27:10,29:c,30:b,31:d,33:h,34:n,35:l,36:p},f(E,[2,26]),{6:62,13:g,14:4,15:e,17:5,20:8,21:9,27:10,29:c,30:b,31:d,33:h,34:n,35:l,36:p},{6:63,13:g,14:4,15:e,17:5,20:8,21:9,27:10,29:c,30:b,31:d,33:h,34:n,35:l,36:p},{13:m,
15:q,32:[1,64]},{5:[2,2],13:m,15:q},{5:[2,3],13:m,15:q},{5:[2,4],13:m,15:q},{5:[2,5],13:m,15:q},{5:[2,6],13:m,15:q},{5:[2,7],13:m,15:q},f(u,[2,9],{27:10,20:30,21:31,16:v,18:w,19:B,22:C,23:F,29:c,30:b,31:d,33:h,34:n,35:l,36:p}),f(u,[2,10],{27:10,20:30,21:31,16:v,18:w,19:B,22:C,23:F,29:c,30:b,31:d,33:h,34:n,35:l,36:p}),f(G,[2,12]),f(G,[2,13]),f(G,[2,14]),f(G,[2,17]),f(G,[2,18]),f(E,[2,29]),f(E,[2,24]),f(E,[2,25]),{13:m,15:q,32:[1,65]},{13:m,15:q,32:[1,66]},f(J,[2,34]),f(J,[2,32]),f(J,[2,33])],defaultActions:{18:[2,
1]},parseError:function(a,b){if(b.recoverable)this.trace(a);else throw a=Error(a),a.hash=b,a;},parse:function(a){var b=[0],c=[null],d=[],e=this.table,g="",f=0,h=0,l=0,n=d.slice.call(arguments,1),m=Object.create(this.lexer),p={},q;for(q in this.yy)Object.prototype.hasOwnProperty.call(this.yy,q)&&(p[q]=this.yy[q]);m.setInput(a,p);p.lexer=m;p.parser=this;"undefined"==typeof m.yylloc&&(m.yylloc={});q=m.yylloc;d.push(q);var w=m.options&&m.options.ranges;this.parseError="function"===typeof p.parseError?
p.parseError:Object.getPrototypeOf(this).parseError;for(var u,r,v,B,C={},F,D;;){v=b[b.length-1];if(this.defaultActions[v])B=this.defaultActions[v];else{if(null===u||"undefined"==typeof u)u=m.lex()||1,"number"!==typeof u&&(u=this.symbols_[u]||u);B=e[v]&&e[v][u]}if("undefined"===typeof B||!B.length||!B[0]){var G;D=[];for(F in e[v])this.terminals_[F]&&2<F&&D.push("'"+this.terminals_[F]+"'");G=m.showPosition?"Parse error on line "+(f+1)+":\n"+m.showPosition()+"\nExpecting "+D.join(", ")+", got '"+(this.terminals_[u]||
u)+"'":"Parse error on line "+(f+1)+": Unexpected "+(1==u?"end of input":"'"+(this.terminals_[u]||u)+"'");this.parseError(G,{text:m.match,token:this.terminals_[u]||u,line:m.yylineno,loc:q,expected:D})}if(B[0]instanceof Array&&1<B.length)throw Error("Parse Error: multiple actions possible at state: "+v+", token: "+u);switch(B[0]){case 1:b.push(u);c.push(m.yytext);d.push(m.yylloc);b.push(B[1]);u=null;r?(u=r,r=null):(h=m.yyleng,g=m.yytext,f=m.yylineno,q=m.yylloc,0<l&&l--);break;case 2:D=this.productions_[B[1]][1];
C.$=c[c.length-D];C._$={first_line:d[d.length-(D||1)].first_line,last_line:d[d.length-1].last_line,first_column:d[d.length-(D||1)].first_column,last_column:d[d.length-1].last_column};w&&(C._$.range=[d[d.length-(D||1)].range[0],d[d.length-1].range[1]]);v=this.performAction.apply(C,[g,h,f,p,B[1],c,d].concat(n));if("undefined"!==typeof v)return v;D&&(b=b.slice(0,-2*D),c=c.slice(0,-1*D),d=d.slice(0,-1*D));b.push(this.productions_[B[1]][0]);c.push(C.$);d.push(C._$);B=e[b[b.length-2]][b[b.length-1]];b.push(B);
break;case 3:return!0}}}},g=function(){return{EOF:1,parseError:function(a,b){if(this.yy.parser)this.yy.parser.parseError(a,b);else throw Error(a);},setInput:function(a,b){this.yy=b||this.yy||{};this._input=a;this._more=this._backtrack=this.done=!1;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};this.options.ranges&&(this.yylloc.range=[0,0]);this.offset=0;return this},input:function(){var a=
this._input[0];this.yytext+=a;this.yyleng++;this.offset++;this.match+=a;this.matched+=a;a.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++;this.options.ranges&&this.yylloc.range[1]++;this._input=this._input.slice(1);return a},unput:function(a){var b=a.length,c=a.split(/(?:\r\n?|\n)/g);this._input=a+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-b);this.offset-=b;a=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-
1);this.matched=this.matched.substr(0,this.matched.length-1);c.length-1&&(this.yylineno-=c.length-1);var d=this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:c?(c.length===a.length?this.yylloc.first_column:0)+a[a.length-c.length].length-c[0].length:this.yylloc.first_column-b};this.options.ranges&&(this.yylloc.range=[d[0],d[0]+this.yyleng-b]);this.yyleng=this.yytext.length;return this},more:function(){this._more=
!0;return this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(a){this.unput(this.match.slice(a))},pastInput:function(){var a=this.matched.substr(0,this.matched.length-this.match.length);return(20<
a.length?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;20>a.length&&(a+=this._input.substr(0,20-a.length));return(a.substr(0,20)+(20<a.length?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=Array(a.length+1).join("-");return a+this.upcomingInput()+"\n"+b+"^"},test_match:function(a,b){var c,d;this.options.backtrack_lexer&&(d={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,
last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(d.yylloc.range=this.yylloc.range.slice(0)));if(c=a[0].match(/(?:\r\n?|\n).*/g))this.yylineno+=c.length;this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:c?
c[c.length-1].length-c[c.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+a[0].length};this.yytext+=a[0];this.match+=a[0];this.matches=a;this.yyleng=this.yytext.length;this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]);this._backtrack=this._more=!1;this._input=this._input.slice(a[0].length);this.matched+=a[0];a=this.performAction.call(this,this.yy,this,b,this.conditionStack[this.conditionStack.length-1]);this.done&&this._input&&(this.done=!1);if(a)return a;
if(this._backtrack)for(var e in d)this[e]=d[e];return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var a,b,c;this._more||(this.match=this.yytext="");for(var d=this._currentRules(),e=0;e<d.length;e++)if((b=this._input.match(this.rules[d[e]]))&&(!a||b[0].length>a[0].length))if(a=b,c=e,this.options.backtrack_lexer){a=this.test_match(b,d[e]);if(!1!==a)return a;if(this._backtrack)a=!1;else return!1}else if(!this.options.flex)break;return a?(a=this.test_match(a,d[c]),!1!==
a?a:!1):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var a=this.next();return a?a:this.lex()},begin:function(a){this.conditionStack.push(a)},popState:function(){return 0<this.conditionStack.length-1?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?
this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(a){a=this.conditionStack.length-1-Math.abs(a||0);return 0<=a?this.conditionStack[a]:"INITIAL"},pushState:function(a){this.begin(a)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(a,b,c,d){switch(c){case 1:return 31;case 2:return 32;case 3:return 28;case 4:return 28;case 5:return 19;case 6:return 29;case 7:return 29;case 8:return 30;
case 9:return 33;case 10:return 16;case 11:return 16;case 12:return 22;case 13:return 18;case 14:return 18;case 15:return 23;case 16:return 15;case 17:return 13;case 18:return 9;case 19:return 9;case 20:return 10;case 21:return 10;case 22:return 7;case 23:return 8;case 24:return 12;case 25:return 12;case 26:return 12;case 27:return 12;case 28:return 11;case 29:return 11;case 30:return 35;case 31:return 35;case 32:return 26;case 33:return 36;case 34:return 34;case 35:return 34;case 36:return 34;case 37:return 5}},
rules:[/^(?:\s+)/,/^(?:\()/,/^(?:\))/,/^(?:\*\*)/,/^(?:\^)/,/^(?:\|)/,/^(?:\u221a)/,/^(?:sqrt\b)/,/^(?:log\b)/,/^(?:ln\b)/,/^(?:\*)/,/^(?:\u00d7)/,/^(?:\/\/)/,/^(?:\/)/,/^(?:\u00f7)/,/^(?:%)/,/^(?:-)/,/^(?:\+)/,/^(?:<=)/,/^(?:\u2264)/,/^(?:>=)/,/^(?:\u2265)/,/^(?:<)/,/^(?:>)/,/^(?:!=)/,/^(?:\/=)/,/^(?:<>)/,/^(?:\u2260)/,/^(?:==)/,/^(?:=)/,/^(?:(([0-9])+\.?([0-9])*|\.([0-9])+)([Ee][+-]?([0-9])+)?)/,/^(?:(0[Bb]([0-1])+|0[Oo]([0-7])+|0[Xx]([0-9A-Fa-f])+))/,/^(?:#[^\#\s]+#)/,/^(?:\$[^\$\s]+\$)/,/^(?:&[^\&\s]+&)/,
/^(?:deltaT\b)/,/^(?:([A-Za-z]))/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37],inclusive:!0}}}}();f.lexer=g;a.prototype=f;f.Parser=a;return new a}();var CTATChemParser={};
(function(){var a;a=function(){function a(a){this.parser=new CTATChemGrammar.Parser;this.parser.yy={CTATChemRelationNode:CTATChemRelationNode,CTATChemAdditionNode:CTATChemAdditionNode,CTATChemMultiplicationNode:CTATChemMultiplicationNode,CTATChemIntDivisionNode:CTATChemIntDivisionNode,CTATChemUnaryNode:CTATChemUnaryNode,CTATChemLogNode:CTATChemLogNode,CTATChemPowerNode:CTATChemPowerNode,CTATChemVariableNode:CTATChemVariableNode,CTATChemConstantNode:CTATChemConstantNode,CTATChemTreeNode:CTATChemTreeNode};this.parser.yy.variableTable=
a}a.none=["simpleFlatten"];a.partial=["flatten","removeIdentity"];a.full="flatten computeConstants combineSimilar expand distribute removeIdentity".split(" ");a.compConstants=["flatten","computeConstants"];a.CHEM_DECIMAL_PRECISION=-1;a.prototype.chemParse=function(g,e){var c;null==e&&(e=!1);try{return c="string"===typeof g?this.parser.parse(g):g,c.simplify(a.none.concat(e?"sort":[]))}catch(b){return console.log("error parsing "+g+" : "),console.log(b),null}};a.prototype.chemStringify=function(a,e){null==
e&&(e=!1);return null!=a?a.toString(e):a};a.prototype.chemEvaluate=function(g){var e;try{return e="string"===typeof g?this.parser.parse(g):g,e.simplify(a.none).evaluate()}catch(c){return console.log(c),null}};a.prototype.chemPartialSimplify=function(g,e,c){var b;null==e&&(e=!1);null==c&&(c=!1);try{return b="string"===typeof g?this.parser.parse(g):g,b.simplify(a.partial.concat(e?"sort":[])).toString(c)}catch(d){return null}};a.prototype.chemSimplify=function(g,e,c){var b;null==e&&(e=!1);null==c&&(c=
!1);try{return b="string"===typeof g?this.parser.parse(g):g,b.simplify(a.full.concat(e?"sort":[])).toString(c)}catch(d){return console.log(d),null}};a.prototype.chemComputeConstants=function(g,e){var c;null==e&&(e=!1);try{return c="string"===typeof g?this.parser.parse(g):g,c.simplify(a.compConstants).toString(e)}catch(b){return console.log(b),null}};a.prototype.chemValid=function(a,e){var c,b;null==e&&(e=!1);return null!=(c=this.chemParse(a,!0))&&null!=(b=this.chemParse(a,!e))?c.toString()===b.toString():
null};a.prototype.chemValued=function(a){var e;return null!=(e=this.chemEvaluate(a))?!isNaN(e):null};a.prototype.chemPartialSimplified=function(a,e){var c,b;null==e&&(e=!1);return null!=(c=this.chemPartialSimplify(a,!0))&&null!=(b=this.chemParse(a,!e))?c===b.toString():null};a.prototype.chemSimplified=function(a,e){var c,b;null==e&&(e=!1);return null!=(c=this.chemSimplify(a,!0))&&null!=(b=this.chemParse(a,!e))?c===b.toString():null};a.prototype.chemConstantsComputed=function(a){var e,c;return null!=
(e=this.chemComputeConstants(a))&&null!=(c=this.chemParse(a))?e===c.toString():null};a.prototype.chemIdentical=function(a,e,c){var b,d;null==c&&(c=!1);return null!=(b=this.chemParse(a,!c))&&null!=(d=this.chemParse(e,!c))?b.toString()===d.toString():null};a.prototype.chemEqual=function(a,e){var c,b;return null!=(c=this.chemEvaluate(a))&&null!=(b=this.chemEvaluate(e))?c===b:null};a.prototype.chemPartialEquivalent=function(a,e,c){var b,d;null==c&&(c=!1);return null!=(b=this.chemPartialSimplify(a,!c))&&
null!=(d=this.chemPartialSimplify(e,!c))?b===d:null};a.prototype.chemEquivalent=function(a,e,c){var b,d;null==c&&(c=!1);return null!=(b=this.chemSimplify(a,!c))&&null!=(d=this.chemSimplify(e,!c))?b===d:null};a.prototype.isChemValid=a.prototype.chemValid;a.prototype.chemEval=a.prototype.chemEvaluate;a.prototype.chemStrictEquivTermsSameOrder=function(a,e){return this.chemPartialEquivalent(a,e,!0)};a.prototype.chemEquivTermsSameOrder=a.prototype.chemStrictEquivTermsSameOrder;a.prototype.chemStrictEquivTerms=
a.prototype.chemPartialEquivalent;a.prototype.chemEquivTerms=a.prototype.chemStrictEquivTerms;a.prototype.chemEquiv=a.prototype.chemEquivalent;a.prototype.isSimplified=function(a){return this.chemSimplified(a,!0)};a.prototype.calc=a.prototype.chemEvaluate;a.prototype.calca=function(a){return(+this.chemEvaluate(a)).toFixed(2)};a.prototype.simplify=function(a){return this.chemSimplify(a,!0)};a.prototype.algebraicEqual=a.prototype.chemEqual;a.prototype.patternMatches=function(a,e){return this.chemIdentical(a,
e,!0)};a.prototype.polyTermsEqual=function(g,e){return this.parser.parse(g).simplify(a.partial).equals(this.parser.parse(e).simplify(a.partial))};a.prototype.algebraicMatches=function(a,e){return this.chemEquivalent(a,e,!0)};a.prototype.expressionMatches=a.prototype.algebraicMatches;a.prototype.chemGetQuadraticCoefficients=function(a,e){var c,b,d,g,f,l,p,m,q,u;a=e?this.chemSimplify(a,!1,!0):a;c=this.chemParse(a);a=null;e=[];u=null;"EQUAL"===c.operator&&("PLUS"===c.left.operator&&"CONST"===c.right.operator&&
0===c.right.value?a=c.left:"PLUS"===c.right.operator&&"CONST"===c.left.operator&&0===c.left.value&&(a=c.right));if(a&&1<a.terms.length&&4>a.terms.length){c=function(a){var b,c,d,e;c=e=b=null;d=1;"TIMES"===a.operator&&2===a.factors.length?(a.factors.forEach(function(b){return function(b,d){if("EXP"===b.operator)return e=b,c=a.factors[0===d?1:0]}}(this)),d=a.sign):"EXP"===a.operator&&(e=a);!e||"VAR"!==e.base.operator||2!==e.exponent.value||u&&e.base.variable!==u||((u||(u=e.base.variable),!c||"CONST"!==
c.operator&&"UMINUS"!==c.operator)?c||(b=a.sign):b=c.evaluate()*d);return b};b=function(a){var b,c,d;c=d=b=null;"TIMES"===a.operator&&2===a.factors.length?a.factors.forEach(function(b){return function(b,e){if("VAR"===b.operator&&(!u||b.variable===u))return u||(u=b.variable),d=b,c=a.factors[0===e?1:0]}}(this)):"VAR"!==a.operator||u&&a.variable!==u||(u||(u=a.variable),d=a);d&&(c&&"CONST"===c.operator?b=c.evaluate()*a.sign:c||(b=a.sign));return b};d=function(a){var b;b=null;"CONST"===a.operator&&(b=
a.evaluate());return b};c={a:c,b:b,c:d};f=["a","b","c"];for(d=g=0;3>g;d=++g)if(a.terms[d]){q=m=null;b=l=0;for(p=f.length;0<=p?l<p:l>p;b=0<=p?++l:--l)if(c[f[b]]&&(m=c[f[b]](a.terms[d]))){q=b;break}if(null===m)return null;e[q]=m;delete c[f[q]]}if(!e[0]||!e[1])return null;e[2]||(e[2]=0);return e}return null};a.prototype.chemSolveQuadratic=function(a,e,c){var b;b=Math.pow(e,2)-4*a*c;c=[];0===b?c.push(""+-e/(2*a)):0<b?(b=Math.sqrt(b),c.push(""+(-e+b)/(2*a)),c.push(""+(-e-b)/(2*a))):(b=Math.sqrt(Math.abs(b)),
a*=2,b/=a,e=-e/a,c.push(e+"+"+b+"i"),c.push(e+"-"+b+"i"));return c};a.prototype.chemGetVariables=function(a){var e,c;a=this.chemParse(a).getVariables();c=[];e={};a.forEach(function(a){return function(a){if(!e[a])return c.push(a),e[a]=!0}}(this));return c};a.prototype.chemSetVariable=function(a,e,c){a=this.chemParse(a);if("VAR"===a.operator)return a.variable===e?this.chemParse(c):a;a.setVariable(e,c,this.chemParse.bind(this,c));return a};a.prototype.chemSetPrecision=function(a,e){a="string"===typeof a?
this.chemParse(a):a;switch(a.operator){case "TIMES":a.factors.forEach(function(a){return function(b){return a.chemSetPrecision(b,e)}}(this));break;case "PLUS":a.terms.forEach(function(a){return function(b){return a.chemSetPrecision(b,e)}}(this));break;case "EXP":this.chemSetPrecision(a.base,e);this.chemSetPrecision(a.exponent,e);break;case "EQUAL":this.chemSetPrecision(a.left,e);this.chemSetPrecision(a.right,e);break;case "UMINUS":this.chemSetPrecision(a.base,e);break;case "CONST":a.precision=e}return a};
a.prototype.chemGetPrecision=function(a){var e,c,b;c=function(a){var b,c;b=Math.log(10);a=String(a);(c=/^(\d(\.\d+)?)e(\+|-)\d/.exec(a))&&(a=c[1]);c=(c=/\.[0-9]*?(0+)$/.exec(a))?c[1].length:0;a=Math.abs(a.replace(".",""));if(0===a)return 0;for(;0!==a&&0===a%10;)a/=10;return c+Math.floor(Math.log(a)/b)+1};if(!isNaN(a))return c(a);a="string"===typeof a?this.chemParse(a):a;b=null;e=function(a){return function(b){var c;c=Number.POSITIVE_INFINITY;b.forEach(function(b){b=a.chemGetPrecision(b);return c=
b<c?b:c});return c}}(this);switch(a.operator){case "TIMES":b=e(a.factors);break;case "PLUS":b=e(a.terms);break;case "EXP":b=e([a.base,a.exponent]);break;case "EQUAL":b=e([a.left,a.right]);break;case "UMINUS":b=this.chemGetPrecision(a.base);break;case "CONST":b=a.precision?a.precision:c(a.value)}return b};a.prototype.chemToPrecision=function(a,e,c,b){var d;a="string"===typeof a?this.chemParse(a):a;b=b||{};switch(a.operator){case "TIMES":a.factors.forEach(function(a){return function(d){return a.chemToPrecision(d,
e,c,b)}}(this));break;case "PLUS":a.terms.forEach(function(a){return function(d){return a.chemToPrecision(d,e,c,b)}}(this));break;case "EXP":this.chemToPrecision(a.base,e,c,b);this.chemToPrecision(a.exponent,e,c,b);break;case "EQUAL":this.chemToPrecision(a.left,e,c,b);this.chemToPrecision(a.right,e,c,b);break;case "UMINUS":this.chemToPrecision(a.base,e,c,b);break;case "CONST":d=a.value.toPrecision(e),b[d]=a.value,a.value=d}return{result:a.toString(c),roundedVals:b}};a.chemRoundTo=function(a,e){a=
String(Math.round(a*("10e"+(e-1))));a.includes("e")?(a=a.split("e"),a=Number(a[0]+"e"+String(Number(a[1])-e))):a=Number(a+"e-"+e);return a};return a}();"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATChemParser=a}).call(this);var CTATVariableTableCount=0,CTATVariableTable=function(){function a(e){var c={},b;for(b in e)!0===e.hasOwnProperty(b)&&(c[b]="object"!==typeof e[b]?e[b]:a(e[b]));return c}CTATBase.call(this,"CTATVariableTable","");CTATVariableTableCount++;var f={},g=this;this.toString=function(){var a="",c;for(c in f)0<a.length&&(a+=", "),a=a+c+"="+f[c];return"{ "+a+" }"};this.clone=function(){ctatdebug("CTATVariableTable --\x3e in clone; this "+this+", this.getTable() "+this.getTable);var e=new CTATVariableTable;
ctatdebug("CTATVariableTable --\x3e in clone; copy "+e+", copy.setTable() "+e.setTable);e.setTable(a(f));ctatdebug("CTATVariableTable --\x3e out of clone");return e};this.put=function(a,c){g.ctatdebug("CTATVariableTable.put("+a+", "+c+") typeof value "+typeof c);if(a)if(0>a.indexOf("."))f[a]=c;else{var b=a.split(".");if("object"!==typeof f[b[0]]||null===f[b[0]])f[b[0]]={};a=f[b[0]];for(var d=1;d<b.length-1;d++)if("object"!==typeof a[b[d]]||null===a[b[d]])a[b[d]]={},a=a[b[d]];a[b[d]]=c}else console.log("CTATVariableTable.put() warning: null or empty variable name '"+
a+"'");return g};this.getTable=function(){return f};this.setTable=function(a){f=a};this.get=function(a){if(0>a.indexOf("."))return null===f[a]||"undefined"===typeof f[a]?null:f[a];var c=a.split(".");if(null===f[c[0]]||"undefined"===typeof f[c[0]])return null;a=f[c[0]];for(var b=1;b<c.length-1;b++){if(null===a[c[b]]||"undefined"===typeof a[c[b]])return null;a=a[c[b]]}return null===a[c[b]]||"undefined"===typeof a[c[b]]?null:a[c[b]]}};
Object.defineProperty(CTATVariableTable,"serialVersionUID",{enumerable:!1,configurable:!1,writable:!1,value:"201403071830L"});CTATVariableTable.standardizeType=function(a){if("string"!=typeof a||1>a.trim().length)return a;if((!0).toString()==a)return!0;if((!1).toString()==a)return!1;if("null"==a)return null;var f=Number(a);return isNaN(f)?a:f};CTATVariableTable.valueAsString=function(a){return"string"==typeof a?a:String(a)};CTATVariableTable.nameAsString=function(a){return a?a+"_String":null};
CTATVariableTable.prototype=Object.create(CTATBase.prototype);CTATVariableTable.prototype.constructor=CTATVariableTable;"undefined"!==typeof module&&(module.exports=CTATVariableTable);var CTATFormulaFunctions={};
(function(){var a,f,g,e,c,b,d,h,n,l,p,m,q,u=[].slice;b=/^([-+])?(?:(\d+)(?:$|\s))?(?:(\d+)\/(\d+))?$/;c=/^\d+(\.\d\d)?$/;d=/((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?/g;m=/^[+-]?((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?$/;e=/^s*([+-]?((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?)s*\/s*([+-]?((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?)s*$/;p=/^[+-]?((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?/;l=/^\s*\(\s*([+-]?((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?)\s*\,\s*([+-]?((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?)\s*\)\s*$/;n=
/([bcdfghjklmnpqrstvwxz]|qu)y$/;h=/([bcdfghjklmnpqrstvwxz]o|[sc]h|s)$/;q=function(a,b){var c;null==b&&(b=!1);var d,e,f;a=null!=(c=a[4])?c:a[2]+(a[3]||"");f=[];d=0;for(e=a.length;d<e;d++)c=a[d],(b||(b="0"!==c))&&f.push(c);return f.length};g=function(a){return(a[4]||a[3]||"").length-+(a[6]||0)};f=function(a,b,c){var d,e;return isNaN(d=+a)||isNaN(e=+b)?c(String(a).toLowerCase(),String(b).toLowerCase()):c(d,e)};a=function(){function a(){}a.printf=("undefined"!==typeof window&&null!==window?window:global).sprintf;
a.sum=function(){return(1<=arguments.length?u.call(arguments,0):[]).reduce(function(a,b){return a+ +b},0)};a.mod=function(a,b){return Math.round(a)%Math.round(b)};a.modf=function(a,b){return a%b};a.IEEEremainder=a.modf;a.isFactor=function(a,b){return 1!==+a&&0===b%a};a.isMultiple=function(a,b){return 0===a%b};a.isUnit=function(a){return 1===+a};a.isAny=function(a,b){return this.isFactor(a,b)||this.isMultiple(a,b)||this.isUnit(a)};a.gcf=function(a,b){b=[Math.abs(a),Math.abs(b)];a=b[0];for(b=b[1];0<
b;)b=[b,a%b],a=b[0],b=b[1];return a};a.lcm=function(a,b){return Math.abs(a*b)/this.gcf(a,b)};a.inRange=function(a,b,c){null==b&&(b=-Infinity);null==c&&(c=Infinity);return b<=a&&a<=c};a.integerInRange=function(a,b,c){var d;null==b&&(b=-Infinity);null==c&&(c=Infinity);return Math.round(b)<=(d=Math.round(a))&&d<=Math.round(c)};a.fmtDecimal=function(a,b){null==b&&(b=2);return(+a).toFixed(Math.round(+b))};a.fmtNormal=function(a,b){null==b&&(b=6);return this.fmtDecimal(a,b).replace(/\.0+$|(\..+?)0+$/,"$1")};
a.fmtDollar=function(a,b){null==b&&(b="");a=this.fmtDecimal(a);b=b.toLowerCase();0<=b.indexOf("i")&&(a=a.replace(/\.00$/,""));return 0<=b.indexOf("d")?"$"+a:a};a.dollarEquals=function(){var a,b;a=arguments[0];b=2<=arguments.length?u.call(arguments,1):[];a=this.fmtDollar(a,"i");return b.some(function(b){return function(c){return a===b.fmtDollar(c,"i")}}(this))};a.matchWithPrecision=function(a,b){var c,d;return(c=String(a).match(m))&&(d=String(b).match(m))&&q(c)===q(d)&&f(a,b,function(a,b){return a===
b})};a.matchWithoutPrecision=function(a,b){var c,d;return(c=String(a).match(m))&&(d=String(b).match(m))&&(a=q(c)>q(d)?(+a).toFixed(g(d)):String(a))&&f(a,b,function(a,b){return a===b})};a.constantsConform=function(){var a,b;a=arguments[0];b=2<=arguments.length?u.call(arguments,1):[];b=b.map(function(a){return"string"===typeof a?new RegExp(a,"i"):a});return(a.match(d)||[]).every(function(a){return b.some(function(b){return b.test(a)})})};a.constantsDollar=function(a){return this.constantsConform(a,
c)};a.isInteger=function(a,b){null==b&&(b=!0);return Number.isInteger(b&&+a||a)};a.isNumber=function(a,b){null==b&&(b=!0);return Number.isFinite(b&&+a||a)};a.isVar=function(a){return/^\s*[a-zA-Z]\s*$/.test(a)};a.makeFraction=function(a,b,c,d){""!==a&&"+"!==a&&"-"!==a&&(d=["",a,b,c],a=d[0],b=d[1],c=d[2],d=d[3]);null!=c&&null==d&&(d=[0,b,c],b=d[0],c=d[1],d=d[2]);b=+b||0;c=+c||0;d=+d||1;return this.isInteger(b)&&this.isInteger(c)&&this.isInteger(d)?a+(b?b+(c?" ":""):"")+(c?c+(1===d?"":"/"+d):""):null};
a.fractionMake=a.makeFraction;a.getSign=function(a){return null!=(a=String(a).match(b))?a[1]||"":null};a.getWhole=function(a){return null!=(a=String(a).match(b))?(a[1]||"")+(a[2]||"0"):null};a.getNumerator=function(a){return null!=(a=String(a).match(b))?(a[1]||"")+(a[3]||"0"):null};a.getDenominator=function(a){return null!=(a=String(a).match(b))?a[4]||"1":null};a.convertToMixed=function(a){return null!=(a=String(a).match(b))?this.makeFraction(a[1]||"",(+a[2]||0)+Math.floor((+a[3]||0)/(+a[4]||1)),
(+a[3]||0)%(+a[4]||1),a[4]):null};a.convertToImproper=function(a){return null!=(a=String(a).match(b))?this.makeFraction(a[1]||"",0,(+a[2]||0)*(+a[4]||1)+(+a[3]||0),a[4]||1):null};a.evaluateFraction=function(a){return null!=(a=String(a).match(b))?((a[1]||"+")+"1")*((+a[2]||0)*(+a[4]||1)+(+a[3]||0))/(+a[4]||1):null};a.simplifyFraction=function(a){var c;return null!=(a=String(a).match(b))?(null!=a[2]&&null!=a[3]&&(a[2]=+a[2]+Math.floor(+a[3]/+a[4]),a[3]=+a[3]%+a[4]),c=null!=a[3]?this.gcf(+a[3],+a[4]):
1,this.makeFraction(a[1]||"",a[2],a[3]/c,a[4]/c)):null};a.fractionsimplify=a.simplifyFraction;a.simplifyMixed=a.simplifyFraction;a.simplifiedFraction=function(a){var b;return null!=(b=this.simplifyFraction(a))?b===a:null};a.isSimplifiedMixed=a.simplifiedFraction;a.fractionEquals=function(a,b){var c,d;return null!=(c=this.evaluateFraction(a))&&null!=(d=this.evaluateFraction(b))?c===d:null};a.simplifiedFractionEquals=function(a,b){var c,d;return null!=(c=this.simplifiedFraction(a))&&null!=(d=this.simplifiedFraction(b))?
c&&d&&this.fractionEquals(a,b):null};a.rationalEquals=function(a,b){return this.matchWithoutPrecision(+b||this.evaluateFraction(b),+a||this.evaluateFraction(a))};a.getDividend=function(a){var b;return null!=(b=String(a).match(e))?b[1]:null};a.getDivisor=function(a){var b;return null!=(b=String(a).match(e))?b[8]:null};a.divEvaluate=function(a){var b;return null!=(b=String(a).match(e))?+b[1]/b[8]:null};a.matchQuantNumber=function(a,b,c){var d;return(d=+String(a).match(p)[0])&&d>=b-c&&d<=b+c};a.matchQuantUnit=
function(){var a,b,c,d;b=arguments[0];d=2<=arguments.length?u.call(arguments,1):[];return(a=String(b).match(p)[0])&&(c=b.slice(a.length).trim())&&d.includes(c)};a.quote=function(a){return'"'+a+'"'};a.compact=function(a){return String(a).replace(/\s*/g,"")};a.equalsIgnoreCase=function(a,b){return a===b||String(a).toLowerCase()===String(b).toLowerCase()};a.replaceFirst=function(a,b,c){return String(a).replace(new RegExp(b),c)};a.replaceAll=function(a,b,c){return String(a).replace(new RegExp(b,"g"),
c)};a.regExMatch=function(a,b,c){return("string"===typeof a?new RegExp(a,c):a).test(b)};a.rm1coeff=function(a){if(null!=a)return String(a).replace(/(^|[^0-9])1([a-zA-Z])/g,"$1$2")};a.setMatches=function(a,b,c){var d,e;d=a.split(c);e=b.split(c);return e.every(function(a){return d.includes(a)})&&d.every(function(a){return e.includes(a)})};a.pointInRange=function(a,b,c,d,e){var f,g,h;if(f=null!=b?"function"===typeof b.match?b.match(l):void 0:void 0)e=[f[1],f[8],c,d],b=e[0],c=e[1],d=e[2],e=e[3];null==
d&&(d=0);null==e&&(e=d);return(f=a.match(l))&&b-d<=(g=f[1])&&g<=+b+ +d&&c-e<=(h=f[8])&&h<=+c+ +e};a.plural=function(a,b,c,d){var e;if(!b||2>a)return b;null==c&&(c=n.test(e=b.toLowerCase())?"y":"");if(!b.endsWith(c))return b;null==d&&(d=n.test(e)?"ies":h.test(e)?"es":"s");c.length&&(b=b.split(c)[0]);return b+(/[A-Z]/.test(b[b.length-1])?d.toUpperCase():d)};a.first=function(){return(1<=arguments.length?u.call(arguments,0):[])[0]};a.last=function(){var a;a=1<=arguments.length?u.call(arguments,0):[];
return a[a.length-1]};a.chooseRandomly=function(){var a;a=1<=arguments.length?u.call(arguments,0):[];return a[Math.floor(Math.random()*a.length)]};a.firstNonNull=function(){var a;return null!=(a=(1<=arguments.length?u.call(arguments,0):[]).find(function(a){return null!=a}))?a:null};a.valueOrZero=function(){var a;return null!=(a=(1<=arguments.length?u.call(arguments,0):[]).find(function(a){return null!=a}))?a:0};a.hasValue=function(){return(1<=arguments.length?u.call(arguments,0):[]).every(function(a){return null!=
a})};a.equals=function(){var a,b,c;b=arguments[0];c=2<=arguments.length?u.call(arguments,1):[];null==b&&(b=void 0);return isNaN(a=+b)?c.every(function(a){return b===(null!=a?a:void 0)}):c.every(function(b){return a===+(null!=b?b:NaN)})};a.memberOf=function(){var a,b,c;b=arguments[0];c=2<=arguments.length?u.call(arguments,1):[];null==b&&(b=void 0);return isNaN(a=+b)?c.some(function(a){return b===(null!=a?a:void 0)}):c.some(function(b){return a===+(null!=b?b:NaN)})};a.greaterThan=function(a,b){return f(a,
b,function(a,b){return a>b})};a.lessThan=function(a,b){return f(a,b,function(a,b){return a<b})};a.greaterThanOrEqual=function(a,b){return f(a,b,function(a,b){return a>=b})};a.lessThanOrEqual=function(a,b){return f(a,b,function(a,b){return a<=b})};a.equal=function(a,b){return f(a,b,function(a,b){return a===b})};a.notEqual=function(a,b){return f(a,b,function(a,b){return a!==b})};a.and=function(){return(1<=arguments.length?u.call(arguments,0):[]).reduce(function(a,b){return a&&b},!0)};a.or=function(){return(1<=
arguments.length?u.call(arguments,0):[]).reduce(function(a,b){return a||b},!1)};a.not=function(a){return!a};a.ifThen=function(a,b,c){return a?b:c};a.assign=function(a,b){var c,d,e,f,g;g="undefined"!==typeof window&&null!==window?window:global;d=a.split(".");a=2<=d.length?u.call(d,0,c=d.length-1):(c=0,[]);e=d[c++];c=0;for(f=a.length;c<f;c++)d=a[c],g=null!=g[d]?g[d]:g[d]={};return g[e]=b};a.length=function(a){return a.length};a.toString=function(a){return a.toString()};return a}();"undefined"!==typeof module&&
null!==module?module.exports=a:this.CTATFormulaFunctions=a}).call(this);var CTATFormulaActions={};
(function(){var a;a=function(){function a(){}a.goToState=function(a){return CTAT.ToolTutor.tutor.goToState(a)};a.goToStartState=function(){return CTAT.ToolTutor.tutor.goToStartState()};a.performInterfaceAction=function(a,e,c){return CTAT.ToolTutor.sendToInterface((new CTATTutoringServiceMessageBuilder).createInterfaceActionMessage(CTATMessage.makeTransactionId(),new CTATSAI(a,e,c)))};return a}();"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATFormulaActions=a}).call(this);var CTATFormulaParser={};
(function(){var a,f,g,e,c=[].slice,b=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};e=/"(?:[^\\"]|\\\")*"|'(?:[^\\'']|\\\')*'/;f=/[A-Za-z_][\w._]*(?![\w(._])/g;g="abstract await boolean break byte case catch char class const continue debugger default delete do double else enum export extends false final finally float for function goto if implements import in instanceof int interface let long native new null of package private protected public return short static super switch synchronized this throw throws transient true try typeof var void volatile while with yield Array Date eval function global hasOwnProperty Infinity isFinite isNaN isPrototypeOf length Math NaN name Number Object prototype String toString undefined valueOf window".split(" ");a=
function(){function a(a){var b,d,e;this.variableTable=a;this.algebraParser=new CTATAlgebraParser;this.logicParser=new CTATLogicParser;this.chemParser=new CTATChemParser;this.keys=[];this.values=[];e="EPSILON MAX_SAFE_INTEGER MAX_VALUE MIN_SAFE_INTEGER MIN_VALUE NEGATIVE_INFINITY POSITIVE_INFINITY isFinite isInteger isNaN isSafeInteger parseFloat parseInt".split(" ");a=0;for(d=e.length;a<d;a++)b=e[a],this.keys.push(b),this.values.push(Number[b]);e=["toExponential","toFixed","toLocaleString","toPrecision",
"valueOf"];a=0;for(d=e.length;a<d;a++)b=e[a],this.keys.push(b),this.values.push(function(a){return function(){var b,d;d=arguments[0];b=2<=arguments.length?c.call(arguments,1):[];return a.apply(d,b)}}(Number.prototype[b]));e="E LN10 LN2 LOG10E LOG2E PI SQRT1_2 SQRT2 abs acos acosh asin asinh atan atanh atan2 cbrt ceil clz32 cos cosh exp expm1 floor fround hypot imul log log10 log1p log2 max min pow random round sign sin sinh sqrt tan tanh trunc".split(" ");a=0;for(d=e.length;a<d;a++)b=e[a],this.keys.push(b),
this.values.push(Math[b]);e=["fromCharCode","fromCodePoint"];a=0;for(d=e.length;a<d;a++)b=e[a],this.keys.push(b),this.values.push(String[b]);e="charAt charCodeAt codePointAt concat endsWith includes indexOf lastIndexOf localeCompare match normalize padEnd padStart repeat replace search slice split startsWith substr substring toLocaleLowerCase toLocaleUpperCase toLowerCase toUpperCase trim trimEnd trimStart valueOf".split(" ");d=0;for(a=e.length;d<a;d++)b=e[d],this.keys.push(b),this.values.push(function(a){return function(){var b,
d;d=arguments[0];b=2<=arguments.length?c.call(arguments,1):[];return a.apply(d,b)}}(String.prototype[b]));e="algParse algGetError algStringify algEvaluate algSort algGetOperator algGetVariables algGetOperands algGetExpression algFindExpression algCreateExpression algReplaceExpression algDeleteExpression algSimplifyRules algPartiallySimplify algSimplify algValid algValued algPartiallySimplified algSimplified algIdentical algEqual algPartiallyEquivalent algEquivalent isAlgValid algEval algStrictEquivTermsSameOrder algEquivTermsSameOrder algStrictEquivTerms algEquivTerms algEquiv isSimplified calc calca simplify algebraicEqual patternMatches polyTermsEqual algebraicMatches expressionMatches".split(" ");
d=0;for(a=e.length;d<a;d++)b=e[d],this.keys.push(b),this.values.push(function(a,b){return function(){var d;d=1<=arguments.length?c.call(arguments,0):[];return a.apply(b,d)}}(this.algebraParser[b],this.algebraParser));e="logicSetMode logicParse logicGetError logicStringify logicEvaluate logicSort logicGetOperator logicGetOperators logicGetVariables logicGetOperands logGetExpression logicFindOperator logicFindExpression logicFindRule logicApplyRules logicCreateExpression logicReplaceExpression logicDeleteExpression logicValid logicValued logicSorted logicIdentical logicEqual logicEquivalent logicSemanticEquivalent logicFindCounterExample logicSimplifyNNF logicSimplifyCNF logicSimplifyDNF logicSimplifiedNNF logicSimplifiedCNF logicSimplifiedDNF".split(" ");
d=0;for(a=e.length;d<a;d++)b=e[d],this.keys.push(b),this.values.push(function(a,b){return function(){var d;d=1<=arguments.length?c.call(arguments,0):[];return a.apply(b,d)}}(this.logicParser[b],this.logicParser));for(b in CTATFormulaFunctions)this.keys.push(b),this.values.push(function(a,b){return function(){var d;d=1<=arguments.length?c.call(arguments,0):[];return a.apply(b,d)}}(CTATFormulaFunctions[b],CTATFormulaFunctions));for(b in CTATFormulaActions)this.keys.push(b),this.values.push(function(a,
b){return function(){var d;d=1<=arguments.length?c.call(arguments,0):[];return a.apply(b,d)}}(CTATFormulaActions[b],CTATFormulaActions))}a.prototype.evaluate=function(a,d,l,p){var h,n,u,v,w,B,C,F,G,H,E,D;try{F="undefined"!==typeof window&&null!==window?window:global;h=function(){var a;a=[];for(v in F)a.push(v);return a}().concat(["selection","action","input"]);G=a.split(e);n=0;for(w=G.length;n<w;n++)for(C=G[n],E=null!=(H=C.match(f))?H:[],u=0,B=E.length;u<B;u++)v=E[u],0>b.call(g,v)&&0>b.call(h,v)&&
0>b.call(this.keys,v)&&CTATFormulaFunctions.assign(v,void 0);for(v in D=this.variableTable.getTable())F[v]=D[v];return function(a,b,c){c.prototype=a.prototype;c=new c;a=a.apply(c,b);return Object(a)===a?a:c}(Function,["selection","action","input"].concat(c.call(this.keys),["return "+a.trim().replace(/[\\]/g,"\\$&")]),function(){}).apply(F,[d,l,p].concat(c.call(this.values)))}catch(K){return console.log(K),null}finally{for(v in F)null!=v&&0>b.call(h,v)&&(D[v]=F[v],delete F[v])}};a.prototype.interpolateSplitPattern=
/<%=|%>/;a.prototype.interpolate=function(a,b,c,d){var e,f,g,h,l;h=a.split(this.interpolateSplitPattern);l=[];a=f=0;for(g=h.length;f<g;a=++f)e=h[a],l.push(a%2?this.evaluate(e,b,c,d):e);return l.join("")};return a}();"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATFormulaParser=a}).call(this);var CTATNoolsTracer=function(a,f,g){var e,c,b,d;function h(a){Ea=[];O.setDoBacktracking(!1);M("debug","starting initial match");Fa=function(){M("debug","done initial match");sa=ta=!0;O.setPruneOldActivations(Z.prune_old_activations);O.setDoBacktracking(Z.use_backtracking);O.setSearchAllPermutations(Z.search_all_permutations);fa=!0;"function"===typeof a&&a()};H()}function n(){M("debug","start conflict tree pregeneration...");pa=!0;ka=[];var a=0;0===ua.length&&ua.push({selection:"not_specified",action:"not_specified",
input:"not_specified"});var b=function(){++a>=ua.length?c():l(ua[a],b)},c=function(){M("debug","done conflict tree pregeneration");pa=!1;Ga();Ga=function(){}};Z.use_hint_fact?(a--,l(null,b,!0)):l(ua[a],b)}function l(a,b,c){O.prepForMatch();I();var d;d=c?G():F(a,!0);H(null,function(){O.retract(d);sa=!0;var e=O.getConflictTree();c?ka.__hintTree=[aa,e]:ka.push([a,aa,e]);b()})}function p(a,b,c){var d=null,e=null,f=null;if("untutored_action"===c)return F(a,!1),n(),!0;"hint"===c&&ka.__hintTree&&(e=K(!0,
a.selection,ka.__hintTree[0]));if(!e)for(var g=0;g<ka.length;g++){var h=ka[g][0],l=ka[g][1],m=l.firstPredictedSolution,l=l.selectionMap;!f&&("hint"!==c||0<m.hints.length)&&(f=m);if(r(a,h).isMatch){!e&&("hint"!==c||0<m.hints.length)&&(e=m);for(var p in l){if(l.hasOwnProperty(p))for(h=l[p],m=0;m<h.length;m++){var q=h[m];if("tutored_action"===c){if(r(a,q.sai,q.saiComparator).isMatch){d=q;break}}else!e&&0<q.hints.length&&(e=q)}if(d||"hint"===c&&e)break}}}if(d)M("debug","Matched w/ pregen tree, refiring chain: "+
d.activationIds.join(" , ")),ya=d,ua=[],O.prepForMatch(),I(),F(a,!0),H(null,function(){M("debug","done refiring activations, returning result");var a=ya.sai.isCorrect?"correct":"bug";1===d.halted&&(d.halted=2);ta="correct"===a;sa=!0;ya=ja=null;b(a,d);n()},d.activationIds);else return e||(f||(f=new oa),e=f),"tutored_action"===c?(M("debug","didn't get a match :( "),b("no_model",e)):b(e),!0}function m(a,b){"string"===typeof a&&(e[e.length-1].successOrBugMsg={message:a,priority:b||0})}function q(a){e[e.length-
1].priority=a}function u(a){var b=e[e.length-1].sai;a.selection&&(b.selection=a.selection);a.action&&(b.action=a.action);a.input&&(b.input=a.input)}function v(a,b,c,d,e,f,g){M("debug","handleImports for "+b);c=c||{};e=e||{count:0,chunks:[]};f=f||0;g=g||0;for(var h=/\bimport\s?\(('|")?([^()'"\s]*)\1?\);/g,l,m=[];null!=(l=h.exec(a));){var n=ha.relativeToAbsolute(l[2],b);c[n]?M("debug","skipping duplicate import: "+n):(m.push(n),c[n]=!0);a=a.replace(l[0],"");h.lastIndex-=l[0].length}e.chunks[f]||(e.chunks[f]=
[]);e.chunks[f][g]=a;e.count+=m.length;M("debug",b+" is importing "+m.length+" files");if(0<m.length)for(a={i$53:0};a.i$53<m.length;a={url$54:a.url$54,i$53:a.i$53},a.i$53++)a.url$54=m[a.i$53],$.ajax(a.url$54,{dataType:"text",success:function(a){return function(b){v(b,a.url$54,c,d,e,f+1,a.i$53);e.count--;0==e.count&&d(w(e.chunks))}}(a),error:function(a,b,c){M("error","Error in _handleImports() : ");M("error",b)}});else 0==f&&d(w(e.chunks))}function w(a){for(var b="",c;0<a.length;)for(c=a.pop();0<c.length;)b+=
c.shift()+"\n";return b}function B(a,b){var c={getRuntime:function(){return La},getStudentInput:function(){return ia.getLastStudentSAI()},getStudentSAIs:function(){return ia.getStudentSAIs()},checkSAI:J,setTutorSAI:u,setSuccessOrBugMsg:m,setChainPriority:q,setProblemAttribute:A,getInitialized:function(){return ia.getInitialized()},backtrack:function(){O.setAboutToBacktrack()},assert:R,modify:z,bulkModify:T,retract:Q,undoAll:S,addPregenSAI:U,halt:X,pruneOldActivations:V,setCTNodeData:P,addScoreLabels:L};
[CTATAlgebraParser,CTATLogicParser,CTATChemParser,CTATFormulaParser].forEach(function(a){var b=new a;a={};for(var d in b)a.f=d,"function"===typeof b[a.f]&&(c[a.f]=function(a){return function(){return b[a.f].apply(b,arguments)}}(a)),a={f:a.f}});try{wa=nools.compile(a,{name:b||"CTATFlow",scope:c})}catch(Pa){return M("error","Error compiling rule file"),fa=!1,Pa}C();return!0}function C(){var a,b;a=wa.__scope;var c={};wa.__rules.forEach(function(a){c[a.name]=!0});if(a&&a.skill_definitions)if(a=a.skill_definitions,
a instanceof Array)a.forEach(function(a){var d={name:a.skillName||a.ruleName,category:a.category,label:a.label||a.skillName,description:a.description||"",mastery:a.mastery||CTATExampleTracerSkill.DEFAULT_MASTERY_THRESHOLD,level:a.pKnown||CTATExampleTracerSkill.DEFAULT_P_KNOWN,pGuess:a.pGuess||CTATExampleTracerSkill.DEFAULT_P_GUESS,pLearn:a.pLearn||CTATExampleTracerSkill.DEFAULT_P_LEARN,pSlip:a.pSlip||CTATExampleTracerSkill.DEFAULT_P_SLIP};a.ruleName?(b=a.ruleName.split(","),b.forEach(function(b){b=
b.trim();if(c[b])Ba[b]=d;else throw Error("Rule "+a.ruleName+" named by skill "+a.skillName+" does not exist in model");})):Ba.__noRuleSkills.push(d)});else throw Error("Global variable 'skill_definitions' must be of type Array");}function F(a,b){M("debug","Assert sai ("+(b?"":"un")+"tutored) : "+JSON.stringify(a));var c=Ca[a.selection];if(c&&O.factExists(c))c.action=a.action,c.input=a.input,c.tutored=b,O.modify(c);else{c=wa.getDefined("StudentValues");if(!c)throw Error("StudentValues type not defined");
c=new c(a.selection,a.action,a.input);c.tutored=b;O.assert(c,"_student_input_"+Ma);Ca[a.selection]=c;pa||Ma++}return ja=c}function G(){M("debug","Asserting hint fact...");if(!Da){var a=wa.getDefined("IsHintMatch");if(!a)throw Error("IsHintMatch type not defined");Da=new a}return O.assert(Da,"_isHintMatch")}function H(a,b,c){va=!1;O.match(function(a){pa||(Ha=O.getConflictTree());if(a)throw M("error","nools encountered an error: "+a),a;b&&"function"===typeof b?b():va&&(xa&&M("override","search complete, returning result"),
Fa())},a,!1,sa,c);sa=!1}function E(a){var b="no_model",c,d,e;aa.matchChain?(c=aa.matchChain,b="correct"):(aa.bugMatchChains.length&&(c=aa.bugMatchChains.sort(function(a,b){return b.priority-a.priority})[0],b="bug",d=c.msg,e=c.bugMessages),c=K(!1),d&&(c.msg=d),e&&(c.bugMessages=e));ta="correct"===b;c.tpas=Ia;sa=!0;ja=null;a(b,c)}function D(a,b,c){c=K(!0,c);b&&(ta=Ja=!1,sa=!0,ja=null,Z.use_hint_fact&&O.retract(Da));a(c)}function K(a,b,c){var d=c||aa;c=d.selectionMap;b=b||(ja?ja.selection:"");var d=
d.firstTutorSelection,e=[];M("debug","getBiasedPrediction selecting chain to return.  includeHints is "+a+", studentSelection is "+b);for(s in c){var f=c[s];M("debug","\tchecking selection: "+s);if(f)for(var g=0;g<f.length;g++){var h=f[g];M("debug","\t\tchecking chain: "+JSON.stringify(h));if(a&&0<h.hints.length||h.sai.isCorrect){M("debug","\t\t^^^^^^^^valid chain found");for(var l=0;l<e.length;){var m;a:{m=e[l];if(a){if(h.hints.length&&!m.hints.length){m=-1;break a}if(m.hints.length&&!h.hints.length){m=
1;break a}}m=h.priority>m.priority?-1:m.priority>h.priority?1:h.sai.selection===b&&m.sai.selection!==b?-1:m.sai.selection===b&&h.sai.selection!==b?1:h.sai.selection===d&&m.sai.selection!==d?-1:m.sai.selection===d&&h.sai.selection!==d?1:0}if(0>=m)break;l++}e.splice(l,0,h)}}}(a=e.shift())?M("debug","returning chain: "+JSON.stringify(a)):(M("debug","\tno chain found, returning blank chain"),a=new oa);return a}function J(a,c,d){var f=!1,g=a.selection,h=a.action,l=a.input,m=e,m=m[m.length-1],n="not_specified"===
g||"not_specified"===h||"not_specified"===l;M("sai_check","check SAI against: "+JSON.stringify(a));if(Z.pregen_conflict_tree)return M("sai_check","in pregen mode, skipping check  (was "+(d?"":"not")+" a buggy step)"),m.sai={selection:g,action:h,input:l,isCorrect:!d&&!n},m.comparator=c,ya&&(M("sai_check","currently re-firing; updating sai in matched chain..."),ya.sai=m.sai),!0;if(!ja)return M("sai_check","no student input to check, returning false"),!1;M("sai_check","student input: "+JSON.stringify(ja));
m.sai={selection:null!==g&&void 0!==g&&"not_specified"!==g&&"don't_care"!==g?g:"",action:null!==h&&void 0!==h&&"not_specified"!==h&&"don't_care"!==h?h:"",input:null!==l&&void 0!==l&&"not_specified"!==l&&"don't_care"!==l?l:"",isCorrect:!d&&!n};Ja?M("sai_check","Skipping check, we're hint matching"):(f=r(ja,a,c),M("sai_check",(f.isMatch?"Match":"No match")+", "+(d?"was":"was not")+" a buggy step"),b=f.isMatch?d?"buggy":"match":null,O.setNodeMatcherResult(f,d));return f.isMatch}function r(a,b,c){var d=
b.selection,e=b.action,f=b.input,g=a.selection,h=a.action,l=a.input,m=["-","-","-"],n={student:a,tutor:b,isMatch:!1,matchedFields:null},l=isNaN(l)?l:parseInt(l,10),f=isNaN(f)?f:parseInt(f,10),p=function(a,b,c){return"don't_care"===a?"*":"not_specified"===a?" ":a===b?c:"-"};m[0]=p(d.toLowerCase(),g.toLowerCase(),"S");m[1]=p(e.toLowerCase(),h.toLowerCase(),"A");m[2]=p(f,l,"I");n.matchedFields=m;if(c&&"function"===typeof c)n.isMatch=c(a,b);else for(n.isMatch=!0,a=0;3>a;a++)if("-"===m[a]){n.isMatch=!1;
break}return n}function I(){aa=new qa;e=[];c=[];b=null;va=d=!1}function A(a,b){M("debug","setProblemAttribute ("+a+", "+b+")");Z[a]=b}function P(a){O.setNodeData(a)}function L(){var a=e[e.length-1];a.scoreLabels=a.scoreLabels.concat(Array.prototype.slice.call(arguments))}function N(){for(var a=e,c=aa.selectionMap,f,g,h={message:"",priority:Number.NEGATIVE_INFINITY},l,m=[],n=[],p=[],q=[],u=[],r=[],w=[],v,D={selection:"",action:"",input:""},B=[],P=null,z={},T=d?pa?1:2:0,N=0,C=0;C<a.length;C++)f=a[C],
g=f.sai,n.push(f.ruleName),(l=Ba[f.ruleName])&&p.push(l.name+" "+l.category),p=p.concat(f.skills),q=q.concat(f.hints),w=w.concat(f.tpas),m.push(f.activationId),u=u.concat(f.successMessages),r=r.concat(f.bugMessages),f.successOrBugMsg&&f.successOrBugMsg.priority>h.priority&&(h=f.successOrBugMsg),g&&(g.selection&&(v=D.selection=g.selection),g.action&&(D.action=g.action),g.input&&(D.input=g.input),D.isCorrect=g.isCorrect,f.comparator&&"function"===typeof f.comparator&&(P=f.comparator)),B=B.concat(f.scoreLabels),
f.customFields.forEach(function(a){return z[a.name]=a.value}),N=f.priority>N?f.priority:N;q.sort(function(a,b){var c=b.precedence-a.precedence;0===c&&(c=a.pos-b.pos);return c});v?aa.firstTutorSelection||(aa.firstTutorSelection=v):v="_default_key";c[v]||(c[v]=[]);a=new oa(D,n,p,q,h,z,m,P,w,T,N,u,r,B);D.isCorrect&&!aa.firstPredictedSolution&&(aa.firstPredictedSolution=a);c[v].push(a);switch(b){case "buggy":aa.bugMatchChains.push(a);break;case "match":aa.matchChain=a}aa.numChains++;Ia=w;M("debug","stored last chain: \n\trules: "+
n+"\n\tskills: "+p+"\n\thints: "+q.map(function(a){return a.msg})+"\n\tfinalSAI: "+JSON.stringify(D)+"\n\tmatchType: "+b+"\n\tmsg: "+h+"\n\tpriority: "+N+"\n\tsuccess messages: "+u.map(function(a){return a.msg})+"\n\tbug messages: "+r.map(function(a){return a.msg})+"\n\tscore labels: "+B.join())}function R(a){Z.use_backtracking&&O.pushUndo("assert",a);return O.assert(a)}function Q(a){Z.use_backtracking&&O.pushUndo("retract",a);return O.retract(a)}function z(a,b,c){if(Z.use_backtracking)O.pushUndo("modify",
a,b);else if(3>arguments.length)return O.modify.apply(O,arguments);a[b]=c;return O.modify(a)}function T(a,b){if(Z.use_backtracking)O.pushUndo("bulkModify",a,Object.keys(b));else if(2>arguments.length)return O.modify.apply(O,arguments);for(var c in b)a[c]=b[c];return O.modify(a)}function X(){d=!0;pa?O.setAboutToBacktrack():(O.halt(!0),va=!0)}function S(){O.undoAll(!0)}function V(){var a=O.pruneOldActivations();M("debug","pruned old activations: "+a.join(","))}function U(){if(!pa)for(var a=0;a<arguments.length;a++){var b=
arguments[a];!b.selection&&(b.selection="not_specified");!b.action&&(b.action="not_specified");!b.input&&(b.input="not_specified");ua.push(b)}}function ea(){N()}function Y(a){Ka||c.pop();Ka=!1;Ia=[];M("backtrack","backtracking, initiated by "+(a?"model":"engine"))}function ra(a,b,c,d){var f;try{f=JSON.stringify(a)}catch(Qa){f="< Error converting fact to JSON >"}M("assert",b+" fact asserted with ID "+d+": "+f);c=e[e.length-1];switch(b){case "tpa":M("tpa","TPA asserted: "+JSON.stringify(a));fa?Z.use_backtracking?
c.tpas.push(a):Oa(a):Ea.push(ha.buildStartStateMsg(a));break;case "hint":fa&&(a.pos=+(e.length+"."+c.hints.length),c.hints.push(a));break;case "skill":fa&&c.skills.push(a.name+" "+a.category);break;case "customfield":fa&&c.customFields.push(a);break;case "successmessage":fa&&c.successMessages.push(a);break;case "bugmessage":fa&&c.bugMessages.push(a)}}function la(a,b,c,d){M("modify",b+" fact modified with ID "+d)}function ga(a,b,c,d){M("retract",b+" fact retracted with ID "+d)}function da(a){M("state_save",
"Hit branch point, agenda: "+JSON.stringify(a.agenda)+", factIdCntr: "+a.state.factIdCounter);c.push({numLinks:e.length,matchType:b})}function ba(a){M("state_restore","State restored, agenda: "+JSON.stringify(a.agenda)+", factIdCntr: "+a.state.factIdCounter);a=c;a=a[a.length-1];links=e;links.splice(a.numLinks);b=a.matchType}function W(a,b,c){M("fire","Firing activation: "+c);e.push(new Aa(a,c));Ka=!0}function ca(a,b,c){M("agenda_insert",a+" added to agenda, is "+(b?" ":"not ")+"new, was "+(c?" ":
"not ")+"skipped")}function ma(a){M("agenda_retract",a+" removed from agenda")}function na(){M("agenda_empty","No more activations in agenda, all branches have been explored");va=!0}function za(a){M("override","hit breakpoint on rule "+a+" (call resume() to resume matching)")}var qa=function(){this.firstTutorSelection=null;this.selectionMap={};this.matchChain=null;this.bugMatchChains=[];this.numChains=0;this.firstPredictedSolution=null},oa=function(a,b,c,d,e,f,g,h,l,m,n,p,q,u){this.sai=a||{selection:"",
action:"",input:""};this.rules=b||[];this.skills=c||[];this.hints=d||[];this.msg=e?e.message:"";this.customFields=f||{};this.activationIds=g||[];this.saiComparator=h||null;this.tpas=l||[];this.halted=m;this.priority=n||0;this.successMessages=p||[];this.bugMessages=q||[];this.scoreLabels=u||[]},Aa=function(a,b){this.ruleName=a;this.activationId=b;this.hints=[];this.tpas=[];this.skills=[];this.customFields=[];this.successMessages=[];this.bugMessages=[];this.scoreLabels=[]},M=a,Oa=f,La=g,ia=this,fa=
!1,wa=null,O=null,Ca={},aa=new qa,ja=null,Ma=0;e=[];c=[];b=null;var Ka=d=!1,ha=null,Ea=[],Z={use_backtracking:!0,prune_old_activations:!1,use_hint_fact:!1,search_all_permutations:!0,hint_out_of_order:!1,substitute_input:!1,auto_hint:"none",auto_hint_threshold:3},ta=!0,Ja=!1,Da=null,Ba={__noRuleSkills:[]},Ia=[],xa=!1,sa=!0,Fa=function(){},va=!1,ua=[],pa=!1,Ga=function(){},ka=[],ya=null,Ha=null,Na;this.getSession=function(){return O};this.getInitialized=function(){return fa};this.getSkills=function(){return Ba};
this.getProblemAttribute=function(a){return Z[a]};this.setProblemAttribute=function(a,b){return A(a,b)};this.getProblemStateStatus=function(){return La.getOutputStatus()};this.init=function(a,b,c){M("debug","noolstracer init w/ source file: "+a);if(nools){ha=new CTATNoolsTracerUtil;var d=ha.relativeToAbsolute(a);$.ajax(a,{dataType:"text",success:function(e){v(e,d,null,function(d){M("debug","compiling model...");!0!==(d=B(d,a))?(M("error","CTATNoolsTracer: Error compiling model"),c(d)):(M("debug",
"done compile"),ia.createSession()||c("CTATNoolsTracer: Error creating session"),registerTracerWrapper(new CTATNoolsTracerWrapper(ia)),h(function(){M("override","tracer initialized, log flags: ");getTracerLogFlags();printBreakpoints();b(Ea,Z);var a=new Event("noolsModelLoaded");window.dispatchEvent(a);Z.pregen_conflict_tree&&n()}))})},error:function(a,b,d){ctatdebug("Error retrieving rule file: ");ctatdebug(b);c(b)}})}else M("error","Error: nools is not defined"),c("nools is not defined")};this.createSession=
function(){M("debug","creating session...");(O=wa.getSession({iAmEventListeners:!0,assert:ra,retract:ga,modify:la,state_save:da,state_restore:ba,backtrack:Y,fire:W,agenda_insert:ca,agenda_retract:ma,agenda_empty:na,endOfChain:ea,breakpoint:za}))&&M("debug","session created");return!!O};this.evaluate=function(a,b,c){M("debug","noolsTracer.evaluate, matchType = "+c+", sai "+JSON.stringify(a)+", "+ta);Na=Date.now();if(Z.pregen_conflict_tree)return p(a,b,c);var d=E.bind(ia,b);O.prepForMatch();switch(c){case "hint":if(ta||
Z.use_hint_fact)Ja=!0,d=D.bind(ia,b,!0),Z.use_hint_fact&&G();else return M("debug","re-using hints from last match"),D(b,!1,a.selection),!0;case "tutored_action":I();F(a,!0);Fa=function(){O.prepForMatch();O.restoreAgenda();ia.printTraceTime();ia.printAgenda("agenda_post");ia.printConflictTree("conflict_tree");d()};xa||(ia.printAgenda("agenda_pre"),H());break;case "untutored_action":return F(a,!1),!0}return!1};this.setListener=function(a,b){O&&O.on(a,b)};this.getStudentSAIs=function(){return Ca};this.getLastStudentSAI=
function(){return ja};this.getTutorSAIs=function(){return aa.selectionMap};this.reset=function(a){ia.createSession();fa=!1;Ca={};aa=new qa;ja=null;ta=!0;h(a)};this.printTraceTime=function(){var a=(Date.now()-Na)/1E3;M("time","trace took "+a+" seconds.")};this.printAgenda=function(a){M(a,ha.printAgenda(O))};this.getAgenda=function(){return O.getAgenda()};this.printConflictTree=function(a,b,c){M(a,"\n"+Ha.toString(b,c))};this.printPregenTrees=function(a,b,c){ka.__hintTree&&M(a," hint tree: \n"+ka.__hintTree[1].toString(b,
c));ka.forEach(function(d){M(a," tree for sai: "+JSON.stringify(d[0])+"\n"+d[2].toString(b,c))})};this.printTutorSAIs=function(a,b){var c="";Ha.getMatchChains().forEach(function(a){var d=a.match.tutor;c+="\n"+d.selection+" ; "+d.action+" ; "+d.input;b&&(c+=" \n "+a.rules.join(",")+"\n")});M(a,c)};this.printFact=function(a){M("override",ha.printFact(O,a))};this.printFacts=function(a){M("override",ha.printFacts(O,a))};this.printRules=function(a){M("override",ha.printRules(O,a))};this.getFact=function(a){return ha.getFact(O,
a)};this.getFacts=function(a){return ha.getFacts(O,a)};this.printCtNodeMatch=function(a){M("override",ha.printCtNodeMatch(O,a))};this.printRuleNodes=function(a){M("override",ha.printRuleNodes(O,a))};this.printBreakpoints=function(){M("override",ha.printBreakpoints(O))};this.setInStepMode=function(a){a=a&&"false"!==a;M("override","Stepper mode "+(a?"on":"off"));!xa||a||va||H();xa=a};this.takeSteps=function(a){xa?ja?(a=a||1,M("override","taking "+a+" steps"),H(a)):M("override","no new student input, ignoring"):
M("override","not in step mode, ignoring")};this.setBreakpoint=function(a,b){a?(b=b||"first",O.setBreakpoint(a,b)?M("override","breakpoint "+("none"===b?"cleared":"set")+" for rule "+a):M("override","breakpoint not "+("none"===b?"cleared":"set")+" -- rule "+a+" doesn't exist")):M("override","need a rule name to break on")};this.resume=function(){xa?M("override","can't resume; engine is in stepper mode"):va?M("override","not at a breakpoint, ignoring"):H()};this.getIAmPregenerating=function(){return pa};
this.setDonePregenCallback=function(a){M("debug","setDonePregenCallback()");Ga=a}};var CTATRuleTracerGlobals={},NOOLS_LOG_FLAGS="time conflict_tree assert modify retract state_save state_restore backtrack agenda_insert agenda_retract agenda_empty fire error debug sai_check agenda_pre agenda_post tpa".split(" "),CTATNoolsTracerLogger=new CTATLogger(NOOLS_LOG_FLAGS),globalTracerRef=null;function registerTracerWrapper(a){globalTracerRef=a}function setTracerLogFlag(a){a=CTATNoolsTracerLogger.set(a)?"set flag "+a:"Error - invalid flag: "+a;CTATNoolsTracerLogger.log("override",a)}
function setTracerLogFlags(a){var f=[],g=[];(a instanceof Array?a:Array.prototype.slice.call(arguments)).forEach(function(a){CTATNoolsTracerLogger.set(a)?f.push(a):g.push(a)});f.length&&CTATNoolsTracerLogger.log("override","set flags: "+f.join(","));g.length&&CTATNoolsTracerLogger.log("override","Error - invalid flag(s): "+g.join(","))}
function getTracerLogFlags(){var a=CTATNoolsTracerLogger.getFlags(),f=[],g=[],e;for(e in a)a[e]?f.push(e):g.push(e);CTATNoolsTracerLogger.log("override","set: "+f.join(",")+"\nunset: "+g.join(","))}function unsetTracerLogFlag(a){CTATNoolsTracerLogger.unset(a)}function unsetTracerLogFlags(a){(a instanceof Array?a:Array.prototype.slice.call(arguments)).forEach(function(a){unsetTracerLogFlag(a)})}function printAgenda(){globalTracerRef.printAgenda()}
function getAgenda(){return globalTracerRef.getAgenda()}function printConflictTree(a,f){globalTracerRef.printConflictTree(a,f)}function printPregenTrees(a,f){globalTracerRef.printPregenTrees(a,f)}function printTutorSAIs(a){globalTracerRef.printTutorSAIs()}function printFact(a){globalTracerRef.printFact(a)}function getFact(a){return globalTracerRef.getFact(a)}function printFacts(a){globalTracerRef.printFacts(a)}function getFacts(a){return globalTracerRef.getFacts(a)}
function printRules(a){globalTracerRef.printRules(a)}function printMatch(a){globalTracerRef.printMatch(a)}function whyNot(a){globalTracerRef.printRuleNodes(a)}function setStepperMode(a){globalTracerRef.setStepperMode(a)}function takeSteps(a,f){globalTracerRef.takeSteps(a,f)}function setBreakpoint(a,f){globalTracerRef.setBreakpoint(a,f)}function printBreakpoints(){globalTracerRef.printBreakpoints()}function resume(){globalTracerRef.resume()}
function getProblemStateStatus(){return globalTracerRef.getProblemStateStatus()};var CTATRuleTracer=function(a,f){function g(a){var b=[],c=Object.keys(a).flatMap(function(b){return a[b]});p("debug","skills from model: "+JSON.stringify(c));c.forEach(function(a){b.push(new CTATExampleTracerSkill(a.category,a.name,a.pGuess,a.level,a.pSlip,a.pLearn,null))});l.addSkillsFromProblemFile(b)}function e(a,b,e,f){var g=f.msg,h=f.successMessages.map(function(a){return a.msg}),l=f.bugMessages.map(function(a){return a.msg}),q=f.sai,w=new CTATSAI(q.selection,q.action,q.input),v=a.getStudentSAI(),
r=f.customFields,B=r.step_id?r.step_id:""+q.selection+(q.selection&&q.action?" ":"")+q.action+"";h.length||h.push(g);l.length||l.push(g);p("debug","ruleTracer.handleResult, result = "+e+"\n\ttutorSAI = "+JSON.stringify(q)+"\n\tmsg = "+g+"\n\tsuccess messages = "+h+"\n\tbug messages = "+l+"\n\tassociated rules = "+f.rules+"\n\tassociated skills = "+f.skills+"\n\tstep ID = "+B+"\n\tscore labels = "+f.scoreLabels+"\n\ttpas = "+f.tpas+"\n\tcustom fields = "+JSON.stringify(r)+"\n\thalted = "+f.halted);
a.setStepID(B);a.setTutorSAI("correct"!==e||m.getProblemAttribute("substitute_input")?w:v);a.setSuccessOrBuggyMsg(g);a.setAssociatedRules(f.rules);a.setAssociatedSkills(f.skills);a.setCustomFields(r);a.addScoreLabels&&f.scoreLabels.length&&a.addScoreLabels(f.scoreLabels);switch(e){case "correct":a.setResult(CTATExampleTracerLink.CORRECT_ACTION);a.setTraceOutcome(CTATExampleTracerLink.CORRECT_ACTION);a.setSuccessOrBuggyMsg(h);u={all:0};break;case "bug":a.setSuccessOrBuggyMsg(l);case "no_model":c(a,
v,"bug"===e),p("debug","consecutive errors: \n\t"+Object.keys(u).map(function(a){return a+": "+u[a]}).join("\n\t")),n()}0<CTATNoolsTracerLogger.getNFlagsSet()&&p("override","------ end of trace ------\n");2===f.halted&&f.tpas.forEach(function(a){d(a)});b()}function c(a,b,c){b.getSelection().includes("done")&&"ButtonPressed"===b.getAction()&&a.setDoneStepFailed(!0);c?(a.setResult(CTATExampleTracerLink.BUGGY_ACTION),a.setTraceOutcome(CTATExampleTracerLink.BUGGY_ACTION)):(a.setResult(CTATExampleTracerLink.NO_MODEL),
a.setTraceOutcome(CTATExampleTracerLink.NO_MODEL));a=b.getSelection();u.all++;u[a]?u[a]++:u[a]=1}function b(a,b,c){var d=c.hints.map(function(a){return a.msg}),e=c.rules,f=c.skills,g=c.sai;a.getStudentSAI();c=c.customFields;var h=c.step_id?c.step_id:""+g.selection+(g.selection&&g.action?" ":"")+g.action+"";p("debug","ruleTracer.handleHintResult,\n\ttutorSAI = "+JSON.stringify(g)+"\n\tassociated rules = "+e+"\n\tassociated skills = "+f+"\n\tstep ID = "+h+"\n\tcustom fields = "+JSON.stringify(c)+"\n\thints = "+
JSON.stringify(d));a.setTutorSAI(new CTATSAI(g.selection,g.action,g.input));a.setResult(CTATExampleTracerLink.HINT_ACTION);a.setTraceOutcome(d.length?CTATExampleTracerLink.HINT_ACTION:CTATExampleTracerLink.NO_MODEL);a.setReportableHints(d);a.setActor(CTATMsgType.DEFAULT_STUDENT_ACTOR);a.setStepID(h);a.setAssociatedSkills(f);a.setAssociatedRules(e);a.setCustomFields(c);u={all:0};b(a,a.getTransactionID())}function d(a){l&&l.addTPAToMessageTank(a.selection,a.action,a.input,"tutor-performed")}function h(a){return{selection:a.getSelection()||
"",action:a.getAction()||"",input:a.getInput()||""}}function n(){var a=m.getProblemAttribute("auto_hint"),b=m.getProblemAttribute("auto_hint_threshold");if("all"===a?u.all>=b:"selection"===a&&Object.keys(u).some(function(a){return"all"!==a&&u[a]>=b}))p("debug","at consecutive error threshold, sending hint request..."),CTATCommShell.commShell.processComponentAction(new CTATSAI("hint","ButtonPressed","hint request"))}var l=f,p=CTATNoolsTracerLogger.log,m=null,q=null,u={all:0},v=this;this.getEngine=
function(){return m};this.initEngine=function(b,c,e){switch(a){case "nools":m=new CTATNoolsTracer(p,d,l)}var f=function(a,b){console.log("CTATRuleTracer.doneInit");g(m.getSkills());c(a,b)};m&&m.init(b,f,e)};this.getModelInitialized=function(){return m&&m.getInitialized()};this.getProblemStateStatus=function(){return l.getOutputStatus()};this.setListener=function(a,b){m.setListener(a,b)};this.evaluate=function(a,b){var c=h(a.getStudentSAI());a=e.bind(v,a,b);c=m.evaluate.bind(m,c,a,"tutored_action");
return m.getIAmPregenerating()?(m.setDonePregenCallback(c),!1):c()};this.doHint=function(a,c,d){a.setTransactionID(c);return m.evaluate(h(a.getStudentSAI()),b.bind(this,a,d),"hint")};this.handleUntutoredAction=function(a){p("debug","ruleTracer.handleUntutoredAction( "+JSON.stringify(a)+" )");m.evaluate({selection:a.selection[0],action:a.action[0],input:a.input[0]},null,"untutored_action")};this.checkOutOfOrder=function(a,b){m.getProblemAttribute("hint_out_of_order")?(a=h(a.getStudentSAI()),a=!m.getTutorSAIs()[a.selection]):
a=!1;b(a)};this.setDefaultBuggyMsg=function(a){a&&"string"===typeof a&&(q=a)};this.getDefaultBuggyMsg=function(){return q};this.reset=function(a){m.reset(a)}};var CTATHintPolicyEnum=function(){};Object.defineProperty(CTATHintPolicyEnum,"HINTS_UNBIASED",{enumerable:!0,configurable:!1,writable:!1,value:"Always Follow Best Path"});Object.defineProperty(CTATHintPolicyEnum,"HINTS_BIASED_BY_CURRENT_SELECTION_ONLY",{enumerable:!0,configurable:!1,writable:!1,value:"Bias Hints by Current Selection Only"});Object.defineProperty(CTATHintPolicyEnum,"HINTS_BIASED_BY_PRIOR_ERROR_ONLY",{enumerable:!0,configurable:!1,writable:!1,value:"Bias Hints by Prior Error Only"});
Object.defineProperty(CTATHintPolicyEnum,"HINTS_BIASED_BY_ALL",{enumerable:!0,configurable:!1,writable:!1,value:"Use Both Kinds of Bias"});Object.defineProperty(CTATHintPolicyEnum,"DEFAULT",{enumerable:!0,configurable:!1,writable:!1,value:CTATHintPolicyEnum.HINTS_BIASED_BY_ALL});CTATHintPolicyEnum.prototype=Object.create(Object.prototype);CTATHintPolicyEnum.prototype.constructor=CTATHintPolicyEnum;
CTATHintPolicyEnum.lookup=function(a){for(policy in CTATHintPolicyEnum)if(CTATHintPolicyEnum[policy]==a)return CTATHintPolicyEnum[policy];return CTATHintPolicyEnum.DEFAULT};"undefined"!==typeof module&&(module.exports=CTATHintPolicyEnum);var CTATMatcher=function(a,f,g){CTATBase.call(this,"CTATMatcher","");this.lastResult=null;var e=new CTATSAI("","",""),c=g,b=CTATMsgType.DEFAULT_ACTOR,d=!1,h=this;this.resetMatcher=function(){};this.MatcherSAItoXML=function(a){return a+"<matcher>\n"+(a+"    <matcherType>Matcher</matcherType>\n")+(a+'    <matcherParameter name="single">null</matcherParameter>\n')+(a+"</matcher>\n")};this.getSelection=function(){return h.getDefaultSelection()};this.getAction=function(){return h.getDefaultAction()};this.getInput=
function(){return h.getDefaultInput()};this.getActor=function(){return b};this.setCaseInsensitive=function(a){c=a};this.getEvaluatedInput=function(a,b){return h.getInput()};this.getTraversalIncrement=function(){return 1};this.getTutorSAI=function(a,b,c){a=String(c).toLowerCase()==CTATExampleTracerLink.CORRECT_ACTION.toLowerCase()?a:h.getDefaultSAI();console.log("CTATMatcher.getTutorSAI() superclass method called, should be subclass;\n  returning: "+a);return a};this.getDefaultSelection=function(){return h.getDefaultSAI().getSelection()};
this.getDefaultAction=function(){return h.getDefaultSAI().getAction()};this.getDefaultInput=function(){return h.getDefaultSAI().getInput()};this.getDefaultSAI=function(){return e};this.setDefaultSAI=function(a){e=a};this.getDefaultActor=function(){switch(String(getActor()).toLowerCase()){case CTATMsgType.DEFAULT_STUDENT_ACTOR.toLowerCase():return CTATMsgType.DEFAULT_STUDENT_ACTOR;case CTATMsgType.DEFAULT_TOOL_ACTOR.toLowerCase():return CTATMsgType.DEFAULT_TOOL_ACTOR;case CTATMsgType.UNGRADED_TOOL_ACTOR.toLowerCase():return CTATMsgType.DEFAULT_TOOL_ACTOR;
case CTATMsgType.ANY_ACTOR.toLowerCase():return CTATMsgType.DEFAULT_TOOL_ACTOR;default:return console.log("CTATMatcher.getDefaultActor() unexpected value for actor: "+b+"; returning "+CTATMsgType.DEFAULT_ACTOR),CTATMsgType.DEFAULT_ACTOR}};this.getInput=function(){return h.getDefaultInput()};this.getCaseInsensitive=function(){return c};this.match=function(a,b,c,d,e){console.log("CTATMatcher superclass method called: match("+a+", "+b+", "+c+", "+d+")");return!1};this.matchForHint=function(a,b,c,d){console.log("CTATMatcher superclass method called: matchForHint("+
a+", "+b+", "+c+", vt)");return!1};this.matchActor=function(a){a=String(a).toUpperCase();var b=String(h.getActor()).toUpperCase();ctatdebug("CTATMatcher.matchActor("+a+") myActor is "+b);return CTATMsgType.ANY_ACTOR.toString().toUpperCase()==b||CTATMsgType.UNGRADED_TOOL_ACTOR.toString().toUpperCase()==b&&CTATMsgType.DEFAULT_TOOL_ACTOR.toString().toUpperCase()==a||CTATMsgType.UNGRADED_TOOL_ACTOR.toString().toUpperCase()==a&&CTATMsgType.DEFAULT_TOOL_ACTOR.toString().toUpperCase()==b?!0:b==a};this.getDefaultSelectionArray=
function(){return h.getDefaultSAI().getSelectionArray()};this.getDefaultActionArray=function(){return h.getDefaultSAI().getActionArray()};this.getDefaultInputArray=function(){return h.getDefaultSAI().getInputArray()};this.getLastResult=function(){return null===h.lastResult||"undefined"===typeof h.lastResult?"":h.lastResult.toString()};this.setActor=function(a){ctatdebug("CTATMatcher --\x3e in setActor("+a+")");if(null===a||"undefined"===typeof a)a=CTATMsgType.DEFAULT_ACTOR;a=String(a).toLowerCase().trim();
b="tool"==a?CTATMsgType.DEFAULT_TOOL_ACTOR:a==CTATMsgType.DEFAULT_STUDENT_ACTOR.toLowerCase()?CTATMsgType.DEFAULT_STUDENT_ACTOR:a==CTATMsgType.DEFAULT_TOOL_ACTOR.toLowerCase()?CTATMsgType.DEFAULT_TOOL_ACTOR:a==CTATMsgType.UNGRADED_TOOL_ACTOR.toLowerCase()?CTATMsgType.UNGRADED_TOOL_ACTOR:a==CTATMsgType.ANY_ACTOR.toLowerCase()?CTATMsgType.ANY_ACTOR:CTATMsgType.DEFAULT_ACTOR};this.array2ConcatString=function(a){var b="";if(null==a)return b;if(!Array.isArray(a))return a.toString();a.forEach(function(a){null!=
a&&(b+=a.toString()+"\n")});return b.substring(0,0<b.length?b.length-1:0)};this.matchConcatenation=function(a){return h.matchSingle(h.array2ConcatString(a))};this.isLinkTriggered=function(){return d};this.setLinkTriggered=function(a){d=a};this.evaluateReplacement=function(a,b,c){return""};this.replaceInput=function(){return!!h.getReplacementFormula()};this.getReplacementFormula=function(){return""}};
CTATMatcher.prototype.toString=function(){console.log("Error: CTATMatcher.toString() called; should be overridden in subclass");return"This is CTATMatcher."};CTATMatcher.prototype.setParameter=function(a,f,g){};CTATMatcher.isTutorActor=function(a,f){return CTATMsgType.DEFAULT_TOOL_ACTOR.toUpperCase()===a.toUpperCase()||CTATMsgType.UNGRADED_TOOL_ACTOR.toUpperCase()===a.toUpperCase()||f&&CTATMsgType.ANY_ACTOR.toUpperCase()===a.toUpperCase()?!0:!1};
Object.defineProperty(CTATMatcher,"NON_SINGLE",{enumerable:!1,configurable:!1,writable:!1,value:-1});Object.defineProperty(CTATMatcher,"SELECTION",{enumerable:!1,configurable:!1,writable:!1,value:0});Object.defineProperty(CTATMatcher,"ACTION",{enumerable:!1,configurable:!1,writable:!1,value:1});Object.defineProperty(CTATMatcher,"INPUT",{enumerable:!1,configurable:!1,writable:!1,value:2});Object.defineProperty(CTATMatcher,"VECTOR",{enumerable:!1,configurable:!1,writable:!1,value:3});
Object.defineProperty(CTATMatcher,"ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Actor"});CTATMatcher.prototype=Object.create(CTATBase.prototype);CTATMatcher.prototype.constructor=CTATMatcher;"undefined"!==typeof module&&(module.exports=CTATMatcher);var CTATSingleMatcher=function(a,f){CTATMatcher.call(this,!0,a,f);var g=this,e="",c="";this.getSingle=function(a){return e};this.setSingle=function(a){null===a||"undefined"===typeof a?g.ctatdebug('CTATSingleMatcher --\x3e bad argument "'+a+'" to setSingle()'):e=a};this.toString=function(){console.log("Error: CTATSingleMatcher.toString() called: should be overridden")};this.matchSingle=function(a){console.log("Error: CTATSingleMatcher.matchSingle("+a+") called: should be overridden");return!1};this.getReplacementFormula=
function(){return c};this.setReplacementFormula=function(a){c=a?a:""};this.evaluateReplacement=function(a,d,e){e=null;if(!c)return e;g.ctatdebug("CTATSingleMatcher.evaluateReplacement("+a+", "+d+")");var b=a.getSelection(),f=a.getAction();a=CTATVariableTable.standardizeType(a.getInput());d||(d=new CTATVariableTable);d=new CTATFormulaParser(d);g.ctatdebug("CTATSingleMatcher calling CTATFormulaParser.evaluate("+c+", "+b+", "+f+", "+a+")");try{e=d.evaluate(c,b,f,a)}catch(p){g.ctatdebug("CTATSingleMatcher error from CTATFormulaParser.evaluate("+
c+") "+p.name+": "+p.message),e=null}g.ctatdebug("CTATSingleMatcher.evaluateReplacement() returns "+e+", type "+typeof e);return e}};CTATSingleMatcher.prototype=Object.create(CTATMatcher.prototype);CTATSingleMatcher.prototype.constructor=CTATSingleMatcher;CTATSingleMatcher.prototype.matchConcatenation=function(a){a=this.array2ConcatString(a);return this.matchSingle(a)};CTATSingleMatcher.prototype.match=function(a,f,g,e){return this.matchConcatenation(a)};
CTATSingleMatcher.prototype.setParameter=function(a,f,g){this.ctatdebug("CTATSingleMatcher.setParameter("+a+", "+f+", "+g+") calling\n  "+this.setSingle.toString());this.setSingle(a)};"undefined"!==typeof module&&(module.exports=CTATSingleMatcher);var CTATAnyMatcher=function(a,f){CTATSingleMatcher.call(this,a,!0);var g=this;this.toString=function(){return"*"};this.matchSingle=function(a){return!0};this.MatcherSAItoXML=function(a){return a+"<matcher>\n"+(a+"    <matcherType>AnyMatcher</matcherType>\n")+(a+'    <matcherParameter name="single">'+g.getSingle()+"</matcherParameter>\n")+(a+"</matcher>\n")}};CTATAnyMatcher.prototype=Object.create(CTATSingleMatcher.prototype);CTATAnyMatcher.prototype.constructor=CTATAnyMatcher;
"undefined"!==typeof module&&(module.exports=CTATAnyMatcher);var CTATExactMatcher=function(a,f){CTATSingleMatcher.call(this,a,!0);var g=this;this.toString=function(){return g.getSingle().toString()};this.matchSingle=function(a){var c=g.getSingle();ctatdebug("CTATExactMatcher --\x3e in matchSingle: s = "+a+", singleval = "+c+", caseInsensitive "+g.getCaseInsensitive()+", "+typeof g.getCaseInsensitive());return g.getCaseInsensitive()?String(a).toUpperCase()==String(c).toUpperCase():String(a)==String(c)};this.MatcherSAItoXML=function(a){return a+"<matcher>\n"+
(a+"    <matcherType>ExactMatcher</matcherType>\n")+(a+'    <matcherParameter name="single">'+g.getSingle()+"</matcherParameter>\n")+(a+"</matcher>\n")}};CTATExactMatcher.prototype=Object.create(CTATSingleMatcher.prototype);CTATExactMatcher.prototype.constructor=CTATExactMatcher;"undefined"!==typeof module&&(module.exports=CTATExactMatcher);var CTATExampleTracerException=function(a){CTATBase.call(this,"CTATExampleTracerException","");this.toString=function(){return a}};CTATExampleTracerException.prototype=Object.create(CTATBase.prototype);CTATExampleTracerException.prototype.constructor=CTATExampleTracerException;"undefined"!==typeof module&&(module.exports=CTATExampleTracerException);var CTATExpressionMatcher=function(a,f){function g(a,c,d,f,g){h.ctatdebug("CTATExpressionMatcher.testVector["+f+"]("+a+", "+c+", "+d+", "+g+") to call evaluate");var l=CTATVariableTable.standardizeType(d);h.ctatdebug("CTATExpressionMatcher.testVector typeof input "+typeof d+"; inputConv "+l+", typeof "+typeof l);d=h.evaluate(a,c,l,g);h.ctatdebug("CTATExpressionMatcher.testVector evaluate("+a+", "+c+", "+l+", "+g+") returned "+d+", type "+typeof d);g=null;switch(f){case CTATMatcher.SELECTION:g=a;break;
case CTATMatcher.ACTION:g=c;break;case CTATMatcher.INPUT:case CTATMatcher.NON_SINGLE:g=l}b=g;h.ctatdebug("CTATExpressionMatcher.testVector comparee "+g+", type "+typeof g+", relation "+e+"( "+CTATExpressionMatcher.RELATIONS[e]+" )");try{switch(e){case CTATExpressionMatcher.BOOL_RELATION:return!!d;case CTATExpressionMatcher.EQ_RELATION:if(null==g)return null==d;if(null==d)break;return h.compareNumberOrString(g,d,e);case CTATExpressionMatcher.NOT_EQ_RELATION:return null==g?null!=d:null==d?!0:h.compareNumberOrString(g,
d,e);case CTATExpressionMatcher.LT_RELATION:case CTATExpressionMatcher.GT_RELATION:if(null==g||null==d)break;return h.compareNumberOrString(g,d,e);case CTATExpressionMatcher.LTE_RELATION:case CTATExpressionMatcher.GTE_RELATION:if(null==g)return null==d;if(null!=d)return h.compareNumberOrString(g,d,e)}}catch(v){}return!1}CTATSingleMatcher.call(this,a,f);var e=CTATExpressionMatcher.EQ_RELATION,e=CTATExpressionMatcher.BOOL_RELATION,c=f,b=null,d=!1,h=this;this.getLastInput=function(){h.ctatdebug("CTATExpressionMatcher.getLastInput() returns "+
b);return b};this.isEqualRelation=function(){h.ctatdebug("CTATExpressionMatcher --\x3e in isEqualRelation");return e===CTATExpressionMatcher.EQ_RELATION};this.getEvaluatedInput=function(a,b){h.ctatdebug("CTATExpressionMatcher --\x3e in getEvaluatedInput("+a+", "+b+")");var c=CTATVariableTable.standardizeType(a.getInput());a=h.evaluate(a.getSelection(),a.getAction(),c,b);h.ctatdebug("CTATExpressionMatcher.getEvaluatedInput() returns "+a);return a};this.toString=function(){return CTATExpressionMatcher.RELATIONS[e]+
' "'+c+'"'};this.MatcherSAItoXML=function(a){var b;b=a+"<matcher>\n"+(a+"    <matcherType>ExpressionMatcher</matcherType>\n")+(a+'    <matcherParameter name="InputExpression">'+h.getInputExpression()+"</matcherParameter>\n");b+=a+'    <matcherParameter name="relation">'+CTATExpressionMatcher.RELATIONS[e]+"</matcherParameter>\n";return b+(a+"</matcher>\n")};this.matchSingle=function(a){throw new CTATExampleTracerException("UnsupportedOperationException");};this.setInputExpression=function(a){c=a};
this.setRelation=function(a){e=CTATExpressionMatcher.nameToRelation(a)};this.getRelation=function(){return CTATExpressionMatcher.RELATIONS[e]};this.interpolate=function(a,b,c,d){try{var e=new CTATVariableTable;return(new CTATFormulaParser(e)).interpolate(a,b,c,d)}catch(u){return null}};this.evaluate=function(a,b,c,d){if("undefined"==typeof d||null==d)d=new CTATVariableTable;h.ctatdebug("CTATExpressionMatcher.evaluate(..., vt="+d+") creating CTATFormulaParser");d=new CTATFormulaParser(d);h.ctatdebug("calling CTATFormulaParser.evaluate("+
h.getInputExpression()+", "+a+", "+b+", "+c+")");try{return d.evaluate(h.getInputExpression(),a,b,c)}catch(q){return h.ctatdebug("CTATExpressionMatcher --\x3e "+q.name+": "+q.message),null}};this.matchConcatenation=function(b,c,e,f){b=h.array2ConcatString(b);null===c||"undefined"===typeof c||null===e||"undefined"===typeof e?d=g(b,null,null,a,f):(c=h.array2ConcatString(c),e=h.array2ConcatString(e),d=g(b,c,e,a,f));return d};this.match=function(a,b,c,d,e){return h.matchConcatenation(a,b,c,e)};this.getInputExpression=
function(){return c};(function(){if(null!==f&&"undefined"!==typeof f){var a;a=f.indexOf('"');var b=f.lastIndexOf('"');0<=a&&0<=b?(a=f.substring(a+1,b),b=f.substring(0,f.indexOf(" ")),e=CTATExpressionMatcher.nameToRelation(b)):a=f;h.setInputExpression(a)}})()};Object.defineProperty(CTATExpressionMatcher,"EQ_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:0});Object.defineProperty(CTATExpressionMatcher,"LT_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:1});
Object.defineProperty(CTATExpressionMatcher,"GT_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:2});Object.defineProperty(CTATExpressionMatcher,"NOT_EQ_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:3});Object.defineProperty(CTATExpressionMatcher,"GTE_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:4});Object.defineProperty(CTATExpressionMatcher,"LTE_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:5});
Object.defineProperty(CTATExpressionMatcher,"BOOL_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:6});Object.defineProperty(CTATExpressionMatcher,"RELATIONS",{enumerable:!1,configurable:!1,writable:!1,value:"= < > != >= <= boolean".split(" ")});CTATExpressionMatcher.nameToRelation=function(a){for(var f=0;f<CTATExpressionMatcher.RELATIONS.length;f++)if(a==CTATExpressionMatcher.RELATIONS[f])return f;return CTATExpressionMatcher.EQ_RELATION};CTATExpressionMatcher.prototype=Object.create(CTATSingleMatcher.prototype);
CTATExpressionMatcher.prototype.constructor=CTATExpressionMatcher;CTATExpressionMatcher.prototype.setParameter=function(a,f,g){a&&f&&g&&(a=g.getNodeTextValue(a),this.ctatdebug("CTATExpressionMatcher.setParameter("+f+", "+a+")"),"InputExpression"==f?this.setInputExpression(a):"relation"==f&&this.setRelation(a))};
CTATExpressionMatcher.prototype.compareNumberOrString=function(a,f,g){a=String(a);f=String(f);var e=Number(a),c=Number(f);if(isNaN(e)||isNaN(c))switch(g){case CTATExpressionMatcher.EQ_RELATION:return a==f;case CTATExpressionMatcher.NOT_EQ_RELATION:return a!=f;case CTATExpressionMatcher.LT_RELATION:return a.toLowerCase()<f.toLowerCase();case CTATExpressionMatcher.GT_RELATION:return a.toLowerCase()>f.toLowerCase();case CTATExpressionMatcher.LTE_RELATION:return a.toLowerCase()<=f.toLowerCase();case CTATExpressionMatcher.GTE_RELATION:return a.toLowerCase()>=
f.toLowerCase();case CTATExpressionMatcher.BOOL_RELATION:return!!f;default:return!1}else switch(g){case CTATExpressionMatcher.EQ_RELATION:return e==c;case CTATExpressionMatcher.NOT_EQ_RELATION:return e!=c;case CTATExpressionMatcher.LT_RELATION:return e<c;case CTATExpressionMatcher.GT_RELATION:return e>c;case CTATExpressionMatcher.LTE_RELATION:return e<=c;case CTATExpressionMatcher.GTE_RELATION:return e>=c;case CTATExpressionMatcher.BOOL_RELATION:return!!c;default:return!1}};
"undefined"!==typeof module&&(module.exports=CTATExpressionMatcher);var CTATRangeMatcher=function(a,f){CTATSingleMatcher.call(this,a,!0);var g=this,e=0,c=0;this.toString=function(){return"[ "+e+" , "+c+" ]"};this.MatcherSAItoXML=function(a){var b;b=a+"<matcher>\n"+(a+"    <matcherType>RangeMatcher</matcherType>\n")+(a+'    <matcherParameter name="minimum">'+g.getMinimum()+"</matcherParameter>\n");b+=a+'    <matcherParameter name="maximum">'+g.getMaximum()+"</matcherParameter>\n";return b+(a+"</matcher>\n")};this.setMinimum=function(a){try{e=parseFloat(a)}catch(d){throw new CTATExampleTracerException('Number format exception while parsing minimum value "'+
a+'": '+d);}};this.getMinimum=function(){return e};this.setMaximum=function(a){try{c=parseFloat(a)}catch(d){throw new CTATExampleTracerException('Number format exception while parsing maximum value "'+a+'": '+d);}};this.getMaximum=function(){return c};this.matchSingle=function(a){var b;try{b=parseFloat(a)}catch(h){throw new CTATExampleTracerException("Number format exception while parsing .");}return e<=b&&b<=c?!0:!1}};CTATRangeMatcher.prototype=Object.create(CTATSingleMatcher.prototype);
CTATRangeMatcher.prototype.constructor=CTATRangeMatcher;CTATRangeMatcher.prototype.setParameter=function(a,f){switch((f?f:"").toString().trim().toLowerCase()){case "minimum":this.setMinimum(a);break;case "maximum":this.setMaximum(a);break;default:console.log('CTATRangeMatcher.setParameter() undefined parameter name "'+f+'"'),this.setMinimum(a),this.setMaximum(a)}};CTATRangeMatcher.prototype.match=function(a,f,g,e){return this.matchSingle(a,f,g,e)};"undefined"!==typeof module&&(module.exports=CTATRangeMatcher);var CTATRegexMatcher=function(a,f){function g(a){null!=a&&(h=a,c=null);a=(new String(h)).valueOf();CTATRegexMatcher.getMatchWholeString()?(a.startsWith("^")||(a="^"+a),a.endsWith("$")||(a+="$")):(a.startsWith("^")&&!e.startsWith("^")&&(a=a.slice(1)),a.endsWith("$")&&!e.endsWith("$")&&(a=a.slice(0,-1)));c&&h==a||(h=a,c=b.getCaseInsensitive()?new RegExp(a,"i"):new RegExp(a));return!0}CTATSingleMatcher.call(this,a,!0);var e=null,c=null,b=this,d=b.setCaseInsensitive;this.toString=function(){return e};
this.MatcherSAItoXML=function(a){return a+"<matcher>\n"+(a+"    <matcherType>RegexMatcher</matcherType>\n")+(a+'    <matcherParameter name="single">'+b.getSinglePattern()+"</matcherParameter>\n")+(a+"</matcher>\n")};var h=null;this.setSinglePattern=function(a){return"undefined"===typeof a||null==a?(console.log("CTATRegexMatcher: null or undefined pattern"),!1):g(e=String(a))};this.getSinglePattern=function(){return e};this.setCaseInsensitive=function(a){ctatdebug("CTATRegexMatcher --\x3e in setCaseInsensitive("+
a+"), typeof(parentSetCaseInsensitive) "+typeof d);d(a);null!=b.getSinglePattern()&&b.setSinglePattern(b.getSinglePattern())};this.setSingle=function(a){b.setSinglePattern(a)};this.matchSingle=function(a){return null==a?null==getSingle():g()?null!=c.exec(a):(console.log("Error: CTATRegexMatcher.matchSingle called before pattern has been set"),!1)}};CTATRegexMatcher._matchWholeString=!0;CTATRegexMatcher.getMatchWholeString=function(){return CTATRegexMatcher._matchWholeString};
CTATRegexMatcher.setMatchWholeString=function(a){CTATRegexMatcher._matchWholeString=(new Boolean(a)).valueOf()};CTATRegexMatcher.prototype=Object.create(CTATSingleMatcher.prototype);CTATRegexMatcher.prototype.constructor=CTATRegexMatcher;"undefined"!==typeof module&&(module.exports=CTATRegexMatcher);var CTATWildcardMatcher=function(a,f){function g(a){if(null==a||"undefined"===typeof a)return null;var b=(new String(a)).replace(/\?/g,"."),c=b.replace(/\*/g,".*"),f="^"+c.replace(/\[\!/g,"[^")+"$";e.ctatdebug("CTATWildcardMatcher.convertToFullRegex("+a+") after qm: "+b+"; after aster: "+c+"; after negate: "+f+";");return f}CTATRegexMatcher.call(this,a,f);var e=this;this.toString=function(){return null};this.MatcherSAItoXML=function(a){return a+"<matcher>\n"+(a+"    <matcherType>WildcardMatcher</matcherType>\n")+
(a+'    <matcherParameter name="single">'+e.getSinglePattern()+"</matcherParameter>\n")+(a+"</matcher>\n")};this.setSingle=function(a){e.simpleSinglePattern=a;e.setSinglePattern.call(e,g(a))};this.setSingle(f);this.simpleSinglePattern=f};CTATWildcardMatcher.prototype=Object.create(CTATRegexMatcher.prototype);CTATWildcardMatcher.prototype.constructor=CTATWildcardMatcher;"undefined"!==typeof module&&(module.exports=CTATWildcardMatcher);var CTATVectorMatcher=function(a,f,g,e){function c(a,c,e,f,g){l.ctatdebug("CTATVectorMatcher --\x3e in _match("+a+", "+c+", "+e+", "+f+")");if(0===b.length||0===d.length||0===h.length)b.push(new CTATExactMatcher(CTATMatcher.SELECTION,l.array2ConcatString(l.getDefaultSelectionArray()))),d.push(new CTATExactMatcher(CTATMatcher.ACTION,l.array2ConcatString(l.getDefaultActionArray()))),h.push(new CTATExactMatcher(CTATMatcher.INPUT,l.array2ConcatString(l.getDefaultInputArray())));var m=[];m[CTATMatcher.SELECTION]=
a;m[CTATMatcher.ACTION]=c;m[CTATMatcher.INPUT]=e;for(var p=0;3>p;p++){var q=n[p][0],u=q instanceof CTATExpressionMatcher?q.matchConcatenation(a,c,e,f):q.matchConcatenation(m[p]);l.ctatdebug("CTATVectorMatcher --\x3e in _match["+p+"] after "+q+".concat returns: "+u);if(g)g.push(u);else if(!1===u)return!1}if(g)for(a=0;a<g.length;++a)if(!g[a])return!1;return!0}CTATMatcher.call(this,!0,CTATMatcher.VECTOR,!0);var b=a instanceof Array?a:[],d=f instanceof Array?f:[],h=g instanceof Array?g:[],n=[];n[CTATMatcher.SELECTION]=
b;n[CTATMatcher.ACTION]=d;n[CTATMatcher.INPUT]=h;var l=this;this.match=function(a,b,d,e,f){return!1!==c(a,b,d,f)&&l.matchActor(e)?!0:!1};this.setMatcher=function(a,b){var c=Array.isArray(b)?b:[b];0<=a&&a<n.length&&c[0]instanceof CTATSingleMatcher?n[a]=c:console.error("CTATVectorMatcher.setMatcher() bad vector",a,"or matcher",b)};this.getMatchers=function(a){return n[a]};this.getTutorSAI=function(a,b,d){l.ctatdebug("CTATVectorMatcher.getTutorSAI("+a+", vt, "+d+")");if(d&&CTATExampleTracerLink.CORRECT_ACTION.toLowerCase()==
d.toLowerCase())return a;var e=[];if(c(a.getSelectionArray(),a.getActionArray(),a.getInputArray(),b,e))return d=a.clone(),a=l.evaluateReplacement(a,b,null),null!=a&&d.setInput("object"==typeof a?a.toString():a),d;d=a.clone();for(a=0;a<e.length;a++)switch(a){case CTATMatcher.SELECTION:if(e[a])continue;d.setSelection(l.getDefaultSelection());d.setSelectionArray(l.getDefaultSelectionArray());break;case CTATMatcher.ACTION:if(e[a])continue;d.setAction(l.getDefaultAction());d.setActionArray(l.getDefaultActionArray());
break;case CTATMatcher.INPUT:if(e[a])continue;d.setInput(l.getDefaultInput());d.setInputArray(l.getDefaultInputArray());break;default:console.log("CTATVectorMatcher.getTutorSAI() unexpected no. of details: "+a)}return d};this.getInputMatcher=function(){var a=h[0];return a instanceof CTATExactMatcher&&a.toString()==="".toString()?l.getDefaultInput():a.toString()};this.getActionMatcher=function(){var a=d[0];return a instanceof CTATExactMatcher&&a.toString()==="".toString()?l.getDefaultAction():a.toString()};
this.getSelectionMatcher=function(){var a=b[0];return a instanceof CTATExactMatcher&&a.toString()==="".toString()?l.getDefaultSelection():a.toString()};this.getSingleMatcher=function(a){return"selection".toString().toUpperCase()===a.toString().toUpperCase()?b[0]:"action".toString().toUpperCase()===a.toString().toUpperCase()?d[0]:h[0]};var p=l.getDefaultSAI;this.getDefaultSAI=function(){var a=p.apply(l),c=0<b.length&&b[0]instanceof CTATExactMatcher?b[0].getSingle():a.getSelection(),e=0<d.length&&d[0]instanceof
CTATExactMatcher?d[0].getSingle():a.getAction(),a=0<h.length&&h[0]instanceof CTATExactMatcher?h[0].getSingle():a.getInput();return new CTATSAI(c,e,a)};this.getSelection=function(){return 0===b.length?l.getDefaultSelection():b[0].toString()};this.getAction=function(){return 0===d.length?l.getDefaultAction():d[0].getAction()};this.setDefaultSelection=function(a){return 0===b.length?l.internalSetDefaultSelection(a):b[0].setDefaultSelection(a)};this.setDefaultAction=function(a){return 0===d.length?l.internalSetDefaultAction(a):
d[0].setDefaultAction(a)};this.setDefaultInput=function(a){return 0===h.length?l.internalSetDefaultInput(a):h[0].setDefaultInput(a)};this.getEvaluatedInput=function(a,b){if(0===h.length)return l.getInput();var c=h[0];return!1===c instanceof CTATExpressionMatcher?l.getInput():!0===c.isEqualRelation()?c.getEvaluatedInput(a,b):l.getInput()};this.matchForHint=function(a,c,d,e){ctatdebug("CTATVectorMatcher.matchForHint("+a+", "+c+", "+d+", vt)");if(!l.matchActor(d))return!1;c=b[0];return Array.isArray(a)?
c.matchConcatenation(a,l.getDefaultActionArray(),l.getDefaultInputArray(),e):c.matchConcatenation([a],l.getDefaultActionArray(),l.getDefaultInputArray(),e)};this.setCaseInsensitive=function(a){ctatdebug("CTATVectorMatcher.setCaseInsensitive("+a+")");for(var b=0;b<n.length;++b)if(Array.isArray(n[b]))for(var c=0;c<n[b].length;++c)n[b][c].setCaseInsensitive(a);else n[b]instanceof CTATMatcher&&n[b].setCaseInsensitive(a)};this.toString=function(){return"this is CTATVectorMatcher"};this.getReplacementFormula=
function(){var a=h[0];return null===a||"undefined"===typeof a?null:a.getReplacementFormula()};this.evaluateReplacement=function(a,b,c){return h[0].evaluateReplacement(a,b,c)};this.setActor(e)};CTATVectorMatcher.prototype=Object.create(CTATMatcher.prototype);CTATVectorMatcher.prototype.constructor=CTATVectorMatcher;"undefined"!==typeof module&&(module.exports=CTATVectorMatcher);var CTATExampleTracerNodeVisualData=function(){CTATBase.call(this,"ExampleTracerNodeVisualData","visualdata");var a="****",f="undefined",g=-1,e=-1,c=null;this.setID=function(b){a=b};this.getID=function(){return a};this.setLabel=function(a){f=a};this.getLabel=function(){return f};this.setX=function(a){g=a};this.getX=function(){return g};this.setY=function(a){e=a};this.getY=function(){return e};this.setVizReference=function(a){c=a};this.getVizReference=function(){return c}};
CTATExampleTracerNodeVisualData.prototype=Object.create(CTATBase.prototype);CTATExampleTracerNodeVisualData.prototype.constructor=CTATExampleTracerNodeVisualData;"undefined"!==typeof module&&(module.exports=CTATExampleTracerNodeVisualData);var CTATExampleTracerNode=function(a,f){CTATBase.call(this,"CTATExampleTracerNode",a);var g=null,e={x:1,y:1},c="",b=f?f:new Set,d=new Set;b.forEach(function(a,b,c){b.isCorrect()&&d.add(b)});var h=new Set,n=!1,l=this;this.toString=function(){return"node"+a};this.toXML=function(a){var b=a+'<node locked="'+this.getLocked()+'" doneState="'+this.IsDoneState()+'">\n',b=b+(a+"    <text>"+this.getNodeName()+"</text>\n"),b=b+(a+"    <uniqueID>"+this.getNodeID()+"</uniqueID>\n"),c=this.getDimension(),d=a+"    ",
e;e=d+"<dimension>\n"+(d+"    <x>"+c.x+"</x>\n");e+=d+"    <y>"+c.y+"</y>\n";return b+(e+(d+"</dimension>")+"\n")+(a+"</node>")};this.getNodeID=function(){return a};this.getLocked=function(){return!1};this.IsDoneState=function(){return this.getNodeName().startsWith("Done")?!0:n};this.setDoneState=function(a){n=a};this.getDimension=function(){return e};this.setDimension=function(a){e=a};this.getNodeName=function(){return c};this.setNodeName=function(a){l.ctatdebug("CTATExampleTracerGraph --\x3e in setNodeName("+
a+")");c=a};this.getOutLinks=function(){ctatdebug("CTATExampleTracerNode --\x3e getOutLinks");return b};this.getCorrectOutLinks=function(){return d};this.addOutLink=function(a,c){ctatdebug("CTATExampleTracerNode --\x3e addOutLink( "+a+" )");b.add(a);a.isCorrect()&&(d.add(a),!1!==c&&a.setIsPreferredLink(1==d.size))};this.deleteOutLink=function(a,c){ctatdebug("CTATExampleTracerNode --\x3e deleteOutLink( "+a+" )");b.delete(a);a.isCorrect()&&(d.delete(a),!1!==c&&a.getIsPreferredLink()&&0<d.size&&d.values().next().value.setIsPreferredLink(!0))};
this.clearInLinks=function(){h=new Set};this.addInLink=function(a){h.add(a)};this.deleteInLink=function(a){h.delete(a)};this.getInLinks=function(){return h};this.getOutDegree=function(){return b.size};this.getCorrectOutDegree=function(){return d.size};this.getTraversableOutDegree=function(){var a=0;b.forEach(function(b){return b.isTraversable()&&++a});return a};this.setVisualData=function(a){g=a};this.getVisualData=function(){return g}};CTATExampleTracerNode.prototype=Object.create(CTATBase.prototype);
CTATExampleTracerNode.prototype.constructor=CTATExampleTracerNode;"undefined"!==typeof module&&(module.exports=CTATExampleTracerNode);var CTATExampleTracerLinkVisualData=function(){CTATBase.call(this,"CTATExampleTracerLinkVisualData","visualdata");var a="****",f="undefined",g="****",e="****";this.setID=function(c){a=c};this.getID=function(){return a};this.setLabel=function(a){f=a};this.getLabel=function(){return f};this.setSource=function(a){g=a};this.getSource=function(){return g};this.setDestination=function(a){e=a};this.getDestination=function(){return e}};CTATExampleTracerLinkVisualData.prototype=Object.create(CTATBase.prototype);
CTATExampleTracerLinkVisualData.prototype.constructor=CTATExampleTracerLinkVisualData;"undefined"!==typeof module&&(module.exports=CTATExampleTracerLinkVisualData);var CTATExampleTracerLink=function(a,f,g){CTATBase.call(this,"CTATExampleTracerLink","("+f+"-"+g+")");var e="undefined"===typeof a||null===a?null:a,c=null,b="",d="",h="undefined"===typeof f||null===f?null:f,n="undefined"===typeof g||null===g?null:g,l=null,p=1,m=1,q=CTATExampleTracerLink.CORRECT_ACTION,u=[],v=!1,w=[],B=[],C=m.toString(),F=p.toString(),G=null,H=null,E=this;this.getUniqueID=function(){return e};this.getMatcher=function(){E.ctatdebug("CTATExampleTracerLink --\x3e in getMatcher");return l};
this.isCorrect=function(){return q==CTATExampleTracerLink.CORRECT_ACTION};this.matchesSAI=function(a,b,c){var d=E.getMatcher();E.ctatdebug("CTATExampleTracerLink --\x3e in matchesSAI(); matcher "+d+", typeof "+typeof d+", sai "+a);a=d.match(a.getSelectionArray(),a.getActionArray(),a.getInputArray(),b,c);E.ctatdebug("CTATExampleTracerLink --\x3e out of matchesSAI: result = "+a);return a};this.matchesSAIforHint=function(a,b,c,d){E.ctatdebug("CTATExampleTracerLink --\x3e in matchesSAIforHint("+a+", "+
b+") selectionArray "+a.getSelectionArray());if(!1===E.getMatcher().matchForHint(a.getSelectionArray(),a.getActionArray(),b,d))return E.ctatdebug("CTATExampleTracerLink --\x3e matchesSAIforHint() returning false because no match"),!1;if(null!==c&&"undefined"!==typeof c&&!0===c.getWantReportableHints()&&(a=null===E.getAllHints()||"undefined"===typeof E.getAllHints()?0:E.getAllHints().length,1>a))return E.ctatdebug("CTATExampleTracerLink --\x3e matchesSAIforHint() returning false nStaticHints "+a+"< 1"),
!1;E.ctatdebug("CTATExampleTracerLink --\x3e matchesSAIforHint() returning true");return!0};this.getDepth=function(){return c};this.getBuggyMsg=function(a){null==a&&(a=0);return B[a]||""};this.getBuggyMsgs=function(){return B||[]};this.getSuccessMsg=function(a){null==a&&(a=0);return w[a]||""};this.getSuccessMsgs=function(){return w||[]};this.getType=function(){return q};this.getPrevNode=function(){return h};this.getNextNode=function(){return n};this.setPrevNode=function(a){h=a};this.setNextNode=function(a){n=
a};this.toString=function(){var a;a="[link "+E.getUniqueID();a+=" ("+E.getPrevNode()+"-"+E.getNextNode();a+=") "+E.getType();return a+"]"};this.toXML=function(a){var b;b=a+"    ";var c=b+'<actionLabel preferPathMark="'+E.getIsPreferredLink()+'" minTraversals="'+E.getMinTraversalsStr()+'" maxTraversals="'+E.getMaxTraversalsStr()+'">\n',c=c+(b+"    <studentHintRequest></studentHintRequest>\n")+(b+"    <stepSuccessfulCompletion></stepSuccessfulCompletion>\n")+(b+"    <stepStudentError></stepStudentError>\n")+
(b+"    <uniqueID>"+E.getUniqueID()+"</uniqueID>\n"),d=b+"    ",e="";E.getDemoMsgObj()&&(e+=d+E.getDemoMsgObj().getXMLString(!0)+"\n");c+=e;for(d=0;d<B.length;d++)c+=b+"    <buggyMessage><![CDATA["+E.getBuggyMsg(d)+"]]\x3e</buggyMessage>\n";for(d=0;d<w.length;d++)c+=b+"    <successMessage><![CDATA["+E.getSuccessMsg(d)+"]]\x3e</successMessage>\n";1>w.length&&(c+=b+"    <successMessage></successMessage>\n");d=E.getAllHints();for(e=0;e<d.length;e++)c+=b+"    <hintMessage><![CDATA["+d[e]+"]]\x3e</hintMessage>\n";
var c=c+(b+"    <callbackFn></callbackFn>\n")+(b+"    <actionType>"+E.getActionType()+"</actionType>\n"),c=c+(b+"    <oldActionType>Correct Action</oldActionType>\n")+(b+"    <checkedStatus>Never Checked</checkedStatus>\n"),d=b+"    ",f=E.getMatcher().getMatchers(0)[0],e=E.getMatcher().getMatchers(1)[0],g=E.getMatcher().getMatchers(2)[0],f=d+'<matchers Concatenation="true">\n'+(d+"    <Selection>\n")+f.MatcherSAItoXML(d+"        "),f=f+(d+"    </Selection>\n")+(d+"    <Action>\n")+e.MatcherSAItoXML(d+
"        "),f=f+(d+"    </Action>\n")+(d+"    <Input>\n")+g.MatcherSAItoXML(d+"        "),f=f+(d+"    </Input>\n")+(d+'    <Actor linkTriggered="false">'+E.getMatcher().getActor()+"</Actor>\n");b=a+"<edge>\n"+(c+(f+(d+"</matchers>\n"))+(b+"</actionLabel>\n"));b+=a+"    <preCheckedStatus>No-Applicable</preCheckedStatus>\n";c=this.getSkillNames();d=a+"    ";e="";if(0<c.length)for(g=0;g<c.length;g++)e+=d+"<rule>\n",e+=d+"    <text>"+c[g]+"</text>\n",e+=d+"    <indicator>-1</indicator>\n",e+=d+"</rule>\n";
else e=e+(d+"<rule>\n")+(d+"    <text>unnamed</text>\n")+(d+"    <indicator>-1</indicator>\n")+(d+"</rule>\n");b=b+e+(a+"    <sourceID>"+this.getPrevNode()+"</sourceID>\n");b+=a+"    <destID>"+this.getNextNode()+"</destID>\n";return b+(a+"    <traversalCount>0</traversalCount>\n")+(a+"</edge>")};this.getDemoMsgObj=function(){return b};this.setDemoMsgObj=function(a){b=a};this.getTransactionID=function(){return d};this.setTransactionID=function(a){d=a};this.getXMLString=function(a){if(messageObj.xml)return messageObj.xml;
if(XMLSerializer)return(new XMLSerializer).serializeToString(messageObj);alert("ERROR: Extremely old browser");return""};this.getTutorSAI=function(a,b){return E.getMatcher().getTutorSAI(a,b,E.getActionType())};this.getEvaluatedInput=function(a,b){return E.getMatcher().getEvaluatedInput(a,b)};this.setDepth=function(a){c=a};this.getMaxTraversals=function(){return p};this.getMaxTraversalsStr=function(){return F};this.isDone=function(){var a=String(E.getDefaultSAI().getSelection()).toLowerCase(),b=String(E.getDefaultSAI().getAction()).toLowerCase(),
a=CTATMsgType.DONE.toLowerCase()==a&&CTATMsgType.BUTTON_PRESSED.toLowerCase()==b;E.ctatdebug("CTATExampleTracerLink.isDone() returns "+a);return a};this.interpolateHints=function(a){E.ctatdebug("CTATExampleTracerLink --\x3e interpolateHints("+a+")");var b=[];if(null===u||"undefined"===typeof u||0===u.length)return b;null==a&&(a=new CTATVariableTable);var c=new CTATFormulaParser(a);u.forEach(function(a){if(!(1>String(a).trim().length)){var d=E.getDefaultSAI().getSelection(),e=E.getDefaultSAI().getAction(),
f=CTATVariableTable.standardizeType(E.getDefaultSAI().getInput());E.ctatdebug("CTATExampleTracerLink.interpolateHints() calling fp.interpolate("+a+", "+d+", "+e+", "+f+")");a=c.interpolate(a,d,e,f);E.ctatdebug("CTATExampleTracerLink.interpolateHints() calling fp.interpolate() returns "+a);b.push(a)}});E.ctatdebug("CTATExampleTracerLink --\x3e out of interpolateHints "+b);return b};this.getHints=function(){E.ctatdebug("CTATExampleTracerLink --\x3e in getHints");var a=[];E.interpolateHints(null).forEach(function(b){E.ctatdebug("CTATExampleTracerLink --\x3e in getHints loop");
b.toString()!=="".toString()&&a.push(b)});E.ctatdebug("CTATExampleTracerLink --\x3e out of getHints");return a};this.getAllNonEmptyHints=function(){var a=[];u.forEach(function(b){b.trim().toString()!=="".toString()&&a.push(b)});return a};this.isTraversable=function(){return 1>E.getMaxTraversals()?!1:CTATExampleTracerLink.CORRECT_ACTION.toString().toUpperCase()==E.getActionType().toString().toUpperCase()||CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString().toUpperCase()==E.getActionType().toString().toUpperCase()?
!0:!1};this.replaceInput=function(){return CTATExampleTracerLink.CORRECT_ACTION.toString().toUpperCase()!==E.getActionType().toString().toUpperCase()&&CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString().toUpperCase()!==E.getActionType().toString().toUpperCase()?!1:E.getMatcher().replaceInput()};this.evaluateReplacement=function(a,b,c){return E.getMatcher().evaluateReplacement(a,b,c)};this.getActor=function(){return E.getMatcher().getActor()};this.getDefaultSAI=function(){E.ctatdebug(E.toString()+
".getSAI(): "+(l?l.getDefaultSAI():"(matcher null)"));return l.getDefaultSAI()};this.getActionType=function(){return q};this.getMinTraversals=function(){return m};this.getMinTraversalsStr=function(){return C};this.getIsPreferredLink=function(){return v};this.getAllHints=function(){return u};this.setMatcher=function(a){l=a};this.setHints=function(a){Array.isArray(a)&&(u=a.map(function(a){return String(a)}))};this.addHint=function(a){null!==a&&"undefined"!==typeof a&&a.toString()!=="".toString()&&u.push(a)};
this.setSelection=function(a){E.getMatcher().setDefaultSelection(null===a[0]||"undefined"===typeof a[0]?"":a[0].toString())};this.setAction=function(a){E.getMatcher().setDefaultAction(null===a[0]||"undefined"===typeof a[0]?"":a[0].toString())};this.setActionType=function(a){if(null===a||"undefined"===typeof a||a.toString()!==CTATExampleTracerLink.CORRECT_ACTION.toString()&&a.toString()!==CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()&&a.toString()!==CTATExampleTracerLink.BUGGY_ACTION.toString()&&
a.toString()!==CTATExampleTracerLink.HINT_ACTION.toString()&&a.toString()!==CTATExampleTracerLink.UNTRACEABLE_ERROR.toString()&&a.toString()!==CTATExampleTracerLink.CLT_ERROR_ACTION.toString()&&a.toString()!==CTATExampleTracerLink.GIVEN_ACTION.toString())throw new CTATExampleTracerException("invalid action type "+q);q=a};this.setBuggyMsg=function(a){B=a instanceof Array?a:[String(a)]};this.addBuggyMsg=function(a){(a=String(a))&&B.push(a)};this.setSuccessMsg=function(a){w=a instanceof Array?a:[String(a)]};
this.addSuccessMsg=function(a){(a=String(a))&&w.push(a)};this.setMinTraversalsStr=function(a){if(null===a||"undefined"===typeof a||1>a.length)C="1",m=1;else try{C=a,m=parseInt(a.trim()),isNaN(m)&&(m=1)}catch(K){m=1}};this.setMaxTraversalsStr=function(a){if(null===a||"undefined"===typeof a||1>a.length)F=C,p=m;else try{F=a,p=parseInt(a.trim()),isNaN(p)&&(p=1)}catch(K){p=m}};this.setUniqueID=function(a){e=a};this.addSkillName=function(a){E.ctatdebug("ETLink["+e+"].addSkillName("+a+")");if("unnamed"!==
a){if(null===H||"undefined"===typeof H)H=[];-1<H.indexOf(a)||(H.push(a),E.ctatdebug("ETLink.addSkillName() return with skillNames "+H))}};this.getSkillNames=function(){if(null===H||"undefined"===typeof H)H=[];return H};this.isTutorPerformed=function(a){if(CTATExampleTracerLink.CORRECT_ACTION.toUpperCase()!==E.getActionType().toUpperCase())return!1;var b=E.getMatcher();if(null===b||"undefined"===typeof b||null!==a&&"undefined"!==typeof a&&a!==b.isLinkTriggered())return!1;a=E.getActor();return CTATMatcher.isTutorActor(a,
!0)?!0:!1};this.setIsPreferredLink=function(a){E.ctatdebug("ETLink.setIsPreferredLink() was "+v+", now "+a);v=a};this.setVisualData=function(a){G=a};this.getVisualData=function(){return G}};
CTATExampleTracerLink.compareLinkTypes=function(a,f){ctatdebug("CTATExampleTracerLink --\x3e in compareLinkTypes("+a+", "+f+")");return null===a||"undefined"===typeof a?null===f||"undefined"===typeof f?0:1:null===f||"undefined"===typeof f?-1:a.toString()===f.toString()?0:a.toString()===CTATExampleTracerLink.CORRECT_ACTION.toString()?-1:f.toString()===CTATExampleTracerLink.CORRECT_ACTION.toString()?1:a.toString()===CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()?-1:f.toString()===CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()?
1:a.toString()===CTATExampleTracerLink.BUGGY_ACTION.toString()?-1:f.toString()===CTATExampleTracerLink.BUGGY_ACTION.toString()?1:0};Object.defineProperty(CTATExampleTracerLink,"BUGGY_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Buggy Action"});Object.defineProperty(CTATExampleTracerLink,"FIREABLE_BUGGY_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Fireable Buggy Action"});
Object.defineProperty(CTATExampleTracerLink,"CORRECT_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Correct Action"});Object.defineProperty(CTATExampleTracerLink,"NO_MODEL",{enumerable:!1,configurable:!1,writable:!1,value:"NO-MODEL"});Object.defineProperty(CTATExampleTracerLink,"HINT_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Hint Action"});Object.defineProperty(CTATExampleTracerLink,"UNTRACEABLE_ERROR",{enumerable:!1,configurable:!1,writable:!1,value:"Untraceable Error"});
Object.defineProperty(CTATExampleTracerLink,"CLT_ERROR_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Error Action"});Object.defineProperty(CTATExampleTracerLink,"GIVEN_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Given Action"});Object.defineProperty(CTATExampleTracerLink,"SUCCESS",{enumerable:!1,configurable:!1,writable:!1,value:"SUCCESS"});
CTATExampleTracerLink.createDefaultHint=function(a,f,g){a=CTATGlobals.languageManager;f=String(f);g=g&&"function"==typeof g.toString?g.toString():String(g);return/UpdateText/i.test(f)?a.getString("DEFAULT_HINT_PREFIX_TEXT")+g+a.getString("DEFAULT_HINT_SUFFIX_TEXT"):/Combo/i.test(f)?a.getString("DEFAULT_HINT_PREFIX_SELECT")+g+a.getString("DEFAULT_HINT_SUFFIX_SELECT"):/Button/i.test(f)?a.getString("DEFAULT_HINT_BUTTON"):a.getString("DEFAULT_HINT_PREFIX")+g+a.getString("DEFAULT_HINT_SUFFIX")};
CTATExampleTracerLink.prototype=Object.create(CTATBase.prototype);CTATExampleTracerLink.prototype.constructor=CTATExampleTracerLink;"undefined"!==typeof module&&(module.exports=CTATExampleTracerLink);var CTATExampleTracerPathComparator=function(){CTATBase.call(this,"CTATExampleTracerPathComparator","");var a=this;this.compare=function(f,g){a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare");a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.isDonePath(): "+f.isDonePath());a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p2.isDonePath(): "+g.isDonePath());if(!0===f.isDonePath()&&!1===g.isDonePath())return-1;if(!0===g.isDonePath()&&!1===f.isDonePath())return 1;
a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p2.isIncorrectPath(): "+g.isIncorrectPath());a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.isIncorrectPath()(): "+f.isIncorrectPath());if(!0===g.isIncorrectPath()&&!1===f.isIncorrectPath())return-1;if(!0===f.isIncorrectPath()&&!1===g.isIncorrectPath())return 1;a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.getNumberOfPreferredPrefixLinks(): "+f.getNumberOfPreferredPrefixLinks());a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p2.getNumberOfPreferredPrefixLinks(): "+
g.getNumberOfPreferredPrefixLinks());var e=f.getNumberOfPreferredPrefixLinks(),c=g.getNumberOfPreferredPrefixLinks();if(e>c)return-1;if(e<c)return 1;a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.getNumberOfSuboptimalLinks(): "+f.getNumberOfSuboptimalLinks());a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p2.getNumberOfSuboptimalLinks(): "+g.getNumberOfSuboptimalLinks());e=f.getNumberOfSuboptimalLinks();c=g.getNumberOfSuboptimalLinks();if(e<c)return-1;if(e>c)return 1;
a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.getNumberOfPreferredLinks(): "+f.getNumberOfPreferredLinks());a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p2.getNumberOfPreferredLinks(): "+g.getNumberOfPreferredLinks());e=f.getNumberOfPreferredLinks();c=g.getNumberOfPreferredLinks();if(e>c)return-1;if(e<c)return 1;e=f.getLinks().size;c=g.getLinks().size;a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.getLinks().size: "+e);a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.getLinks().size: "+
c);if(e<c)return-1;if(e>c)return 1;a.ctatdebug("CTATExampleTracerPathComparator --\x3e out of comapre, about to call breakByLowerLinkID");return a.breakByLowerLinkID(f,g)};this.breakByLowerLinkID=function(f,g){a.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID");f=f.getSortedLinks();g=g.getSortedLinks();var e=null,c=null,b=0,d=0;do a.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID in do while"),d>=f.length?(a.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID path 1 is shorter"),
b=-1):d>=g.length?(a.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID path 2 is shorter"),b=1):(a.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID path are same, compare IDS"),e=f[d],c=g[d]),d++;while(0===b&&e.getUniqueID()===c.getUniqueID());0===b&&(a.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID result is zero: "+e.getUniqueID()),a.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID result is zero: "+c.getUniqueID()),
b=e.getUniqueID()<c.getUniqueID()?-1:1);return b}};CTATExampleTracerPathComparator.prototype=Object.create(CTATBase.prototype);CTATExampleTracerPathComparator.prototype.constructor=CTATExampleTracerPathComparator;"undefined"!==typeof module&&(module.exports=CTATExampleTracerPathComparator);var CTATExampleTracerPath=function(a){CTATBase.call(this,"CTATExampleTracerPath","");var f=new Set;"undefined"!==typeof a&&null!==a&&a.forEach(function(a){ctatdebug("CTATExampleTracerPath --\x3e in constructor building links with "+a);f.add(a)});var g=null,e=null,c=null,b=null,d=null,h=null,n=this;this.isIncorrectPath=function(){ctatdebug("CTATExampleTracerPath --\x3e in isIncorrectPath");if(null!==h&&"undefined"!==typeof h)return h;var a=!1;n.getLinks().forEach(function(b){!0!==a&&b.getType().toString()===
CTATExampleTracerLink.BUGGY_ACTION.toString()&&(a=h=!0)});if(!0===a)return!0;h=!1;ctatdebug("CTATExampleTracerPath --\x3e out of isIncorrectPath");return!1};this.getNumberOfSuboptimalLinks=function(){ctatdebug("CTATExampleTracerPath --\x3e in getNumberOfSuboptimalLinks");n.getSortedLinks();if(null!==b&&"undefined"!==typeof b)return b;var a=0;n.getLinks().forEach(function(b){CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()===b.getType().toString()&&a++});b=a;ctatdebug("CTATExampleTracerPath --\x3e out of getNumberOfSuboptimalLinks");
return a};this.getNumberOfPreferredPrefixLinks=function(){ctatdebug("CTATExampleTracerPath --\x3e in getNumberOfPreferredPrefixLinks");if(null!==e&&"undefined"!==typeof e)return e;var a=0,b=!1;n.getSortedLinks().forEach(function(c){!0!==b&&(!0===c.getIsPreferredLink()?a++:b=!0)});e=a;ctatdebug("CTATExampleTracerPath --\x3e out of getNumberOfPreferredPrefixLinks");return a};this.size=function(){return f.size};this.containsAll=function(a){var b=!0;if(a)for(var c=0;b&&c<a.length;++c)b=n.getLinks().has(a[c]);
n.ctatdebug("CTATExampleTracerPath containsAll(testLinks.length "+a.length+") returning "+b);return b};this.getLinksRestricted=function(a){ctatdebug("CTATExampleTracerPath --\x3e in getLinksRestricted");var b=CTATExampleTracerPath.getDeepestLink(a),c=new Set;f.forEach(function(a){a.getDepth()<=b.getDepth()&&c.add(a)});ctatdebug("CTATExampleTracerPath --\x3e out of getLinksRestricted");return c};this.getLinks=function(){ctatdebug("CTATExampleTracerPath --\x3e in getLinks");return f};this.getSortedLinks=
function(){ctatdebug("CTATExampleTracerPath --\x3e in getSortedLinks that.getLinks(): "+n.getLinks());g=[];n.getLinks().forEach(function(a){g.push(a)});ctatdebug("CTATExampleTracerPath --\x3e in getSortedLinks sortedLinks.length(): "+g.length);g.sort(function(a,b){return a.getDepth()-b.getDepth()});ctatdebug("CTATExampleTracerPath --\x3e out of getSortedLinks, returning "+g);return g};this.isDonePath=function(){ctatdebug("CTATExampleTracerPath --\x3e in isDonePath");if(null!==d&&"undefined"!==typeof d)return d;
var a=!1;n.getLinks().forEach(function(b){!0!==a&&!0===b.isDone()&&(a=d=!0)});if(!0===a)return!0;d=!1;ctatdebug("CTATExampleTracerPath --\x3e out of isDonePath");return!1};this.addLink=function(a){ctatdebug("CTATExampleTracerPath --\x3e in addLink ("+a+")");f.add(a);h=d=b=c=e=g=null;ctatdebug("CTATExampleTracerPath --\x3e out of addLink")};this.getNumberOfPreferredLinks=function(){ctatdebug("CTATExampleTracerPath --\x3e in getNumberOfPreferredLinks");if(null!==c&&"undefined"!==typeof c)return c;var a=
0;n.getLinks().forEach(function(b){!0===b.getIsPreferredLink()&&a++});c=a;ctatdebug("CTATExampleTracerPath --\x3e out of getNumberOfPreferredLinks");return a};this.subpath=function(a){for(var b=new CTATExampleTracerPath,c=n.getSortedLinks(),d=0;d<c.length;++d)if(b.addLink(c[d]),c[d].getNextNode()==a.getNodeID())return b;return null};this.toString=function(){var a="CTATExampleTracerPath: links";n.getSortedLinks().forEach(function(b){a+=" "+b});return a};CTATExampleTracerPath.getDeepestLink=function(a){ctatdebug("CTATExampleTracerPath --\x3e in getDeepestLink");
var b=null;a.forEach(function(a){if(null===b||"undefined"===typeof b||b.getDepth()<a.getDepth())b=a});ctatdebug("CTATExampleTracerPath --\x3e out of getDeepestLink");return b};CTATExampleTracerPath.getBestPath=function(a){ctatdebug("CTATExampleTracerPath --\x3e in getBestPath");var b=null,c=new CTATExampleTracerPathComparator;a.forEach(function(a){ctatdebug("CTATExampleTracerPath --\x3e in getBestPath loop");if(null===b||"undefined"===typeof b||0<c.compare(b,a))b=a});ctatdebug("CTATExampleTracerPath --\x3e out of getBestPath");
return b}};CTATExampleTracerPath.prototype=Object.create(CTATBase.prototype);CTATExampleTracerPath.prototype.constructor=CTATExampleTracerPath;"undefined"!==typeof module&&(module.exports=CTATExampleTracerPath);var CTATLinkGroup=function(){CTATBase.call(this,"CTATLinkGroup","")};CTATLinkGroup.prototype=Object.create(CTATBase.prototype);CTATLinkGroup.prototype.constructor=CTATLinkGroup;"undefined"!==typeof module&&(module.exports=CTATLinkGroup);var CTATDefaultLinkGroup=function(a,f,g,e){CTATLinkGroup.call(this,"CTATDefaultLinkGroup",a);var c=a,b=f,d=g,h=new Set;null!==e&&"undefined"!==typeof e&&e.forEach(function(a){h.add(a)});var n=new Set,l=null,p=null,m=this;m.ctatdebug("CTATDefaultLinkGroup constructor group name: "+a);m.ctatdebug("CTATDefaultLinkGroup constructor group isOrdered: "+f);m.ctatdebug("CTATDefaultLinkGroup constructor group isReenterable: "+g);this.toXML=function(a,b){var c=a+'<group name="'+m.getName(),c=c+('" ordered="'+
m.getIsOrdered()),c=c+('" reenterable="'+m.getIsReenterable()+'">\n');b.getUniqueLinks(m).forEach(function(b){c+=a+'    <link id="'+b.getUniqueID()+'"/>\n'});n.forEach(function(d){c+=d.toXML(a+"    ",b)});return c+=a+"</group>\n"};this.setOrdered=function(a){m.ctatdebug("CTATDefaultLinkGroup --\x3e in setOrdered group name: "+c);m.ctatdebug("CTATDefaultLinkGroup --\x3e in setOrdered:: "+a);b=a};this.setName=function(a){m.ctatdebug("CTATDefaultLinkGroup --\x3e in setName: "+a);c=a};this.containsLink=
function(a){m.ctatdebug("CTATDefaultLinkGroup --\x3e in containsLink: "+a.getUniqueID());return h.has(a)};this.removeLink=function(a){m.ctatdebug("CTATDefaultLinkGroup --\x3e in removeLink: "+a.getUniqueID());return h.delete(a)};this.removeSubgroup=function(a){m.ctatdebug("CTATDefaultLinkGroup.removeSubgroup: "+(grp&&grp.getName()));return n.delete(a)};this.getParent=function(){m.ctatdebug("CTATDefaultLinkGroup --\x3e in getParent");return l};this.addLink=function(a){m.ctatdebug("CTATDefaultLinkGroup --\x3e in addLink: "+
a.getUniqueID());h.add(a)};this.getIsOrdered=function(){m.ctatdebug("CTATDefaultLinkGroup --\x3e in getIsOrdered: "+b);return b};this.getIsReenterable=function(){m.ctatdebug("CTATDefaultLinkGroup --\x3e in getIsReenterable: "+d);return d};this.getSubgroups=function(){m.ctatdebug("CTATDefaultLinkGroup --\x3e in getSubgroups");return n};this.setSubgroups=function(a){n=a};this.getLinks=function(){m.ctatdebug("CTATDefaultLinkGroup --\x3e in getLinks");return h};this.setReenterable=function(a){m.ctatdebug("CTATDefaultLinkGroup --\x3e in setReenterable: "+
a);d=a};this.setParent=function(a){m.ctatdebug("CTATDefaultLinkGroup --\x3e in setParent: "+a.getName());l=a};this.addSubgroup=function(a){m.ctatdebug("CTATDefaultLinkGroup --\x3e in addSubgroup groupName: "+a.getName());n.add(a)};this.getName=function(){return c};this.getDefaultBuggyMsg=function(){return p};this.setDefaultBuggyMsg=function(a){p=""==a?null:a};this.toString=function(){return"Group Name: "+this.getName()}};CTATDefaultLinkGroup.prototype=Object.create(CTATLinkGroup.prototype);
CTATDefaultLinkGroup.prototype.constructor=CTATDefaultLinkGroup;"undefined"!==typeof module&&(module.exports=CTATDefaultLinkGroup);var InternalGroupIterator=function(a,f){CTATBase.call(this,"InternalGroupIterator",a);var g=this,e=f.length,c=[],b=0;a.getSubgroups().forEach(function(a){a&&c.push(a)});f.push(g);g.ctatdebug("InternalGroupIterator() constructor group "+a+", stack.length "+f.length+", sgList.length "+c.length);this.toString=function(){return"{"+a+" at "+e+" with "+c.length+" subgroups}"};this.next=function(){return b>=c.length?(f.pop(),g.ctatdebug("InternalGroupIterator at deepest next() returning "+a+" with stack.length "+
f.length),{value:a,done:!1}):(new InternalGroupIterator(c[b++],f)).next()}};InternalGroupIterator.prototype=Object.create(CTATBase.prototype);InternalGroupIterator.prototype.constructor=InternalGroupIterator;var CTATGroupIterator=function(a){CTATBase.call(this,"CTATGroupIterator",a);this.ctatdebug("CTATGroupIterator("+a+") begin constructor");var f=null;this.next=function(){null===f&&(f=[],new InternalGroupIterator(a,f));return 0>=f.length?{value:null,done:!0}:f[f.length-1].next()}};
CTATGroupIterator.prototype=Object.create(CTATBase.prototype);CTATGroupIterator.prototype.constructor=CTATGroupIterator;"undefined"!==typeof module&&(module.exports=CTATGroupIterator);var CTATGroupModel=function(){CTATBase.call(this,"CTATGroupModel","");var a=this;this.clear=function(){};this.setDefaultReenterable=function(a){};this.setGroupOrdered=function(a,g){};this.getTopLevelGroup=function(){};this.setGroupName=function(a,g){};this.addLinkToGroup=function(a,g){};this.isGroupOrdered=function(a){};this.isGroupReenterable=function(a){};this.isLinkInGroup=function(){};this.getGroupsContainingLink=function(a){};this.getGroupLinkCount=function(f){return a.getGroupLinks(f).size};
this.getLowestLevelGroupOfLink=function(a){};this.getGroupSubgroups=function(a){};this.getUniqueLinks=function(a){};this.getGroupLinks=function(a){};this.removeLinkFromGroup=function(a,g){};this.getGroupParent=function(a){};this.addGroup=function(a,g,e){};this.setGroupReenterable=function(a,g){}};CTATGroupModel.prototype=Object.create(CTATBase.prototype);CTATGroupModel.prototype.constructor=CTATGroupModel;"undefined"!==typeof module&&(module.exports=CTATGroupModel);var CTATDefaultGroupModel=function(){function a(b,d){var e=b.containsLink(d);m.ctatdebug("removeLinkUpdateGroups(G="+group.getName()+",L="+d.getUniqueID()+") hasLink "+e);if(e){var h=[];m.getGroupSubgroups(b).forEach(function(b){a(b,d);1>b.getLinks().size&&h.push(b)});h.forEach(function(a){return g(a)});c(b,d)||console.log("removeLinkUpdateGroups(G="+b.getName()+",L="+d.getUniqueID()+") link not found on delete");1>b.getLinks().size&&f(b)}}function f(a){a=new GroupIterator(group);var b=[];for(a.next();a.hasNext();)b.add(a.next());
group.removeAllSubGroups()}function g(a){var b=a.getParent();b&&((new Set(a.getSubgroups())).forEach(function(a){return n(b,a)}),b.removeSubgroup(a))}function e(a,b,d){m.ctatdebug("CTATDefaultGroupModel --\x3e in internalRemoveLinkFromGroupRecursive");!0===a.containsLink(b)&&(m.getGroupSubgroups(a).forEach(function(a){m.removeLinkFromGroup(a,b)}),(a!==l||d)&&c(a,b))}function c(a,b){m.ctatdebug("CTATDefaultGroupModel --\x3e in internalRemoveLinkFromGroup");return a.removeLink(b)}function b(a,c){m.ctatdebug("CTATDefaultGroupModel --\x3e in getImmediateGroupOfLink");
var d=null,e=!1,f=null;m.getGroupSubgroups(c).forEach(function(c){!0!==e&&!0===m.isLinkInGroup(c,a)&&(d=b(a,c),f=null!==d&&"undefined"!==typeof d?d:c,e=!0)});return!0===e?f:null}function d(a,b){m.ctatdebug("CTATDefaultGroupModel --\x3e in getNaturalContainingGroup");if(b.size===m.getGroupLinks(a).size)throw m.getGroupLinks(a).forEach(function(c){if(!1===b.has(c))throw new CTATExampleTracerException("Invalid link selection: Partial overlap with existing group: "+a);}),new CTATExampleTracerException("Group containing this set of links already exists: "+
a);if(b.size>=m.getGroupLinks(a).size)throw new CTATExampleTracerException("Invalid link selection: Partial overlap with existing group: "+a);var c=!1,e=null;b.forEach(function(f){if(!0!==c){if(!1===m.isLinkInGroup(a,f))throw new CTATExampleTracerException("Invalid link selection: Partial overlap with existing group: "+a);m.getGroupSubgroups(a).forEach(function(g){!0!==c&&!0===m.isLinkInGroup(g,f)&&(m.getGroupLinkCount(g)>=b.size?(e=d(g,b),c=!0):m.getGroupLinks(g).forEach(function(c){if(!1===b.has(c))throw new CTATExampleTracerException("Invalid link selection: Partial overlap with existing group: "+
a);}))})}});return!0===c?e:a}function h(a,b){m.ctatdebug("CTATDefaultGroupModel --\x3e in addSubgroupPreserveSanity parent: "+a.getName());m.ctatdebug("CTATDefaultGroupModel --\x3e in addSubgroupPreserveSanity child: "+b.getName());m.ctatdebug("CTATDefaultGroupModel --\x3e in addSubgroupPreserveSanity size: "+m.getGroupSubgroups(a).size);m.getGroupSubgroups(a).forEach(function(c){var d=m.getGroupLinks(c);if(0===d.size)m.getGroupSubgroups(a).delete(c),n(b,c);else{var e=null,f=!1;d.forEach(function(a){!1===
f&&(e=a,f=!0)});!0===m.isLinkInGroup(b,e)&&(m.getGroupSubgroups(a).delete(c),n(b,c))}});n(a,b)}function n(a,b){m.ctatdebug("CTATDefaultGroupModel --\x3e in addSubgroup");a.addSubgroup(b);b.setParent(a)}CTATGroupModel.call(this);var l=null,p=!1,m=this;this.removeLinkFromModel=function(b){var d=[];m.getGroupSubgroups(l).forEach(function(c){c.containsLink(b)&&d.push(b);a(c,b)});d.forEach(function(a){1>a.getLinks().size()&&g(a)});c(l,b)};this.clear=function(){m.ctatdebug("CTATDefaultGroupModel --\x3e in clear");
l=new CTATDefaultLinkGroup("defaultName",!0,p,null)};this.setDefaultReenterable=function(a){m.ctatdebug("CTATDefaultGroupModel --\x3e in setDefaultReenterable");p=a};this.setGroupOrdered=function(a,b){m.ctatdebug("CTATDefaultGroupModel --\x3e in setGroupOrdered");a.setOrdered(b)};this.getTopLevelGroup=function(){ctatdebug("CTATDefaultGroupModel --\x3e in getTopLevelGroup");return l};this.setGroupName=function(a,b){m.ctatdebug("CTATDefaultGroupModel --\x3e in setGroupName");a.setName(b)};this.removeLink=
function(a){m.removeLinkFromGroup(l,a);return l.removeLink(a)};this.addLinkToGroup=function(a,b){m.ctatdebug("CTATDefaultGroupModel --\x3e in addLinkToGroup");for(m.removeLinkFromGroup(l,b);null!==a&&"undefined"!==typeof a;a=m.getGroupParent(a)){var c=a,d=b;m.ctatdebug("CTATDefaultGroupModel --\x3e in internalAddLinkToGroup");c.addLink(d)}};this.isGroupOrdered=function(a){m.ctatdebug("CTATDefaultGroupModel --\x3e in isGroupOrdered group name: "+a.getName());m.ctatdebug("CTATDefaultGroupModel --\x3e in isGroupOrdered: "+
a.getIsOrdered());return a.getIsOrdered()};this.isGroupReenterable=function(a){m.ctatdebug("CTATDefaultGroupModel --\x3e in isGroupReenterable");return a.getIsReenterable()};this.isLinkInGroup=function(a,b){m.ctatdebug("CTATDefaultGroupModel --\x3e in isLinkInGroup");return a.containsLink(b)};this.getGroupsContainingLink=function(a){m.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupsContainingLink("+a+"): TopLevel "+l+", typeof(TopLevel) "+typeof l);var b=new Set,c=new CTATGroupIterator(l);m.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupsContainingLink before loop: groupIter "+
c+", typeof(groupIter) "+typeof c);for(var d=c.next();!d.done;d=c.next())d=d.value,!0===m.isLinkInGroup(d,a)&&b.add(d);m.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupsContainingLink returning groups.size "+b.size);return b};this.getLowestLevelGroupOfLink=function(a){m.ctatdebug("CTATDefaultGroupModel --\x3e in getLowestLevelGroupOfLink");var c=b(a,l);return null!==c&&"undefined"!==typeof c?c:!0===m.isLinkInGroup(l,a)?l:null};this.getGroupSubgroups=function(a){m.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupSubgroups");
return null!==a&&"undefined"!==typeof a?a.getSubgroups():null};this.getUniqueLinks=function(a){m.ctatdebug("CTATDefaultGroupModel --\x3e in getUniqueLinks");var b=new Set;m.getGroupLinks(a).forEach(function(a){b.add(a)});m.getGroupSubgroups(a).forEach(function(a){m.getGroupLinks(a).forEach(function(a){b.delete(a)})});return b};this.getGroupLinks=function(a){m.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupLinks: "+a.getName());return a.getLinks()};this.removeLinkFromGroup=function(a,b){m.ctatdebug("CTATDefaultGroupModel --\x3e in removeLinkFromGroup");
e(a,b,!1)};this.getGroupParent=function(a){m.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupParent");return a.getParent()};this.addGroup=function(a,b,c){m.ctatdebug("CTATDefaultGroupModel --\x3e in addGroup");var e=null;try{e=d(l,c)}catch(B){return B.toString()}a=new CTATDefaultLinkGroup(a,b,p,c);m.ctatdebug("CTATDefaultGroupModel --\x3e in addGroup after creating new group");h(e,a);return""};this.setGroupReenterable=function(a,b){m.ctatdebug("CTATDefaultGroupModel --\x3e in setGroupReenterable");
a.setReenterable(b)};this.createIdToLinkMap=function(){m.ctatdebug("CTATDefaultGroupModel --\x3e in createIdToLinkMap");var a={};m.getGroupLinks(l).forEach(function(b){a[b.getUniqueID()]=b});return a};this.getGroupByName=function(a){m.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupByName TopLevel has: "+l.getSubgroups().size);for(var b=new CTATGroupIterator(l),c=b.next();!c.done;c=b.next())if(c=c.value,m.getGroupName(c).toString()===a.toString())return c;return null};this.getGroupName=function(a){return a.getName()};
m.clear()};CTATDefaultGroupModel.prototype=Object.create(CTATGroupModel.prototype);CTATDefaultGroupModel.prototype.constructor=CTATDefaultGroupModel;"undefined"!==typeof module&&(module.exports=CTATDefaultGroupModel);var CTATMatcherComparator=function(){CTATBase.call(this,"CTATMatcherComparator","");CTATMatcherComparator.compare=function(a,f){ctatdebug("CTATMatcherComparator--\x3e in compare");var g=CTATMatcherComparator.compareBasedOnType(a,f);if(0!==g||!1===a instanceof CTATVectorMatcher&&!1===f instanceof CTATVectorMatcher)return g;g=CTATMatcherComparator.compareBasedOnType(a.getSingleMatcher("input"),f.getSingleMatcher("input"));if(0!==g)return g;g=CTATMatcherComparator.compareBasedOnType(a.getSingleMatcher("selection"),
f.getSingleMatcher("selection"));return 0!==g?g:CTATMatcherComparator.compareBasedOnType(a.getSingleMatcher("action"),f.getSingleMatcher("action"))};CTATMatcherComparator.compareBasedOnType=function(a,f){ctatdebug("CTATMatcherComparator --\x3e in compareBasedOnType");for(var g in CTATMatcherComparator.matcherPrecedenceOrder)if(CTATMatcherComparator.matcherPrecedenceOrder.hasOwnProperty(g)&&a instanceof CTATMatcherComparator.matcherPrecedenceOrder[g])break;for(var e in CTATMatcherComparator.matcherPrecedenceOrder)if(CTATMatcherComparator.matcherPrecedenceOrder.hasOwnProperty(e)&&
f instanceof CTATMatcherComparator.matcherPrecedenceOrder[e])break;return g<e?1:g>e?-1:0}};Object.defineProperty(CTATMatcherComparator,"matcherPrecedenceOrder",{enumerable:!1,configurable:!1,writable:!1,value:{0:CTATExactMatcher,1:CTATRangeMatcher,2:CTATExpressionMatcher,3:CTATWildcardMatcher,4:CTATRegexMatcher,5:CTATAnyMatcher}});CTATMatcherComparator.prototype=Object.create(CTATBase.prototype);CTATMatcherComparator.prototype.constructor=CTATMatcherComparator;
"undefined"!==typeof module&&(module.exports=CTATMatcherComparator);new CTATMatcherComparator;var CTATExampleTracerLinkComparator=function(a,f){CTATBase.call(this,"CTATExampleTracerLinkComparator","");this.compare=function(g,e){ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l1.getUniqueID(): "+g.getUniqueID());ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l2.getUniqueID(): "+e.getUniqueID());var c=g.getType(),b=e.getType(),c=CTATExampleTracerLink.compareLinkTypes(c,b);if(0!==c)return ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare m: "+c),c;c=f.nonEmptyHints(g,
a.getVariableTable());b=f.nonEmptyHints(e,a.getVariableTable());ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare h1, h2: "+c+", "+b);if(0<c&&0>=b)return-1;if(0>=c&&0<b)return 1;ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l1.getDepth(), l2.getDepth(): "+g.getDepth()+", "+e.getDepth());if(g.getDepth()<e.getDepth())return-1;if(g.getDepth()>e.getDepth())return 1;c=a.getTraversalCount(g)-g.getMinTraversals();b=a.getTraversalCount(e)-e.getMinTraversals();ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare tc1, tc2: "+
c+", "+b);if(0>c&&0<=b)return-1;if(0<=c&&0>b)return 1;ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l1.getIsPreferredLink(): "+g.getIsPreferredLink());ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l2.getIsPreferredLink(): "+e.getIsPreferredLink());if(g.getIsPreferredLink())return-1;if(e.getIsPreferredLink())return 1;if(0!==(c=CTATMatcherComparator.compare(g.getMatcher(),e.getMatcher())))return c;ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l1.getUniqueID(): "+
g.getUniqueID());ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l2.getUniqueID(): "+e.getUniqueID());return g.getUniqueID()<e.getUniqueID()?-1:1}};CTATExampleTracerLinkComparator.prototype=Object.create(CTATBase.prototype);CTATExampleTracerLinkComparator.prototype.constructor=CTATExampleTracerLinkComparator;"undefined"!==typeof module&&(module.exports=CTATExampleTracerLinkComparator);var CTATExampleTracerEvent=function(a,f,g){CTATBase.call(this,"CTATExampleTracerEvent",f?f.toString():"null");var e="",c=!1,b=CTATExampleTracerLink.NO_MODEL,d=!1,h=null,n=null,l="student",p=null,m=null,q=[],u="",v="",w=null,B="",C=null,F=null,G=null,H=null,E=[],D=!1,K=null,J=null,r=this,I=null,A=[],P=[],L={};this.getMsgToRestore=function(){return I};this.setMsgToRestore=function(a){I=a};this.getActor=function(){return l};this.setActor=function(a){r.ctatdebug("CTATExampleTracerEvent --\x3e setActor("+
a+")");l=a};this.getStudentSAI=function(){r.ctatdebug("CTATExampleTracerEvent.getStudentSAI() returning type "+typeof h+", value "+h);return h};this.setStudentSAI=function(a){r.ctatdebug("CTATExampleTracerEvent --\x3e in setStudentSAI("+a+")");null!==a&&"undefined"!==typeof a&&(h=a);r.ctatdebug("CTATExampleTracerEvent --\x3e out of setStudentSAI")};this.getPreloadedLinkMatches=function(){r.ctatdebug("CTATExampleTracerEvent --\x3e in getPreloadedLinkMatches");return C};this.setTutorSAI=function(a){r.ctatdebug("CTATExampleTracerEvent --\x3e in setTutorSAI");
null!==a&&"undefined"!==typeof a&&(n=a);r.ctatdebug("CTATExampleTracerEvent --\x3e out of setTutorSAI")};this.setNumberOfInterpretations=function(a){r.ctatdebug("CTATExampleTracerEvent --\x3e in setNumberOfInterpretations( "+a+" )")};this.getTransactionID=function(){r.ctatdebug("CTATExampleTracerEvent --\x3e in getTransactionID() returning "+e);return e};this.setTransactionID=function(a){r.ctatdebug("CTATExampleTracerEvent --\x3e in setTransactionID( "+a+" )");e=a};this.setDoneStepFailed=function(a){r.ctatdebug("CTATExampleTracerEvent --\x3e in setDoneStepFailed( "+
a+" )");c=a};this.setHintRequest=function(a){d=a};this.getHintRequest=function(){return d};this.setResult=function(a){r.ctatdebug("CTATExampleTracerEvent --\x3e in setResult( "+a+" )");b=a};this.isBuggyResult=function(){return b.toString()===CTATExampleTracerLink.BUGGY_ACTION||b.toString()===CTATExampleTracerLink.FIREABLE_BUGGY_ACTION};this.isSolverResult=function(){r.ctatdebug("CTATExampleTracerEvent --\x3e in isSolverResult");return!1};this.getResult=function(){r.ctatdebug("CTATExampleTracerEvent --\x3e in getResult() returning "+
b);return b};this.setReportableLink=function(a){r.ctatdebug("CTATExampleTracerEvent --\x3e in setReportableLink("+a+")");p=a};this.setReportableInterpretation=function(a){r.ctatdebug("CTATExampleTracerEvent --\x3e in setReportableInterpretation("+a+")");m=a};this.addScoreLabels=function(a){null!=a&&(Array.isArray(a)||(a=[].concat($jscomp.arrayFromIterable(arguments))),a.forEach(function(a){null!=a&&(a=String(a),q.includes(a)||q.push(a))}))};this.setStepID=function(a){r.ctatdebug("CTATExampleTracerEvent --\x3e in setStepID("+
a+")");u=a?a.toString():""};this.setBuggyStepID=function(a){v=a?a.toString():""};this.setReportableVariableTable=function(a){G=a.clone()};this.setSuccessOrBuggyMsg=function(a){r.ctatdebug("CTATExampleTracerEvent --\x3e in setSuccessOrBuggyMsg("+a+")");H=a instanceof Array?a:[a]};this.setReportableHints=function(a){r.ctatdebug("CTATExampleTracerEvent --\x3e in setReportableHints("+a+")");E=Array.isArray(a)&&0<a.length?a:[]};this.getWantReportableHints=function(){r.ctatdebug("CTATExampleTracerEvent --\x3e in getWantReportableHints() returning "+
D);return D};this.setOutOfOrder=function(a){r.ctatdebug("CTATExampleTracerEvent --\x3e in setOutOfOrder("+a+")");w=a};this.isOutOfOrder=function(){r.ctatdebug("CTATExampleTracerEvent --\x3e in getOutOfOrder() returning "+w);return w};this.setTraceOutcome=function(a){B=a};this.getTraceOutcome=function(){return B};this.setEvaluatedInput=function(a){r.ctatdebug("CTATExampleTracerEvent --\x3e in setEvaluatedInput("+a+")");if(null===F||"undefined"===typeof F)F=[];F.push(a)};this.addPreloadedLinkMatch=
function(a){r.ctatdebug("CTATExampleTracerEvent --\x3e in addPreloadedLinkMatch("+a+")");if(null===C||"undefined"===typeof C)C=[];C.push(a)};this.setInterpolatedSAI=function(a){r.ctatdebug("CTATExampleTracerEvent --\x3e in setInterpolatedSAI("+a+")");a&&(K=a)};this.getInterpolatedSAI=function(){return K?K:r.getStudentSAI()};this.setInterpolatedHints=function(a){r.ctatdebug("CTATExampleTracerEvent --\x3e in setInterpolatedHints("+a+")");J&&(J.length=0);a&&(J=a.slice(0));r.ctatdebug("CTATExampleTracerEvent --\x3e out of setInterpolatedHints")};
this.setWantReportableHints=function(a){r.ctatdebug("CTATExampleTracerEvent --\x3e in setWantReportableHints("+a+")");D=a};this.setAssociatedRules=function(a){A=a instanceof Array?a:a instanceof String?[a]:[]};this.setAssociatedSkills=function(a){P=a instanceof Array?a:a instanceof String?[a]:[]};this.setCustomFields=function(a){L=a instanceof Object?a:{}};this.getSuccessOrBuggyMsg=function(){r.ctatdebug("CTATExampleTracerEvent --\x3e in getSuccessOrBuggyMsg() returning "+H);return H};this.getReportableHints=
function(){r.ctatdebug("CTATExampleTracerEvent --\x3e in getReportableHints() returning "+E);return E};this.getReportableLink=function(){r.ctatdebug("CTATExampleTracerEvent --\x3e in getReportableLink() returning "+p);return p};this.getReportableVariableTable=function(){r.ctatdebug("CTATExampleTracerEvent --\x3e in getReportableVariableTable() returning "+G);return G};this.getReportableInterpretation=function(){r.ctatdebug("CTATExampleTracerEvent --\x3e in getReportableInterpretation() returning "+
m);return m};this.getScoreLabels=function(){r.ctatdebug("CTATExampleTracerEvent --\x3e in getScoreLabels() returning "+q);return q};this.getStepID=function(){r.ctatdebug("CTATExampleTracerEvent --\x3e in getStepID() returning "+u);return u};this.getBuggyStepID=function(){return v};this.getTutorSelection=function(){return null===n||"undefined"===typeof n?null:n.getSelectionArray()};this.getTutorAction=function(){return null===n||"undefined"===typeof n?null:n.getActionArray()};this.getTutorInput=function(){return null!==
F&&"undefined"!==typeof F?r.getEvaluatedInputArray():null!==n&&"undefined"!==typeof n?n.getInputArray():null};this.getEvaluatedInputArray=function(){return F};this.toString=function(){var a;a="["+r.getResult();null!==r.getStudentSAI()&&"undefined"!==typeof r.getStudentSAI()&&(a+=", StudentSAI "+r.getStudentSAI());null!==r.getReportableLink()&&"undefined"!==typeof r.getReportableLink()&&(a+=", reportableLink "+r.getReportableLink());!0===r.isDoneStepFailed()&&(a+=", doneStepFailed");null!==r.getTutorSAI()&&
"undefined"!==typeof r.getTutorSAI()&&(a+=", TutorSAI "+r.getTutorSAI());return a+"]"};this.isDoneStepFailed=function(){return c};this.getTutorSAI=function(){return n};this.getAssociatedRules=function(){return A};this.getAssociatedSkills=function(){return P};this.getCustomFields=function(){return L};this.setStudentSAI(f);this.setActor(g)};CTATExampleTracerEvent.prototype=Object.create(CTATBase.prototype);CTATExampleTracerEvent.prototype.constructor=CTATExampleTracerEvent;
"undefined"!==typeof module&&(module.exports=CTATExampleTracerEvent);var CTATExampleTracerInterpretation=function(a){CTATBase.call(this,"CTATExampleTracerInterpretation","");var f=null,g=[],e={},c=new CTATVariableTable,b=new Set;a.forEach(function(a){b.add(a)});var d=CTATExampleTracerLink.CORRECT_ACTION,h=null,n=this;this.getVariableTable=function(){return c};this.setVariableTable=function(a){c=a};this.setLatestHints=function(a,b){n.ctatdebug("In evaluate after calling setInterpolatedHints");if(!Array.isArray(a)||1>a.length)a=b;!Array.isArray(a)||1>a.length||c.put("hints",
a)};this.getLatestHints=function(){return c.get("hints")};this.setLatestBuggyMessage=function(a){!a||1>(a=String(a)).length||c.put("buggy_message",a)};this.setLatestSuccessMessage=function(a){!a||1>(a=String(a)).length||c.put("success_message",a)};this.getLatestBuggyMessage=function(){return c.get("buggy_message")};this.getLatestSuccessMessage=function(){return c.get("success_message")};this.getTraversalCount=function(a){a=e[a.getUniqueID()];return"undefined"===typeof a||null===a?0:a[0]};this.getPaths=
function(){return b};this.clone=function(){var a=new CTATExampleTracerInterpretation(b);a.setInterpolatedSAI(n.getInterpolatedSAI());a.addTraversedLinks(g);for(var f in e)e.hasOwnProperty(f)&&a.putInlinkIdTraversalCountMap(f,e[f].slice());a.setWorstLinkType(d);f=c.clone();a.setVariableTable(f);a.setLatestHints(n.getLatestHints());a.setLatestSuccessMessage(n.getLatestSuccessMessage());a.setLatestBuggyMessage(n.getLatestBuggyMessage());h&&a.setPathToDone(new CTATExampleTracerPath(h.getLinks()));ctatdebug("CTATExampleTracerInterpretation --\x3e out of clone");
return a};this.addTraversedLinks=function(a){g=g.concat(a)};this.putInlinkIdTraversalCountMap=function(a,b){ctatdebug("CTATExampleTracerInterpretation --\x3e in putInlinkIdTraversalCountMap");ctatdebug("CTATExampleTracerInterpretation --\x3e in putInlinkIdTraversalCountMap key: "+a);ctatdebug("CTATExampleTracerInterpretation --\x3e in putInlinkIdTraversalCountMap value: "+b);e[a]=b};this.setWorstLinkType=function(a){d=a};this.addLink=function(a){!a.isTraversable()||h&&h.getLinks().has(a)||(h=null);
ctatdebug("CTATExampleTracerInterpretation.addLink("+(a&&a.getUniqueID())+") pathToDone "+(h&&h.size()));g.push(a);var b=a.getMatcher(),b=null===b||"undefined"===typeof b?1:b.getTraversalIncrement(),c=e[a.getUniqueID()];null!==c&&"undefined"!==typeof c?c[0]+=b:(c=[],c.push(b),e[a.getUniqueID()]=c);a=a.getType();0>CTATExampleTracerLink.compareLinkTypes(d,a)&&(d=a)};this.setPathToDone=function(a){h=a};this.getPathToDone=function(a){if(h)return h;var b=a.getStartNode();b&&a.getDoneStates().forEach(function(c){h||
(h=a.getBestSubpath(b,c,g))});return h};this.countStepsForScore=function(a){var b=Number.MAX_VALUE,c=n.getPathToDone(a);if((a=a.getStudentStartsHereNode()||a.getStartNode())&&c&&c.getLinks()){var d=a.getNodeID(),b=0;c.getSortedLinks().forEach(function(a){if(!(0<d&&a.getPrevNode()!=d||(d=-1,CTATMatcher.isTutorActor(a.getActor(),!0)))){var c=n.getTraversalCount(a);a=a.getMinTraversals();b=c>a?b+c:b+a}})}return b};this.getCurrentState=function(a){var b=a&&n.getPathToDone(a);if(!b)return a&&a.getStartNode()&&
a.getStartNode().getNodeID();for(var c=null,b=b.getSortedLinks(),d=0;d<b.length&&!(n.getTraversalCount(b[d])<b[d].getMinTraversals());++d)c=b[d];return c?c.getNextNode():a.getStartNode().getNodeID()};this.updateVariableTable=function(a,b,d){var e=a,f=a.getInput();null!==b&&"undefined"!==typeof b&&(f=b,e=new CTATSAI(a.getSelection(),a.getAction(),f));c.put("link"+d.getUniqueID()+".selection",a.getSelection());c.put("link"+d.getUniqueID()+".action",a.getAction());b="link"+d.getUniqueID()+".input";c.put(b,
f);c.put(CTATVariableTable.nameAsString(b),CTATVariableTable.valueAsString(f));if(CTATExampleTracerLink.CORRECT_ACTION.toString().toUpperCase()===d.getActionType().toString().toUpperCase()||CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString().toUpperCase()===d.getActionType().toString().toUpperCase())a=a.getSelection(),null!==a&&"undefined"!==typeof a&&0<a.length&&c.put(a,f);return e};this.getInterpolatedSAI=function(){return f};this.setInterpolatedSAI=function(a){f=a};this.getLastMatchedLink=function(){return 0===
g.length?null:g[g.length-1]};this.getMatchedLinks=function(){return g};this.getType=function(){return d};this.isTraversed=function(a,b){ctatdebug("CTATExampleTracerInterpretation --\x3e in isTraversed: "+a.getUniqueID());var c=e[a.getUniqueID()];if(null===c||"undefined"===typeof c)return ctatdebug("CTATExampleTracerInterpretation --\x3e in isTraversed in if condition (traversalCount === null): "+(null===c)),ctatdebug("CTATExampleTracerInterpretation --\x3e in isTraversed in if condition (typeof(traversalCount) === 'undefined'): "+
("undefined"===typeof c)),!0===b?0>=a.getMinTraversals():!1;ctatdebug("CTATExampleTracerInterpretation --\x3e in isTraversed out of if condition traversalCount[0]: "+c[0]);ctatdebug("CTATExampleTracerInterpretation --\x3e in isTraversed out of if condition link.getMinTraversals(): "+a.getMinTraversals());return c[0]>=a.getMinTraversals()};this.toString=function(){var a="{";g.forEach(function(b){a+=b.getUniqueID()+", "});a.substring(a.length-2,a.length).toString()===", ".toString()&&(a=a.substring(0,
a.length-2));a+=" ("+(null===b||"undefined"===typeof b?-1:b.size)+" paths)";a+=" var tbl "+c;return a+="}"}};CTATExampleTracerInterpretation.prototype=Object.create(CTATBase.prototype);CTATExampleTracerInterpretation.prototype.constructor=CTATExampleTracerInterpretation;"undefined"!==typeof module&&(module.exports=CTATExampleTracerInterpretation);var CTATExampleTracerInterpretationComparator=function(){CTATBase.call(this,"CTATExampleTracerInterpretationComparator","");var a=this;this.compare=function(f,g){a.ctatdebug("CTATExampleTracerInterpretationComparator --\x3e in compare");var e=f.getType(),c=CTATExampleTracerLink.compareLinkTypes(e,g.getType());ctatdebug("CTATExampleTracerInterpretationComparator comparing i1Type: "+f.getType());ctatdebug("CTATExampleTracerInterpretationComparator comparing i2Type: "+g.getType());ctatdebug("CTATExampleTracerInterpretationComparator comparing link types result: "+
c);if(0!==c)return ctatdebug("CTATExampleTracerInterpretationComparator result is not equal to 0"),0>c?1:-1;if(CTATExampleTracerLink.BUGGY_ACTION.toString().toUpperCase()===e.toString().toUpperCase()&&(ctatdebug("CTATExampleTracerInterpretationComparator checking for buggy actions"),e=f.getLastMatchedLink(),c=g.getLastMatchedLink(),e=CTATMatcherComparator.compare(e.getMatcher(),c.getMatcher()),0!==e))return e;f=CTATExampleTracerPath.getBestPath(f.getPaths());g=CTATExampleTracerPath.getBestPath(g.getPaths());
e=new Set;e.add(f);e.add(g);f=CTATExampleTracerPath.getBestPath(e);ctatdebug("CTATExampleTracerInterpretationComparator found best path: "+(f===g));f.getLinks().forEach(function(b){a.ctatdebug("My best link==: "+b.getUniqueID())});return f===g?-1:1}};CTATExampleTracerInterpretationComparator.prototype=Object.create(CTATBase.prototype);CTATExampleTracerInterpretationComparator.prototype.constructor=CTATExampleTracerInterpretationComparator;"undefined"!==typeof module&&(module.exports=CTATExampleTracerInterpretationComparator);var CTATExampleTracerTracer_count=0,CTATExampleTracerTracer=function(a,f){function g(a,b,c){if(!a)return a;b=new CTATFormulaParser(b);A.ctatdebug("CTATETT.interpolate("+a+",vt,"+c+")");var d=c.getSelection(),e=c.getAction();c=c.getInput();c=CTATVariableTable.standardizeType(c);A.ctatdebug("CTATETT.interpolate() calling CTATFP.interpolate("+a+", "+d+", "+e+", "+c);a=b.interpolate(a,d,e,c);A.ctatdebug("CTATETT.interpolate() returning "+a);return a}function e(a,b,c,d,e,f){A.ctatdebug("finishEvaluate() doUpdate "+
b+", link "+d+", bestInterp.getLastMatchedLink() "+e.getLastMatchedLink());null==d&&(d=e.getLastMatchedLink());(b||a.getWantReportableHints())&&f.forEach(function(b){var c=[],d=b.getLastMatchedLink();if(d){if(d.getActionType()==CTATExampleTracerLink.CORRECT_ACTION)if(a.getHintRequest())a.getWantReportableHints()&&b.setLatestHints(d.interpolateHints(b.getVariableTable()),d.getHints());else for(c=d.getSuccessMsgs(),d=0;d<c.length;++d)c[d]=g(c[d],b.getVariableTable(),a.getStudentSAI()),0==d&&b.setLatestSuccessMessage(c[d]);
else for(c=d.getBuggyMsgs(),d=0;d<c.length;++d)c[d]=g(c[d],b.getVariableTable(),a.getStudentSAI()),0==d&&b.setLatestBuggyMessage(c[d]);b==e&&(A.ctatdebug('ETT.finishEvaluate() successOrBuggyMsg "'+c.toString()+'"'),a.setSuccessOrBuggyMsg(c))}});if(b){b={sai:a.getStudentSAI(),actor:a.getActor()};E.push(b);d!=e.getLastMatchedLink()&&(e.addLink(d),a.setResult(d.getActionType()),a.setTraceOutcome(d.getActionType()));if(c.toString()===CTATExampleTracerLink.CORRECT_ACTION.toString()||c.toString()===CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()){A.ctatdebug("In evaluate -- in first branch doUpdate()");
f.forEach(function(a){a.getLastMatchedLink().getType().toString()===CTATExampleTracerLink.BUGGY_ACTION.toString()&&(A.ctatdebug("In evaluate -- deleting an incorrect interp"),f.delete(a))});A.ctatdebug("In evaluate -- to call setInterpretations(), if 0 < newInterps.size "+f.size);0<f.size&&(q(f),r=e);for(var h in H)H.hasOwnProperty(h)&&delete H[h];A.ctatdebug("In evaluate -- out of DoUpdate if branch")}else{A.ctatdebug("In evaluate -- in else branch of doUpdate");a.setNumberOfInterpretations(0);for(var l in H)H.hasOwnProperty(l)&&
delete H[l];f.forEach(function(a){H[a.getLastMatchedLink().getUniqueID()]=a.getLastMatchedLink()})}c.toString()===CTATExampleTracerLink.BUGGY_ACTION.toString()&&E.splice(E.length-1,1)}a.isSolverResult()||(A.ctatdebug("In evaluate inside the NOT solver result if condition "+c),a.setResult(c),a.setTraceOutcome(c));c.toString()!==CTATExampleTracerLink.BUGGY_ACTION.toString()&&c.toString()!==CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()||a.setBuggyStepID(d.getUniqueID());A.ctatdebug("In evaluate out the solver result if condition");
a.setReportableLink(d);a.setAssociatedSkills(d.getSkillNames());a.setStepID(d.getUniqueID());a.setReportableInterpretation(e);a.setInterpolatedSAI(e.getInterpolatedSAI());a.setReportableVariableTable(e.getVariableTable());a.getHintRequest()?(a.setReportableHints(e.getLatestHints()),A.ctatdebug("In evaluate --\x3e after setReportableHints")):(d=d.getTutorSAI(a.getInterpolatedSAI(),e.getVariableTable()),A.ctatdebug("In evaluate -- TUTORSAI: "+d+", studentSAI was "+a.getStudentSAI()),a.setTutorSAI(d));
A.ctatdebug("In evaluate after fireExampleTracerEvent");A.ctatdebug("CTATExampleTracerTracer --\x3e out of finishEvaluate");return c.toString()!==CTATExampleTracerLink.BUGGY_ACTION.toString()}function c(a,c,d,e){A.ctatdebug("checkDoneStep() hintTrace "+c+", sai "+a.getStudentSAI()+", exitOnIncorrectDone "+D.exitOnIncorrectDone()+", hideButRequireSteps "+D.hideButRequireSteps()+", nInterps "+e.size);if(!a.getStudentSAI().isDone())return A.ctatdebug("checkDoneStep() not isDone(), so setDoneStepFailed(false) & return null "),
null;if(D.exitOnIncorrectDone())return A.ctatdebug("checkDoneStep() exitOnIncorrectDone() with setDoneStepFailed(false), so return CORRECT"),b(a,d,null,e);if(!c&&D.hideButRequireSteps()){c=D.getDoneLinks();A.ctatdebug("checkDoneStep getDoneLinks().size "+c.size);c=c.values();for(var f;!(f=c.next()).done;)if(D.pathToLinkIsSubset(f.value,I))return b(a,d,f.value,e)}1>e.size&&a.setDoneStepFailed(!0);return null}function b(a,b,c,d){var f;a.setDoneStepFailed(!1);1>d.size?(d=A.getInterpretationsInternal(),
f=A.getBestInterpretation()):f=m(d);f.setInterpolatedSAI(new CTATSAI("done","ButtonPressed","-1"));return e(a,b,CTATExampleTracerLink.CORRECT_ACTION,c,f,d)}function d(a,b,d){A.ctatdebug("CTATExampleTracerTracer --\x3e _evaluate("+a+", "+b+", "+d+")");K=a;var f=new Set,g=a.getPreloadedLinkMatches();A.ctatdebug("interps # : "+G.length);A.ctatdebug("interps: "+G);G.forEach(function(c){A.ctatdebug("In evaluate -- entered the interpretations loop");if("undefined"===typeof g||null===g)A.ctatdebug("In evaluate -- entered if check for saiLinkMatches"),
g=n(a.getStudentSAI(),a.getActor(),b,c.getVariableTable(),a),A.ctatdebug("In evaluate -- exiting if check for saiLinkMatches");else for(var e=0;e<g.length;++e)h(a.getStudentSAI(),!0,g[e],g[e].getActor(),c.getVariableTable());A.ctatdebug("Link matches # : "+g.length);g.forEach(function(b){A.ctatdebug("In evaluate -- entered the saiLinkMatches loop + "+b);if(!D.relaxOrderConstraints()&&c.getTraversalCount(b)>=b.getMaxTraversals())return A.ctatdebug("In evaluate -- skipped a saiLinkMatches loop \n Skipped due to max traversals"+
b.getMaxTraversals()),!1;var e=c.clone();e.setInterpolatedSAI(null);A.ctatdebug("In evaluate size of getPaths "+e.getPaths().size);e.getPaths().forEach(function(c){A.ctatdebug("In evaluate -- looping through the newInterp.getPaths()\n Examining path: "+c);!1===l(b,e,c,A.isDemonstrateMode(),a)&&(A.ctatdebug("In evaluate -- in if condition, checking if isPathOK"),e.getPaths().delete(c),A.ctatdebug("In evaluate -- out of if condition, checking if isPathOK\n Tried to delete path."))});A.ctatdebug("In evaluate -- done looping through the newInterp.getPaths(), size "+
e.getPaths().size);if(0<e.getPaths().size){A.ctatdebug("In evaluate -- if number of paths is greater than 0");e.addLink(b);A.ctatdebug("In evaluate -- new link added");if(!0===d){A.ctatdebug("In evaluate -- we are in the doUpdate if condition");var g=p(b,a.getStudentSAI(),e);A.ctatdebug("In evaluate -- updatingVariable table");e.setInterpolatedSAI(e.updateVariableTable(a.getStudentSAI(),g,b));A.ctatdebug("In evaluate -- done updatingVariable table: "+e.getVariableTable())}f.add(e);A.ctatdebug("In evaluate -- added new interp")}A.ctatdebug("In evaluate -- out of saiLinkMatches loop")});
A.ctatdebug("In evaluate -- out of interpretation loops")});a.setNumberOfInterpretations(f.size);A.ctatdebug("In evaluate -- number of interpretations "+f.size+" set");var q=c(a,b,d,f);if(null!==q)return q;if(0===f.size)return A.ctatdebug("In evaluate -- if condition no new interpretations"),0!==g.length&&!0===g[0].isDone()&&a.setDoneStepFailed(!0),a.setResult(CTATExampleTracerLink.NO_MODEL),a.setTraceOutcome(CTATExampleTracerLink.NO_MODEL),A.ctatdebug("In evaluate -- if condition no new interpretations returning false"),
!1;q=m(f);A.ctatdebug("In evaluate -- just found bestInterp");var u=null;!0===a.isSolverResult()?(A.ctatdebug("In evaluate -- in if branch of isSolverResult"),u=CTATExampleTracerLink.NO_MODEL.toString().toUpperCase()===a.getResult().toString().toUpperCase()?CTATExampleTracerLink.BUGGY_ACTION.toString():a.getResult().toString()):(A.ctatdebug("In evaluate -- in else branch of isSolverResult"),u=q.getLastMatchedLink().getType());return e(a,d,u,null,q,f)}function h(a,b,c,d,e){var f=b&&c.isCorrect();if("undefined"!=
typeof I[c.getUniqueID()]||c.matchesSAIforHint(a,d,null,e))I[c.getUniqueID()]=f;A.ctatdebug("updateMatchedSelections(): link "+c.getUniqueID()+", matched "+b+", newResult "+f+", matchedSelections[link] "+I[c.getUniqueID()])}function n(a,b,c,d,e){A.ctatdebug("CTATExampleTracerTracer --\x3e in findSAIMatchingLinks("+a+", "+b+", "+c+")");var f=[];D.getLinks().forEach(function(g){if(!1===c){A.ctatdebug("Calling link.matchesSAI() on link "+g+", sai "+a);var l=g.matchesSAI(a,b,d);A.ctatdebug("Result from link.matchesSAI() on link "+
g+": "+l+", typeof "+typeof l);!0===l&&f.push(g);D.hideButRequireSteps()&&h(a,l,g,b,d)}else!0===g.matchesSAIforHint(a,b,e,d)&&f.push(g)});A.ctatdebug("CTATExampleTracerTracer --\x3e out of findSAIMatchingLinks: #matchingLinks "+f.length);return f}function l(a,b,c,d,e){A.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK");var f=null;if(!0===d){A.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK in demonstrate mode");var g=b.getMatchedLinks().slice();g.push(a);f=c.getLinksRestricted(g)}else A.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK NOT in demonstrate mode"),
f=c.getLinks();A.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK path.getLinks() "+c.getLinks().size);A.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK pathLinks "+f.size);if(!0===d){var h=[],l=!0;b.getMatchedLinks().forEach(function(a){!1!==l&&(!1===D.observesOrderingConstraints(h,a,f,e)||!1===v(b,a,f)?(A.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK returning false1"),l=!1):h.push(a))});if(!1===l)return A.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK returning false2"),
!1}if(a.getType().toString()===CTATExampleTracerLink.BUGGY_ACTION.toString()){if(!1===D.isIncorrectLinkOK(b.getMatchedLinks(),a,f,b))return A.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK returning false3"),!1}else{if(!1===D.observesOrderingConstraints(b.getMatchedLinks(),a,f,e))return A.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK returning false4"),!1;if(!1===v(b,a,f))return A.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK returning false5"),!1}A.ctatdebug("CTATExampleTracerTracer --\x3e out of isPathOK returning true");
return!0}function p(a,b,c){A.ctatdebug("CTATExampleTracerTracer.replaceInput("+a+", "+b+", ...)");if(null===a||"undefined"===typeof a||!1===a.replaceInput())return A.ctatdebug("replaceInput false, returning null"),null;a=a.evaluateReplacement(b,c.getVariableTable(),A);A.ctatdebug("CTATExampleTracerTracer.replaceInput() returning "+a);return a}function m(a){A.ctatdebug("CTATExampleTracerTracer --\x3e in findBestInterpretation");var b=new CTATExampleTracerInterpretationComparator,c=null;a.forEach(function(a){A.ctatdebug("CTATExampleTracerTracer --\x3e in findBestInterpretation iteration");
null===c||"undefined"===typeof c?(A.ctatdebug("CTATExampleTracerTracer --\x3e in findBestInterpretation first if condition"),c=a):(A.ctatdebug("CTATExampleTracerTracer --\x3e in findBestInterpretation else of first if condition"),0<b.compare(a,c)&&(A.ctatdebug("CTATExampleTracerTracer --\x3e in findBestInterpretation second if condition"),c=a))});A.ctatdebug("CTATExampleTracerTracer --\x3e out of findBestInterpretation");return c}function q(a){A.ctatdebug("CTATExampleTracerTracer --\x3e in setInterpretations");
G.length=0;0===a.size?A.ctatdebug("CTATExampleTracerTracer --\x3e returning from setInterpretations"):(A.ctatdebug("CTATExampleTracerTracer --\x3e setInterpretations c.size: "+a.size),a.forEach(function(a){G.push(a)}),r=null,A.ctatdebug("CTATExampleTracerTracer --\x3e out of setInterpretations"))}function u(){A.ctatdebug("CTATExampleTracerTracer --\x3e in getAllPaths");var a=D.findAllPaths();A.ctatdebug("CTATExampleTracerTracer --\x3e in getAllPaths: #paths "+a.size);a.forEach(function(a){A.ctatdebug("CTATExampleTracerTracer --\x3e in getAllPaths loopring through paths");
A.ctatdebug("CTATExampleTracerTracer --\x3e in getAllPaths size of path"+a.getLinks().size)});return a}function v(a,b,c){A.ctatdebug("CTATExampleTracerTracer --\x3e in doneStepOK: link "+b+", isDone() "+b.isDone());if(null===b||"undefined"===typeof b||!1===b.isDone())return A.ctatdebug("doneStepOK in first if condition"),!0;if(b.isDone()&&D.exitOnIncorrectDone())return!0;if(b.getType().toString()===CTATExampleTracerLink.BUGGY_ACTION.toString())return A.ctatdebug("doneStepOK in second if condition"),
!0;A.ctatdebug("doneStepOK before loop");var d=!0;c.forEach(function(c){if(!1===d)A.ctatdebug("CTATExampleTracerTracer --\x3e we are breaking from the loop");else if(c.getUniqueID()===b.getUniqueID())A.ctatdebug("CTATExampleTracerTracer --\x3e inside second if condition");else{var e=a.getTraversalCount(c);D.hideButRequireSteps()&&(0<e||1>c.getMinTraversals())||!(e<c.getMinTraversals())||(A.ctatdebug("CTATExampleTracerTracer --\x3e we should return false from the second if condition"),d=!1)}});if(!1===
d)return A.ctatdebug("CTATExampleTracerTracer --\x3e out of doneStepOK returning false"),!1;A.ctatdebug("CTATExampleTracerTracer --\x3e out of doneStepOK returning true");return!0}function w(a,b){A.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink");var c=null!==b&&"undefined"!==typeof b&&null!==b[0]&&"undefined"!==typeof b[0]?b[0]:null;if(null===c||"undefined"===typeof c)A.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink first if condition"),c=A.getBestInterpretation();null!==
b&&"undefined"!==typeof b&&(b[0]=c);A.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink interp.getPaths(): "+c.getPaths().size);var d=CTATExampleTracerPath.getBestPath(c.getPaths());A.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink path: "+d);b=B(c,d,a,!1);A.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink highestLink: "+b);if(null!==b&&"undefined"!==typeof b)return A.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink returning highestLink"),b;var e=
null;A.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink returning path.getLinks() "+d.getLinks().size);A.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink returning path.getSortedLinks() "+d.getSortedLinks());var f=!1,g=null;d.getSortedLinks().forEach(function(b){!0!==f&&(A.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink in for loop"+b),e=b,c.getTraversalCount(b)<b.getMaxTraversals()&&(!1===a||0<A.nonEmptyHints(b,c.getVariableTable()))&&D.observesOrderingConstraints(c.getMatchedLinks(),
b,d.getLinks(),null)&&v(c,b,d.getLinks())&&(A.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink in link: "+b),g=b,f=!0))});if(!0===f)return g;A.ctatdebug("CTATExampleTracerTracer --\x3e out of _getBestNextLink, returning: "+e);return null}function B(a,b,c,d){A.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink");var e=new CTATExampleTracerEvent(A,null,CTATMsgType.DEFAULT_STUDENT_ACTOR),f=!0,g=[];b.getSortedLinks().forEach(function(b){A.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink in loop link.getUniqueID(): "+
b.getUniqueID());A.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink in loop interp.isTraversed(link, countOptionalAsTraversed): "+a.isTraversed(b,d));A.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink in loop isNoOp(link): "+C(b));!0===a.isTraversed(b,d)||!0===C(b)?(A.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink in if condition"),f=!0):(!0===f&&(A.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink in second if condition"),
D.getNode(b.getPrevNode()).getOutLinks().forEach(function(b){c&&1>A.nonEmptyHints(b,a.getVariableTable())||a.getTraversalCount(b)>=b.getMaxTraversals()||(A.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink pushing outlink: "+b.getUniqueID()),g.push(b))})),f=null===b||"undefined"===typeof b?!1:b.getMinTraversals()<=a.getTraversalCount(b))});g.sort(function(b,c){return(new CTATExampleTracerLinkComparator(a,A)).compare(b,c)});A.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink before sorting");
var h=!1,m=null;g.forEach(function(c){!0!==h&&(A.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink after sorting in fro loop"),!0===l(c,a,b,A.isDemonstrateMode(),e)?(A.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink after sorting first if"),m=c,h=!0):a.getPaths().forEach(function(d){!0!==h&&(A.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink after sorting in inner loop"),b!==d&&(A.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink after sorting second if"),
!0===l(c,a,d,A.isDemonstrateMode(),e)&&(A.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink after sorting third if"),m=c,h=!0)))}))});if(!0===h)return A.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink returning: "+m.getUniqueID()),m;A.ctatdebug("CTATExampleTracerTracer --\x3e out of getHighestUntraversedLink");return null}function C(a){return null===a||"undefined"===typeof a?!1:1>a.getMinTraversals()&&1>a.getMaxTraversals()}CTATBase.call(this,"CTATExampleTracerTracer",
a);var F=!1,G=null,H=null,E=[],D=a,K=null;CTATExampleTracerTracer_count++;var J=!1,r=null,I={},A=this;this.getModelInitialized=function(){return F};this.setModelInitialized=function(a){F=a};this.goToDone=function(a,b,c){return(a=a.getPathToDone(b))?c.traceLinks(a.getSortedLinks()):!1};this.getMatchedSelections=function(){return I};this.getLastResult=function(){A.ctatdebug("CTATExampleTracerTracer --\x3e in getResult");return K};this.resetTracer=function(){A.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer entering");
null===G||"undefined"===typeof G?(A.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer making interpretations array"),G=[]):(A.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer clearing interpretations array"),G.length=0);var a=new CTATExampleTracerInterpretation(u());A.ctatdebug("CTATExampleTracerTracer tempInterp--\x3e in resetTracer tempInterp "+a);null!==f&&"undefined"!==typeof f&&(A.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer startStateVT if condition"),a.setVariableTable(f));
G.push(a);r=a;if(null===H||"undefined"===typeof H)A.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer incorrectActionMatches if condition"),H={};else{A.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer else branch of incorrectActionMatches if condition");for(var b in H)H.hasOwnProperty(b)&&delete H[b]}I={};a=E?E.slice():[];null===E||"undefined"===typeof E?A.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer saisForReplay empty"):A.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer else branch of last if condition");
E=[];A.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer before iterating over all the links in the graphs");D.getLinks().forEach(function(a){a.getMatcher().resetMatcher()});A.ctatdebug("CTATExampleTracerTracer --\x3e out of resetTracer, oldSAIsForReplay.length "+a.length);return a};this.evaluate=function(a){A.ctatdebug("CTATExampleTracerTracer --\x3e in public evaluate(), calling private _evaluate; given event "+a);return d(a,!1,!0)};this.nonEmptyHints=function(a,b){A.ctatdebug("CTATExampleTracerTracer --\x3e in nonEmptyHints");
if(null===a||"undefined"===typeof a)return 0;b=a.interpolateHints(b);A.ctatdebug("CTATExampleTracerTracer --\x3e in nonEmptyHints: link.interpolateHints() "+a.interpolateHints().length);if(null===b||"undefined"===typeof b||1>b.length)return 0;for(var c=a=0;c<b.length;++c)0<String(b[c]).trim().length&&a++;A.ctatdebug("CTATExampleTracerTracer --\x3e returning from nonEmptyHints "+a);return a};this.traceForHint=function(a){A.ctatdebug("CTATExampleTracerTracer --\x3e in traceForHint");var b=d(a,!0,!1);
A.ctatdebug("CTATExampleTracerTracer --\x3e in traceForHint return from evaluate "+b);A.ctatdebug("CTATExampleTracerTracer --\x3e in traceForHint result from evaluate "+a.getResult().toString());A.ctatdebug("CTATExampleTracerTracer --\x3e in traceForHint link   from evaluate "+a.getReportableLink());if(a.getResult().toString()===CTATExampleTracerLink.CORRECT_ACTION.toString())return b=a.getReportableLink(),a.setTutorSAI(new CTATSAI(a.getStudentSAI().getSelection(),b.getDefaultSAI().getAction(),b.getDefaultSAI().getInput())),
a.setActor(CTATMsgType.DEFAULT_STUDENT_ACTOR),A.ctatdebug("CTATExampleTracerTracer --\x3e traceForHint returning hintLink "+b+", result "+a),b;A.ctatdebug("CTATExampleTracerTracer --\x3e out of traceForHint, returning null");return null};this.matchForHint=function(a){A.ctatdebug("CTATExampleTracerTracer --\x3e in matchForHint");var b;if((b=(b=a.getStudentSAI())?b.getSelectionArray():null)&&0<b.length&&(A.ctatdebug("CTATExampleTracerTracer --\x3e in matchForHint first if"),(b=A.traceForHint(a))&&0<
a.getReportableHints().length))return A.ctatdebug("CTATExampleTracerTracer --\x3e matchForHint via traceForHint returning "+b+", reportable hints "+a.getReportableHints()),a.setResult(CTATExampleTracerLink.HINT_ACTION),a.setTraceOutcome(CTATExampleTracerLink.HINT_ACTION),b;b=A.getBestNextLink(!0,a);a.setResult(CTATExampleTracerLink.HINT_ACTION);a.setTraceOutcome(0<a.getReportableHints().length?CTATExampleTracerLink.HINT_ACTION:CTATExampleTracerLink.NO_MODEL);A.ctatdebug("CTATExampleTracerTracer --\x3e matchForHint() traceForHint via getBestNextLink returning "+
b+", reportable hints "+a.getReportableHints());return b};this.getBestNextLink=function(a,b){A.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink");var c=[];a=w(a,c);if(null===a||"undefined"===typeof a)return A.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink returning null"),null;if(a.getType().toString()===CTATExampleTracerLink.BUGGY_ACTION.toString())return A.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink return null no correct suboptimal step"),null;A.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink else branch");
A.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink got interp "+(null==c?"null":c[0]));if(b){var d=a.interpolateHints(c[0].getVariableTable());b.setInterpolatedHints(d);A.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink setInterpolatedHints");Array.isArray(d)&&0<d.length?b.setReportableHints(d):b.setReportableHints(a.getHints());A.ctatdebug("In evaluate --\x3e after setReportableHints");c&&c[0]&&c[0].setLatestHints(d,a.getHints());b.setReportableLink(a);b.setAssociatedSkills(a.getSkillNames());
b.setReportableInterpretation(c[0]);b.setResult(a.getType());b.setTraceOutcome(a.getType());b.setStepID(a.getUniqueID());b.setTutorSAI(a.getDefaultSAI())}A.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink return etLink");return a};this.doHint=function(a,b){A.ctatdebug("CTATExampleTracerTracer --\x3e in doHint");var c=A.matchForHint(a);Array.isArray(b)&&(A.ctatdebug("CTATExampleTracerTracer --\x3e in doHint last if condition"),b.push(a));A.ctatdebug("CTATExampleTracerTracer --\x3e returning from doHint: "+
c);return c};this.getBestInterpretation=function(){A.ctatdebug("CTATExampleTracerTracer --\x3e in getBestInterpretation");if(null===r||"undefined"===typeof r)A.ctatdebug("CTATExampleTracerTracer --\x3e in getBestInterpretation in if condition"),r=m(A.getInterpretationsInternal());A.ctatdebug("CTATExampleTracerTracer --\x3e out of getBestInterpretation "+(null===r||void 0===r));return r};this.getInterpretationsInternal=function(){A.ctatdebug("CTATExampleTracerTracer --\x3e in getInterpretationsInternal");
return G};this.toString=function(){var a="TracerState\n";null===G?a+="(no interpretations)\n":G.forEach(function(b){a+=b.toString()+"\n"});return a};this.addInterfaceVariablesFromEvent=function(a){if(a){var b=a.getTutorSelection();a=a.getTutorInput();A.addInterfaceVariables(b,a)}};this.addInterfaceVariables=function(a,b){A.ctatdebug("CTATExampleTracerTracer.addInterfaceVariables("+a+", "+b+")");if(a&&b){var c=a.length;c>b.length&&(c=b.length);for(var d=0;d<c;d++)a[d]&&(f.put(a[d],CTATVariableTable.standardizeType(b[d])),
f.put(CTATVariableTable.nameAsString(a[d]),CTATVariableTable.valueAsString(b[d])));A.ctatdebug("CTATExampleTracerTracer.addInterfaceVariables() startStateVT "+f);G&&G.forEach(function(d){if(d=d.getVariableTable()){for(var e=0;e<c;e++)a[e]&&(d.put(a[e],CTATVariableTable.standardizeType(b[e])),d.put(CTATVariableTable.nameAsString(a[e]),CTATVariableTable.valueAsString(b[e])));A.ctatdebug("CTATExampleTracerTracer.addInterfaceVariables() interp.vt "+d)}})}};this.findCurrentState=function(){A.ctatdebug("Entering findCurrentState");
var a=A.getBestInterpretation(),b=null,c=-1;return a&&(b=a.getLastMatchedLink())&&(c=b.getNextNode(),b.isDone())?c:(a=w(!1,[a]))?a.getPrevNode():0<c&&1>D.getNode(c).getTraversableOutDegree()?c:D?D.getStartNode().getNodeID():null};this.saveLastReport=function(a){G&&a&&G.forEach(function(b){b.setLatestHints(a.getReportableHints()||[]);var c=a.getSuccessOrBuggyMsg()||[];a.getResult()==CTATExampleTracerLink.CORRECT_ACTION?(b.setLatestSuccessMessage(0<c.length?c[0]:""),b.setLatestBuggyMessage("")):(b.setLatestSuccessMessage(""),
b.setLatestBuggyMessage(0<c.length?c[0]:""))})};this.addDemonstratedLink=function(a){var b=D.getNode(A.findCurrentState());if(!b)return console.log("CTATExampleTracerTracer.addDemonstratedLink(",a,"): findCurrentState() returns null or 0"),null;var c=b.getDimension()||{x:50,y:50},c=D.addNewNode({x:c.x,y:c.y+40});return D.addNewEdge(b,c,a)};this.getCurrentState=function(){var a=A.getBestInterpretation();return a?a.getCurrentState(D):D&&D.getStartNode()&&D.getStartNode().getNodeID()};this.replay=function(){D.redoLinkDepths();
for(var a=A.resetTracer(),b=null,c=0;c<a.length;++c){var d=a[c],b=new CTATExampleTracerEvent(A,d.sai,d.actor);console.log("ETT.replay["+c+"]("+d.sai+","+d.actor+") returns",A.evaluate(b,!1,!0),"result",b.toString(),"current state",A.findCurrentState())}return b};this.isDemonstrateMode=function(){return"demonstrate"==J};this.isInitialValuesDemonstrateMode=function(){return"initialValuesDemonstrate"==J};this.setMode=function(a){J=a};this.getMode=function(){return J}};
CTATExampleTracerTracer.prototype=Object.create(CTATBase.prototype);CTATExampleTracerTracer.prototype.constructor=CTATExampleTracerTracer;"undefined"!==typeof module&&(module.exports=CTATExampleTracerTracer);var CTATExampleTracerGraph=function(a,f,g){function e(a,c,e){z.ctatdebug("CTATExampleTracerGraph --\x3e in isOrderOK");if(z.relaxOrderConstraints()||c.isDone()&&z.exitOnIncorrectDone())return!0;for(var f=b(c),g=0;g<f.length;g++){var l=f[g];if(!0===L.isGroupOrdered(l))if(g!==f.length-1){if(!1===d(l,h(f[g+1],e),a,e))return!1}else if(!1===d(l,c,a,e))return!1}z.ctatdebug("CTATExampleTracerGraph --\x3e out of isOrderOK");return!0}function c(a,c,d){z.ctatdebug("CTATExampleTracerGraph --\x3e in isReenteringOK");
if(z.relaxOrderConstraints()||c.isDone()&&z.exitOnIncorrectDone())return!0;c=b(c);for(var e=!0,f=0;f<c.length;f++)if(!0===e&&!1===L.isGroupReenterable(c[f]))for(var e=!1,g=0;g<a.length;g++)if(!0===L.isLinkInGroup(c[f],a[g]))e=!0;else{if(!0===e)return!1}else if(!1===e)break;if(0!==a.length){var h=b(a[a.length-1]);z.ctatdebug("CTATExampleTracerGraph --\x3e in isReentrableOK: exitedGroups null? "+(null===h));z.ctatdebug("CTATExampleTracerGraph --\x3e in isReentrableOK: exitedGroups undefined? "+("undefined"===
typeof h));z.ctatdebug("CTATExampleTracerGraph --\x3e in isReentrableOK: exitedGroups last traversedLink "+a[a.length-1].getUniqueID());z.ctatdebug("CTATExampleTracerGraph --\x3e in isReentrableOK: exitedGroups length "+(h?h.length:null));c.forEach(function(a){a=h.indexOf(a);0<=a&&h.splice(a,1)});z.ctatdebug("CTATETGraph.isReentrableOK: exitedGroups.length after removing newLink's groups: "+h.length);for(k=h.length-1;0<=k;k--)L.isGroupReenterable(h[k])&&h.splice(k,1);z.ctatdebug("CTATETGraph --\x3e in isReentrableOK: exitedGroups after removing reenterables: "+
h.length);z.ctatdebug("CTATETGraph --\x3e in isReentrableOK: traversedLinks: "+a+", path: "+d);var l=!0;h.forEach(function(b){!1!==l&&d.forEach(function(c){!1!==l&&n(a,c)<c.getMinTraversals()&&!0===L.isLinkInGroup(b,c)&&(l=!1)})});if(!1===l)return!1}z.ctatdebug("CTATExampleTracerGraph --\x3e out of isReenteringOK");return!0}function b(a){z.ctatdebug("in findGroupsOfLink(link "+a+"): typeof(groupModel) "+typeof L);a=L.getGroupsContainingLink(a);z.ctatdebug("in findGroupsOfLink groupsSet.size "+a.size);
var b=[];a.forEach(function(a){z.ctatdebug("in findGroupsOfLink group element "+a.getName());b.push(a)});b.sort(function(a,b){return L.getGroupLinkCount(b)-L.getGroupLinkCount(a)});return b}function d(a,b,c,d){var e=-1,f=null,g=Number.MAX_VALUE,l=null;L.getGroupSubgroups(a).forEach(function(a){if(!1===L.isLinkInGroup(a,b)&&0!==L.getGroupLinkCount(a)){var n=h(a,d);null!==n&&"undefined"!==typeof n&&(n=n.getDepth(),n<b.getDepth()&&n>e&&(!1===p(a)||!0===m(a,c))&&(e=n,f=a),n>b.getDepth()&&n<g&&(!1===p(a)||
!0===m(a,c))&&(g=n,l=a))}});L.getUniqueLinks(a).forEach(function(a){if(!0===d.has(a)){var h=a.getDepth();h<b.getDepth()&&h>e&&(0<a.getMinTraversals()||-1<c.indexOf(a))&&(e=h,f=a);h>b.getDepth()&&h<g&&(0<a.getMinTraversals()||-1<c.indexOf(a))&&(g=h,l=a)}});if(null!==f&&"undefined"!==typeof f)if(f instanceof CTATExampleTracerLink){if(n(c,f)<f.getMinTraversals())return!1}else if(f instanceof CTATLinkGroup&&!1===q(f,c,d))return!1;return null!==l&&"undefined"!==typeof l&&(l instanceof CTATExampleTracerLink&&
-1<c.indexOf(l)||l instanceof CTATLinkGroup&&!0===m(l,c))?!1:!0}function h(a,b){var c=Number.MAX_VALUE,d=null;L.getGroupLinks(a).forEach(function(a){a.getDepth()<c&&!0===b.has(a)&&(c=a.getDepth(),d=a)});return d}function n(a,b){for(var c=0,d=0;d<a.length;d++)b===a[d]&&c++;z.ctatdebug("CTATETGraph.getTraversalCount("+b+"): "+c);return c}function l(a,b,c){var d=!1,e=!0,f=!1;(new CTATExampleTracerPath(b)).getSortedLinks().forEach(function(b){if(!1!==e&&!0!==f){if(!1===d)!0===L.isLinkInGroup(a,b)&&(d=
!0);else if(!1===L.isLinkInGroup(a,b)){f=!0;return}c.getTraversalCount(b)<b.getMaxTraversals()&&(e=!1)}});return!1===e?!1:!0}function p(a){var b=!0;L.getGroupLinks(a).forEach(function(a){!1!==b&&0!==a.getMinTraversals()&&(b=!1)});return!1===b?!1:!0}function m(a,b){for(var c=0;c<b.length;c++)if(!0===L.isLinkInGroup(a,b[c]))return!0;return!1}function q(a,b,c){var d=!0;L.getGroupLinks(a).forEach(function(a){!1!==d&&!0===c.has(a)&&n(b,a)<a.getMinTraversals()&&(d=!1)});return!1===d?!1:!0}function u(){for(var a=
0;a<F.length;a++)F[a].clearInLinks();var b=z.getStartNode();null!==b&&"undefined"!==typeof b&&null!==b.getOutLinks()&&"undefined"!==typeof b.getOutLinks()&&(a=0,b.getOutLinks().forEach(function(b){v(b,a++)}))}function v(a,b){ctatdebug("updateInLinkSubGraph("+a+", "+b+")");b=z.getNode(a.getNextNode());if(null!==b&&"undefined"!==typeof b){b.addInLink(a);var c=0;b.getOutLinks().forEach(function(a){v(a,c++)})}}function w(a){var b=z.getNode(a.getPrevNode());if(null!==b&&"undefined"!==typeof b){var c=-1;
b.getInLinks().forEach(function(a){-1===a.getDepth()&&w(a);a.getDepth()>c&&(c=a.getDepth())});a.setDepth(c+1)}}function B(a){var b=z.getGroupModel(),c=b.getTopLevelGroup(),d="",e=c.getSubgroups(),d=a+'<EdgesGroups ordered="'+c.getIsOrdered()+'">\n';e.forEach(function(c){d+=c.toXML(a+"    ",b)});return d+=a+"</EdgesGroups>\n"}CTATBase.call(this,"CTATExampleTracerGraph","visualdata");var C=null,F=null,G=null,H=null,E=null,D=!0,K=null,J="",r=[],I=new Set,A=new Set,P=null,L=null,N=!0,R=!0,Q=CTATMsgType.SHOW_ALL_FEEDBACK,
z=this;this.getAllNodes=function(){var a=[],b;for(b in H)a.push(H[b]);return a};this.getFeedbackPolicy=function(){return Q};this.setFeedbackPolicy=function(a){z.ctatdebug("Graph.setFeedbackPolicy("+a+") old policy "+Q);Q="false"===a?CTATMsgType.SHOW_ALL_FEEDBACK:"true"===a?CTATMsgType.HIDE_ALL_FEEDBACK:a};this.hideButRequireSteps=function(){return Q==CTATMsgType.HIDE_BUT_COMPLETE};this.hideAllFeedback=function(){return Q==CTATMsgType.HIDE_ALL_FEEDBACK};this.relaxOrderConstraints=function(){return z.hideAllFeedback()||
z.hideButRequireSteps()||Q==CTATMsgType.DELAY_FEEDBACK};this.exitOnIncorrectDone=function(){switch(Q){case CTATMsgType.HIDE_ALL_FEEDBACK:case CTATMsgType.HIDE_BUT_ENFORCE:return!0;default:return!1}};this.getDefaultBuggyMsg=function(){return L.getTopLevelGroup()?L.getTopLevelGroup().getDefaultBuggyMsg():null};this.getLinks=function(){z.ctatdebug("CTATExampleTracerGraph --\x3e in getLinks");return G};this.addLink=function(a,b){z.ctatdebug("CTATExampleTracerGraph --\x3e in addLink");z.updateMaxEdgeID(a.getUniqueID());
G.push(a);a.isDone()?A.add(a):A.delete(a);null===b||"undefined"===typeof b?L.addLinkToGroup(L.getTopLevelGroup(),a):L.addLinkToGroup(b,a);z.ctatdebug("CTATExampleTracerGraph --\x3e out of addLink")};this.addNode=function(a){z.ctatdebug("CTATExampleTracerGraph --\x3e in addNode");F.push(a);H[z.updateMaxNodeID(a.getNodeID())]=a;z.ctatdebug("CTATExampleTracerGraph --\x3e out of addNode")};this.addNewNode=function(a){var b=++z.maxNodeID,c=new CTATExampleTracerNode(b,new Set);c.setNodeName("state"+b);
a&&c.setDimension({x:a.x,y:a.y});z.addNode(c);return c};this.addNewEdge=function(a,b,c,d){var e=++z.maxEdgeID,e=new CTATExampleTracerLink(e,a.getNodeID(),b.getNodeID());a.addOutLink(e);e.setDemoMsgObj(CTATMessage.fromString((new CTATTutoringServiceMessageBuilder).createInterfaceActionMessage(CTATGuid.guid(),c)));e.addHint(CTATExampleTracerLink.createDefaultHint(c.getSelection(),c.getAction(),c.getInput()));var f=new CTATExactMatcher(CTATMatcher.SELECTION,null);f.setParameter(String(c.getSelection()));
var g=new CTATExactMatcher(CTATMatcher.ACTION,null);g.setParameter(String(c.getAction()));var h=new CTATExactMatcher(CTATMatcher.INPUT,null);h.setParameter(String(c.getInput()));d=new CTATVectorMatcher([f],[g],[h],d||CTATMsgType.DEFAULT_STUDENT_ACTOR);d.setDefaultSAI(c);d.setCaseInsensitive(z.getCaseInsensitive());d.setLinkTriggered(!1);e.setMatcher(d);z.checkForDoneState(e);z.addLink(e);window.postMessage({command:"tutorEdited",details:{edit:"addLink",linkid:e.getUniqueID(),prevNode:a.getNodeID(),
nextNode:b.getNodeID(),linktype:e.getType(),selection:c.getSelection(),action:c.getAction(),input:c.getInput()}},location.origin);return e};this.maxEdgeID=0;this.updateMaxEdgeID=function(a){return z.maxEdgeID<a?z.maxEdgeID=a:a};this.maxNodeID=0;this.updateMaxNodeID=function(a){return z.maxNodeID<a?z.maxNodeID=a:a};this.findAllPaths=function(){ctatdebug("CTATExampleTracerGraph --\x3e in findAllPaths "+z.getStartNode().getNodeID());return z.findPathsFromNode(z.getStartNode())};this.pathToLinkIsSubset=
function(a,b){var c=z.getNode(a.getPrevNode());z.ctatdebug("pathToLinkIsSubset("+a+") sourceNode "+c.getNodeID());if(0<a.getMinTraversals()&&"undefined"==typeof b[a.getUniqueID()])return!1;if(c==z.getStartNode())return!0;for(a=c.getInLinks().values();!(a=a.next()).done;)return z.pathToLinkIsSubset(a.value,b);return!1};this.observesOrderingConstraints=function(a,b,d,f){z.ctatdebug("CTATExampleTracerGraph --\x3e in observesOrderingConstraints");null!==f&&"undefined"!==typeof f&&(z.ctatdebug("CTATExampleTracerGraph --\x3e in observesOrderingConstraints initializing out of order false"),
f.setOutOfOrder(!1));if(null===d||"undefined"===typeof d||0===d.size||null===b||"undefined"===typeof b)return z.ctatdebug("CTATExampleTracerGraph --\x3e returning first true observesOrderingConstraints"),!0;if(b.isDone()&&z.exitOnIncorrectDone())return z.ctatdebug("CTATExampleTracerGraph.observesOrderingConstraints --\x3e returning true for doneStep && exitOnIncorrectDone"),!0;if(!0===d.has(b)&&!0===e(a,b,d)&&!0===c(a,b,d))return z.ctatdebug("CTATExampleTracerGraph.observesOrderingConstraints --\x3e returning isOrderOK true && isisReenteringOK() true"),
!0;null!==f&&"undefined"!==typeof f&&(z.ctatdebug("CTATExampleTracerGraph --\x3e in observesOrderingConstraints setting out of order true"),f.setOutOfOrder(!0));z.ctatdebug("CTATExampleTracerGraph --\x3e returning false observesOrderingConstraints");return!1};this.isIncorrectLinkOK=function(a,b,c,d){z.ctatdebug("CTATExampleTracerGraph --\x3e in isIncorrectLinkOK");var f=!1,g=null,h=!0,m=!1;z.getNode(b.getPrevNode()).getOutLinks().forEach(function(b){!0!==m&&!1!==h&&b.getType().toString()!==CTATExampleTracerLink.BUGGY_ACTION.toString()&&
!0===c.has(b)&&(f=!0,!1===e(a,b,c)?h=!1:(g=b,m=!0))});if(!1===h||null===g||"undefined"===typeof g)return!1;if(!1===f)return z.ctatdebug("isIncorrectLinkOK(): no siblings of link in path"),!1;if(!0===f&&(b=z.getSmallestContainingGroup(b),!0===L.isLinkInGroup(b,g)&&!1===L.isGroupOrdered(b)&&!0===l(b,c,d)))return!1;z.ctatdebug("CTATExampleTracerGraph --\x3e out of isIncorrectLinkOK");return!0};this.toXML=function(a){var b=this.getLinks(),c=z.getGroupModel().getTopLevelGroup().getIsOrdered(),d;d='<?xml version="1.0" standalone="yes"?>\n<stateGraph firstCheckAllStates="true" caseInsensitive="'+
z.getCaseInsensitive();d=d+('" unordered="'+!c)+('" lockWidget="'+z.getLockWidget());d+='" hintPolicy="'+(a&&a.getHintPolicy()||CTATHintPolicyEnum.DEFAULT);d=d+'" version="4.0'+('" suppressStudentFeedback="'+z.isFeedbackSuppressed());d+='" highlightRightSelection="'+z.isHighlightRightSelection();d+='" confirmDone="'+a.getConfirmDone();d+='" startStateNodeName="'+z.getStudentStartStateNodeName();d+='" tutorType="Example-tracing Tutor">\n';for(var c=this.getStartStateMsgs(),e="    <startNodeMessages>\n",
f=0;f<c.length;f++)e+="        "+c[f].outerHTML+"\n";d+=e+"    </startNodeMessages>\n";for(c=0;c<F.length;c++)d+=F[c].toXML("    ")+"\n";for(c=0;c<b.length;c++)d+=b[c].toXML("    ")+"\n";b=d;a=a.getGraphSkills();d="";for(c=0;c<a.length;c++)d+="    <productionRule>\n",d+="        <ruleName>"+CTATExampleTracerSkill.getName(a[c].getSkillName())+"</ruleName>\n",d+="        <productionSet>"+a[c].getCategory()+"</productionSet>\n",d+="        <label>"+a[c].getLabel()+"</label>\n",d+="        <description>"+
a[c].getDescription()+"</description>\n",d+="    </productionRule>\n";d=b+d+B("    ");return d+="</stateGraph>\n"};this.addGroup=function(a,b,c){};this.getCaseInsensitive=function(){return R};this.setCaseInsensitive=function(a){R=a};this.getLockWidget=function(){return N};this.setLockWidget=function(a){N=a};this.isFeedbackSuppressed=function(){return feedbackSuppressed};this.setFeedbackSuppressed=function(a){feedbackSuppressed="false"===a?!1:"true"===a?!0:a===CTATMsgType.SHOW_ALL_FEEDBACK?!1:a===
CTATMsgType.HIDE_ALL_FEEDBACK?!0:a===CTATMsgType.HIDE_BUT_ENFORCE?!0:a===CTATMsgType.HIDE_BUT_COMPLETE?!0:!1;z.ctatdebug("setFeedbackSuppressed("+a+"): "+feedbackSuppressed);problemSummary&&problemSummary.setCountOnlyLastResults(feedbackSuppressed)};this.isHighlightRightSelection=function(){return D};this.setHighlightRightSelection=function(a){D=a};this.getStartStateMsgs=function(){return r};this.setStartStateMsgs=function(a){r=a};this.convertStartStateToTPAs=function(a,b){var c=[],d=[],e=new XMLSerializer;
a.forEach(function(a){if("message"==b.getElementName(a)){var f=e.serializeToString(a),f=CTATMsgType.getMessageType(f);CTATMsgType.UNTUTORED_ACTION==f||CTATMsgType.INTERFACE_ACTION==f?(a=CTATMsgType.getSAIArraysFromElement(a,b),d.push(new CTATSAI(a.selection[0]||"",a.action[0]||"",a.input[0]||""))):c.push(a)}});a=z.addStartStateLinks(d);z.setStartStateMsgs(c);console.log("convertStartStateToTPAs() addedLinkIDs",a);return c};this.addStartStateLinks=function(a){var b=[],c=null,d=z.getStartNode().getNodeID();
a.forEach(function(a){return(c=z.addStartStateLink(a,d))&&(d=c.getNextNode())&&b.push(c.getUniqueID())});return b};this.addStartStateLink=function(a,b){b=z.getNode(0<b?b:z.findEndOfStartState());if(!b)return console.log("CTATExTrGraph.addStartStateLink(",a,"): findEndOfStartState() returns null or 0"),null;var c=b.getDimension()||{x:50,y:50},c=z.addNewNode({x:c.x+60,y:c.y+40}),d=z.moveOutLinks(b,c,!1);console.log("addSSL.moveOutLinks(",b.getNodeID(),c.getNodeID(),")",d);return z.addNewEdge(b,c,a,
CTATMsgType.UNGRADED_TOOL_ACTOR)};this.moveOutLinks=function(a,b,c){var d=[];a.getOutLinks().forEach(function(a){return d.push(a.getUniqueID())});var e="";d.forEach(function(a){return(e=z.rerouteLink(a,b.getNodeID(),!1,c))&&console.log("Error in moveOutLinks.rerouteLink(",a,b.getNodeID(),"):",e)});return d};this.getNode=function(a){z.ctatdebug("CTATExampleTracerGraph --\x3e in getNode("+a+") returning "+H[a]);return H[a]};this.findNode=function(a){if(a){a=a.toLowerCase();for(var b in H)if(H[b].getNodeName().toLowerCase()==
a)return z.getNode(b);if("start"==a)return z.getStudentStartsHereNode()||z.getStartNode()}return null};this.isStartStateLink=function(a){return z.getStartStateLink(a)};this.getStartStateLinks=function(a){for(var b=[],c=z.getStartNode().getOutLinks(),d=null;2>c.size&&(d=c.entries().next())&&(d=d.value&&d.value[0])&&d.isTutorPerformed(null)&&0<d.getMaxTraversals();c=z.getNode(d.getNextNode()).getOutLinks()){if(a==d.getUniqueID())return d;b.push(d)}return Number.isInteger(a)?null:b};this.findEndOfStartState=
function(){var a=z.getStartStateLinks().pop();return a?a.getNextNode():z.getStartNode().getNodeID()};this.deleteSubtree=function(a){var b=z.getNode(a);if(!b)return"Could not find state with ID "+a;if(b==z.getStartNode())return"Cannot delete the origin state "+b.getNodeName()+"(ID "+a+")";console.log("deleteSubtree nodeID, name, inLinks",a,b.getNodeName(),b.getInLinks().size);if(1<b.getInLinks().size)return"";var c="";try{b.getOutLinks().forEach(function(a){var b=a.getNextNode(),d=z.getNode(b),e=d&&
d.getNodeName()||"null";if(c=d?z.deleteSubtree(d.getNodeID()):"Could not find destination state with ID "+b+" from link with ID "+a.getUniqueID())throw Error("Error deleting subtree at state "+e()+"(ID "+b+"): "+c);})}catch(V){return V.toString()}try{if(c=z.deleteNode(a))throw Error("Error deleting state "+b.getNodeName()+"(ID "+a+"): "+c);}catch(V){return V.toString()}return""};this.deleteNode=function(a){var b=z.getNode(a);if(!b)return"Could not find state with ID "+a;if(b==z.getStartNode())return"Cannot delete the origin state "+
b.getNodeName()+"(ID "+a+")";var c="";try{b.getOutLinks().forEach(function(d){if(c=z.deleteLink(d.getUniqueID()))throw Error("Error deleting outgoing link "+d.getUniqueID()+" from state "+b.getNodeName()+"(ID "+a+"): "+c);})}catch(V){return V.toString()}try{b.getInLinks().forEach(function(d){if(c=z.deleteLink(d.getUniqueID()))throw Error("Error deleting incoming link "+d.getUniqueID()+" from state "+b.getNodeName()+"(ID "+a+"): "+c);})}catch(V){return V.toString()}b.getNodeName()==z.getStudentStartStateNodeName()&&
z.setStudentStartsHereNode(z.getStartNode());F.splice(F.indexOf(b),1);return""};this.deleteLink=function(a){for(var b=null,c=-1;!b&&++c<G.length;)G[c].getUniqueID()==a&&(b=G[c]);if(!b)return"Error: cannot find link with ID "+a;var d=z.getNode(b.getPrevNode()),e=z.getNode(b.getNextNode());if(!d)return"Error: cannot find source state (ID "+b.getPrevNode()+") for link "+a;if(!e)return"Error: cannot find destination state (ID "+b.getNextNode()+") for link "+a;z.getGroupModel().removeLink(b);A.delete(b);
G.splice(c,1);d.deleteOutLink(b);e.deleteInLink(b);return""};this.rerouteLink=function(a,b,c,d){var e=z.getLinkByID(a),f=z.getNode(b);if(!e)return"Error: cannot find link with ID "+a;if(!f)return"Error: cannot find state with ID "+b;if(b==e.getNextNode()||b==e.getPrevNode())return"Error: link "+a+" is already connected to state "+f.getNodeName();a=$jscomp.makeIterator(f.getInLinks().values());for(var g=a.next();!g.done;g=a.next())if(g.value.getType()==CTATExampleTracerLink.BUGGY_ACTION)return"Error: cannot attach links after incorrect actions";
if(c){d=z.getNode(e.getNextNode());if(!d)return"Error: could not find state for previous destination, id "+e.getNextNode();d.deleteInLink(e);f.addInLink(e);e.setNextNode(b)}else{c=z.getNode(e.getPrevNode());if(!c)return"Error: could not find state for previous source, id "+e.getPrevNode();c.deleteOutLink(e,d);f.addOutLink(e,d);e.setPrevNode(b)}z.redoLinkDepths();z.getExampleTracer().resetTracer();return""};this.findPathsFromNode=function(a){z.ctatdebug("CTATExampleTracerGraph --\x3e in findPathsFromNode outlinks "+
a.getOutLinks().size);var b=new Set;if(!a||0===a.getOutLinks().size)return b.add(new CTATExampleTracerPath(null)),b;z.ctatdebug("CTATExampleTracerGraph --\x3e before forEach ");a.getOutLinks().forEach(function(a){z.ctatdebug("CTATExampleTracerGraph --\x3e in forEach "+a.getType().toString());if(a.getType().toString()!=CTATExampleTracerLink.BUGGY_ACTION.toString()){var c=z.findPathsFromNode(z.getNode(a.getNextNode()));z.ctatdebug("findPathsFromNode childPaths.size "+c.size);c.forEach(function(c){z.ctatdebug("findPathsFromNode childPath.size "+
c.size+", outLink "+a);c.addLink(a);b.add(c)})}},a);0===b.size&&b.add(new CTATExampleTracerPath(null));z.ctatdebug("CTATExampleTracerGraph --\x3e out of findPathsFromNode "+b.size);return b};this.getDoneStates=function(){return I};this.checkForDoneState=function(a){if(a.isDone()&&a.isTraversable()){var b=z.getNode(a.getNextNode());z.ctatdebug("CTATExampleTracerGraph.addDoneState(linkID "+a.getUniqueID()+") adding destNode "+b);I.add(b)}};this.getBestSubpath=function(a,b,c){if(!a||!b)return null;var d=
z.findPathsFromNode(a),e=new Set;d.forEach(function(a){a=a.subpath(b);!a||c&&!a.containsAll(c)||e.add(a)});z.ctatdebug("CTATExampleTracerGraph.getBestSubpath("+a+", "+b+", ["+(c?c.length:-1)+"]) pathsFrom "+d.size+", pathsFromTo "+e.size);return 1>e.size?null:CTATExampleTracerPath.getBestPath(e)};this.getStartNode=function(){z.ctatdebug("CTATExampleTracerGraph --\x3e in getStartNode() returning "+E);return E};this.getLinkByID=function(a){z.ctatdebug("CTATExampleTracerGraph --\x3e in getLinkByID");
for(var b=0;b<G.length;b++)if(G[b].getUniqueID()===a)return G[b];z.ctatdebug("CTATExampleTracerGraph --\x3e out of getLinkByID");return null};this.setStartNode=function(a){z.ctatdebug("CTATExampleTracerGraph --\x3e in setStartNode("+a+")");E=a};this.getStudentStartsHereNode=function(){return null!=K?K:z.getStartNode()};this.setStudentStartsHereNode=function(a){z.ctatdebug("CTATExampleTracerGraph --\x3e in setStudentStartsHereNode("+a+")");K=a};this.setStudentStartStateNodeName=function(a){J=a};this.getStudentStartStateNodeName=
function(){return J};this.getExampleTracer=function(){z.ctatdebug("CTATExampleTracerGraph --\x3e in getExampleTracer() returning "+C);return C};this.forDebugging=function(){z.ctatdebug("CTATExampleTracerGraph --\x3e in forDebugging");z.ctatdebug("Nodes in the graph -- ids");F.forEach(function(a){z.ctatdebug(a.getNodeID())});z.ctatdebug("Links in the graph -- ids, from, to");G.forEach(function(a){z.ctatdebug(a)})};this.getSmallestContainingGroup=function(a){return L.getLowestLevelGroupOfLink(a)};this.redoLinkDepths=
function(){u();z.getLinks().forEach(function(a){a.setDepth(-1)});z.getLinks().forEach(function(a){-1===a.getDepth()&&w(a)})};this.getGroupModel=function(){return L};this.setVisualData=function(a){z.ctatdebug("CTATExampleTracerGraph --\x3e in setVisualData");P=a};this.getVisualData=function(){z.ctatdebug("CTATExampleTracerGraph --\x3e in getVisualData() returning "+P);return P};this.getDoneLinks=function(){return A};(function(a,b){z.ctatdebug("CTATExampleTracerGraph --\x3e in initGraph ("+a+" , "+
b);G=[];F=[];H={};if(null===L||"undefined"===typeof L)L=new CTATDefaultGroupModel,z.ctatdebug("CTATExampleTracerGraph --\x3e created a group model from here");L.clear();L.setDefaultReenterable(!b);L.setGroupOrdered(L.getTopLevelGroup(),a);L.setGroupName(L.getTopLevelGroup(),CTATExampleTracerGraph.TOP_LEVEL);C=new CTATExampleTracerTracer(z,g);z.ctatdebug("CTATExampleTracerGraph --\x3e out of initGraph")})(!a,f)};
Object.defineProperty(CTATExampleTracerGraph,"TOP_LEVEL",{enumerable:!1,configurable:!1,writable:!1,value:"Top Level"});Object.defineProperty(CTATExampleTracerGraph,"STUDENT_BEGINS_HERE_VAR",{enumerable:!1,configurable:!1,writable:!1,value:"%(startStateNodeName)%"});Object.defineProperty(CTATExampleTracerGraph,"IS_ORDERED",{enumerable:!1,configurable:!1,writable:!1,value:"ordered"});CTATExampleTracerGraph.prototype=Object.create(CTATBase.prototype);CTATExampleTracerGraph.prototype.constructor=CTATExampleTracerGraph;
"undefined"!==typeof module&&(module.exports=CTATExampleTracerGraph);var CTATGraphParser=function(){function a(a){ctatdebug("processEdge()");for(var c=new CTATExampleTracerLink(null,null,null),g=d.getElementChildren(a),h,l,m,n,q,H=a=-1,E=CTATMsgType.DEFAULT_ACTOR,D=!1,K=0;K<g.length;K++){"sourceID"===d.getElementName(g[K])&&(a=parseInt(d.getNodeTextValue(g[K])),c.setPrevNode(a));"destID"===d.getElementName(g[K])&&(H=parseInt(d.getNodeTextValue(g[K])),c.setNextNode(H));if("rule"===d.getElementName(g[K]))for(var J=d.getElementChildren(g[K]),r=0;r<J.length;r++)"text"===
d.getElementName(J[r])&&c.addSkillName(d.getNodeTextValue(J[r]).toString());if("actionLabel"===d.getElementName(g[K]))for(c.setIsPreferredLink("false"!=d.getElementAttr(g[K],"preferPathMark")),c.setMinTraversalsStr(d.getElementAttr(g[K],"minTraversals")),c.setMaxTraversalsStr(d.getElementAttr(g[K],"maxTraversals")),J=d.getElementChildren(g[K]),r=0;r<J.length;r++){"uniqueID"===d.getElementName(J[r])&&(q=d.getNodeTextValue(J[r]),c.setUniqueID(parseInt(d.getNodeTextValue(J[r]))));"message"===d.getElementName(J[r])&&
(n=new CTATMessage(J[r]),c.setDemoMsgObj(n));"actionType"===d.getElementName(J[r])&&c.setActionType(d.getNodeTextValue(J[r]));"buggyMessage"===d.getElementName(J[r])&&c.addBuggyMsg(d.getNodeTextValue(J[r]));"successMessage"===d.getElementName(J[r])&&c.addSuccessMsg(d.getNodeTextValue(J[r]));"hintMessage"===d.getElementName(J[r])&&c.addHint(d.getNodeTextValue(J[r]));if("matchers"===d.getElementName(J[r]))for(var I=d.getElementChildren(J[r]),A=0;A<I.length;A++)"Selection"===d.getElementName(I[A])&&
(h=f(I[A],0)),"Action"===d.getElementName(I[A])&&(l=f(I[A],1)),"Input"===d.getElementName(I[A])&&(m=f(I[A],2)),"Actor"===d.getElementName(I[A])&&(E=d.getNodeTextValue(I[A]),D=(D=d.getElementAttr(I[A],"linkTriggered"))&&"false"!=D.toLowerCase().trim()?!0:!1);if("matcher"===d.getElementName(J[r])){m=J[r];l=n;h=d.getElementAttr(m,"replacementFormula");var P=d.getElementChildren(m),L=I=void 0,N,R=void 0,A=CTATMsgType.DEFAULT_ACTOR;m=new CTATExactMatcher(CTATMatcher.SELECTION,null);E=new CTATExactMatcher(CTATMatcher.ACTION,
null);e.ctatdebug("processMatcher(): nChildren "+P.length+", saiMessage "+l);for(var Q=0;Q<P.length;Q++)"matcherType"===d.getElementName(P[Q])&&(N=d.getNodeTextValue(P[Q]),"ExactMatcher"===N&&(L=CTATExactMatcher),"RegexMatcher"===N&&(L=CTATRegexMatcher),"AnyMatcher"===N&&(L=CTATAnyMatcher),"RangeMatcher"===N&&(L=CTATRangeMatcher),"WildcardMatcher"===N&&(L=CTATWildcardMatcher),"ExpressionMatcher"===N&&(L=CTATExpressionMatcher),e.ctatdebug("processMatcher(): child "+Q+", eltText "+N+", matcher "+L)),
"matcherParameter"===d.getElementName(P[Q])&&(N=d.getElementAttr(P[Q],"name"),R=d.getNodeTextValue(P[Q]),"selection"==N&&m.setParameter(R),"action"==N&&E.setParameter(R),"input"==N&&(I=I?I:new L(CTATMatcher.INPUT,null),I.setParameter(R)),"actor"==N&&(A=R),"minimum"==N&&(I=I?I:new L(CTATMatcher.INPUT,null),I.setParameter(R,"minimum")),"maximum"==N&&(I=I?I:new L(CTATMatcher.INPUT,null),I.setParameter(R,"maximum")),"InputExpression"==N&&(I=I?I:new L(CTATMatcher.INPUT,null),I.setParameter(P[Q],N,d)),
"relation"==N&&(I=I?I:new L(CTATMatcher.INPUT,null),I.setParameter(P[Q],N,d)),e.ctatdebug("processMatcher(): child "+Q+", eltAttrName "+N+", inputMatcher "+I));I||(I=L?new L(CTATMatcher.INPUT,null):new CTATExactMatcher(CTATMatcher.INPUT,null),I.setParameter(R?R:""),"undefined"!=typeof l&&"function"==typeof l.getSAI&&(l=l.getSAI(),m.setSingle(l.getSelection()),E.setSingle(l.getAction()),I.setSingle(l.getInput())));I.setReplacementFormula(h);E=[[m],[E],[I],A];h=E[0];l=E[1];m=E[2];E=E[3]}}}b.getStartNode()&&
H==b.getStartNode().getNodeID()&&console.log("***WARNING*** edge "+q+" destination is graph startNode "+b.getStartNode());q=new CTATVectorMatcher(h,l,m,E);q.setDefaultSAI(n.getSAI());q.setCaseInsensitive(p);q.setLinkTriggered(D);c.setMatcher(q);ctatdebug("GraphParser.processEdge() "+a+"->"+H+", edge "+c);b.getNode(a).addOutLink(c,!1);b.checkForDoneState(c);return c}function f(a,b){e.ctatdebug("processMatchers()");a=d.getElementChildren(a);for(var c=[],f=0;f<a.length;f++)if("matcher"===d.getElementName(a[f])){for(var g=
null,h=d.getElementAttr(a[f],"replacementFormula"),l=d.getElementChildren(a[f]),m=0;m<l.length;m++){if("matcherType"===d.getElementName(l[m]))switch(g=d.getNodeTextValue(l[m]),e.ctatdebug("CTATGraphParser.processMatchers() matcherType["+m+"] = "+g),g){case "ExactMatcher":g=new CTATExactMatcher(b,null);break;case "RegexMatcher":g=new CTATRegexMatcher(b,null);break;case "AnyMatcher":g=new CTATAnyMatcher(b,null);break;case "RangeMatcher":g=new CTATRangeMatcher(b,null);break;case "WildcardMatcher":g=
new CTATWildcardMatcher(b,null);break;case "ExpressionMatcher":g=new CTATExpressionMatcher(b,null);break;default:console.log("CTATGraphParser.processMatchers() unknown matcherType["+m+"] = "+g+"; using CTATExactMatcher"),g=new CTATExactMatcher(b,null)}if("matcherParameter"===d.getElementName(l[m])){var n=d.getElementAttr(l[m],"name");"single"===n?g.setParameter(d.getNodeTextValue(l[m])):"minimum"===n?g.setParameter(d.getNodeTextValue(l[m]),"minimum"):"maximum"===n?g.setParameter(d.getNodeTextValue(l[m]),
"maximum"):g.setParameter(l[m],n,d)}}g&&g.setReplacementFormula(h);c.push(g)}return c}function g(a,b){var c=new Set;if("group"!==d.getElementName(a))return c;var e=d.getElementAttr(a,"name");ctatdebug("readGroupFromXML group name: "+e);var f="true"===d.getElementAttr(a,"ordered"),h="true"===d.getElementAttr(a,"reenterable");ctatdebug("readGroupFromXML group isOrdered typeof: "+typeof f);ctatdebug("readGroupFromXML group isOrdered: "+f);var m=function(a){c.add(a)};a=d.getElementChildren(a);for(var n=
0;n<a.length;n++){if("link"===d.getElementName(a[n])){var p=Number(d.getElementAttr(a[n],"id")),q=b[p];if(null!==q||void 0!==q)ctatdebug("Added link ID : "+p),c.add(q)}"group"===d.getElementName(a[n])&&(ctatdebug("encountered a subgroup"),g(a[n],b).forEach(m))}l.addGroup(e,f,c);l.setGroupReenterable(l.getGroupByName(e),h);return c}CTATBase.call(this,"CTATGraphParser","__undefined__");var e=this,c,b,d=new CTATXML,h=null,n=[];new XMLSerializer;var l,p=!0,m=[];this.parseGraph=function(e,f){ctatdebug("parseBRD()");
var q=0,u="true"===d.getElementAttr(e,"unordered");p="false"!=String(d.getElementAttr(e,"caseInsensitive")).toLowerCase();var B=d.getElementAttr(e,"lockWidget");feedbackSuppressed=d.getElementAttr(e,"suppressStudentFeedback");var C=new CTATVariableTable;b=new CTATExampleTracerGraph(u,!1,C);b.setCaseInsensitive(p);b.setStudentStartStateNodeName(d.getElementAttr(e,"startStateNodeName"));b.setLockWidget(B);var F=d.getElementChildren(e),C=d.getElementAttr(e,"suppressStudentFeedback");if(null===C||void 0===
C)C=CTATMsgType.SHOW_ALL_FEEDBACK;b.setFeedbackPolicy(C);f.setFeedbackSuppressed(C);C=d.getElementAttr(e,"highlightRightSelection");b.setHighlightRightSelection("false"!=C);var G=d.getElementAttr(e,"confirmDone");f.setConfirmDone("true"===G?!0:"false"===G?!1:b.getFeedbackPolicy()===CTATMsgType.HIDE_ALL_FEEDBACK);f.setHintPolicy(d.getElementAttr(e,"hintPolicy"));f.setOutOfOrderMessage(d.getElementAttr(e,"outOfOrderMessage"));e=null;for(G=0;G<F.length;G++)switch(d.getElementName(F[G])){case "startNodeMessages":n=
d.getElementChildren(F[G]);b.setStartStateMsgs(n);break;case "node":q++;var H;H=F[G];ctatdebug("processNode("+H+")");var E=d.getElementChildren(H),D=-1;H="";for(var K=[],J=0;J<E.length;J++)switch(d.getElementName(E[J])){case "uniqueID":D=parseInt(d.getNodeTextValue(E[J]));break;case "text":H=d.getNodeTextValue(E[J]);break;case "dimension":for(var r=d.getElementChildren(E[J]),I=0;I<r.length;I++)ctatdebug("grandkids "+I+", "+r[I]+", "+d.getNodeTextValue(r[I])+", "+parseInt(d.getNodeTextValue(r[I]))),
K[I]=parseInt(d.getNodeTextValue(r[I]));ctatdebug("grandkids d "+K)}E=new CTATExampleTracerNode(D,new Set);""!==H&&E.setNodeName(H);2<=K.length&&E.setDimension({x:K[0],y:K[1]});H=E;b.addNode(H);1==q&&(b.setStartNode(H),b.setStudentStartsHereNode(H));H.getNodeName()==b.getStudentStartStateNodeName()&&b.setStudentStartsHereNode(H);break;case "edge":b.addLink(a(F[G]));break;case "EdgesGroups":e=F[G];break;case "productionRule":J=F[G];ctatdebug("processSkill()");K=H="";D=E=null;J=d.getElementChildren(J);
for(r=0;r<J.length;r++)I=d.getElementName(J[r]),"ruleName"==I&&(H=d.getNodeTextValue(J[r]),ctatdebug("ruleName="+H)),"productionSet"==I&&(K=d.getNodeTextValue(J[r]),ctatdebug("productionSet="+K)),"label"==I&&(E=d.getNodeTextValue(J[r]),ctatdebug("label="+E)),"description"==I&&(D=d.getNodeTextValue(J[r]),ctatdebug("description="+D));H&&(J=new CTATExampleTracerSkill(K,H,CTATExampleTracerSkill.DEFAULT_P_GUESS,CTATExampleTracerSkill.DEFAULT_P_KNOWN,CTATExampleTracerSkill.DEFAULT_P_SLIP,CTATExampleTracerSkill.DEFAULT_P_LEARN,
CTATExampleTracerSkill.DEFAULT_HISTORY),null!=E?J.setLabel(E):J.setLabel(H),null!=D?J.setDescription(D):J.setDescription(H+(K?" "+K:"")),m.push(J))}if(e){q=d.getElementAttr(e,"ordered");if(null===q||"undefined"==typeof isordered)q=!u;ctatdebug("parseGraph() value of isOrdered = "+q);ctatdebug("parseGraph() value of isUnordered = "+u);ctatdebug("parseGraph() typeof isOrdered: "+typeof q);ctatdebug("parseGraph()typeof isUnordered: "+typeof u);F=e;e=q;ctatdebug("processGroup()");l=b.getGroupModel();
q=l.createIdToLinkMap();l.setGroupOrdered(l.getTopLevelGroup(),e);ctatdebug("processGroup() name of group: "+l.getGroupName(l.getTopLevelGroup()));ctatdebug("processGroup() group isOrdered?: "+l.isGroupOrdered(l.getTopLevelGroup()));ctatdebug("processGroup() order of group: isOrdered= "+e);ctatdebug("processGroup() order of group: isOrdered typeof= "+typeof e);F=d.getElementChildren(F);for(e=0;e<F.length;e++)switch(d.getElementName(F[e])){case "group":g(F[e],q);break;case "outOfOrderMessage":l.getTopLevelGroup().setDefaultBuggyMsg(d.getNodeTextValue(F[e]))}b.addGroup(void 0)}f.addSkillsFromProblemFile(m);
q=f.getSkillBarVector(!1,!0);h=(new CTATTutorMessageBuilder).createStateGraphMessage(p,u,B,f.isSourceFlash()?b.exitOnIncorrectDone():f.isFeedbackSuppressed(),C,String(f.getConfirmDone()),q);b.redoLinkDepths();c=b.getExampleTracer();c.resetTracer();b.forDebugging();ctatdebug("Graph loaded.");return{gr:b,tracer:c,ssm:n,sgMsg:h}}};CTATGraphParser.prototype=Object.create(CTATBase.prototype);CTATGraphParser.prototype.constructor=CTATGraphParser;"undefined"!==typeof module&&(module.exports=CTATGraphParser);var CTATProblemStateStatus=function(){var a="empty";this.getStatus=function(){return a};this.setStatus=function(f){a=f}};Object.defineProperty(CTATProblemStateStatus,"empty",{enumerable:!1,configurable:!1,writable:!1,value:"empty"});Object.defineProperty(CTATProblemStateStatus,"incompleteStartState",{enumerable:!1,configurable:!1,writable:!1,value:"incompleteStartState"});Object.defineProperty(CTATProblemStateStatus,"startState",{enumerable:!1,configurable:!1,writable:!1,value:"startState"});
Object.defineProperty(CTATProblemStateStatus,"incomplete",{enumerable:!1,configurable:!1,writable:!1,value:"incomplete"});Object.defineProperty(CTATProblemStateStatus,"goingToState",{enumerable:!1,configurable:!1,writable:!1,value:"goingToState"});Object.defineProperty(CTATProblemStateStatus,"normalFeedback",{enumerable:!1,configurable:!1,writable:!1,value:"normalFeedback"});Object.defineProperty(CTATProblemStateStatus,"complete",{enumerable:!1,configurable:!1,writable:!1,value:"complete"});
Object.defineProperty(CTATProblemStateStatus,"completedEarlier",{enumerable:!1,configurable:!1,writable:!1,value:"completedEarlier"});CTATProblemStateStatus.prototype=Object.create(CTATBase.prototype);CTATProblemStateStatus.prototype.constructor=CTATProblemStateStatus;CTATProblemStateStatus.prototype.isSendingSavedMsgsForRestore=function(){switch(this.getStatus()){case CTATProblemStateStatus.normalFeedback:return!0;default:return!1}};
CTATProblemStateStatus.prototype.mustSaveForRestore=function(){switch(this.getStatus()){case CTATProblemStateStatus.incomplete:case CTATProblemStateStatus.incompleteStartState:case CTATProblemStateStatus.goingToState:case CTATProblemStateStatus.completedEarlier:return!1;default:return!0}};
CTATProblemStateStatus.prototype.countForProblemSummary=function(){switch(this.getStatus()){case CTATProblemStateStatus.incompleteStartState:case CTATProblemStateStatus.incomplete:return CTATConfiguration.get("instructor_mode")||!1;case CTATProblemStateStatus.goingToState:case CTATProblemStateStatus.startState:case CTATProblemStateStatus.completedEarlier:return!1;default:return!0}};
CTATProblemStateStatus.prototype.isOutputSuppressed=function(){switch(this.getStatus()){case CTATProblemStateStatus.goingToState:return!0;default:return!1}};CTATProblemStateStatus.prototype.isComplete=function(){switch(this.getStatus()){case CTATProblemStateStatus.complete:case CTATProblemStateStatus.completedEarlier:return!0;default:return!1}};
CTATProblemStateStatus.prototype.canRestore=function(){switch(this.getStatus()){case CTATProblemStateStatus.incompleteStartState:case CTATProblemStateStatus.incomplete:case CTATProblemStateStatus.complete:case CTATProblemStateStatus.completedEarlier:return!0;default:return!1}};
CTATProblemStateStatus.prototype.mustRetrieveProblemState=function(){switch(this.getStatus()){case CTATProblemStateStatus.incompleteStartState:case CTATProblemStateStatus.incomplete:case CTATProblemStateStatus.complete:case CTATProblemStateStatus.completedEarlier:return!0;default:return!1}};
CTATProblemStateStatus.prototype.transition=function(a,f){var g=this.getStatus();if(CTATProblemStateStatus.completedEarlier!=g)if(CTATProblemStateStatus.complete==g&&f==CTATProblemStateStatus.completedEarlier)this.setStatus(CTATProblemStateStatus.completedEarlier);else{switch(a){case CTATMsgType.SET_PREFERENCES:CTATProblemStateStatus[f]&&(CTATProblemStateStatus.incomplete==CTATProblemStateStatus[f]?this.setStatus(CTATProblemStateStatus.incompleteStartState):CTATProblemStateStatus.complete==CTATProblemStateStatus[f]?
this.setStatus(CTATProblemStateStatus.completedEarlier):this.setStatus(CTATProblemStateStatus.startState));break;case CTATMsgType.STATE_GRAPH:this.getStatus()==CTATProblemStateStatus.incomplete||this.getStatus()==CTATProblemStateStatus.incompleteStartState?this.setStatus(CTATProblemStateStatus.incompleteStartState):this.setStatus(CTATProblemStateStatus.startState);break;case CTATMsgType.START_STATE_END:this.getStatus()==CTATProblemStateStatus.incompleteStartState?this.setStatus(CTATProblemStateStatus.incomplete):
this.getStatus()==CTATProblemStateStatus.incomplete?this.setStatus(CTATProblemStateStatus.incomplete):this.setStatus(CTATProblemStateStatus.normalFeedback);break;case CTATMsgType.PROBLEM_RESTORE_END:this.setStatus(CTATProblemStateStatus.normalFeedback);break;case CTATMsgType.END_GO_TO_STATE:this.setStatus(CTATProblemStateStatus.normalFeedback);break;case CTATMsgType.BEGIN_GO_TO_STATE:this.setStatus(CTATProblemStateStatus.startState);break;case CTATMsgType.BEGIN_RESTORE:this.getStatus()!=CTATProblemStateStatus.incompleteStartState&&
this.setStatus(CTATProblemStateStatus.incomplete)}ctatdebug("CTATProblemStateStatus.transition("+a+", "+f+") old "+g+" => new "+this.getStatus());return this.getStatus()}};CTATProblemStateStatus.prototype.toString=function(){return"{"+this.getStatus()+"}"};var CTATMessageTank=function(a){function f(a){n.ctatdebug("entering updateProblemSummary()");a&&b.forEach(function(b){if(b.msgType==CTATMsgType.ASSOCIATED_RULES&&(b=b.evt,n.ctatdebug("entering updateProblemSummaryWithEvent("+b+")"),b))if(c&&c.getOutputStatus().isComplete())a.setCompletionStatus(CTATMsgType.CompletionValue[1],!1);else{var d=b.getResult();b.getHintRequest()&&(d=CTATExampleTracerLink.HINT_ACTION);var e=CTATMsgType.CompletionValue[0],f=d&&d==CTATExampleTracerLink.CORRECT_ACTION,g=!1,
h=null,l=null,p=null,F=b.getStudentSAI();F&&(h=F.getSelection())&&(l=F.getAction())&&(g="done"==String(h).toLowerCase()&&"buttonpressed"==String(l).toLowerCase());a.setCompletionStatus(e,CTATGlobals.confirmDone);n.ctatdebug("updateProblemSummary() Completion status "+e+", doneStep "+g+", correct "+f);g&&(e=f?(p=F.getInput())&&"-1"!=p?p:CTATMsgType.CompletionValue[1]:CTATMsgType.CompletionValue[0],a.setCompletionStatus(e,!0));e.startsWith(CTATMsgType.CompletionValue[1])?(a.stopTimer(),c&&c.setOutputStatus(CTATProblemStateStatus.complete)):
a.restartTimer();e=b.getActor();f=b.getStepID();n.ctatdebug("updateProblemSummmary() actor "+e+", indicatorObj "+d+", stepID "+f);!CTATMatcher.isTutorActor(e)&&c.getOutputStatus().countForProblemSummary()&&(CTATTutorMessageBuilder.isHint(d)?a.addHint(f):CTATTutorMessageBuilder.isCorrect(d)?null!==d&&"undefined"!==typeof d&&a.addCorrect(f,b.getScoreLabels()):a.addError(f))}})}function g(a){switch(n.suppressFeedback(a,c.getFeedbackPolicy())){case CTATMsgType.SHOW_ALL_FEEDBACK:return!1;case CTATMsgType.DELAY_FEEDBACK:a=
a.msg;var b=CTATMsgType.getProperty(a,"Selection");n.ctatdebug("CTATMessageTank.addToDelayedFeedbackTank(\n  "+a+") selection "+b);b&&(c.getDelayedFeedback()[b.toLowerCase()]=a);return!0;case CTATMsgType.HIDE_ALL_FEEDBACK:return!0;case CTATMsgType.HIDE_BUT_COMPLETE:return!0;case CTATMsgType.HIDE_BUT_ENFORCE:return!0;default:return!1}}function e(a,b){a=new CTATMessageTank(a,null);for(var c=0;c<b.length;++c){var d=b[c];n.ctatdebug("sendNewTankful() mto["+c+"] msgType "+d.msgType);a.addToMessageTank(d.msgType,
d.msg,d.evt,null)}a.flushMessageTank(null,!0)}CTATBase.call(this,"CTATMessageTank",null);var c=a,b=null,d=null,h=null;a=new Set;a.add("SuccessMessage");a.add("BuggyMessage");a.add("HighlightMsg");a.add("NotDoneMessage");var n=this;this.toString=function(){n.ctatdebug("toString tank "+b);if(!b||1>b.length)return"MessageTank empty";var a="";b.forEach(function(b){a+=b.msgType+", "});return"MessageTank["+a.substr(0,a.length-2)+"]"};this.enqueueToolActionToStudent=function(a,b,d,e){n.ctatdebug("Entering enqueueToolActionToStudent("+
a+", "+b+", "+d+", "+e+")");var f=CTATMsgType.INTERFACE_ACTION;n.ctatdebug("entering enqueueMessageToStudent()");var g=CTATMessage.makeTransactionId();a=new CTATSAI(a,b,d);b=(new CTATTutoringServiceMessageBuilder).createInterfaceActionMessage(g,a);b=CTATMsgType.setProperty(b,CTATTutorMessageBuilder.TRIGGER,"DATA");b=CTATMsgType.setProperty(b,CTATTutorMessageBuilder.SUBTYPE,!e||1>e.length?CTATTutorMessageBuilder.TUTOR_PERFORMED:e);e=new CTATExampleTracerEvent(c,a,CTATMsgType.DEFAULT_TOOL_ACTOR);e.setTransactionID(g);
n.addToMessageTank(f,b,e,a);return g};this.addToMessageTank=function(a,c,e,f){n.ctatdebug("Entering addToMessageTank("+a+", "+c+", "+e+")");if(c){b||(b=[],d={},h={});var g={};g.msgType=a;g.msg=c;g.evt=e;g.sai=f;b.push(g);d[a]=d[a]?d[a]+1:1;a=e.getResult();e.getHintRequest()&&(a=CTATExampleTracerLink.HINT_ACTION);h[a]=h[a]?h[a]+1:1;n.ctatdebug("Exiting addToMessageTank() this "+n.toString())}};this.flushMessageTank=function(a,p){n.ctatdebug("Entering flushMessageTank("+a+", "+p+")");if(b&&!(1>b.length)){f(a);
n.ctatdebug("flushMessageTank() after updateProblemSummary; messageTank.length "+b.length);p=[];for(var l=[],q=0;q<b.length;++q){var u=b[q];if(u.msg){var v=u.msgType,w=u.evt;n.ctatdebug("entering processInterfaceVariables() msgType "+v+", evt "+w);if(v){var B=c?c.getTracer():null;n.ctatdebug("entering processInterfaceVariables() et "+c+", tracer "+B);v=v.toLowerCase();(0===v.indexOf("correct")||0===v.indexOf("interfaceaction"))&&B&&B.addInterfaceVariablesFromEvent(w)}if(!(v=g(u)))if(v=u,w=l,CTATConfiguration.usingFlash()){var C=
B=void 0;if(!(v&&v.sai&&(B=v.sai.getAction())&&(C=CTATSAI.delayedActionRegExp.exec(B)))||3>C.length||1>=C[2])v=!1;else{var F=w.length-1,F=0>F?null:w[F];v.msg=v.msg.replace(B,C[1]);F&&F.timeout==C[2]?F.msgTuples.push(v):w.push({timeout:Number(C[2]),msgTuples:[v]});v=!0}}else v=!1;v||p.push(u.msg)}}n.ctatdebug("flushMessageTank(): msgBundle.length "+p.length+", delayedMsgsBundle.length "+l.length);for(q=0;q<l.length;++q)u=l[q],n.ctatdebug("processDelayedMsgs() delayedMsgs.timeout "+u.timeout+", .msgTuples.length "+
u.msgTuples.length),setTimeout(e,u.timeout,c,u.msgTuples);0<p.length&&(n.ctatdebug("Bottom of flushMessageTank(); to send bundle of length "+p.length+" via "+c),c.sendBundle(p)&&(n.ctatdebug("CTATMessageTank.shouldSaveNow() resultTypes "+h+", msgTypes "+d),(h[CTATExampleTracerLink.CORRECT_ACTION]||h[CTATExampleTracerLink.FIREABLE_BUGGY_ACTION]||h[CTATExampleTracerLink.BUGGY_ACTION]||h[CTATExampleTracerLink.NO_MODEL]||h[CTATExampleTracerLink.HINT_ACTION]||d.CorrectAction||d.InterfaceAction||d.UntutoredAction||
c.isFeedbackSuppressed()&&d.AssociatedRules)&&c.isSendingSavedMsgsForRestore()&&(CTATGlobalFunctions.isInstructorMode()?n.ctatdebug("We're in reviewer mode: we shouldn't save as we go"):c.getProblemStateSaver().saveAsYouGo(a))),n.ctatdebug("Exiting flushMessageTank() #CorrectAction "+d.CorrectAction+", #InterfaceAction "+d.InterfaceAction+", #UntutoredAction "+d.UntutoredAction));d=b=null}};this.flushDelayedFeedback=function(){n.ctatdebug("Entering flushDelayedFeedback()");var a=c.getDelayedFeedback(),
b;for(b in a)a.hasOwnProperty(b)&&CTAT.ToolTutor.sendToInterface(a[b]);c.clearDelayedFeedback()};this.suppressFeedback=function(a,b){n.ctatdebug("CTATMessageTank.suppressFeedback("+a.msgType+", "+b+")");b==CTATMsgType.SHOW_ALL_FEEDBACK?(n.ctatdebug("if.1"),a=b):CTATMsgType.hasTextFeedback(a.msgType)?(n.ctatdebug("if.2"),b==CTATMsgType.HIDE_ALL_FEEDBACK||b==CTATMsgType.HIDE_BUT_ENFORCE?(n.ctatdebug("if.2.1"),a=b):(n.ctatdebug("if.2.2"),(a=CTATMsgType.getProperty(a.msg,CTATMsgType.BUGGY_MSG))&&a.startsWith("<value>")&&
(a=CTATMsgType.getValue(a,0)),a&&-1!=a.toLowerCase().indexOf(CTATMsgType.NOT_DONE_MSG.toLowerCase())?(n.ctatdebug("if.2.2.1"),a=CTATMsgType.SHOW_ALL_FEEDBACK):(n.ctatdebug("if.2.2.2"),a=CTATMsgType.HIDE_ALL_FEEDBACK))):CTATMsgType.isCorrectOrIncorrect(a.msgType)?(n.ctatdebug("if.3: "+a.msg),CTATMsgType.isDoneMessage(a.msg)?(n.ctatdebug("if.3.1"),a=CTATMsgType.SHOW_ALL_FEEDBACK):(n.ctatdebug("if.3.2"),a=b)):(n.ctatdebug("if.4"),a=CTATMsgType.SHOW_ALL_FEEDBACK);n.ctatdebug("CTATMessageTank.suppressFeedback() returning "+
a);return a}};Object.defineProperty(CTATMessageTank,"END_OF_TRANSACTION",{enumerable:!1,configurable:!1,writable:!1,value:"end_of_transaction"});CTATMessageTank.prototype=Object.create(CTATBase.prototype);CTATMessageTank.prototype.constructor=CTATMessageTank;"undefined"!==typeof module&&(module.exports=CTATMessageTank);var CTATStep=function(a,f){CTATBase.call(this,"CTATStep",a);this.id=a;this.result=f;this.nFirstHints=0;this.lastResult=null;this.nErrors=this.nCorrect=0;var g=this;g.ctatdebug("entering CTATStep("+a+", "+f+") constructor");this.incrementFirstHints=function(){g.nFirstHints++};this.incrementNCorrect=function(){g.nCorrect++};this.incrementErrors=function(){g.nErrors++};this.setLastResult=function(a){g.lastResult=a};this.getLastResult=function(){return g.lastResult};this.getResult=function(){return g.result};
this.getNCorrect=function(){return g.nCorrect};this.getNErrors=function(){return g.nErrors};this.getNFirstHints=function(){return g.nFirstHints};g.ctatdebug("in CTATStep("+a+", "+f+") constructor");switch(f){case CTATStep.StepResult[3]:g.incrementNCorrect();break;case CTATStep.StepResult[1]:g.incrementErrors();break;case CTATStep.StepResult[2]:g.incrementFirstHints()}g.ctatdebug("exiting CTATStep constructor")};
CTATStep.fromJSON=function(a){if(!a)return null;var f=new CTATStep("",""),g;for(g in a)a.hasOwnProperty(g)&&"function"!=typeof a[g]&&(f[g]=a[g]);return f};Object.defineProperty(CTATStep,"StepResult",{enumerable:!1,configurable:!1,writable:!1,value:["UNTRIED","INCORRECT","HINT","CORRECT"]});CTATStep.prototype=Object.create(CTATBase.prototype);CTATStep.prototype.constructor=CTATStep;"undefined"!==typeof module&&(module.exports=CTATStep);var CTATProblemSummary=function(a,f,g){CTATBase.call(this,"CTATProblemSummary","");var e=this;if(null===a||"undefined"===typeof a||1>a.length)throw new CTATExampleTracerException("givenProblemName null or empty");this.showCounts=!0;this.requiredSteps=Number.MAX_VALUE;this.problemName=a;this.psSkills="undefined"==typeof f?null:f;this.psUpdateHistory={toJSON:function(a){var b=e.getSkills();return"psUpdateHistory"==a?b?b.getAllUpdates():[]:this}};this.countOnlyLastResults="undefined"==typeof g?null:
g;this.timeElapsed=this.initialErrorsOnly=this.initialHintsOnly=0;var c=new Date;this.stepMap={};this.correct=0;this.scoreLabels={};this.uniqueErrors=this.uniqueCorrectUnassisted=this.uniqueCorrect=this.uniqueHints=this.errors=this.hints=0;this.completionStatus=CTATMsgType.CompletionValue[0];this.getCountOnlyLastResults=function(){return e.countOnlyLastResults};this.setCountOnlyLastResults=function(a){e.countOnlyLastResults=a};this.getTimeElapsed=function(){return e.timeElapsed};this.getUniqueErrors=
function(){if(!e.getCountOnlyLastResults())return e.uniqueErrors;var a=0,c;for(c in e.stepMap)e.stepMap[c].getLastResult()==CTATStep.StepResult[1]&&a++;return a};this.getUniqueCorrect=function(){if(!e.getCountOnlyLastResults())return e.uniqueCorrect;var a=0,c;for(c in e.stepMap)e.stepMap[c].getLastResult()==CTATStep.StepResult[3]&&a++;return a};this.getUniqueCorrectUnassisted=function(){return e.uniqueCorrectUnassisted};this.getHintsOnly=function(){var a=e.initialHintsOnly,c;for(c in e.stepMap)CTATStep.StepResult[2]==
e.stepMap[c].getResult()&&1>e.stepMap[c].getNErrors()&&++a;return a};this.getErrorsOnly=function(){var a=e.initialErrorsOnly,c;for(c in e.stepMap)CTATStep.StepResult[1]==e.stepMap[c].getResult()&&1>e.stepMap[c].getNFirstHints()&&++a;return a};this.getUniqueSteps=function(){var a=0,c;for(c in e.stepMap)a++;return a};this.getRequiredSteps=function(){return e.requiredSteps==Number.MAX_VALUE?0:e.requiredSteps};this.setRequiredSteps=function(a){e.requiredSteps=a};this.getCorrect=function(){return e.correct};
this.getScoreLabels=function(){return e.scoreLabels};this.fromJSON=function(a){if(!a)return e;for(var b in a)if(a.hasOwnProperty(b)&&"function"!=typeof a[b])switch(b){case "stepMap":e[b]={};for(var c in a[b])e[b][c]=CTATStep.fromJSON(a[b][c]);break;case "psSkills":e[b]=(e.psSkills||(e.psSkills=new CTATSkills([]))).fromJSON(a[b]);break;case "psUpdateHistory":e.getSkills().restoreUpdates(a[b]);break;default:e[b]=a[b]}return e};this.toJSON=function(a){if(!a)return e;var b=e.getSkills();switch(a){case "psSkills":return b?
b.getAllSkills():[];case "psUpdateHistory":return b?b.getAllUpdates():[];default:return e[a]}};this.toJSONforTutorshop=function(){var a={};a.problem_name=e.problemName;a.completion_status=e.completionStatus;e.showCounts&&(a.correct=e.correct,a.score_labels=e.scoreLabels,a.unique_correct=e.getUniqueCorrect(),a.unique_correct_unassisted=e.uniqueCorrectUnassisted,a.hints=e.hints,a.unique_hints=e.uniqueHints,a.hints_only=e.getHintsOnly(),a.errors=e.errors,a.unique_errors=e.getUniqueErrors(),a.errors_only=
e.getErrorsOnly(),a.unique_steps=e.getUniqueSteps(),a.required_steps=e.getRequiredSteps());a.time_elapsed=e.timeElapsed;var c=e.getSkills();e.showCounts&&c?(a.skills=c.toJSONforTutorshop(),a.skill_history=c.updatesToJSONforTutorshop()):(a.skills=[],a.skill_history=[]);return JSON.stringify(a)};this.toXML=function(a){var b,c="";b=""+(' ProblemName="'+e.problemName+'"');b+=' CompletionStatus="'+e.completionStatus+'"';e.showCounts&&(b+=' Correct="'+e.correct+'"',b+=' UniqueCorrect="'+e.getUniqueCorrect()+
'"',b+=' UniqueCorrectUnassisted="'+e.uniqueCorrectUnassisted+'"',b+=' Hints="'+e.hints+'"',b+=' UniqueHints="'+e.uniqueHints+'"',b+=' HintsOnly="'+e.getHintsOnly()+'"',b+=' Errors="'+e.errors+'"',b+=' UniqueErrors="'+e.getUniqueErrors()+'"',b+=' ErrorsOnly="'+e.getErrorsOnly()+'"',b+=' UniqueSteps="'+e.getUniqueSteps()+'"',b+=' RequiredSteps="'+e.getRequiredSteps()+'"');b+=' TimeElapsed="'+e.timeElapsed+'"';e.showCounts&&(c=e.getSkills()?e.getSkills().toXML(a):"");return a?"&lt;ProblemSummary"+b+
"&gt;"+c+"&lt;/ProblemSummary&gt;":"<ProblemSummary"+b+">"+c+"</ProblemSummary>"};this.getSkills=function(){return e.psSkills};this.setSkills=function(a){e.psSkills=a};this.stopTimer=function(){var a=new Date;e.timeElapsed+=a.getTime()-c.getTime();return a};this.restartTimer=function(){c=e.stopTimer();return e.timeElapsed};this.addHint=function(a){e.ctatdebug("addHint("+a+")");var b=e.stepMap[a];null!==b&&"undefined"!==typeof b?(1>b.getNFirstHints()&&++e.uniqueHints,b.incrementFirstHints()):(b=new CTATStep(a,
CTATStep.StepResult[2]),e.stepMap[a]=b,e.uniqueHints++);e.hints++;b.setLastResult(CTATStep.StepResult[2]);e.ctatdebug("exiting addHint() hint count "+e.hints+", trial "+b)};this.addError=function(a){e.ctatdebug("addError("+a+")");var b=e.stepMap[a];null!==b&&"undefined"!==typeof b?(1>b.getNCorrect()&&1>b.getNErrors()&&++e.uniqueErrors,b.incrementErrors()):(b=new CTATStep(a,CTATStep.StepResult[1]),e.stepMap[a]=b,e.uniqueErrors++);e.errors++;b.setLastResult(CTATStep.StepResult[1]);e.ctatdebug("exiting addError() error count "+
e.errors+", trial "+b)};this.addCorrect=function(a,c){var b=e.stepMap[a];e.ctatdebug("entering addCorrect("+a+") trial "+b);b?(1>b.getNCorrect()&&1>b.getNErrors()&&(++e.uniqueCorrect,1>b.getNFirstHints()&&e.uniqueCorrectUnassisted++),b.incrementNCorrect()):(e.ctatdebug("to call CTATStep("+a+", StepResult "+CTATStep.StepResult[3]),b=new CTATStep(a,CTATStep.StepResult[3]),e.stepMap[a]=b,e.uniqueCorrect++,e.uniqueCorrectUnassisted++);e.correct++;Array.isArray(c)&&c.forEach(function(a){return e.scoreLabels[a]?
e.scoreLabels[a]++:e.scoreLabels[a]=1});b.setLastResult(CTATStep.StepResult[3]);e.ctatdebug("exiting addCorrect() correct count "+e.correct+", trial "+b)};this.setShowCounts=function(a){e.showCounts=a};this.setCompletionStatus=function(a,c){e.ctatdebug("setCompletionStatus("+a+", "+c+") old value "+e.completionStatus);if(!e.completionStatus.startsWith(CTATMsgType.CompletionValue[1])||c)e.completionStatus=a};this.getCompletionStatus=function(){return e.completionStatus}};
CTATProblemSummary.prototype=Object.create(CTATBase.prototype);CTATProblemSummary.prototype.constructor=CTATProblemSummary;"undefined"!==typeof module&&(module.exports=CTATProblemSummary);var ProblemStateSaver=function(a){CTATBase.call(this,"ProblemStateSaver",a);this.tracer=a;var f=this,g=[],e=null,c="",b="",d=0;this.saveAsYouGo=function(e){f.ctatdebug("saveAsYouGo() curriculum_service_url "+c+", tracer "+a);if(a&&e){var h={};h.session_id=a.getSessionID();h.authenticity_token=b;h.summary=CTATLMS.is.TutorShop()?e.toJSONforTutorshop():e.toXML(!0);h.problem_state=e?'{"summary":'+JSON.stringify(e)+',"state":'+ProblemStateSaver.xmlToJSON(g)+"}":ProblemStateSaver.xmlToJSON(g);++d;f.ctatdebug("saveAsYouGo["+
d+"] to send problem_state length "+h.problem_state.length);CTATLMS.saveProblemState&&CTATLMS.saveProblemState(h);CTATLMS.gradeStudent&&CTATLMS.gradeStudent(parseInt(e.getCorrect()),parseInt(e.getRequiredSteps()),e.toJSONforTutorshop());CTATLMS.commit&&CTATLMS.commit()}else f.ctatdebug("Error: no tracer or no problem summary available, aborting save as you go")};this.setCurriculumServiceUrl=function(a){f.ctatdebug("ProblemStateSaver.setCurriculumServiceUrl() old "+c+", new "+a);c=a};this.setAuthenticityToken=
function(a){f.ctatdebug("ProblemStateSaver.setAuthenticityToken() old "+b+", new "+a);a&&(b=a)};this.getStepToIndexMap=function(){null===e&&(e=new Map);return e};this.getProblemState=function(){return g};this.getProblemStateLength=function(){return g.length}};ProblemStateSaver.prototype=Object.create(CTATBase.prototype);ProblemStateSaver.prototype.constructor=ProblemStateSaver;
ProblemStateSaver.prototype.replaceInProblemState=function(a,f,g,e,c,b){this.ctatdebug("PSS.replaceInProblemState("+CTATMsgType.getMessageType(a)+", "+e+", "+c+", "+b+")");!1!==b&&"false"!==b&&(!0===b||"true"===b||g.mustSaveForRestore()&&ProblemStateSaver.mustSaveForRestore(CTATMsgType.getMessageType(a)))&&(g=this.getProblemState(),a=this.editForProblemState(a),c||(e=ProblemStateSaver.makeStepKey(e),c=this.getStepToIndexMap(),this.ctatdebug("PSS.replaceInProblemState() stepKey"+e+", index "+c.get(e)+
")"),c.has(e)&&(b=c.get(e),g[b]=null),c.set(e,g.length)),g.push({outcome:ProblemStateSaver.getOutcome(a,f,1),msg:a}))};ProblemStateSaver.prototype.appendToProblemState=function(a,f,g,e){!1!==e&&"false"!==e&&(!0===e||"true"===e||g.mustSaveForRestore()&&ProblemStateSaver.mustSaveForRestore(CTATMsgType.getMessageType(a)))&&(g=this.getProblemState(),a=this.editForProblemState(a),g.push({outcome:ProblemStateSaver.getOutcome(a,f,1),msg:a}))};ProblemStateSaver.Outcomes={};
[CTATExampleTracerLink.BUGGY_ACTION,CTATExampleTracerLink.FIREABLE_BUGGY_ACTION,CTATExampleTracerLink.CORRECT_ACTION,CTATExampleTracerLink.NO_MODEL,CTATExampleTracerLink.HINT_ACTION,CTATExampleTracerLink.UNTRACEABLE_ERROR,CTATExampleTracerLink.GIVEN_ACTION].forEach(function(a,f){ProblemStateSaver.Outcomes[a]={name:a,abbr:a.charAt(0)};ProblemStateSaver.Outcomes[a.charAt(0)]={name:a,abbr:a.charAt(0)}});
ProblemStateSaver.getOutcome=function(a,f,g){if(a)a="function"==typeof a.getMessageType?String(a.getMessageType()):"U"==String(a)?CTATMsgType.UNTUTORED_ACTION:CTATMsgType.getMessageType(String(a.msg||a));else return"";return a.toLowerCase()==CTATMsgType.UNTUTORED_ACTION.toLowerCase()?"":(f=ProblemStateSaver.Outcomes[f])?1==g?f.abbr:f.name:""};Object.defineProperty(ProblemStateSaver,"XML_PROLOGUE",{enumerable:!1,configurable:!1,writable:!1,value:/<\? *[xX][mM][lL][^?]*\?>/});
Object.defineProperty(ProblemStateSaver,"LEADING_WHITE_SPACE",{enumerable:!1,configurable:!1,writable:!1,value:/^\s+</m});Object.defineProperty(ProblemStateSaver,"MESSAGES_TAG",{enumerable:!1,configurable:!1,writable:!1,value:"<messages>"});
ProblemStateSaver.prototype.editForProblemState=function(a){var f=a.split(ProblemStateSaver.XML_PROLOGUE),g=f[0],e;for(e=1;e<f.length;++e)g+=f[e];f=g.split(ProblemStateSaver.LEADING_WHITE_SPACE);g=f[0];for(e=1;e<f.length;++e)g.endsWith("\n")&&(g=g.slice(0,-1)),g.endsWith("\r")&&(g=g.slice(0,-1)),g+="<"+f[e];this.ctatdebug("ProblemStateSaver.editForProblemState("+a+")\n returns "+g);return g};ProblemStateSaver.omitFromRestore={init:!1};
ProblemStateSaver.mustSaveForRestore=function(a){ProblemStateSaver.omitFromRestore.init||(ProblemStateSaver.omitFromRestore[CTATMsgType.ASSOCIATED_RULES.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.BUGGY_MESSAGE.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.CORRECT_ACTION.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.INCORRECT_ACTION.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.INTERFACE_IDENTIFICATION.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.PROBLEM_RESTORE_END.toLowerCase()]=
!0,ProblemStateSaver.omitFromRestore[CTATMsgType.PROBLEM_SUMMARY_REQUEST.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.PROBLEM_SUMMARY_RESPONSE.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.SET_PREFERENCES.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.SHOW_HINTS_MESSAGE.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.SUCCESS_MESSAGE.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore.init=!0);return a&&ProblemStateSaver.omitFromRestore[a.toLowerCase()]?
!1:!0};ProblemStateSaver.prototype.forwardToInterface=function(a,f,g){var e=CTATMsgType.getMessageType(a);this.ctatdebug("PSS.forwardToInterface("+e+") problemState.length "+this.getProblemState().length+", outputStatus "+g);if(g&&g.isOutputSuppressed())return!1;CTAT.ToolTutor.sendToInterface(a,f);g&&g.transition(CTATMsgType.getMessageType(a));return!0};ProblemStateSaver.prototype.processMessage=function(a){this.ctatdebug("ProblemStateSaver.processMessage("+a+")")};
ProblemStateSaver.makeStepKey=function(a){if(!a)return" ";var f=a.getSelection();a=a.getAction();f="string"!=typeof f||1>f.length?" ":f;a="string"!=typeof a||1>a.length?" ":a;return f+" "+a};
ProblemStateSaver.fromJSON=function(a){if("string"!=typeof a)return ProblemStateSaver.jsonToState(a);switch(a.charAt(0)){case "[":return ProblemStateSaver.jsonToState(a);case "{":break;default:return ProblemStateSaver.jsonToState(a)}var f={};try{f=JSON.parse(a)}catch(g){return console.log("ProblemStateSaver.fromJSON() error",g,"problemState",a),ProblemStateSaver.jsonToState(null)}f.summary&&(a=CTAT.ToolTutor.tutor.getProblemSummary().fromJSON(f.summary),a=(new CTATTutorMessageBuilder).createAssociatedRulesMessageForAction(CTATMsgType.CORRECT_ACTION,
new CTATSAI("none","none","none"),CTATMsgType.DEFAULT_TOOL_ACTOR,new CTATSAI("none","none","none"),a.getSkills().getSkillBarVector(!1,!0),"0","T"+CTATGuid.guid(),""),CTAT.ToolTutor.sendToInterface(a));return f.state?ProblemStateSaver.jsonToXML(f.state):ProblemStateSaver.jsonToState(null)};ProblemStateSaver.jsonToState=function(a){if("string"!=typeof a||"["!=a.charAt(0))return[];var f=[];try{f=JSON.parse(a)}catch(g){return console.log("ProblemStateSaver.jsonToState() error",g,"problemState",a),[]}return ProblemStateSaver.jsonToXML(f)};
ProblemStateSaver.actionsToIgnore=[CTATTransactionListener.visibilitychangeSAI.action];
ProblemStateSaver.jsonToXML=function(a){var f=[];a.forEach(function(a,e){console.log("ProblemStateSaver.jsonToXML["+e+"] mo",a);e=ProblemStateSaver.getOutcome(a.m,a.o);if((CTATConfiguration.get("instructor_mode")||"U"==a.m||e==CTATExampleTracerLink.CORRECT_ACTION||e==CTATExampleTracerLink.FIREABLE_BUGGY_ACTION)&&!ProblemStateSaver.actionsToIgnore.includes(a.a)){e=decodeURIComponent(a.i);e=0>e.indexOf("<![CDATA[")?"<![CDATA["+e+"]]\x3e":e;var c;c="<message><verb>NotePropertySet</verb><properties><MessageType>"+
("U"==a.m?CTATMsgType.UNTUTORED_ACTION:CTATMsgType.INTERFACE_ACTION);c+="</MessageType><transaction_id>"+CTATMessage.makeTransactionId();c+="</transaction_id><Selection><value>";/^ *previousfocus *$/i.test(a.a)?(c+="hint</value><value>"+a.s,c+="</value></Selection><Action><value>ButtonPressed</value><value>"+a.a):(c+=a.s,c+="</value></Selection><Action><value>"+a.a);c+="</value></Action><Input><value>"+e+"</value></Input></properties></message>";f.push({outcome:ProblemStateSaver.getOutcome(a.m,a.o,
1),msg:c})}});return f};
ProblemStateSaver.xmlToJSON=function(a){var f=[];a.forEach(function(a,e){ctatdebug("ProblemStateSaver.xmlToJSON["+e+"] msg\n  "+a);if(a){var c={},b=null;c.o=ProblemStateSaver.getOutcome(a.msg||a,a.outcome,1);"undefined"!=typeof a.msg&&(a=a.msg);c.m=CTATMsgType.getMessageType(a)==CTATMsgType.UNTUTORED_ACTION?"U":"I";c.s=(b=CTATMsgType.getValue(CTATMsgType.getProperty(a,"Selection"),0))?b:"";c.a=(b=CTATMsgType.getValue(CTATMsgType.getProperty(a,"Action"),0))?b:"";if(/^ *(hint|help) *$/i.test(c.s)&&/^ *buttonpress[ed ]*$/i.test(c.a)){var d=
(b=CTATMsgType.getValue(CTATMsgType.getProperty(a,"Selection"),1))?b:"",g=(b=CTATMsgType.getValue(CTATMsgType.getProperty(a,"Action"),1))?b:"";d&&/^ *previousfocus *$/i.test(g)&&(c.s=d,c.a=g)}b=CTATMsgType.getValue(CTATMsgType.getProperty(a,"Input"),0);a=b.replace(/^<!\[CDATA\[([^\]]*)\]\]>$/,"$1");c.i=encodeURIComponent(a);ctatdebug("ProblemStateSaver.xmlToJSON["+e+"]  mo "+JSON.stringify(c));f.push(c)}});try{return JSON.stringify(f)}catch(g){return console.log("ProblemStateSaver.xmlToJSON() error",
g,"toStringify",f),""}};"undefined"!==typeof module&&(module.exports=ProblemStateSaver);var ProblemStateRestorer=function(a){CTATBase.call(this,"ProblemStateRestorer",a);var f=this,g=null;this.getRestoreProblemUrl=function(){return g};this.setRestoreProblemUrl=function(a){g=a};this.toString=function(){return"["+g+": 0]"};this.retrieveMessages=function(e){console.log("retrieveMessages("+e+", ...)");e.mustRetrieveProblemState()?(a.stopWorking(1),CTATLMS.getProblemState&&CTATLMS.getProblemState(f.process)):console.log("Retrieval status indicates that we should not retrieve")};this.process=
function(e){var c=null;a.getOutputStatus().transition(CTATMsgType.BEGIN_RESTORE);"string"!=typeof e||""==e?(console.log("ProblemStateRestorer.process("+e+") empty or not a string: ",typeof e),c=[]):/^[[{]/.test(e)||e.slice(0,ProblemStateSaver.MESSAGES_TAG.length)==ProblemStateSaver.MESSAGES_TAG||(console.log("ProblemStateRestorer.process() called with unrecognized string, to try htmlDecode(): ",e.slice(0,20)),e=(new DOMParser).parseFromString(e,"text/html").documentElement.textContent,e.slice(0,ProblemStateSaver.MESSAGES_TAG.length)!=
ProblemStateSaver.MESSAGES_TAG&&(console.log("ProblemStateRestorer.process() called with unrecognized string: ",e.slice(0,20)),c=[]));parent.postMessage({command:"startRestoreSteps",data:{restoreJSON:null==c?e:JSON.stringify(c)}},location.origin);if(null==c)a:{var b=e,c=[];if("string"==typeof b){e="";if(/^[[{]/.test(b))b=ProblemStateSaver.fromJSON(b);else{b=b.split(/<\/?messages>/);f.ctatdebug("msgsArr.length "+b.length+", msgsArr[1].length "+(b[1]?b[1].length:-1));if(2>b.length)break a;e="<message>";
b=b[1].split(e)}f.ctatdebug("problemStateArr.length "+b.length);for(var d=0,g=!1,n=0;n<b.length;++n)if(b[n]){var l=b[n],p=e+("string"==typeof l?l:l.msg),m=CTATMsgType.getMessageType(p);CTATMsgType.STATE_GRAPH==m?g=!0:CTATMsgType.START_STATE_END==m?g=!1:g?d++:CTATMsgType.INTERFACE_ACTION==m&&n==b.length-1&&CTATMsgType.isDoneMessage(p)&&a.getOutputStatus().isComplete()||(a.getProblemStateSaver().appendToProblemState(p,l.outcome,null,!0),p=CTATMsgType.setProperty(p,"Actor","Student"),c.push(p));f.ctatdebug("problemStateArr["+
n+"] "+(g?"omit ":"keep ")+m+" omitted "+d+" kept "+c.length)}}}a.insertFreeze(c);a.enqueueForRestore(c)}};ProblemStateRestorer.prototype=Object.create(CTATBase.prototype);ProblemStateRestorer.prototype.constructor=ProblemStateRestorer;var SCORMProblemSummary=function(){CTATBase.call(this,"SCORMProblemSummary","")};Object.defineProperty(SCORMProblemSummary,"LESSON_STATUS",{enumerable:!1,configurable:!1,writable:!1,value:"cmi.core.lesson_status"});Object.defineProperty(SCORMProblemSummary,"RAW_SCORE",{enumerable:!1,configurable:!1,writable:!1,value:"cmi.core.score.raw"});Object.defineProperty(SCORMProblemSummary,"EXIT",{enumerable:!1,configurable:!1,writable:!1,value:"cmi.core.exit"});
Object.defineProperty(SCORMProblemSummary,"SESSION_TIME",{enumerable:!1,configurable:!1,writable:!1,value:"cmi.core.session_time"});Object.defineProperty(SCORMProblemSummary,"ExitReason",{enumerable:!1,configurable:!1,writable:!1,value:{timeout:"time-out",suspend:"suspend",logout:"logout",done:" "}});
Object.defineProperty(SCORMProblemSummary,"LessonStatus",{enumerable:!1,configurable:!1,writable:!1,value:{passed:"passed",completed:"completed",failed:"failed",incomplete:"incomplete",browsed:"browsed",notAttempted:"not attempted"}});SCORMProblemSummary.getLessonStatus=function(a){return CTATMsgType.CompletionValue[1]==a.getCompletionStatus()?SCORMProblemSummary.LessonStatus.completed:SCORMProblemSummary.LessonStatus.incomplete};
SCORMProblemSummary.getRawScore=function(a){var f=a.getUniqueSteps();return 0==f?0:parseInt(100*(a.getUniqueCorrectUnassisted()/f+.005))};SCORMProblemSummary.getExitReason=function(a){return SCORMProblemSummary.ExitReason.suspend};SCORMProblemSummary.getSessionTime=function(a){var f=a.getTimeElapsed();a=f%1E3;var f=(f-a)/1E3,g=f/60,e=g/60,f=f%60;9999<e&&(e=9999,g=f=99,a=990);return sprintf("%04d:%02d:%02d.%02d",e,g,f,a/10)};
SCORMProblemSummary.getProblemSummaryElements=function(a){var f=sprintf("<%s>%s</%s>",SCORMProblemSummary.LESSON_STATUS,SCORMProblemSummary.getLessonStatus(a),SCORMProblemSummary.LESSON_STATUS),g=sprintf("<%s>%d</%s>",SCORMProblemSummary.RAW_SCORE,SCORMProblemSummary.getRawScore(a),SCORMProblemSummary.RAW_SCORE),e=sprintf("<%s>%s</%s>",SCORMProblemSummary.EXIT,SCORMProblemSummary.getExitReason(a),SCORMProblemSummary.EXIT);a=sprintf("<%s>%s</%s>",SCORMProblemSummary.SESSION_TIME,SCORMProblemSummary.getSessionTime(a),
SCORMProblemSummary.SESSION_TIME);return f+g+e+a};CTATMsgType.prototype=Object.create(CTATBase.prototype);CTATMsgType.prototype.constructor=SCORMProblemSummary;"undefined"!==typeof module&&(module.exports=SCORMProblemSummary);var CTATExampleTracer=function(a){function f(){return"example"===J&&P&&P.getModelInitialized()||"rule"===J&&L&&L.getModelInitialized()}function g(a,b){b?na|=1<<a:(na&=-65537>>16-a,h())}function e(a){if(r.isFeedbackSuppressed()){var b=new CTATSAI("hint","SetVisible","false"),b=(new CTATTutoringServiceMessageBuilder).createInterfaceActionMessage("dummyTransactionID",b);a.push(b)}}function c(){return"<message><verb>NotePropertySet</verb><properties><MessageType>"+CTATMsgType.INTERFACE_REBOOT+"</MessageType></properties></message>"}
function b(a){a.unshift(c());r.ctatdebug("sendStartStateMessageStrings(): "+a.length+" elts, "+W);r.sendBundle(a)}function d(a,b){var c=a[b];if(!CTATMsgType.getProperty(c,"freezeHere"))return!1;a[b]=CTATMsgType.setProperty(c,"freezeHere","");return!0}function h(){var a=Math.min(ca.length,r.restoreStep||Number.MAX_SAFE_INTEGER);a==ca.length-1&&++a;r.restoreInterval=r.restoreStep?0:Number.parseInt(CTATConfiguration.get("restore_interval"))||0;r.log("queue","workTheQueue() working "+na+", workOrRestoreQueue "+
ba+", workQueue.length "+ma.length+", restoreQueue.length "+ca.length+", restoreIndex "+r.restoreIndex+", timer "+r.timer+", restoreInterval "+r.restoreInterval+", stopIndex "+a+", restoreStep "+r.restoreStep);if(!(na&1<<ba&&r.timer))for(;0!=(na=0<ma.length|(r.restoreIndex<a)<<1)&&1>r.timer;){var b=null,c=!1;if(r.restoreIndex<a){ba=1;if(d(ca,r.restoreIndex))return r.freezeRestore();b=ca[r.restoreIndex++];r.restoreIndex>=r.restoreStep&&(clearTimeout(r.timer),r.timer=0);c=!0}else ba=0,b=ma.shift();
r.log("queue","workTheQueue() working "+na+", restoreIndex "+r.restoreIndex+", stopIndex "+a+",\n  msg "+b);b=n(b,c);r.restoreInterval&&ba&&1<a-r.restoreIndex?(clearTimeout(r.timer),(new Promise(function(a){return r.timer=setTimeout(a,r.restoreInterval)})).then(function(){r.log("restore","***stopIndex "+a+", index "+r.restoreIndex);clearTimeout(r.timer);r.timer=0;h()}),r.log("restore","Now waiting "+r.restoreInterval+" ms on timer "+r.timer)):r.timer=-1;if(!b&&(r.log("queue","workTheQueue() suspending workQueue.length "+
ma.length+", restoreQueue.length "+ca.length+", stopIndex "+a),r.stopWorking(c?1:0),1>r.timer))break;r.log("queue","workTheQueue() bottom workQueue.length "+ma.length+", restoreQueue.length "+ca.length+", stopIndex "+a)}}function n(a,b){r.lastMessageAsString=a;var d=r.lastMessageAsXML=(new CTATXML).parseXML(a),e=r.lastMessage=new CTATMessage(d),g=e.getMessageType();r.ctatdebug("CTATExampleTracer.handleMessageFromInterface(msgType "+g+")");switch(g){case CTATMsgType.SET_PREFERENCES:return l(a,e,T,
d),!1;case CTATMsgType.INTERFACE_IDENTIFICATION:return!0;case CTATMsgType.UNTUTORED_ACTION:b&&r.sendBundle([a]);b=T;g=e.getTransactionID();r.ctatdebug("UntutoredAction ("+a+"), getTransactionID "+g);var g=/^student$/i.test(String(e.getProperty("actor")||"student")),h=e.getProperty("saveForRestore");g&&r.getInitialValuesDemonstrateMode()?(a=r.getGraph().addStartStateLink(e.getSAI()),a=r.traceLinks([a]),console.log("handleUntutoredAction() in ivDemoMode",a)):((g||h)&&ga.appendToProblemState(a,"",r.getOutputStatus(),
h),f()&&(r.setVariablesFromSAI(d,b),F(a)));return!0;case CTATMsgType.INTERFACE_ACTION:return b&&r.sendBundle([a]),m(a,e,T,d);case CTATMsgType.PROBLEM_SUMMARY_REQUEST:return r.handleProblemSummaryRequest(r.getProblemSummary()),!0;case CTATMsgType.START_STATE_END:return W.transition(CTATMsgType.START_STATE_END),!0;case CTATMsgType.PROBLEM_RESTORE_END:return W.transition(CTATMsgType.PROBLEM_RESTORE_END),a=r.getSkillBarVector(),d=[],e=new CTATTutorMessageBuilder,d.push(e.createMessage(CTATMsgType.PROBLEM_RESTORE_END,
a?{Skills:a}:null)),r.sendBundle(d),!0;case CTATMsgType.GO_TO_STATE:return a=e.getProperty("nodeID"),0>a||!sessionStorage||!sessionStorage.setItem?a=!0:(sessionStorage.setItem("Go-To-State",String(a)),CTAT.ToolTutor.reboot("Go-To-State "+a+" from CTATExampleTracer")||(d=[],d.push(c()),r.ctatdebug("CTATET.handleGoToState() saved nodeID "+a+"; sending to interface\n"+d),r.sendBundle(d)),a=!1),a;default:return console.log("CTATExampleTracer.handleMessageFromInterface(restoring "+b+") "+(b?"sending":
"unprocessed")+" message, type "+g+"\n  "+a),b&&r.sendBundle([a]),!0}}function l(a,b,c,d){ra=b.getProperty("problem_name");r.ctatdebug("handleSetPreferences() problem_name = "+ra);a=c.getElementChildren(c.getElementChildren(d)[1]);for(b=0;b<a.length;b++)if(d=c.getElementName(a[b]),r.ctatdebug("SetPreferences eltName "+d),d)switch(d.toLowerCase()){case "source_id":la=c.getNodeTextValue(a[b]);break;case "tutoring_service_communication":A=c.getNodeTextValue(a[b]);break;case "question_file":I=c.getNodeTextValue(a[b]);
break;case "skills":r.log("skills","parseSkills(",a[b],")");d=new CTATSkills(CTATSkills.parseSkills(a[b]));r.getProblemSummary().setSkills(d,c);d.setExternallyDefined(!0);break;case "problem_state_status":W.transition(CTATMsgType.SET_PREFERENCES,c.getNodeTextValue(a[b]));da||(da=new ProblemStateRestorer(r));r.ctatdebug("SetPreferences problemStateRestorer "+da);break;case "curriculum_service_url":CTATConfiguration.set("curriculum_service_url",c.getNodeTextValue(a[b]));break;case "restore_problem_url":da||
(da=new ProblemStateRestorer(r));r.ctatdebug("SetPreferences problemStateRestorer "+da);CTATConfiguration.set("restoreProblemUrl",c.getNodeTextValue(a[b]));break;case "session_id":za=c.getNodeTextValue(a[b]);break;case "authenticity_token":ga.setAuthenticityToken(c.getNodeTextValue(a[b]))}r.log("restore","questionFile "+I+", outputStatus "+W+", problemStateRestorer "+da);p();r.log("restore","outputStatus "+W+", problemStateRestorer "+da);r.log("load","handleSetPreferences(): questionFile",I,"tutoringServiceCommunication",
A);if(I)Aa.retrieveProblemFile(I,c,r);else if(/^postmessage$/i.test(A)){console.log("to reload upon setPreferences(postmessage)");var e=Date.now();(new Promise(function(a,b){return r.loadGraphFromString(r.getGraph().toXML(r),function(b){console.log("after setPreferences(postmessage), ms:",Date.now()-e,b);return a?a(b):b},function(a){console.log("error loading after setPreferences(postmessage)",a);return b?b(a):a})})).then(function(a){console.log("then after setPreferences(postmessage): to startWorking");
r.startWorking()})}da&&da.retrieveMessages(W)}function p(){var a="undefined"!=typeof sessionStorage&&sessionStorage?sessionStorage.getItem("Go-To-State"):null;null!=a&&(sessionStorage.removeItem("Go-To-State"),a=Number(a),!Number.isSafeInteger(a)||0>=a||(qa=a,W.transition(CTATMsgType.BEGIN_GO_TO_STATE,null)))}function m(a,b,c,d){r.ctatdebug("Interface action received.");c=b.getTransactionID();if(!f())return!1;if(CTATShellTools.getReservedSelection(b))return!0;if(r.getInitialValuesDemonstrateMode())return a=
r.getGraph().addStartStateLink(b.getSAI()),a=r.traceLinks([a]),console.log("handleInterfaceAction() in ivDemoMode",a),!0;r.messageTank=new CTATMessageTank(r);r.ctatdebug("MessageTank "+r.messageTank);r.ctatdebug("InterfaceAction ("+a+"), getTransactionID "+c);var e=b.getSelectionArray().slice(0);d=b.getActionArray().slice(0);var g=b.getProperty("actor")||"student";r.ctatdebug("selectionArray "+e+", message.getSelectionArray() "+b.getSelectionArray());if(e[0]&&"_tutor"==e[0].toLowerCase())return r.ctatdebug("handleInterfaceAction tutor cmd SAI "+
b.getSAI()+";"),d[0]&&"function"===typeof r[d[0]]&&(a=b.getSAI().getInput(),r[d[0]](a)),!0;if(!e[0]||"hint"!=e[0].toLowerCase()&&"help"!=e[0].toLowerCase())return r.ctatdebug("calling doNewTrace("+J+", "+b.getSAI()+") sai.selectionArray "+b.getSAI().getSelectionArray()+" msg.selectionArray "+b.getSelectionArray()),C(J,[null,b.getSAI(),g,!0,c,a]);r.ctatdebug("handleInterfaceAction() hint request: hintPolicy "+S+", errorSAI "+X);S===CTATHintPolicyEnum.HINTS_UNBIASED?(1<e.length&&(e[1]=""),1<d.length&&
(d[1]="")):S!==CTATHintPolicyEnum.HINTS_BIASED_BY_CURRENT_SELECTION_ONLY&&(S===CTATHintPolicyEnum.HINTS_BIASED_BY_PRIOR_ERROR_ONLY?X&&X.getSelection()?(e.splice(1,0,X.getSelection()),d.splice(1,0,"PreviousFocus")):(e[1]="",d[1]=""):S===CTATHintPolicyEnum.HINTS_BIASED_BY_ALL&&X&&X.getSelection()&&(e.splice(1,0,X.getSelection()),d[1]=CTATMsgType.PREVIOUS_FOCUS.toString()));r.startSkillTransaction();r.ctatdebug("ExampleTracer.doHint, givenSelection = "+e);var h=b=null;if(d&&1<d.length&&d[1].toString()===
CTATMsgType.PREVIOUS_FOCUS.toString()&&e&&1<e.length&&e[1]&&"null"!==e[1].toString()&&(b=e[1]!==e[0]?[e[1]]:null,2<d.length))for(r.ctatdebug("CTATExampleTracer --\x3e in doHint inner if condition"),h=[],e=2;e<d.length;e++)r.ctatdebug("CTATExampleTracer --\x3e in doHint for loop "+e),h.push(d[e]);r.ctatdebug("CTATExampleTracer --\x3e in doHint out of if condition");d=new CTATSAI(b,h,null);d=new CTATExampleTracerEvent(r,d,g);d.setHintRequest(!0);d.setWantReportableHints(!0);d.setMsgToRestore(a);r.ctatdebug("CTATExampleTracerTracer --\x3e in doHint result: "+
d);"example"===J?(P.doHint(d),a=B(d,c,a)):a=L.doHint(d,c,B.bind(r,d,c,a))?d:null;return a}function q(a,b,c){var d={tutorAdvice:null,msg:null,msgType:null};d.tutorAdvice=a.getSuccessOrBuggyMsg();d.tutorAdvice&&d.tutorAdvice.length&&d.tutorAdvice[0]?(d.msg=c.createBuggyMessage(a.getTransactionID(),d.tutorAdvice),d.msgType="BuggyMessage"):d.tutorAdvice=null;if(a.isBuggyResult())return d;r.ctatdebug("CTATET.createBuggyMessage() past getReportableLink()");if(a.isDoneStepFailed())return d.tutorAdvice=CTATMsgType.NOT_DONE_MSG,
d.msg=c.createBuggyMessage(a.getTransactionID(),d.tutorAdvice),d.msgType="BuggyMessage",d;r.ctatdebug("CTATET.createBuggyMessage() past isDoneStepFailed()");var e=b&&b.getTutorSAI()?b.getTutorSAI().getSelection():null,e=e&&""!==e.trim()?e:null,f=a.getStudentSAI()?a.getStudentSAI().getSelection():null,f=f&&""!==f.trim()?f:null;r.ctatdebug("CTATET.createBuggyMessage() past hintSelection0 "+e+", studentSelection0 "+f);if(a.getResult()==CTATExampleTracerLink.NO_MODEL&&a.isOutOfOrder()&&e&&e!=f)return r.ctatdebug("CTATET.createBuggyMessage() to create out of order"),
r.isHighlightRightSelection()?(d.tutorAdvice=r.getOutOfOrderMessage(),d.msg=c.createHighlightWidgetMessage(e,b.getTutorSAI().getAction(),d.tutorAdvice,a.getTransactionID()),d.msgType="HighlightMsg",r.ctatdebug("createBuggyMessage() out of order with highlight; rtn: "+d)):(d.tutorAdvice=CTATGlobals.languageManager.getString("OUTOFORDER"),d.msg=c.createBuggyMessage(a.getTransactionID,d.tutorAdvice),d.msgType="BuggyMessage",r.ctatdebug("createBuggyMessage() out of order without highlight; rtn: "+d)),
d;if(b="example"===J?z.getDefaultBuggyMsg():L.getDefaultBuggyMsg())return d.tutorAdvice=b,d.msg=c.createBuggyMessage(a.getTransactionID,d.tutorAdvice),d.msgType="BuggyMessage",r.ctatdebug("createBuggyMessage() default buggy msg: "+d),d;r.ctatdebug("createBuggyMessage() no buggy msg: "+d);return d}function u(a,b,c,d){r.ctatdebug("checkForTutorAction("+a+", "+b+", "+c+", "+d+")");var e=[];e[0]=v(z.getNode(a),!0);e[1]=v(z.getNode(b),!1);r.ctatdebug("checkForTutorAction() links[0] "+e[0]+", links[1] "+
e[1]+";");a=0;e[0]===e[1]?e[1]=null:e[0]||(a=1);b=null;r.messageTank||(r.messageTank=new CTATMessageTank(r,null));for(;a<e.length&&e[a];++a)if(b=CTATGuid.guid(),c){var f=e[a].getEvaluatedInput(c,d.getReportableVariableTable()),g=e[a].getDefaultSAI().clone();g.setInput(f);b=C("example",[e[a],g,e[a].getActor(),!0,b])}else b=C("example",[e[a],e[a].getDefaultSAI(),e[a].getActor(),!0,b]);r.ctatdebug("checkForTutorAction() returning "+b+";");return b}function v(a,b){if(null===a||"undefined"===typeof a||
1!==a.getCorrectOutDegree())return null;var c=null;a.getCorrectOutLinks().forEach(function(a){null===c&&a.isTutorPerformed(b)&&0<a.getMaxTraversals()&&(c=a)});return c}function w(a){for(var b=0;b<arguments.length;++b);for(var b={},c=0;c<arguments.length;++c){var d=arguments[c];"object"==typeof d?Object.assign(b,d):b["cf"+c]=d}return b}function B(a,b,c){var d=a.getReportableHints();if(!d||1>d.length)d=[],d.push(CTATGlobals.languageManager.getString("NO_HINT_AVAILABLE"));var e=a.getAssociatedSkills()||
[],f=a.getStepID(),g=a.getMsgToRestore();ga.appendToProblemState(g,a.getResult(),r.getOutputStatus(),CTATMsgType.getProperty(g,"saveForRestore"));r.updateSkills(CTATExampleTracerSkill.HINT,e,f,a.getActor());r.ctatdebug("Before building hint message: tutorSAI "+a.getTutorSAI()+", hints "+d+", edge # "+f);e=(new CTATTutorMessageBuilder).createHintMessage(d,a.getTutorSAI(),f,b);r.messageTank.addToMessageTank(CTATMsgType.SHOW_HINTS_MESSAGE,e,a,null);b=(new CTATTutorMessageBuilder).createAssociatedRulesMessageForHint(d,
a.getTutorSAI(),E(a.getActor()||CTATMsgType.DEFAULT_STUDENT_ACTOR),r.getSkillBarVector(!0),f,b,w(a.getCustomFields(),{rules:a.getAssociatedRules()}));r.messageTank.addToMessageTank(CTATMsgType.ASSOCIATED_RULES,b,a,null);b=r.getProblemSummary(a.getReportableInterpretation());r.messageTank.flushMessageTank(b,!0);r.lastResult=a;r.ctatdebug("handleInterfaceAction() sent hint result "+a);X=null;F(c);r.restartWorking();return a}function C(a,b){r.ctatdebug("doNewTrace ( "+a+", "+b+" )");var c=b.shift(),
d=b.shift(),e=b.shift(),f=b.shift(),g=b.shift(),h=b.shift(),l=new CTATExampleTracerEvent(r,d,e),m=g;r.startSkillTransaction();g=function(){l.setTransactionID(m);var c=l.getMsgToRestore();if(c){var g=CTATMsgType.getProperty(c,"saveForRestore");if(/^student$/i.test(String(e))||g)r.isFeedbackSuppressed()?ga.replaceInProblemState(c,l.getResult(),r.getOutputStatus(),l.getStudentSAI(),r.getFeedbackPolicy()==CTATMsgType.HIDE_BUT_ENFORCE,g):ga.appendToProblemState(c,l.getResult(),r.getOutputStatus(),g)}g=
D(l,d,e,f);r.ctatdebug("doNewTrace( "+a+", "+b+" ) returns "+g);F(c);r.restartWorking();return g};switch(a){case "example":return m=G(c,l,h,m),l.getResult()==CTATExampleTracerLink.NO_MODEL&&r.getDemonstrateMode()&&(c=r.getTracer().addDemonstratedLink(l.getStudentSAI()),r.getTracer().replay(),m=G(c,l,h,m)),g();case "rule":return f=!1,H(l,h,g)}return null}function F(a){if(ba){var b={stepNumber:r.restoreIndex-1};if(/<MessageType>InterfaceAction<.MessageType>/i.test(a)){a=b;var c=r.lastResult,d;if(d=
c.getStudentSAI())a.selection=d.getSelection(),a.action=d.getAction(),a.input=d.getInput();if(d=c.getTutorSAI())a.tutor_selection=d.getSelection(),a.tutor_action=d.getAction(),a.tutor_input=d.getInput();/hint/i.test(a.result=c.getResult())?a.tutor_advice=c.getReportableHints():a.tutor_advice=c.getSuccessOrBuggyMsg();a.skills=c.getAssociatedSkills()}else/<MessageType>UntutoredAction<.MessageType>/i.test(a)?(b.selection=CTATMsgType.getProperty(a,"Selection"),b.action=CTATMsgType.getProperty(a,"Action"),
b.input=CTATMsgType.getProperty(a,"Input")):b=null;b&&parent.postMessage({command:"restoredStep",data:b},location.origin)}}function G(a,b,c,d){r.ctatdebug("doNewExampleTrace (link "+a+", result "+b+", origMsgTxt "+c+", transactionID "+d);a&&b.addPreloadedLinkMatch(a);var e=P.evaluate(b);r.ctatdebug("Evaluate returned : "+e+", given link "+a+", result "+b);a?(r.ctatdebug("result.getTutorSelection() "+b.getTutorSelection()),r.ctatdebug("result.getTutorAction() "+b.getTutorAction()),r.ctatdebug("result.getTutorInput() "+
b.getTutorInput()),r.ctatdebug("typeof(messageTank) "+typeof messageTank),a=b.getTutorSelection(),c=b.getTutorAction(),b=b.getTutorInput(),d=r.messageTank.enqueueToolActionToStudent(a,c,b,CTATTutorMessageBuilder.TUTOR_PERFORMED)):b.setMsgToRestore(c);return d}function H(a,b,c){r.ctatdebug("DoNewRuleTrace( "+a+", "+b+" )");a.setMsgToRestore(b);return L.evaluate(a,c)}function E(a){return"undefined"!=typeof a&&a&&0<=a.toString().toLowerCase().indexOf("tutor")?"Tutor":"Student"}function D(a,b,c,d){r.ctatdebug("finishNewExampleTrace("+
a+", "+b+", "+c+", "+d+")");var e=a.getStudentSAI(),f=a.getTutorSAI(),g=a.getTransactionID(),h=new CTATTutorMessageBuilder,l=a.getReportableLink()||null,m=null;b=a.getAssociatedSkills()||[];var n=function(){r.lastResult=a;r.getTracer()&&"function"==typeof r.getTracer().saveLastReport&&r.getTracer().saveLastReport(a);var b=r.getProblemSummary(a.getReportableInterpretation());r.ctatdebug("finishNewExampleTrace() to flushMessageTank");r.messageTank.flushMessageTank(b,!0);r.ctatdebug("finishNewExampleTrace() sent result "+
a.getResult()+",\n studentSAI "+e+",\n tutorSAI "+a.getTutorSAI()+",\n successOrBuggyMsg "+a.getSuccessOrBuggyMsg());return a};if(a.isSolverResult())return a.getResult(),n();if(a.getResult()===CTATExampleTracerLink.CORRECT_ACTION){CTATMsgType.UNGRADED_TOOL_ACTOR.toUpperCase()!=c.toUpperCase()&&r.messageTank.addToMessageTank(CTATMsgType.CORRECT_ACTION,h.createCorrectActionMessage(g,f),a,f);r.updateSkills(CTATExampleTracerSkill.CORRECT,b,a.getStepID(),c);b=a.getSuccessOrBuggyMsg();var p=h.createAssociatedRulesMessageForAction(a.getResult(),
f,E(c),e,r.getSkillBarVector(!0,c),l?l.getUniqueID():a.getStepID(),g,b,a.isOutOfOrder(),w(a.getCustomFields(),{rules:a.getAssociatedRules()}),a.getTraceOutcome(),a.getBuggyStepID());r.messageTank.addToMessageTank(CTATMsgType.ASSOCIATED_RULES,p,a,f);r.ctatdebug("finishNewExampleTrace() successMsg "+b);b&&b.length&&b[0]&&r.messageTank.addToMessageTank("SuccessMessage",h.createSuccessMessage(g,b),a,null);X=null;d&&(m=u(l?l.getNextNode():null,P.findCurrentState(!1,!1),r.lastMessage?r.lastMessage.getSAI():
null,a))&&(a=m);return n()}r.messageTank.addToMessageTank(CTATMsgType.INCORRECT_ACTION,h.createInCorrectActionMessage(g,a.getInterpolatedSAI()),a,null);r.ctatdebug("about to do silent traceForHint("+e+"), selectionArray "+e.getSelectionArray());var v=r.lastSilentHintResult=new CTATExampleTracerEvent(r,e,c);v.setHintRequest(!0);b=function(){var b=a.getAssociatedSkills()||[],p=a.getStepID()||"";r.updateSkills(CTATExampleTracerSkill.INCORRECT,b,p,c);f=a.getTutorSAI();b=q(a,v,h);r.ctatdebug("createBuggyMessage() tutorAdvice: "+
b.tutorAdvice+";\n  msg "+b.msg);p=h.createAssociatedRulesMessageForAction(a.getResult(),f&&f.getSelection()?f:e,E(c),e,r.getSkillBarVector(!0,c),p,g,b.tutorAdvice,a.isOutOfOrder(),a.getCustomFields(),a.getTraceOutcome(),a.getBuggyStepID());r.messageTank.addToMessageTank(CTATMsgType.ASSOCIATED_RULES,p,a,null);b.msg&&r.messageTank.addToMessageTank(b.msgType,b.msg,a);X=e;d&&CTATExampleTracerLink.FIREABLE_BUGGY_ACTION==a.getResult()?(m=u(l?l.getNextNode():null,P.findCurrentState(!1,!1),r.lastMessage?
r.lastMessage.getSAI():null,a))&&(a=m):a.isDoneStepFailed()&&r.messageTank.flushDelayedFeedback();return n()};if("example"===J)return K(a,v),b();"rule"===J&&(a.setCustomFields(w(a.getCustomFields(),{rules:a.getAssociatedRules()})),b())}function K(a,b){var c=P.traceForHint(b);r.ctatdebug("silent hint result: "+b+"; hintLink "+c);c||(c=P.getBestNextLink(!1,b),r.ctatdebug("getBestNextLink result: "+b+"; hintLink "+c));c&&((c=b.getTutorSAI())&&c.getSelection()&&a.setTutorSAI(c),a.setStepID(b.getStepID()),
a.setAssociatedSkills(b.getAssociatedSkills()),a.setReportableInterpretation(b.getReportableInterpretation()))}CTATBase.call(this,"CTATExampleTracer","tracer");var J=null,r=this,I=null,A=null,P=null,L,N=null,R=null,Q,z,T=new CTATXML;new XMLSerializer;var X=null,S=CTATHintPolicyEnum.DEFAULT,V=!0,U=!1,ea=CTATMsgType.SHOW_ALL_FEEDBACK,Y=null,ra=null,la=null,ga=new ProblemStateSaver(r);ga.setAuthenticityToken(CTATCommLibrary.getAuthenticityToken());var da=null,ba=1,W=new CTATProblemStateStatus,ca=[],
ma=[],na=0,za="",qa=-1,oa=null;this.logger=new CTATLogger(["load","restore","queue","skills"]);this.log=r.logger.log;r.ctatdebug("CTATExampleTracer constructor outputStatus="+W);this.messageTank=this.lastSilentHintResult=this.lastResult=this.lastMessage=this.lastMessageAsXML=this.lastMessageAsString=null;this.timer=-1;this.restoreInterval=0;this.restoreStep=Number.parseInt(CTATConfiguration.get("restore_step")||"-1")+1;var Aa=new CTATCommLibrary(null,!Number(CTATConfiguration.get("restore_interval")));
this.receiveFromInterface=function(a){r.log("queue","CTATExampleTracer.receiveFromInterface() \n  "+a);/<MessageType>SetPreferences<.MessageType>/i.test(a)?(ba=1,ca.push(a)):ma.push(a);h()};this.setVariablesFromSAI=function(a,b){a=CTATMsgType.getSAIArraysFromElement(a,b);switch(J){case "example":r.getTracer()&&r.getTracer().addInterfaceVariables(a.selection,a.input);break;case "rule":L.handleUntutoredAction(a)}};this.traceLinks=function(a){for(var b=[],c=r.getTracer().getBestInterpretation(),d=0;d<
a.length&&null!==a[d];++d)c.getTraversalCount(a[d])<a[d].getMinTraversals()&&(r.messageTank=new CTATMessageTank(r,null),b.push(C("example",[a[d],a[d].getDefaultSAI(),a[d].getActor(),!1,null])),r.ctatdebug("traceLinks["+d+"] result "+b[d]));return b};this.enqueueForRestore=function(a){r.ctatdebug("enqueueForRestore() tracerReady "+f()+": got "+(a?a.length:-1)+" message elements");null==R&&null!=a&&(R=a);null!=R&&(ca=ca.concat(R),R=null,a=(new CTATTutorMessageBuilder).createMessage(CTATMsgType.PROBLEM_RESTORE_END,
null),ca.push(a),ba=1,f()&&r.startWorking())};this.restartWorking=function(){"rule"===J&&g(ba,!1)};this.startWorking=function(){g(ba,!1)};this.stopWorking=function(a){g("undefined"!=typeof a?a:ba,!0)};this.insertFreeze=function(a){var b=CTATConfiguration.get("freeze_restore");console.log("ET.insertFreeze(length "+a.length+") freezeAfterN",b);null!=b&&!1!==b&&"false"!==b&&(Number.isInteger(b=Number(b))||(b=1),CTATConfiguration.set("freeze_restore",!1),b<a.length&&(a[b]=CTATMsgType.setProperty(a[b],
"freezeHere","default")))};this.restoreIndex=0;this.loadProblemFile=function(a){return a?new Promise(function(b,c){Aa.retrieveProblemFile(a,T,r,b,c)}):Promise.reject(Error("no questionFile specified"))};this.goToStartState=function(){var a=z.getStudentStartsHereNode()||z.getStartNode();a?r.goToState(a.getNodeName()):console.trace("goToStartState() did not find start node")};this.goToState=function(a){a=(a=z.findNode(a))?a.getNodeID():-1;0<a&&r.receiveFromInterface("<message><verb>NotePropertySet</verb><properties><MessageType>"+
CTATMsgType.GO_TO_STATE+"</MessageType><nodeID>"+a+"</nodeID></properties></message>")};this.loadGraphFromString=function(a,b,c){try{var d=(new CTATXML).parseXML(a);return r.processXML(d,b,c)}catch(fa){return"function"==typeof c?c(fa):fa}};this.processXML=function(c,d,f){if(null==c)return r.startWorking(),c=Error("empty or invalid XML document"),"function"==typeof f?f(c):c;J="example";r.ctatdebug("processXML (), tutorType = "+J);r.ctatdebug("No of children"+T.getElementChildren(c).length);var g=(new CTATGraphParser).parseGraph(c,
r);z=g.gr;P=g.tracer;f=g.ssm;a&&(f=z.convertStartStateToTPAs(g.ssm,T));var g=g.sgMsg,h=z.getLockWidget();r.ctatdebug("sendStartStateMessages() nMsgs "+f.length+", outputStatus "+W);for(var l=[],m=new XMLSerializer,n=null,p=null,q=0;q<f.length;q++)if("message"==T.getElementName(f[q])){var v=m.serializeToString(f[q]),w=CTATMsgType.getMessageType(v);if(CTATMsgType.SEND_WIDGET_LOCK==w)p=v;else{if(CTATMsgType.UNTUTORED_ACTION==w||CTATMsgType.INTERFACE_ACTION==w)r.setVariablesFromSAI(f[q],T);else if(CTATMsgType.START_STATE_END==
w){e(l);n=v;l.push((new CTATTutoringServiceMessageBuilder).createInterfaceConfigurationEnd());continue}l.push(v)}}p&&console.log("CTATExampleTracer.sendStartStateMessages(lockWidget="+h+") to replace SendWidgetLock",swlMag);p=(new CTATTutorMessageBuilder).createLockWidgetMsg(h);l.unshift(p);l.unshift(g);b(l);f=n;a:{g=[];h=z.getStartNode();l=CTATMsgType.START_STATE_END;m=h.getNodeID();n=null;p=qa;qa=-1;0>p&&(p=(p=z?z.getStudentStartsHereNode():null)?p.getNodeID():m);console.log("CTATExampleTracer.resetGoToState to transition1 destNodeID",
p,"noopNodeID",m);p==m?W.transition(l,null):0<p&&((n=z.getNode(p))||console.log("CTATExampleTracer.resetGoToState to transition2 no destNode for destNodeID",p));r.ctatdebug("CTATET.resetGoToState("+l+", null, "+m+") returns "+n);l=n;if(null!==h&&null!==l&&h.getNodeID()!=l.getNodeID()){g=z.getBestSubpath(h,l);r.ctatdebug("advanceToStudentStartsHere() path "+g);if(!g)break a;g=g.getSortedLinks();g=r.traceLinks(g);r.ctatdebug("advanceToStudentStartsHere() results "+g)}l=h=null;0<g.length&&(l=g[g.length-
1],g=l.getReportableLink(),null!==g&&(h=g.getNextNode()));r.ctatdebug("advanceToStudentStartsHere() to check for TPA "+h+", "+l);u(h,P.findCurrentState(!1,!1),null,l)}g=[];f&&g.push(f);W.canRestore()||g.push((new CTATTutorMessageBuilder).createMessage(CTATMsgType.PROBLEM_RESTORE_END,null));0<g.length&&r.sendBundle(g);P.setModelInitialized(!0);r.startWorking();return"function"==typeof d?d(c):c};this.processNools=function(a,c,d){var f=new CTATTutorMessageBuilder;J="rule";L=new CTATRuleTracer("nools",
r);L.initEngine(a,function(d,g){r.ctatdebug("nools engine compiled");var h;N=g;h=new CTATTutorMessageBuilder;var l=g.suppressStudentFeedback;if(null===l||void 0===l)l=CTATMsgType.SHOW_ALL_FEEDBACK;r.setFeedbackSuppressed(l);var m="false"!=g.highlightRightSelection,n=g.confirmDone;r.setConfirmDone("true"===n?!0:"false"===n?!1:l===CTATMsgType.HIDE_ALL_FEEDBACK);l=g.lockWidget;r.setHintPolicy(g.hintPolicy);r.setOutOfOrderMessage(g.outOfOrderMessage);h=h.createStateGraphMessage("false","false",l,r.isFeedbackSuppressed(),
m,String(r.getConfirmDone()),r.getSkillBarVector(!1,!0));m=[];e(d);d.push((new CTATTutoringServiceMessageBuilder).createInterfaceConfigurationEnd());d.unshift(f.createLockWidgetMsg(g.lockWidget));d.unshift(h);b(d);m.push("<message><verb>SendNoteProperty</verb><properties><MessageType>StartStateEnd</MessageType></properties></message>");W.canRestore()||m.push(f.createMessage(CTATMsgType.PROBLEM_RESTORE_END,null));r.sendBundle(m);r.enqueueForRestore();r.startWorking();"function"==typeof c&&c(a)},function(a){console.log("error starting nools engine: "+
a);if("function"==typeof d)return d(a)})};this.handleProblemSummaryRequest=function(a){r.ctatdebug("CTATExampleTracer.ProblemSummaryRequest getProblemSummary() "+r.getProblemSummary());var b="<message><verb>NotePropertySet</verb><properties><MessageType>"+CTATMsgType.PROBLEM_SUMMARY_RESPONSE+"</MessageType>",b=b+SCORMProblemSummary.getProblemSummaryElements(a),b=b+("<ProblemSummary>"+a.toXML(!0)+"</ProblemSummary>"),b=b+("<ProblemSummaryJSON><![CDATA["+a.toJSONforTutorshop()+"]]\x3e</ProblemSummaryJSON>"),
b=b+"<end_of_transaction>true</end_of_transaction></properties></message>",c=[];c.push(b);r.sendBundle(c);W.transition(CTATMsgType.PROBLEM_SUMMARY_RESPONSE,a.getCompletionStatus());r.ctatdebug("CTATExampleTracer.handleProblemSummaryRequest() sent result '"+b+"';")};this.setConfirmDone=function(a){V=a};this.getConfirmDone=function(){return V};this.addSkillsFromProblemFile=function(a){var b=r.getProblemSummary().getSkills()&&r.getProblemSummary().getSkills().getExternallyDefined();r.log("skills","adding skills from problem file, maybe: count, externallyDefined",
a.length,b);!b&&0<a.length&&(a=new CTATSkills(a),a.setExternallyDefined(!1),r.getProblemSummary().setSkills(a))};this.getGraphSkills=function(){var a=r.getProblemSummary().getSkills();return a?a.getAllSkills():[]};this.sendBundle=function(a){r.ctatdebug("sending bundle #msgs = "+a.length+", outputStatus "+W);for(var b=0,c=0;c<a.length;c++){r.ctatdebug("Sending message #"+c);var d=a[c];0>=c&&(d='<?xml version="1.0" encoding="UTF-8"?>'+d);ga.forwardToInterface(d,c>=a.length-1,W)&&++b}return 0<b};this.getHintPolicy=
function(){return S};this.setHintPolicy=function(a){S=CTATHintPolicyEnum.lookup(a)};this.isHighlightRightSelection=function(){var a=null;switch(J){case "example":a=r.getGraph()&&r.getGraph().isHighlightRightSelection();break;case "rule":a="false"!=N.highlightRightSelection}return null==a?!0:a};this.updateSkills=function(a,b,c,d){var e=[];r.log("skills","in updateSkills("+b+") with step ID = "+c+", transaction result = "+a+", outputStatus "+r.getOutputStatus()+", ocountForProblemSummary "+r.getOutputStatus().countForProblemSummary()+
", actor "+d);if(!r.getOutputStatus().countForProblemSummary()||d&&!/^(student)?$/i.test(d))return e;var f=r.getProblemSummary().getSkills();if(!f)return e;b.forEach(function(b){var d=f.updateSkill(a,b,c);r.log("skills","updateSkill("+b+") returns "+(d?d.getSkillBarString(!0):null));d&&e.push(d)});return e};this.getSessionID=function(){return za};this.getProblemSummary=function(a){r.ctatdebug("Entering getProblemSummary() problemSummary "+Y);if(null===Y||"undefined"===typeof Y){var b=r.getProblemName();
Y=null===b||"undefined"===typeof b||1>b.length?new CTATProblemSummary("NoProblemDefined",null,r.isFeedbackSuppressed()):new CTATProblemSummary(b,null,r.isFeedbackSuppressed())}a&&Y.setRequiredSteps(a.countStepsForScore(z));return Y};this.getProblemName=function(){return ra};this.getSourceID=function(){return la};this.isSourceFlash=function(){return"string"==typeof la&&la.match(/flash/i)};this.isFeedbackSuppressed=function(){return U};this.setFeedbackSuppressed=function(a){ea=a;"false"===a?(U=!1,ea=
CTATMsgType.SHOW_ALL_FEEDBACK):"true"===a?(U=!0,ea=CTATMsgType.HIDE_ALL_FEEDBACK):U=a===CTATMsgType.SHOW_ALL_FEEDBACK?!1:a===CTATMsgType.HIDE_ALL_FEEDBACK?!0:a===CTATMsgType.HIDE_BUT_ENFORCE?!0:a===CTATMsgType.HIDE_BUT_COMPLETE?!0:!1;r.ctatdebug("setFeedbackSuppressed("+a+"): "+U);Y&&Y.setCountOnlyLastResults(U)};this.getSkillBarVector=function(a,b){var c=r.getProblemSummary().getSkills();return null===c||"undefined"===typeof c?null:"Student"!=E(b)?null:"undefined"!=typeof a&&a?c.getSkillBarVector(!1,
!1):c.getSkillBarVector(!0,!0)};this.startSkillTransaction=function(){var a=r.getProblemSummary().getSkills();a&&a.startTransaction()};this.getProblemStateSaver=function(){return ga};this.isSendingSavedMsgsForRestore=function(){return r.getOutputStatus().isSendingSavedMsgsForRestore()};this.getOutputStatus=function(){return W};this.setOutputStatus=function(a){var b=W.getStatus();r.ctatdebug("setOutputStatus() old "+b+", new "+a);CTATProblemStateStatus[a]?W.setStatus(CTATProblemStateStatus[a]):(console.error("CTATExampleTracer.setOutputStatus() unexpected argument "+
a),W.setStatus(CTATProblemStateStatus.empty))};this.getFeedbackPolicy=function(){return z?z.getFeedbackPolicy():ea?ea:CTATMsgType.SHOW_ALL_FEEDBACK};this.getGraph=function(){return z};this.getTracer=function(){return P};this.getRuleTracer=function(){return L};this.getOutOfOrderMessage=function(){return Q?Q:CTATMsgType.DEFAULT_OUT_OF_ORDER_MESSAGE};this.setOutOfOrderMessage=function(a){Q=a};this.getDelayedFeedback=function(){null==oa&&(oa={});return oa};this.clearDelayedFeedback=function(){oa=null};
this.getDemonstrateMode=function(){return P&&P.isDemonstrateMode()};this.setDemonstrateMode=function(a){P&&P.setMode(a?"demonstrate":"")};this.getInitialValuesDemonstrateMode=function(){return P&&P.isInitialValuesDemonstrateMode()};this.setInitialValuesDemonstrateMode=function(a,b,c,d){a&&b&&r.loadGraphFromString(r.getGraph().toXML(r),c||function(a){return console.log("reload after setInitialValuesDemonstrate",a)||a},d||function(a){return console.log("error loading after setInitialValuesDemonstrate",
a)||a});P&&P.setMode(a?"initialValuesDemonstrate":"")};this.getCurrentState=function(){return P&&P.getCurrentState()};this.getQuestionFile=function(a){if(!I||a)return I;a=I.split("/");return a[a.length-1]};this.addTPAToMessageTank=function(a,b,c,d){r.messageTank.enqueueToolActionToStudent(a,b,c,d)};this.resumeRestore=function(a){r.advanceToStep(0,a)};this.nextRestoreStep=function(a,b){r.advanceToStep(r.restoreIndex+(a||1),b)};this.advanceToStep=function(a,b){r.restoreStep=a<=r.restoreIndex?0:a;clearTimeout(r.timer);
r.timer=0;Number.isInteger(b=Number.parseInt(b))&&(r.restoreInterval=b,CTATConfiguration.set("restore_interval",""+b));h()};this.freezeRestore=function(a){a=Number(a)||2147483647;clearTimeout(r.timer);r.timer=setTimeout(function(){r.log("restore","***freezeRestore waited "+a+" ms; restoreQueue.length "+ca.length+", index "+r.restoreIndex);clearTimeout(r.timer);r.timer=0;h()},a);return r.timer};this.getRestoreQueue=function(){return ca}};CTATExampleTracer.prototype=Object.create(CTATBase.prototype);
CTATExampleTracer.prototype.constructor=CTATExampleTracer;"undefined"!==typeof module&&(module.exports=CTATExampleTracer);
